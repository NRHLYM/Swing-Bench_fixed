{"problem_statement": "Functionality of cmd.exe \"color\" command broken since 1.22\n### Windows Terminal version\n\n1.22.10731.0\n\n### Windows build number\n\n10.0.26100.3624\n\n### Other Software\n\nNew history list (F7) implementation changes the default text/background colors of console and does not restore them back on close. Probably, introduced in #17445.\n\n### Steps to reproduce\n\n* Run command prompt (cmd.exe) in Terminal\n* Type `help` command. Help will be displayed.\n* Type `color E0` command. Colors of text and background will change,\n* Type `help` command again. Help will be displayed with new color. You can type other commands, they will also produce output using new colors.\n* Press F7, select `help` command from the list and press Enter, Help will be displayed with **original** color that was active before the `color E0` command was executed. All subsequent commands will also use this color.\n\n\n### Expected Behavior\n\nColor change made by `color E0` command will remain active after history usage,\n\n### Actual Behavior\n\nResult of `color E0` command is reverted by F7 implementation,\n", "patch": "diff --git a/src/host/readDataCooked.cpp b/src/host/readDataCooked.cpp\nindex 8b88f2d4a38..ea086b12301 100644\n--- a/src/host/readDataCooked.cpp\n+++ b/src/host/readDataCooked.cpp\n@@ -1119,12 +1119,33 @@ void COOKED_READ_DATA::_redisplay()\n         output.append(L\"\\x1b[J\");\r\n     }\r\n \r\n-    // Disable the cursor when opening a popup, reenable it when closing them.\r\n+    // Backup the attributes (DECSC) and disable the cursor when opening a popup (DECTCEM).\r\n+    // Restore the attributes (DECRC) reenable the cursor when closing them (DECTCEM).\r\n     if (const auto popupOpened = !_popups.empty(); _popupOpened != popupOpened)\r\n     {\r\n-        wchar_t buf[] = L\"\\x1b[?25l\";\r\n-        buf[5] = popupOpened ? 'l' : 'h';\r\n-        output.append(&buf[0], 6);\r\n+        wchar_t buf[] =\r\n+            // Back/restore cursor position & attributes (commonly supported)\r\n+            L\"\\u001b7\"\r\n+            // Show/hide cursor (commonly supported)\r\n+            \"\\u001b[?25l\"\r\n+            // The popup code uses XTPUSHSGR (CSI # {) / XTPOPSGR (CSI # }) to draw the popups in the popup-colors,\r\n+            // while properly restoring the previous VT attributes. On terminals that support them, the following\r\n+            // won't do anything. On other terminals however, it'll reset the attributes to default.\r\n+            // This is important as the first thing the popup drawing code uses CSI K to erase the previous contents\r\n+            // and CSI m to reset the attributes on terminals that don't support XTPUSHSGR/XTPOPSGR. In order for\r\n+            // the first CSI K to behave as if there had a previous CSI m, we must emit an initial CSI m here.\r\n+            // (rarely supported)\r\n+            \"\\x1b[#{\\x1b[m\\x1b[#}\";\r\n+\r\n+        buf[1] = popupOpened ? '7' : '8';\r\n+        buf[7] = popupOpened ? 'l' : 'h';\r\n+\r\n+        // When the popup closes we skip the XTPUSHSGR/XTPOPSGR sequence. This is crucial because we\r\n+        // use DECRC to restore the cursor position and attributes with a widely supported sequence.\r\n+        // If we emitted that XTPUSHSGR/XTPOPSGR sequence it would reset the attributes again.\r\n+        const size_t len = popupOpened ? 19 : 8;\r\n+\r\n+        output.append(buf, len);\r\n         _popupOpened = popupOpened;\r\n     }\r\n \r\n@@ -1595,10 +1616,10 @@ void COOKED_READ_DATA::_popupDrawPrompt(std::vector<Line>& lines, const til::Coo\n     str.append(suffix);\r\n \r\n     std::wstring line;\r\n-    line.append(L\"\\x1b[K\");\r\n+    line.append(L\"\\x1b[#{\\x1b[K\");\r\n     _appendPopupAttr(line);\r\n     const auto res = _layoutLine(line, str, 0, 0, width);\r\n-    line.append(L\"\\x1b[m\");\r\n+    line.append(L\"\\x1b[m\\x1b[#}\");\r\n \r\n     lines.emplace_back(std::move(line), 0, 0, res.column);\r\n }\r\n@@ -1654,7 +1675,7 @@ void COOKED_READ_DATA::_popupDrawCommandList(std::vector<Line>& lines, const til\n         const auto selected = index == cl.selected && !stackedCommandNumberPopup;\r\n \r\n         std::wstring line;\r\n-        line.append(L\"\\x1b[K\");\r\n+        line.append(L\"\\x1b[#{\\x1b[K\");\r\n         _appendPopupAttr(line);\r\n \r\n         wchar_t scrollbarChar = L' ';\r\n@@ -1681,7 +1702,7 @@ void COOKED_READ_DATA::_popupDrawCommandList(std::vector<Line>& lines, const til\n         }\r\n         else\r\n         {\r\n-            line.append(L\"\\x1b[m \");\r\n+            line.append(L\"\\x1b[m\\x1b[#} \");\r\n         }\r\n \r\n         fmt::format_to(std::back_inserter(line), FMT_COMPILE(L\"{:{}}: \"), index, indexWidth);\r\n@@ -1690,7 +1711,7 @@ void COOKED_READ_DATA::_popupDrawCommandList(std::vector<Line>& lines, const til\n \r\n         if (selected)\r\n         {\r\n-            line.append(L\"\\x1b[m\");\r\n+            line.append(L\"\\x1b[m\\x1b[#}\");\r\n         }\r\n \r\n         line.append(L\"\\r\\n\");\r\n", "instance_id": "microsoft__terminal-18797", "clarity": 2, "difficulty": 0.65, "clarity_explanation": "The problem statement is mostly clear in describing the issue: the `color` command in `cmd.exe` within Windows Terminal reverts to original colors after using the F7 history feature, which is not the expected behavior. It provides specific steps to reproduce the issue, expected behavior, and actual behavior, which helps in understanding the problem. However, there are minor ambiguities and missing details. For instance, it does not explicitly mention whether this issue affects only specific color codes or all color changes, nor does it discuss potential edge cases like multiple color changes or interactions with other terminal features. Additionally, while it references a likely cause (a change introduced in a specific PR), it lacks deeper technical context about the terminal's color handling mechanism or the F7 history implementation. Overall, the statement is valid and clear but could benefit from more comprehensive details on constraints and edge cases.", "difficulty_explanation": "The difficulty of this problem falls into the \"Hard\" category due to several factors. First, the scope of code changes is relatively focused, primarily within a single file (`readDataCooked.cpp`), but the modifications involve intricate handling of terminal escape sequences and attribute management (e.g., cursor visibility, color attributes). This requires a deep understanding of terminal emulation and VT (Virtual Terminal) sequences, which are niche and complex concepts. Second, the changes impact how popups (like the F7 history list) interact with terminal state, specifically color attributes, which suggests a need to understand the broader terminal rendering logic and state management. Third, the number of technical concepts involved is significant, including terminal escape codes (e.g., DECSC/DECRC for saving/restoring cursor and attributes, XTPUSHSGR/XTPOPSGR for attribute stacking), terminal popup rendering, and attribute restoration logic. These are advanced topics that require specific domain knowledge of terminal emulation. Finally, while the problem statement does not explicitly mention edge cases, the code changes imply potential complexities in ensuring that color attributes are consistently preserved across various terminal states and interactions (e.g., nested popups, multiple color changes). The solution also involves careful sequencing of escape codes to avoid unintended resets, adding to the intricacy. Overall, this problem requires a solid grasp of terminal internals and careful modification of state management logic, justifying a difficulty score of 0.65, on the lower end of the \"Hard\" range due to the focused scope of changes but still reflecting the technical depth required.", "clarity_label": -1, "difficulty_label": -1, "human_clarity": -1, "human_difficulty": -1}
{"problem_statement": "Request: \"Select color scheme...\" mouse-hover should provide color-scheme preview\n### Description of the new feature\n\nThis is a tiny quality-of-life improvement request:\n\nCTRL + SHIFT + P   ----> \"Select color scheme...\"\n\nWe see now see a dropdown of all our color schemes.\nThe UP and DOWN arrows trigger a preview of the highlighted color-scheme.\nBut hovering the mouse over a color-scheme ...only results in a 'gentle highlight', no preview.\n\nMy request: hovering over a color-scheme should also trigger a preview in the current tab.\n\nThis may seem trivial, but it would be much appreciated.\n\n\n### Proposed technical implementation details\n\n_No response_\n", "patch": "diff --git a/src/cascadia/TerminalApp/CommandPalette.cpp b/src/cascadia/TerminalApp/CommandPalette.cpp\nindex bcee25c72dd..6d5540703fc 100644\n--- a/src/cascadia/TerminalApp/CommandPalette.cpp\n+++ b/src/cascadia/TerminalApp/CommandPalette.cpp\n@@ -530,6 +530,79 @@ namespace winrt::TerminalApp::implementation\n         }\n     }\n \n+    // Method Description:\n+    // - This event is called when the user's mouse pointer enters an individual\n+    //   item from the list. We'll get the item that was hovered and \"preview\"\n+    //   the command that the user hovered. To do that, we'll dispatch the switch\n+    //   to tab command for this tab, but not dismiss the switcher.\n+    //\n+    // Arguments:\n+    // - sender: the UI element that raised the event.\n+    // Return Value:\n+    // - <none>\n+    void CommandPalette::_listItemPointerEntered(const winrt::Windows::Foundation::IInspectable& sender,\n+                                                 const winrt::Windows::UI::Xaml::Input::PointerRoutedEventArgs& /*args*/)\n+    {\n+        // cancel any pending exit timer to prevent an unwanted preview revert\n+        if (_pointerExitTimer)\n+        {\n+            _pointerExitTimer.Stop();\n+        }\n+\n+        const auto listViewItem = sender.try_as<winrt::Windows::UI::Xaml::Controls::ListViewItem>();\n+        if (_currentMode == CommandPaletteMode::ActionMode && listViewItem)\n+        {\n+            const auto enteredItem = listViewItem.Content();\n+            if (const auto filteredCommand{ enteredItem.try_as<winrt::TerminalApp::FilteredCommand>() })\n+            {\n+                if (const auto actionPaletteItem{ filteredCommand.Item().try_as<winrt::TerminalApp::ActionPaletteItem>() })\n+                {\n+                    // immediately preview the hovered command\n+                    PreviewAction.raise(*this, actionPaletteItem.Command());\n+                }\n+            }\n+        }\n+    }\n+\n+    // Method Description:\n+    // - This event is called when the user's mouse pointer exits an individual\n+    //   item from the list. We then revert to previewing the selected item rather\n+    //   than the hovered one, using a short delay (via a DispatcherTimer) to smooth\n+    //   transitions when rapidly moving between items.\n+    //\n+    // Arguments:\n+    // - <none>\n+    // Return Value:\n+    // - <none>\n+    void CommandPalette::_listItemPointerExited(const winrt::Windows::Foundation::IInspectable& /*sender*/,\n+                                                const winrt::Windows::UI::Xaml::Input::PointerRoutedEventArgs& /*args*/)\n+    {\n+        // if there is no exit timer, create one\n+        if (!_pointerExitTimer)\n+        {\n+            _pointerExitTimer = winrt::Windows::UI::Xaml::DispatcherTimer();\n+            _pointerExitTimer.Interval(std::chrono::milliseconds(10));\n+            _pointerExitTimer.Tick([this](auto const&, auto const&) {\n+                // when the timer ticks, revert the preview to the selected command\n+                const auto selectedCommand = _filteredActionsView().SelectedItem();\n+                if (const auto filteredCommand{ selectedCommand.try_as<winrt::TerminalApp::FilteredCommand>() })\n+                {\n+                    if (_currentMode == CommandPaletteMode::ActionMode && filteredCommand)\n+                    {\n+                        if (const auto actionPaletteItem{ filteredCommand.Item().try_as<winrt::TerminalApp::ActionPaletteItem>() })\n+                        {\n+                            PreviewAction.raise(*this, actionPaletteItem.Command());\n+                        }\n+                    }\n+                }\n+                _pointerExitTimer.Stop();\n+            });\n+        }\n+\n+        // restart the timer\n+        _pointerExitTimer.Start();\n+    }\n+\n     void CommandPalette::_listItemSelectionChanged(const Windows::Foundation::IInspectable& /*sender*/, const Windows::UI::Xaml::Controls::SelectionChangedEventArgs& e)\n     {\n         // We don't care about...\n@@ -1214,6 +1287,9 @@ namespace winrt::TerminalApp::implementation\n \n         ParentCommandName(L\"\");\n         _currentNestedCommands.Clear();\n+\n+        // revert any preview\n+        _filteredActionsView().SelectedIndex(-1);\n         PreviewAction.raise(*this, nullptr);\n     }\n \n@@ -1306,6 +1382,10 @@ namespace winrt::TerminalApp::implementation\n         else\n         {\n             itemContainer.DataContext(args.Item());\n+\n+            // attach the pointer event handlers to the container\n+            itemContainer.PointerEntered({ this, &CommandPalette::_listItemPointerEntered });\n+            itemContainer.PointerExited({ this, &CommandPalette::_listItemPointerExited });\n         }\n     }\n \ndiff --git a/src/cascadia/TerminalApp/CommandPalette.h b/src/cascadia/TerminalApp/CommandPalette.h\nindex 58e34bb1f90..0da7ee13344 100644\n--- a/src/cascadia/TerminalApp/CommandPalette.h\n+++ b/src/cascadia/TerminalApp/CommandPalette.h\n@@ -78,6 +78,8 @@ namespace winrt::TerminalApp::implementation\n \n         Windows::Foundation::Collections::IVector<winrt::TerminalApp::FilteredCommand> _commandsToFilter();\n \n+        winrt::Windows::UI::Xaml::DispatcherTimer _pointerExitTimer{ nullptr }; // timer to debounce pointer exit events (used to smooth preview transitions)\n+\n         bool _lastFilterTextWasEmpty{ true };\n \n         void _populateCommands();\n@@ -103,6 +105,10 @@ namespace winrt::TerminalApp::implementation\n \n         void _listItemClicked(const Windows::Foundation::IInspectable& sender, const Windows::UI::Xaml::Controls::ItemClickEventArgs& e);\n \n+        void _listItemPointerEntered(const Windows::Foundation::IInspectable& sender, const Windows::UI::Xaml::Input::PointerRoutedEventArgs& args);\n+\n+        void _listItemPointerExited(const winrt::Windows::Foundation::IInspectable& sender, const winrt::Windows::UI::Xaml::Input::PointerRoutedEventArgs& args);\n+\n         void _listItemSelectionChanged(const Windows::Foundation::IInspectable& sender, const Windows::UI::Xaml::Controls::SelectionChangedEventArgs& e);\n \n         void _moveBackButtonClicked(const Windows::Foundation::IInspectable& sender, const Windows::UI::Xaml::RoutedEventArgs&);\n", "instance_id": "microsoft__terminal-18518", "clarity": 2, "difficulty": 0.35, "clarity_explanation": "The problem statement is mostly clear in describing the desired feature: a quality-of-life improvement where hovering over a color scheme in the command palette should trigger a preview, similar to what happens with arrow key navigation. The goal is well-defined, and the context (CTRL + SHIFT + P to access \"Select color scheme...\") is provided. However, there are minor ambiguities and missing details. For instance, the statement does not specify how long the preview should persist after the mouse leaves the item, nor does it address potential edge cases like rapid mouse movements or interactions with other UI elements. Additionally, there are no explicit constraints or requirements for performance or compatibility with existing features. While the intent is clear, these missing details prevent it from being comprehensive.", "difficulty_explanation": "The difficulty of this problem falls into the \"Easy\" range (0.2-0.4) due to several factors. First, the scope of code changes is relatively limited, primarily affecting a single file (`CommandPalette.cpp`) with additions to handle mouse hover events (`PointerEntered` and `PointerExited`) and a minor update to the header file (`CommandPalette.h`). The changes involve around 70-80 lines of new code, which is moderate but focused. Second, the technical concepts required are straightforward: understanding event handling in the Windows UI XAML framework, working with timers for debouncing (using `DispatcherTimer`), and interacting with existing command preview logic. These are not overly complex for someone familiar with C++ and UI programming. Third, the problem does not appear to impact the broader system architecture, as it is a localized UI enhancement. However, there is some complexity in handling the preview transitions smoothly (via a timer to debounce rapid hover changes), which adds a slight challenge. Edge cases, such as rapid mouse movements or ensuring the preview reverts correctly, are implicitly present but not overly intricate to address. Overall, this task requires understanding specific UI event logic and making targeted modifications, but it does not demand deep architectural changes or advanced technical expertise, justifying a score of 0.35.", "clarity_label": -1, "difficulty_label": -1, "human_clarity": -1, "human_difficulty": -1}
{"problem_statement": "Crash when switching back from the alt buffer\n### Windows Terminal version\n\nCommit edfa3ea0f0080eadf7f01b463ed0a8638de6ce04\n\n### Windows build number\n\n10.0.19045.4651\n\n### Other Software\n\n_No response_\n\n### Steps to reproduce\n\nIt's not easy to reproduce, but I think all you really need to trigger the crash is to switch to the alt buffer with `printf \"\\e[?1049h\"`, and then switch back to the main buffer with `printf \"\\e[?1049l\"`.\r\n\r\nThis is in Windows Terminal using a build that includes the new VT passthrough (PR #17510).\n\n### Expected Behavior\n\nThe terminal should not crash.\n\n### Actual Behavior\n\nI got an access violation accessing the `screenInfo` parameter in the `WriteCharsVT` function here:\r\n\r\nhttps://github.com/microsoft/terminal/blob/0199ca33ddb4a02ca3549627d772ce6b330ed1ce/src/host/_stream.cpp#L353\r\n\r\nWhat happens is that we first pass the `\\e[?1049l` sequence through to conhost in the `stateMachine.ProcessString` call a couple of lines above. That ends up calling `SCREEN_INFORMATION::UseMainScreenBuffer`, which calls `s_RemoveScreenBuffer(psiAlt)`, which deletes the active `screenInfo` instance here:\r\n\r\nhttps://github.com/microsoft/terminal/blob/0199ca33ddb4a02ca3549627d772ce6b330ed1ce/src/host/screenInfo.cpp#L231\r\n\r\nThat's the same `screenInfo` instance that was passed to our `WriteCharsVT` function, so when we later try to reference that, we're referencing a deleted object. Sometimes we get lucky and nothing bad happens, but sometimes it will crash.\r\n\r\nI think maybe all we need to do to prevent the crash is to save the `screenInfo.OutputMode` at the start of the function, and then use that saved value instead of trying to look it up via the `screenInfo` object.\n", "patch": "diff --git a/src/host/_stream.cpp b/src/host/_stream.cpp\nindex e434e413ebd..82dda40ef9b 100644\n--- a/src/host/_stream.cpp\n+++ b/src/host/_stream.cpp\n@@ -336,6 +336,9 @@ void WriteCharsVT(SCREEN_INFORMATION& screenInfo, const std::wstring_view& str)\n {\r\n     auto& gci = ServiceLocator::LocateGlobals().getConsoleInformation();\r\n     auto& stateMachine = screenInfo.GetStateMachine();\r\n+    // If the given screenInfo is the alternate screen buffer, disabling the alternate screen buffer in this\r\n+    // VT payload will cause the pointer to be invalidated. We thus need to get all the information we need now.\r\n+    const auto disableNewlineTranslation = WI_IsFlagSet(screenInfo.OutputMode, DISABLE_NEWLINE_AUTO_RETURN);\r\n     // When switch between the main and alt-buffer SCREEN_INFORMATION::GetActiveBuffer()\r\n     // may change, so get the VtIo reference now, just in case.\r\n     auto writer = gci.GetVtWriterForBuffer(&screenInfo);\r\n@@ -350,7 +353,7 @@ void WriteCharsVT(SCREEN_INFORMATION& screenInfo, const std::wstring_view& str)\n         // DISABLE_NEWLINE_AUTO_RETURN not being set is equivalent to a LF -> CRLF translation.\r\n         const auto write = [&](size_t beg, size_t end) {\r\n             const auto chunk = til::safe_slice_abs(str, beg, end);\r\n-            if (WI_IsFlagSet(screenInfo.OutputMode, DISABLE_NEWLINE_AUTO_RETURN))\r\n+            if (disableNewlineTranslation)\r\n             {\r\n                 writer.WriteUTF16(chunk);\r\n             }\r\n", "instance_id": "microsoft__terminal-17748", "clarity": 2, "difficulty": 0.35, "clarity_explanation": "The problem statement is mostly clear in describing the issue: a crash occurs when switching between the main and alternate screen buffers in Windows Terminal due to accessing a deleted `screenInfo` object. The steps to reproduce are provided, though they are noted as not easy to replicate consistently, which introduces some ambiguity. The expected and actual behaviors are clearly stated, and the root cause of the crash is well-explained with references to specific lines of code in the repository. However, there are minor details missing, such as specific conditions or edge cases under which the crash is more likely to occur, and the problem statement does not explicitly discuss constraints or additional requirements for the fix. Overall, it is clear enough to understand the issue and propose a solution, but it lacks comprehensive detail on edge cases or broader implications.", "difficulty_explanation": "The difficulty of this problem falls into the \"Easy\" range (0.2-0.4) due to the following factors:\n\n1. **Scope and Depth of Code Changes**: The provided code change is localized to a single function (`WriteCharsVT`) in a single file (`_stream.cpp`). The modification involves a small number of lines (adding a variable to store a value upfront and using it later), and it does not impact the broader system architecture or require changes across multiple modules. The fix is straightforward and does not necessitate deep refactoring.\n\n2. **Technical Concepts Involved**: Solving this problem requires understanding basic C++ concepts such as pointers, object lifetimes, and memory management (specifically, avoiding access to deleted objects). It also involves familiarity with the Windows Terminal codebase's handling of screen buffers and VT sequences. However, these concepts are not particularly advanced for a senior engineer, and the fix does not require complex algorithms, design patterns, or domain-specific knowledge beyond the terminal emulation context.\n\n3. **Edge Cases and Error Handling**: The problem statement does not explicitly mention additional edge cases beyond the crash scenario described. The code change addresses the primary issue (accessing a deleted object) by caching a value upfront, and no additional error handling logic is introduced or required in the provided diff. While there might be implicit edge cases related to buffer switching or VT sequence processing, they are not discussed or addressed in the solution, keeping the complexity low.\n\n4. **Overall Complexity**: The problem requires understanding a specific bug related to object lifetime in a multi-buffer terminal environment, but the solution is a simple mitigation (caching a value). It does not demand deep architectural changes or extensive debugging beyond identifying the root cause, which is already provided in the problem statement.\n\nGiven these factors, a difficulty score of 0.35 reflects an \"Easy\" problem that requires some understanding of the codebase and logic but involves a minimal and targeted code change with low risk of broader impact.", "clarity_label": -1, "difficulty_label": -1, "human_clarity": -1, "human_difficulty": -1}
{"problem_statement": "Window layout persisted in `state.json` even if window persistence not enabled\n### Windows Terminal version\n\n1.20.11215.0\n\n### Windows build number\n\n10.0.22631.3447\n\n### Other Software\n\n_No response_\n\n### Steps to reproduce\n\n1. Ensure window persistence is turned off\r\n2. Set windows terminal as your default terminal application\r\n3. Go to run and type `cmd /k echo hello world`\r\n4. Close the terminal\r\n5. Inspect `%LOCALAPPDATA%\\Packages\\Microsoft.WindowsTerminalPreview_8wekyb3d8bbwe\\LocalState\\state.json`\n\n### Expected Behavior\n\nThere is no history of the command that I ran in `state.json`.\n\n### Actual Behavior\n\n`state.json` has leaked my super secret command line invocation!\r\n\r\n```json\r\n{\r\n  \"persistedWindowLayouts\" : \r\n  [\r\n    {\r\n      \"initialPosition\" : \"234,234\",\r\n      \"initialSize\" : \r\n      {\r\n        \"height\" : 436.0,\r\n        \"width\" : 873.0\r\n      },\r\n      \"launchMode\" : \"default\",\r\n      \"tabLayout\" : \r\n      [\r\n        {\r\n          \"action\" : \"newTab\",\r\n          \"commandline\" : \"\\\"C:\\\\WINDOWS\\\\system32\\\\cmd.exe\\\" /k echo hello world\",\r\n          \"profile\" : \"Command Prompt\",\r\n          \"startingDirectory\" : \"C:\\\\Users\\\\Ian\",\r\n          \"suppressApplicationTitle\" : false,\r\n          \"tabTitle\" : \"C:\\\\WINDOWS\\\\system32\\\\cmd.exe\"\r\n        }\r\n      ]\r\n    }\r\n  ],\r\n  \"settingsHash\" : \"190f05f1cd1315b4-01d98faa8aecd332\"\r\n}\r\n```\r\n\r\nThis is not reproducible on version 1.19.11213.0.\n", "patch": "diff --git a/src/cascadia/TerminalApp/TerminalWindow.cpp b/src/cascadia/TerminalApp/TerminalWindow.cpp\nindex 749fd2e842c..c04a34affc9 100644\n--- a/src/cascadia/TerminalApp/TerminalWindow.cpp\n+++ b/src/cascadia/TerminalApp/TerminalWindow.cpp\n@@ -263,7 +263,7 @@ namespace winrt::TerminalApp::implementation\n         AppLogic::Current()->NotifyRootInitialized();\r\n     }\r\n \r\n-    void TerminalWindow::Quit()\r\n+    void TerminalWindow::PersistState()\r\n     {\r\n         if (_root)\r\n         {\r\ndiff --git a/src/cascadia/TerminalApp/TerminalWindow.h b/src/cascadia/TerminalApp/TerminalWindow.h\nindex b10c29a8d72..40e94a39201 100644\n--- a/src/cascadia/TerminalApp/TerminalWindow.h\n+++ b/src/cascadia/TerminalApp/TerminalWindow.h\n@@ -73,7 +73,7 @@ namespace winrt::TerminalApp::implementation\n \r\n         void Create();\r\n \r\n-        void Quit();\r\n+        void PersistState();\r\n \r\n         winrt::fire_and_forget UpdateSettings(winrt::TerminalApp::SettingsLoadEventArgs args);\r\n \r\ndiff --git a/src/cascadia/TerminalApp/TerminalWindow.idl b/src/cascadia/TerminalApp/TerminalWindow.idl\nindex 75c47fce8bf..2cf4b317298 100644\n--- a/src/cascadia/TerminalApp/TerminalWindow.idl\n+++ b/src/cascadia/TerminalApp/TerminalWindow.idl\n@@ -61,7 +61,7 @@ namespace TerminalApp\n         Boolean ShouldImmediatelyHandoffToElevated();\r\n         void HandoffToElevated();\r\n \r\n-        void Quit();\r\n+        void PersistState();\r\n \r\n         Windows.UI.Xaml.UIElement GetRoot();\r\n \r\ndiff --git a/src/cascadia/WindowsTerminal/AppHost.cpp b/src/cascadia/WindowsTerminal/AppHost.cpp\nindex 94585f4391c..63d8de231d3 100644\n--- a/src/cascadia/WindowsTerminal/AppHost.cpp\n+++ b/src/cascadia/WindowsTerminal/AppHost.cpp\n@@ -1184,13 +1184,16 @@ winrt::fire_and_forget AppHost::_QuitRequested(const winrt::Windows::Foundation:\n     co_await wil::resume_foreground(_windowLogic.GetRoot().Dispatcher());\r\n \r\n     const auto strongThis = weakThis.lock();\r\n-    // GH #16235: If we don't have a window logic, we're already refrigerating, and won't have our _window either.\r\n-    if (!strongThis || _windowLogic == nullptr)\r\n+    if (!strongThis)\r\n     {\r\n         co_return;\r\n     }\r\n \r\n-    _windowLogic.Quit();\r\n+    if (_appLogic && _windowLogic && _appLogic.ShouldUsePersistedLayout())\r\n+    {\r\n+        _windowLogic.PersistState();\r\n+    }\r\n+\r\n     PostQuitMessage(0);\r\n }\r\n \r\ndiff --git a/src/cascadia/WindowsTerminal/WindowEmperor.cpp b/src/cascadia/WindowsTerminal/WindowEmperor.cpp\nindex a8f0961e420..1e78e721fd4 100644\n--- a/src/cascadia/WindowsTerminal/WindowEmperor.cpp\n+++ b/src/cascadia/WindowsTerminal/WindowEmperor.cpp\n@@ -348,6 +348,14 @@ void WindowEmperor::_becomeMonarch()\n \r\n     _revokers.WindowCreated = _manager.WindowCreated(winrt::auto_revoke, { this, &WindowEmperor::_numberOfWindowsChanged });\r\n     _revokers.WindowClosed = _manager.WindowClosed(winrt::auto_revoke, { this, &WindowEmperor::_numberOfWindowsChanged });\r\n+\r\n+    // If a previous session of Windows Terminal stored buffer_*.txt files, then we need to clean all those up on exit\r\n+    // that aren't needed anymore, even if the user disabled the ShouldUsePersistedLayout() setting in the meantime.\r\n+    {\r\n+        const auto state = ApplicationState::SharedInstance();\r\n+        const auto layouts = state.PersistedWindowLayouts();\r\n+        _requiresPersistenceCleanupOnExit = layouts && layouts.Size() > 0;\r\n+    }\r\n }\r\n \r\n // sender and args are always nullptr\r\n@@ -486,7 +494,7 @@ void WindowEmperor::_finalizeSessionPersistence() const\n     // Ensure to write the state.json before we TerminateProcess()\r\n     state.Flush();\r\n \r\n-    if (!_app.Logic().ShouldUsePersistedLayout())\r\n+    if (!_requiresPersistenceCleanupOnExit)\r\n     {\r\n         return;\r\n     }\r\ndiff --git a/src/cascadia/WindowsTerminal/WindowEmperor.h b/src/cascadia/WindowsTerminal/WindowEmperor.h\nindex a35032e6d5e..d4186cbbb06 100644\n--- a/src/cascadia/WindowsTerminal/WindowEmperor.h\n+++ b/src/cascadia/WindowsTerminal/WindowEmperor.h\n@@ -51,6 +51,7 @@ class WindowEmperor : public std::enable_shared_from_this<WindowEmperor>\n \r\n     std::unique_ptr<NotificationIcon> _notificationIcon;\r\n \r\n+    bool _requiresPersistenceCleanupOnExit = false;\r\n     bool _quitting{ false };\r\n \r\n     void _windowStartedHandlerPostXAML(const std::shared_ptr<WindowThread>& sender);\r\n", "instance_id": "microsoft__terminal-17211", "clarity": 2, "difficulty": 0.55, "clarity_explanation": "The problem statement is mostly clear in describing the issue: Windows Terminal persists window layout information in `state.json` even when window persistence is disabled, which is a privacy concern as it leaks command-line invocations. The steps to reproduce are detailed, and the expected versus actual behavior is explicitly stated with a JSON snippet showing the leaked data. However, there are minor ambiguities, such as the lack of explicit mention of specific edge cases (e.g., different terminal configurations or user settings) and no detailed constraints or requirements for the fix (e.g., performance considerations or backward compatibility). Additionally, the problem statement does not clarify whether this issue affects all commands or only specific ones like `cmd /k`. Despite these minor gaps, the core issue and goal are well-defined, warranting a score of 2 (Mostly Clear).", "difficulty_explanation": "The difficulty of this problem falls into the medium range (0.4-0.6) due to several factors. First, the scope of code changes spans multiple files (`TerminalWindow.cpp`, `TerminalWindow.h`, `TerminalWindow.idl`, `AppHost.cpp`, `WindowEmperor.cpp`, and `WindowEmperor.h`), indicating a need to understand interactions between different components of the Windows Terminal codebase, such as window management, application logic, and state persistence. The changes involve renaming a method (`Quit` to `PersistState`) and adding conditional logic to check if persistence is enabled before saving state, which requires a moderate understanding of the system's architecture. \n\nSecond, the technical concepts involved include familiarity with C++ (specifically WinRT and Windows-specific APIs), application state management, and configuration settings. While these are not overly complex for an experienced developer, they do require specific domain knowledge of the Windows Terminal's internals and how settings are propagated through the system.\n\nThird, the problem does not explicitly mention edge cases in the statement, but the code changes suggest considerations like ensuring persistence cleanup happens only when necessary (`_requiresPersistenceCleanupOnExit`) and handling scenarios where previous layouts exist. Error handling modifications are minimal, as the changes focus on conditional logic rather than introducing new error paths.\n\nOverall, the task requires understanding multiple parts of the codebase and making targeted but non-trivial modifications. It does not significantly impact the system's architecture or require advanced algorithms, but it is more involved than a simple bug fix due to the cross-file changes and conditional logic. Hence, a difficulty score of 0.55 is appropriate, placing it in the medium range with a slight lean towards the higher end due to the need for domain-specific knowledge.", "clarity_label": -1, "difficulty_label": -1, "human_clarity": -1, "human_difficulty": -1}
{"problem_statement": "[BUG] - Crash when dragging/dropping a dock source item in non-manual mode.\n**Describe the bug**\r\nAn item can still be dragged in non-manual docks, which causes OBS to crash.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Create a new dynamic or search dock.\r\n2. Make sure it is populated with items.\r\n3. Drag an item up or down and release.\r\n4. Crash.\r\n\r\n**Expected behavior**\r\nDynamic and search docks should not have any ability to drag/reorder items, and should not crash if an item is accidentally dragged.\r\n\r\n**Additional context**\r\nNeed to disable drag/drop functionality for non-manual docks.\n", "patch": "diff --git a/src/quick-access-dock.cpp b/src/quick-access-dock.cpp\nindex 9c2cb10..95e6f91 100644\n--- a/src/quick-access-dock.cpp\n+++ b/src/quick-access-dock.cpp\n@@ -22,6 +22,7 @@ QuickAccessDock::QuickAccessDock(QWidget *parent, obs_data_t *obsData)\n \t_clickableScenes = obs_data_get_bool(obsData, \"clickable_scenes\");\n \n \t_widget = new QuickAccess(this, this, \"quick_access_widget\");\n+\tsetMinimumWidth(200);\n \tauto l = new QVBoxLayout;\n \tl->setContentsMargins(0, 0, 0, 0);\n \tl->addWidget(_widget);\ndiff --git a/src/quick-access.cpp b/src/quick-access.cpp\nindex 123c487..4831281 100644\n--- a/src/quick-access.cpp\n+++ b/src/quick-access.cpp\n@@ -77,57 +77,47 @@ QuickAccessItem::QuickAccessItem(QWidget *parent, QuickAccessDock *dock,\n \tlayout->addSpacing(2);\n \tlayout->addWidget(_label);\n \n-\t_actionsToolbar = new QToolBar(this);\n-\t_actionsToolbar->setObjectName(QStringLiteral(\"actionsToolbar\"));\n-\t_actionsToolbar->setIconSize(QSize(16, 16));\n-\t_actionsToolbar->setFixedHeight(22);\n-\t_actionsToolbar->setStyleSheet(\"QToolBar{spacing: 0px;}\");\n-\t_actionsToolbar->setFloatable(false);\n-\t_actionsToolbar->setSizePolicy(QSizePolicy::Maximum,\n-\t\t\t\t       QSizePolicy::Maximum);\n-\t_actionsToolbar->setStyleSheet(\n-\t\t\"QToolButton {padding: 0px; margin-left: 2px; margin-right: 2px;}\");\n-\n-\t_actionProperties = new QAction(this);\n-\t_actionProperties->setObjectName(QStringLiteral(\"actionProperties\"));\n+\t_actionProperties = new QPushButton();\n \t_actionProperties->setProperty(\"themeID\", \"propertiesIconSmall\");\n-\t_actionProperties->setText(QT_UTF8(obs_module_text(\"Properties\")));\n-\tconnect(_actionProperties, SIGNAL(triggered()), this,\n-\t\tSLOT(on_actionProperties_triggered()));\n-\t_actionsToolbar->addAction(_actionProperties);\n-\n-\t_actionFilters = new QAction(this);\n-\t_actionFilters->setObjectName(QStringLiteral(\"actionFilters\"));\n-\t_actionFilters->setShortcutContext(Qt::WidgetWithChildrenShortcut);\n+\t_actionProperties->setDisabled(false);\n+\t_actionProperties->setAccessibleDescription(\n+\t\t\"Opens the source properties window.\");\n+\t_actionProperties->setAccessibleName(\"Open Source Properties\");\n+\t_actionProperties->setToolTip(\"Open Source Properties\");\n+\t_actionProperties->setStyleSheet(\"padding: 0px; background: none\");\n+\tconnect(_actionProperties, &QPushButton::released, this,\n+\t\t&QuickAccessItem::on_actionProperties_triggered);\n+\n+\t_actionFilters = new QPushButton();\n \t_actionFilters->setProperty(\"themeID\", \"filtersIcon\");\n-\t_actionFilters->setText(QT_UTF8(obs_module_text(\"Filters\")));\n-\tconnect(_actionFilters, SIGNAL(triggered()), this,\n-\t\tSLOT(on_actionFilters_triggered()));\n-\t_actionsToolbar->addAction(_actionFilters);\n-\n-\t_actionScenes = new QAction(this);\n-\t_actionScenes->setObjectName(QStringLiteral(\"actionScenes\"));\n-\t_actionScenes->setShortcutContext(Qt::WidgetWithChildrenShortcut);\n+\t_actionFilters->setDisabled(false);\n+\t_actionFilters->setAccessibleDescription(\n+\t\t\"Opens the source filters window.\");\n+\t_actionFilters->setAccessibleName(\"Open Source Filters\");\n+\t_actionFilters->setToolTip(\"Open Source Filters\");\n+\t_actionFilters->setStyleSheet(\"padding: 0px; background: none\");\n+\tconnect(_actionFilters, &QPushButton::released, this,\n+\t\t&QuickAccessItem::on_actionFilters_triggered);\n+\n+\t_actionScenes = new QPushButton();\n \tQIcon sceneIcon;\n \tsceneIcon = qau->GetSceneIcon();\n \t_actionScenes->setIcon(sceneIcon);\n-\t_actionScenes->setText(QT_UTF8(obs_module_text(\"Scenes\")));\n-\tconnect(_actionScenes, SIGNAL(triggered()), this,\n-\t\tSLOT(on_actionScenes_triggered()));\n-\t_actionsToolbar->addAction(_actionScenes);\n-\n-\tSetButtonVisibility();\n+\t_actionScenes->setDisabled(false);\n+\t_actionScenes->setAccessibleDescription(\n+\t\t\"Opens list of all parent scenes\");\n+\t_actionScenes->setAccessibleName(\"Show Parent Scenes\");\n+\t_actionScenes->setToolTip(\"Show Parent Scenes\");\n+\t_actionScenes->setStyleSheet(\"padding: 0px; background: none\");\n+\tconnect(_actionScenes, &QPushButton::released, this,\n+\t\t&QuickAccessItem::on_actionScenes_triggered);\n+\n+\tlayout->addWidget(_actionProperties);\n+\tlayout->addWidget(_actionFilters);\n+\tlayout->addWidget(_actionScenes);\n \n-\t// Themes need the QAction dynamic properties\n-\tfor (QAction *x : _actionsToolbar->actions()) {\n-\t\tQWidget *temp = _actionsToolbar->widgetForAction(x);\n-\n-\t\tfor (QByteArray &y : x->dynamicPropertyNames()) {\n-\t\t\ttemp->setProperty(y, x->property(y));\n-\t\t}\n-\t}\n-\tlayout->addWidget(_actionsToolbar);\n \tsetLayout(layout);\n+\tSetButtonVisibility();\n }\n \n void QuickAccessItem::SetButtonVisibility()\n@@ -135,17 +125,6 @@ void QuickAccessItem::SetButtonVisibility()\n \t_actionProperties->setVisible(_configurable && _dock->ShowProperties());\n \t_actionFilters->setVisible(_dock->ShowFilters());\n \t_actionScenes->setVisible(_dock->ShowScenes());\n-\n-\t// Refresh Toolbar Styling\n-\tfor (auto x : _actionsToolbar->actions()) {\n-\t\tauto widget = _actionsToolbar->widgetForAction(x);\n-\n-\t\tif (!widget) {\n-\t\t\tcontinue;\n-\t\t}\n-\t\twidget->style()->unpolish(widget);\n-\t\twidget->style()->polish(widget);\n-\t}\n }\n \n const char *QuickAccessItem::GetSourceName()\n@@ -160,7 +139,9 @@ QuickAccessItem::~QuickAccessItem()\n {\n \tdelete _label;\n \tdelete _iconLabel;\n-\tdelete _actionsToolbar;\n+\tdelete _actionProperties;\n+\tdelete _actionFilters;\n+\tdelete _actionScenes;\n \t_clearSceneItems();\n \tobs_weak_source_release(_source);\n }\n@@ -352,9 +333,16 @@ QuickAccess::QuickAccess(QWidget *parent, QuickAccessDock *dock, QString name)\n \t_sourceList->setFrameShape(QFrame::NoFrame);\n \t_sourceList->setFrameShadow(QFrame::Plain);\n \t_sourceList->setProperty(\"showDropIndicator\", QVariant(true));\n-\t_sourceList->setDragEnabled(_dock->GetType() == \"Manual\");\n-\t_sourceList->setDragDropMode(QAbstractItemView::InternalMove);\n-\t_sourceList->setDefaultDropAction(Qt::TargetMoveAction);\n+\tif (_dock->GetType() == \"Manual\") {\n+\t\t_sourceList->setDragEnabled(true);\n+\t\t_sourceList->setDragDropMode(QAbstractItemView::InternalMove);\n+\t\t_sourceList->setDefaultDropAction(Qt::TargetMoveAction);\n+\t} else {\n+\t\t_sourceList->setDragEnabled(false);\n+\t\t_sourceList->setDragDropMode(QAbstractItemView::NoDragDrop);\n+\t\t_sourceList->viewport()->setAcceptDrops(false);\n+\t}\n+\n \tconnect(_sourceList, SIGNAL(itemSelectionChanged()), this,\n \t\tSLOT(on_sourceList_itemSelectionChanged()));\n \ndiff --git a/src/quick-access.hpp b/src/quick-access.hpp\nindex 073bfa8..3fb49ea 100644\n--- a/src/quick-access.hpp\n+++ b/src/quick-access.hpp\n@@ -72,10 +72,9 @@ class QuickAccessItem : public QFrame {\n \tQLabel *_label = nullptr;\n \tQLabel *_iconLabel = nullptr;\n \n-\tQToolBar *_actionsToolbar = nullptr;\n-\tQAction *_actionProperties = nullptr;\n-\tQAction *_actionFilters = nullptr;\n-\tQAction *_actionScenes = nullptr;\n+\tQPushButton *_actionProperties = nullptr;\n+\tQPushButton *_actionFilters = nullptr;\n+\tQPushButton *_actionScenes = nullptr;\n \n \tQPushButton *_filters = nullptr;\n \tobs_weak_source_t *_source = nullptr;\n", "instance_id": "FiniteSingularity__obs-quick-access-utility-16", "clarity": 2, "difficulty": 0.35, "clarity_explanation": "The problem statement is mostly clear and provides a valid description of the bug, including steps to reproduce and the expected behavior. It identifies the issue (crash when dragging/dropping items in non-manual docks) and specifies the goal (disable drag/drop functionality for non-manual docks). However, there are minor ambiguities and missing details. For instance, it does not explicitly mention whether there are specific types of non-manual docks (beyond dynamic and search docks) that need to be considered, nor does it discuss potential edge cases or constraints related to disabling drag/drop functionality. Additionally, there is no mention of whether this change might affect other parts of the application or user experience beyond preventing the crash. Despite these minor gaps, the problem statement is actionable and provides enough context to understand the issue and the desired outcome.", "difficulty_explanation": "The difficulty of this problem falls in the \"Easy\" range (0.2-0.4) due to the following factors:\n\n1. **Scope and Depth of Code Changes:** The code changes are relatively localized, primarily affecting the `quick-access.cpp` file with modifications to the drag/drop behavior of the `QAbstractItemView` in the `QuickAccess` class. Additional changes in UI elements (e.g., replacing `QAction` with `QPushButton` for toolbar actions) appear to be incidental or part of a broader refactoring but are not directly related to the core bug fix. The changes do not impact the broader system architecture and are confined to a specific module. The amount of code change is moderate, involving conditional logic for drag/drop settings and some UI refactoring.\n\n2. **Number of Technical Concepts:** Solving this problem requires a basic understanding of Qt framework concepts, specifically `QAbstractItemView` and its drag/drop properties (`setDragEnabled`, `setDragDropMode`, `viewport()->setAcceptDrops`). These are standard features of Qt, and the logic to disable drag/drop based on the dock type is straightforward. No advanced algorithms, design patterns, or domain-specific knowledge are required beyond familiarity with Qt's UI components.\n\n3. **Edge Cases and Error Handling:** The problem statement does not explicitly mention edge cases, but the code changes suggest a simple binary condition (manual vs. non-manual docks) for enabling/disabling drag/drop. There is no indication of complex error handling or unforeseen interactions with other parts of the system. However, a developer might need to consider whether disabling drag/drop could affect other functionalities or user interactions, though this is not explicitly required by the problem statement.\n\n4. **Overall Complexity:** The core fix (disabling drag/drop for non-manual docks) is a simple conditional modification that does not require deep understanding of the broader codebase. The incidental UI refactoring (e.g., changing `QAction` to `QPushButton`) adds some complexity but is still within the realm of basic UI programming tasks. There are no performance considerations or intricate logic involved.\n\nGiven these factors, a difficulty score of 0.35 reflects an \"Easy\" problem that requires understanding some code logic and making straightforward modifications. It is slightly above the lower end of the range due to the need for familiarity with Qt's drag/drop API and the moderate scope of UI-related changes, but it does not approach the complexity of a \"Medium\" difficulty problem.", "clarity_label": -1, "difficulty_label": -1, "human_clarity": -1, "human_difficulty": -1}
{"problem_statement": "`window.showSaveFilePicker()` shows warning in file picker UI\n### Preflight Checklist\n\n- [x] I have read the [Contributing Guidelines](https://github.com/electron/electron/blob/main/CONTRIBUTING.md) for this project.\n- [x] I agree to follow the [Code of Conduct](https://github.com/electron/electron/blob/main/CODE_OF_CONDUCT.md) that this project adheres to.\n- [x] I have searched the [issue tracker](https://www.github.com/electron/electron/issues) for a bug report that matches the one I want to file, without success.\n\n### Electron Version\n\n35.0.1, 36.0.0-alpha.2\n\n### What operating system(s) are you using?\n\nmacOS\n\n### Operating System Version\n\nmacOS Sequioa 15.3.1\n\n### What arch are you using?\n\narm64 (including Apple Silicon)\n\n### Last Known Working Electron version\n\n29.4.6\n\n### Expected Behavior\n\nIf I open a file picker with `window.showSaveFilePicker()`, it shows the standard file picker without any extra warnings.\n\nIn the context of an Electron app, I'd expect my app not to be referred to as a \"site\".\n\nAdditionally, in the context of a desktop app, a user expects the app to be able to continuously access files they select through a file picker. Warning them about that is unnecessary.\n\n### Actual Behavior\n\nThe file picker contains an ugly warning: \"Warning: this site can see edits you make\"\n\n![Screenshot](https://github.com/user-attachments/assets/b369517c-e6c3-480d-82b5-405b4abc38bb)\n\n### Testcase Gist URL\n\nhttps://gist.github.com/11316fce28ba719ce8446fb85955d50c\n\n### Additional Information\n\n_No response_\n", "patch": "diff --git a/shell/browser/file_system_access/file_system_access_permission_context.cc b/shell/browser/file_system_access/file_system_access_permission_context.cc\nindex 9f4b43645332b..865fa06f19bac 100644\n--- a/shell/browser/file_system_access/file_system_access_permission_context.cc\n+++ b/shell/browser/file_system_access/file_system_access_permission_context.cc\n@@ -825,13 +825,7 @@ std::u16string FileSystemAccessPermissionContext::GetPickerTitle(\n               ? IDS_FILE_SYSTEM_ACCESS_CHOOSER_OPEN_WRITABLE_DIRECTORY_TITLE\n               : IDS_FILE_SYSTEM_ACCESS_CHOOSER_OPEN_READABLE_DIRECTORY_TITLE);\n       break;\n-    case blink::mojom::TypeSpecificFilePickerOptionsUnion::Tag::\n-        kSaveFilePickerOptions:\n-      title = l10n_util::GetStringUTF16(\n-          IDS_FILE_SYSTEM_ACCESS_CHOOSER_OPEN_SAVE_FILE_TITLE);\n-      break;\n-    case blink::mojom::TypeSpecificFilePickerOptionsUnion::Tag::\n-        kOpenFilePickerOptions:\n+    default:\n       break;\n   }\n   return title;\n", "instance_id": "electron__electron-46067", "clarity": 2, "difficulty": 0.25, "clarity_explanation": "The problem statement is mostly clear in describing the issue: the `window.showSaveFilePicker()` method in Electron displays an unnecessary and misleading warning in the file picker UI on macOS. The expected behavior (no warning) and actual behavior (warning displayed) are explicitly stated, along with relevant context such as Electron versions affected and a screenshot for visual reference. However, there are minor ambiguities and missing details. For instance, the problem statement does not specify whether this warning appears under specific conditions (e.g., certain file types or permissions) or if it is consistent across all uses of the API. Additionally, while the test case gist is provided, it is not embedded or summarized in the statement, requiring extra effort to understand the full scope. Edge cases or potential side effects of removing the warning are also not discussed, which could be critical for a complete understanding of the issue. Overall, the statement is valid and clear but lacks some minor details for full comprehensiveness.", "difficulty_explanation": "The difficulty of this problem falls in the \"Easy\" range (0.2-0.4) due to several factors. First, the scope of the code change is minimal, as it involves modifying a single file (`file_system_access_permission_context.cc`) with a small diff that removes specific logic for setting a title for the save file picker. This suggests the fix is localized and does not impact the broader architecture or multiple modules of the Electron codebase. Second, the technical concepts required to solve this are relatively straightforward: understanding basic C++ syntax, familiarity with string localization (`l10n_util`), and a basic grasp of how Electron's file system access permissions are handled. No advanced algorithms, design patterns, or domain-specific knowledge beyond typical desktop app development are needed. Third, the problem does not explicitly mention complex edge cases or error handling requirements, and the code change itself does not introduce new error handling logic\u2014it simply removes a specific title assignment. While there might be implicit considerations (e.g., ensuring the default title or UI behavior is still appropriate after removal), these are not complex. Overall, this task requires understanding some code logic and making a simple modification, aligning with an easy difficulty level of 0.25.", "clarity_label": -1, "difficulty_label": -1, "human_clarity": -1, "human_difficulty": -1}
{"problem_statement": "Use Writing Tools in macOS 15.1\n### Preflight Checklist\n\n- [x] I have read the [Contributing Guidelines](https://github.com/electron/electron/blob/main/CONTRIBUTING.md) for this project.\n- [x] I agree to follow the [Code of Conduct](https://github.com/electron/electron/blob/main/CODE_OF_CONDUCT.md) that this project adheres to.\n- [x] I have searched the [issue tracker](https://www.github.com/electron/electron/issues) for a feature request that matches the one I want to file, without success.\n\n### Problem Description\n\nAre there plans to support apple intelligence's [`Writing Tools`](https://developer.apple.com/documentation/updates/apple-intelligence/) in electron?\n\nThe option is available in Chromium (tested on v128). Digging through the source code I found [`render_view_context_menu_mac.mm`](https://github.com/chromium/chromium/blob/main/chrome/browser/ui/cocoa/renderer_context_menu/render_view_context_menu_mac.mm) and [`text_services_context_menu.mm`](https://github.com/chromium/chromium/blob/main/ui/menus/cocoa/text_services_context_menu.mm), but I'm honestly none the wiser how it's implemented \ud83e\udee0\n\n![Image](https://github.com/user-attachments/assets/072e02db-f586-4502-b7e3-d2fc90d6c144)\n\n\n### Proposed Solution\n\n`Writing Tools` could be exposed as a context menu `role`, added to the menu only if it's available. \n\nAlso need to expose [`isWritingToolsActive`](https://developer.apple.com/documentation/appkit/nstextview/4431696-iswritingtoolsactive/) for UI/UX reasons, but I guess that can be of a lower priority.\n\n### Alternatives Considered\n\nnil\n\n### Additional Information\n\nRequirements to use apple intelligence:\n\n- macOS 15.1+\n- M-series Mac\n- [Enable apple intelligence in settings](https://support.apple.com/en-sg/guide/mac-help/mchl46361784/mac)\n", "patch": "diff --git a/docs/api/menu.md b/docs/api/menu.md\nindex b9a8a7b09e07f..949720dc0e8c8 100644\n--- a/docs/api/menu.md\n+++ b/docs/api/menu.md\n@@ -73,6 +73,8 @@ The `menu` object has the following instance methods:\n \n * `options` Object (optional)\n   * `window` [BaseWindow](base-window.md) (optional) - Default is the focused window.\n+  * `frame` [WebFrameMain](web-frame-main.md) (optional) - Provide the relevant frame\n+    if you want certain OS-level features such as Writing Tools on macOS to function correctly. Typically, this should be `params.frame` from the [`context-menu` event](web-contents.md#event-context-menu) on a WebContents.\n   * `x` number (optional) - Default is the current mouse cursor position.\n     Must be declared if `y` is declared.\n   * `y` number (optional) - Default is the current mouse cursor position.\ndiff --git a/lib/browser/api/menu.ts b/lib/browser/api/menu.ts\nindex c0244cc3c1bf2..8e0a63f764654 100644\n--- a/lib/browser/api/menu.ts\n+++ b/lib/browser/api/menu.ts\n@@ -93,7 +93,7 @@ Menu.prototype.popup = function (options = {}) {\n     }\n   }\n \n-  this.popupAt(window as unknown as BaseWindow, x, y, positioningItem, sourceType, callback);\n+  this.popupAt(window as unknown as BaseWindow, options.frame, x, y, positioningItem, sourceType, callback);\n   return { browserWindow: window, x, y, position: positioningItem };\n };\n \ndiff --git a/patches/chromium/.patches b/patches/chromium/.patches\nindex 6464dce67d2ee..ace5629450845 100644\n--- a/patches/chromium/.patches\n+++ b/patches/chromium/.patches\n@@ -135,6 +135,7 @@ fix_add_method_which_disables_headless_mode_on_native_widget.patch\n refactor_unfilter_unresponsive_events.patch\n build_disable_thin_lto_mac.patch\n build_add_public_config_simdutf_config.patch\n+fix_multiple_scopedpumpmessagesinprivatemodes_instances.patch\n revert_code_health_clean_up_stale_macwebcontentsocclusion.patch\n ignore_parse_errors_for_pkey_appusermodel_toastactivatorclsid.patch\n feat_add_signals_when_embedder_cleanup_callbacks_run_for.patch\ndiff --git a/patches/chromium/fix_multiple_scopedpumpmessagesinprivatemodes_instances.patch b/patches/chromium/fix_multiple_scopedpumpmessagesinprivatemodes_instances.patch\nnew file mode 100644\nindex 0000000000000..6605f24d7b15f\n--- /dev/null\n+++ b/patches/chromium/fix_multiple_scopedpumpmessagesinprivatemodes_instances.patch\n@@ -0,0 +1,51 @@\n+From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001\n+From: Calvin Watford <watfordcalvin@gmail.com>\n+Date: Wed, 5 Mar 2025 15:26:28 -0700\n+Subject: fix: multiple ScopedPumpMessagesInPrivateModes instances\n+\n+Context: When swapping `Menu.popup` to use `ui::ShowContextMenu`, we\n+found that its use of `ScopedPumpMessagesInPrivateModes` may potentially\n+be used multiple times simultaneously. This class was designed to work\n+with only one global instance.\n+\n+This patch adds a global reference count to keep track of\n+`ScopedPumpMessagesInPrivateModes` instances and gate its\n+enable/disable behavior on this reference count.\n+\n+diff --git a/base/message_loop/message_pump_apple.mm b/base/message_loop/message_pump_apple.mm\n+index 52ed68ac3150bdeef3c5032f3f5f7df3d5aaac51..1658aece3e8fbcef89944a849e311f7949a68de9 100644\n+--- a/base/message_loop/message_pump_apple.mm\n++++ b/base/message_loop/message_pump_apple.mm\n+@@ -760,20 +760,29 @@ explicit OptionalAutoreleasePool(MessagePumpCFRunLoopBase* pump) {\n+ \n+ #else\n+ \n++static int g_private_mode_ref_count = 0;\n++\n+ ScopedPumpMessagesInPrivateModes::ScopedPumpMessagesInPrivateModes() {\n+   DCHECK(g_app_pump);\n+-  DCHECK_EQ(kNSApplicationModalSafeModeMask, g_app_pump->GetModeMask());\n+   // Pumping events in private runloop modes is known to interact badly with\n+   // app modal windows like NSAlert.\n+   if (NSApp.modalWindow) {\n+     return;\n+   }\n+-  g_app_pump->SetModeMask(kAllModesMask);\n++\n++  g_private_mode_ref_count += 1;\n++  if (g_private_mode_ref_count == 1) {\n++    g_app_pump->SetModeMask(kAllModesMask);\n++  }\n+ }\n+ \n+ ScopedPumpMessagesInPrivateModes::~ScopedPumpMessagesInPrivateModes() {\n+   DCHECK(g_app_pump);\n+-  g_app_pump->SetModeMask(kNSApplicationModalSafeModeMask);\n++  DCHECK(g_private_mode_ref_count > 0);\n++  g_private_mode_ref_count -= 1;\n++  if (g_private_mode_ref_count == 0) {\n++    g_app_pump->SetModeMask(kNSApplicationModalSafeModeMask);\n++  }\n+ }\n+ \n+ int ScopedPumpMessagesInPrivateModes::GetModeMaskForTest() {\ndiff --git a/shell/browser/api/electron_api_menu.cc b/shell/browser/api/electron_api_menu.cc\nindex daef73495bf76..595a3513c499e 100644\n--- a/shell/browser/api/electron_api_menu.cc\n+++ b/shell/browser/api/electron_api_menu.cc\n@@ -7,6 +7,7 @@\n #include <utility>\n \n #include \"shell/browser/api/electron_api_base_window.h\"\n+#include \"shell/browser/api/electron_api_web_frame_main.h\"\n #include \"shell/browser/api/ui_event.h\"\n #include \"shell/browser/javascript_environment.h\"\n #include \"shell/browser/native_window.h\"\n@@ -16,6 +17,7 @@\n #include \"shell/common/gin_converters/file_path_converter.h\"\n #include \"shell/common/gin_converters/gurl_converter.h\"\n #include \"shell/common/gin_converters/image_converter.h\"\n+#include \"shell/common/gin_converters/optional_converter.h\"\n #include \"shell/common/gin_helper/dictionary.h\"\n #include \"shell/common/gin_helper/object_template_builder.h\"\n #include \"shell/common/node_includes.h\"\ndiff --git a/shell/browser/api/electron_api_menu.h b/shell/browser/api/electron_api_menu.h\nindex c861bd97a3e80..6b5ee0635da30 100644\n--- a/shell/browser/api/electron_api_menu.h\n+++ b/shell/browser/api/electron_api_menu.h\n@@ -22,6 +22,7 @@ class Arguments;\n namespace electron::api {\n \n class BaseWindow;\n+class WebFrameMain;\n \n class Menu : public gin::Wrappable<Menu>,\n              public gin_helper::EventEmitterMixin<Menu>,\n@@ -81,6 +82,7 @@ class Menu : public gin::Wrappable<Menu>,\n   void OnMenuWillShow(ui::SimpleMenuModel* source) override;\n \n   virtual void PopupAt(BaseWindow* window,\n+                       std::optional<WebFrameMain*> frame,\n                        int x,\n                        int y,\n                        int positioning_item,\ndiff --git a/shell/browser/api/electron_api_menu_mac.h b/shell/browser/api/electron_api_menu_mac.h\nindex 679bff8784568..f4d92f0840693 100644\n--- a/shell/browser/api/electron_api_menu_mac.h\n+++ b/shell/browser/api/electron_api_menu_mac.h\n@@ -13,6 +13,7 @@\n \n namespace electron {\n class NativeWindow;\n+class WebFrameMain;\n \n namespace api {\n \n@@ -23,12 +24,14 @@ class MenuMac : public Menu {\n \n   // Menu\n   void PopupAt(BaseWindow* window,\n+               std::optional<WebFrameMain*> frame,\n                int x,\n                int y,\n                int positioning_item,\n                ui::mojom::MenuSourceType source_type,\n                base::OnceClosure callback) override;\n   void PopupOnUI(const base::WeakPtr<NativeWindow>& native_window,\n+                 const base::WeakPtr<WebFrameMain>& frame,\n                  int32_t window_id,\n                  int x,\n                  int y,\ndiff --git a/shell/browser/api/electron_api_menu_mac.mm b/shell/browser/api/electron_api_menu_mac.mm\nindex 7ea23ffd91262..f5dffd4492e2b 100644\n--- a/shell/browser/api/electron_api_menu_mac.mm\n+++ b/shell/browser/api/electron_api_menu_mac.mm\n@@ -11,11 +11,15 @@\n #include \"base/strings/sys_string_conversions.h\"\n #include \"base/task/current_thread.h\"\n #include \"base/task/sequenced_task_runner.h\"\n+#include \"content/app_shim_remote_cocoa/render_widget_host_view_cocoa.h\"  // nogncheck\n+#include \"content/browser/renderer_host/render_widget_host_view_mac.h\"  // nogncheck\n #include \"content/public/browser/browser_task_traits.h\"\n #include \"shell/browser/api/electron_api_base_window.h\"\n+#include \"shell/browser/api/electron_api_web_frame_main.h\"\n #include \"shell/browser/native_window.h\"\n #include \"shell/common/keyboard_util.h\"\n #include \"shell/common/node_includes.h\"\n+#include \"ui/base/cocoa/menu_utils.h\"\n \n namespace {\n \n@@ -48,6 +52,7 @@\n MenuMac::~MenuMac() = default;\n \n void MenuMac::PopupAt(BaseWindow* window,\n+                      std::optional<WebFrameMain*> frame,\n                       int x,\n                       int y,\n                       int positioning_item,\n@@ -57,14 +62,19 @@\n   if (!native_window)\n     return;\n \n+  base::WeakPtr<WebFrameMain> weak_frame;\n+  if (frame && frame.value()) {\n+    weak_frame = frame.value()->GetWeakPtr();\n+  }\n+\n   // Make sure the Menu object would not be garbage-collected until the callback\n   // has run.\n   base::OnceClosure callback_with_ref = BindSelfToClosure(std::move(callback));\n \n-  auto popup =\n-      base::BindOnce(&MenuMac::PopupOnUI, weak_factory_.GetWeakPtr(),\n-                     native_window->GetWeakPtr(), window->weak_map_id(), x, y,\n-                     positioning_item, std::move(callback_with_ref));\n+  auto popup = base::BindOnce(&MenuMac::PopupOnUI, weak_factory_.GetWeakPtr(),\n+                              native_window->GetWeakPtr(), weak_frame,\n+                              window->weak_map_id(), x, y, positioning_item,\n+                              std::move(callback_with_ref));\n   base::SequencedTaskRunner::GetCurrentDefault()->PostTask(FROM_HERE,\n                                                            std::move(popup));\n }\n@@ -95,6 +105,7 @@\n }\n \n void MenuMac::PopupOnUI(const base::WeakPtr<NativeWindow>& native_window,\n+                        const base::WeakPtr<WebFrameMain>& frame,\n                         int32_t window_id,\n                         int x,\n                         int y,\n@@ -145,18 +156,27 @@\n     position.x = position.x - [menu size].width;\n \n   [popup_controllers_[window_id] setCloseCallback:std::move(close_callback)];\n-  // Make sure events can be pumped while the menu is up.\n-  base::CurrentThread::ScopedAllowApplicationTasksInNativeNestedLoop allow;\n-\n-  // One of the events that could be pumped is |window.close()|.\n-  // User-initiated event-tracking loops protect against this by\n-  // setting flags in -[CrApplication sendEvent:], but since\n-  // web-content menus are initiated by IPC message the setup has to\n-  // be done manually.\n-  base::mac::ScopedSendingEvent sendingEventScoper;\n-\n-  // Don't emit unresponsive event when showing menu.\n-  [menu popUpMenuPositioningItem:item atLocation:position inView:view];\n+\n+  if (frame && frame->render_frame_host()) {\n+    auto* rfh = frame->render_frame_host()->GetOutermostMainFrameOrEmbedder();\n+    if (rfh && rfh->IsRenderFrameLive()) {\n+      auto* rwhvm =\n+          static_cast<content::RenderWidgetHostViewMac*>(rfh->GetView());\n+      RenderWidgetHostViewCocoa* cocoa_view = rwhvm->GetInProcessNSView();\n+      view = cocoa_view;\n+    }\n+  }\n+\n+  NSEvent* dummy_event = [NSEvent mouseEventWithType:NSEventTypeRightMouseDown\n+                                            location:position\n+                                       modifierFlags:0\n+                                           timestamp:0\n+                                        windowNumber:nswindow.windowNumber\n+                                             context:nil\n+                                         eventNumber:0\n+                                          clickCount:1\n+                                            pressure:0];\n+  ui::ShowContextMenu(menu, dummy_event, view, true);\n }\n \n void MenuMac::ClosePopupAt(int32_t window_id) {\ndiff --git a/shell/browser/api/electron_api_menu_views.cc b/shell/browser/api/electron_api_menu_views.cc\nindex dd5a543c965c0..67aa94e77032a 100644\n--- a/shell/browser/api/electron_api_menu_views.cc\n+++ b/shell/browser/api/electron_api_menu_views.cc\n@@ -8,6 +8,7 @@\n #include <utility>\n \n #include \"shell/browser/api/electron_api_base_window.h\"\n+#include \"shell/browser/api/electron_api_web_frame_main.h\"\n #include \"shell/browser/native_window_views.h\"\n #include \"ui/display/screen.h\"\n \n@@ -20,6 +21,7 @@ MenuViews::MenuViews(gin::Arguments* args) : Menu(args) {}\n MenuViews::~MenuViews() = default;\n \n void MenuViews::PopupAt(BaseWindow* window,\n+                        std::optional<WebFrameMain*> frame,\n                         int x,\n                         int y,\n                         int positioning_item,\ndiff --git a/shell/browser/api/electron_api_menu_views.h b/shell/browser/api/electron_api_menu_views.h\nindex 7759f07a898dd..490d4229050f3 100644\n--- a/shell/browser/api/electron_api_menu_views.h\n+++ b/shell/browser/api/electron_api_menu_views.h\n@@ -22,6 +22,7 @@ class MenuViews : public Menu {\n  protected:\n   // Menu\n   void PopupAt(BaseWindow* window,\n+               std::optional<WebFrameMain*> frame,\n                int x,\n                int y,\n                int positioning_item,\ndiff --git a/shell/browser/api/electron_api_web_frame_main.h b/shell/browser/api/electron_api_web_frame_main.h\nindex ca5cc07e7d1fa..f62d75e0a8f69 100644\n--- a/shell/browser/api/electron_api_web_frame_main.h\n+++ b/shell/browser/api/electron_api_web_frame_main.h\n@@ -73,6 +73,10 @@ class WebFrameMain final : public gin::Wrappable<WebFrameMain>,\n \n   content::RenderFrameHost* render_frame_host() const;\n \n+  base::WeakPtr<WebFrameMain> GetWeakPtr() {\n+    return weak_factory_.GetWeakPtr();\n+  }\n+\n   // disable copy\n   WebFrameMain(const WebFrameMain&) = delete;\n   WebFrameMain& operator=(const WebFrameMain&) = delete;\ndiff --git a/typings/internal-electron.d.ts b/typings/internal-electron.d.ts\nindex f7338daa599e2..5d281261bb10d 100644\n--- a/typings/internal-electron.d.ts\n+++ b/typings/internal-electron.d.ts\n@@ -166,7 +166,7 @@ declare namespace Electron {\n     commandsMap: Record<string, MenuItem>;\n     groupsMap: Record<string, MenuItem[]>;\n     getItemCount(): number;\n-    popupAt(window: BaseWindow, x: number, y: number, positioning: number, sourceType: Required<Electron.PopupOptions>['sourceType'], callback: () => void): void;\n+    popupAt(window: BaseWindow, frame: WebFrameMain | undefined, x: number, y: number, positioning: number, sourceType: Required<Electron.PopupOptions>['sourceType'], callback: () => void): void;\n     closePopupAt(id: number): void;\n     setSublabel(index: number, label: string): void;\n     setToolTip(index: number, tooltip: string): void;\n", "instance_id": "electron__electron-45138", "clarity": 2, "difficulty": 0.75, "clarity_explanation": "The problem statement is mostly clear in its intent to integrate Apple Intelligence's \"Writing Tools\" feature into the Electron framework, specifically as a context menu role on macOS 15.1+. The goal is defined (supporting Writing Tools), and there is a proposed solution (exposing it as a context menu role and adding an API for checking if it's active). Additionally, relevant constraints like OS version and hardware requirements (M-series Mac) are provided. However, there are minor ambiguities and missing details that prevent a perfect score. For instance, the problem statement lacks specifics on how the feature should behave in different scenarios (e.g., what happens if Apple Intelligence is not enabled or supported on the system?), and there are no explicit examples of expected input/output or UI behavior beyond a screenshot. Edge cases, such as handling unsupported macOS versions or non-M-series hardware at runtime, are not addressed. Overall, while the intent and high-level requirements are clear, these minor gaps in detail slightly reduce the clarity.", "difficulty_explanation": "The difficulty of this problem falls into the \"Hard\" category (0.6-0.8) due to several factors. First, the scope of code changes is significant, spanning multiple files across the Electron codebase (e.g., menu.ts, electron_api_menu_mac.mm, and Chromium patches) and requiring modifications to both high-level API definitions and low-level macOS-specific implementations. This indicates a need to understand interactions between Electron's JavaScript layer, C++ bindings, and native macOS integration, as well as Chromium's internals for context menu handling. Second, the technical concepts involved are moderately complex, including macOS-specific APIs (e.g., NSEvent, ui::ShowContextMenu), Chromium's rendering and widget host architecture (e.g., RenderWidgetHostViewMac), and Electron's cross-platform menu system. Additionally, the patch to handle multiple ScopedPumpMessagesInPrivateModes instances introduces subtle concurrency and event-loop considerations, which require a deep understanding of macOS event handling and potential race conditions. Third, while edge cases are not explicitly mentioned in the problem statement, the code changes suggest the need to handle scenarios like missing or invalid WebFrameMain instances, unsupported hardware/OS versions, and ensuring proper event propagation for context menus. Finally, the impact on the system's architecture is non-trivial, as it modifies how context menus are displayed and interacts with native macOS features, potentially affecting other parts of the Electron framework. Overall, this problem requires a solid grasp of multiple layers of the stack, careful handling of platform-specific details, and significant code modifications, justifying a difficulty score of 0.75.", "clarity_label": -1, "difficulty_label": -1, "human_clarity": -1, "human_difficulty": -1}
{"problem_statement": "[Bug]: Electron crashes with libnotify 0.8.3 in portal environment when closing notification\n### Preflight Checklist\r\n\r\n- [X] I have read the [Contributing Guidelines](https://github.com/electron/electron/blob/main/CONTRIBUTING.md) for this project.\r\n- [X] I agree to follow the [Code of Conduct](https://github.com/electron/electron/blob/main/CODE_OF_CONDUCT.md) that this project adheres to.\r\n- [X] I have searched the [issue tracker](https://www.github.com/electron/electron/issues) for a bug report that matches the one I want to file, without success.\r\n\r\n### Electron Version\r\n\r\n25.0.0, 27.0.3 and 28.0.0-beta.2\r\n\r\n### What operating system are you using?\r\n\r\nOther Linux\r\n\r\n### Operating System Version\r\n\r\n- Arch Linux\r\n- `uname -a`: `Linux hostname 6.5.7-arch1-1 #1 SMP PREEMPT_DYNAMIC Tue, 10 Oct 2023 21:10:21 +0000 x86_64 GNU/Linux`\r\n\r\n### What arch are you using?\r\n\r\nx64\r\n\r\n### Last Known Working Electron version\r\n\r\nNot sure\r\n\r\n### Expected Behavior\r\n\r\nElectron does not crash when running `notification.close()`.\r\n\r\n### Actual Behavior\r\n\r\nElectron crashes with `notification.close()` when in portal (flatpak/snap, or `NOTIFY_FORCE_PORTAL=1` is set).\r\n\r\n### Testcase Gist URL\r\n\r\n_No response_\r\n\r\n### Additional Information\r\n\r\nAn MRE modified from electron-quick-start: https://github.com/taoky/electron-libnotify-portal-crash-mre.\r\n\r\nScreencast:\r\n\r\nhttps://github.com/electron/electron/assets/2109893/9bc49b03-ddef-4599-93e6-e7b4fb168b29\r\n\r\nMy analysis:\r\n\r\n1. `LibnotifyNotification::Show()` binds \"closed\" glib signal to `LibnotifyNotification::OnNotificationClosed` https://github.com/electron/electron/blob/7999ea39e2ee9702e64e4125e8e89c314e9f468f/shell/browser/notifications/linux/libnotify_notification.cc#L91-L94\r\n2. When closing (dismissing) notification, `LibnotifyNotification::Dismiss()` is called which runs `libnotify_loader_.notify_notification_close()`: https://github.com/electron/electron/blob/7999ea39e2ee9702e64e4125e8e89c314e9f468f/shell/browser/notifications/linux/libnotify_notification.cc#L167\r\n3. In `notify_notification_close()`, as libnotify 0.8.x adds supports for portal environment, it will call `remove_portal_notification()` instead of using gdbus call (<https://gitlab.gnome.org/GNOME/libnotify/-/blob/0.8.3/libnotify/notification.c#L1761>), then it calls `close_notification()` (<https://gitlab.gnome.org/GNOME/libnotify/-/blob/0.8.3/libnotify/notification.c#L825>), and nightmare happens: it `g_signal_emit (notification, signals[SIGNAL_CLOSED], 0);` (<https://gitlab.gnome.org/GNOME/libnotify/-/blob/0.8.3/libnotify/notification.c#L707>).\r\n4. `LibnotifyNotification::OnNotificationClosed()` happily calls `NotificationDismissed()`, which finally calls `Destroy()`, and then `presenter()->RemoveNotification(this)`, and `this` is then `delete`d inside.\r\n5. `Notification::Close()` in electron_api_notification.cc has no idea about `notification_` being deleted, it continues, and crashes:\r\nhttps://github.com/electron/electron/blob/7999ea39e2ee9702e64e4125e8e89c314e9f468f/shell/browser/api/electron_api_notification.cc#L217C6-L227\n", "patch": "diff --git a/shell/browser/notifications/linux/libnotify_notification.cc b/shell/browser/notifications/linux/libnotify_notification.cc\nindex e039b382e3e24..4c8452fad1a8d 100644\n--- a/shell/browser/notifications/linux/libnotify_notification.cc\n+++ b/shell/browser/notifications/linux/libnotify_notification.cc\n@@ -159,21 +159,21 @@ void LibnotifyNotification::Show(const NotificationOptions& options) {\n \n void LibnotifyNotification::Dismiss() {\n   if (!notification_) {\n-    Destroy();\n     return;\n   }\n \n   GError* error = nullptr;\n+  on_dismissing_ = true;\n   libnotify_loader_.notify_notification_close(notification_, &error);\n   if (error) {\n     log_and_clear_error(error, \"notify_notification_close\");\n-    Destroy();\n   }\n+  on_dismissing_ = false;\n }\n \n void LibnotifyNotification::OnNotificationClosed(\n     NotifyNotification* notification) {\n-  NotificationDismissed();\n+  NotificationDismissed(!on_dismissing_);\n }\n \n void LibnotifyNotification::OnNotificationView(NotifyNotification* notification,\ndiff --git a/shell/browser/notifications/linux/libnotify_notification.h b/shell/browser/notifications/linux/libnotify_notification.h\nindex 8aacd0952062a..315419fc5c734 100644\n--- a/shell/browser/notifications/linux/libnotify_notification.h\n+++ b/shell/browser/notifications/linux/libnotify_notification.h\n@@ -33,6 +33,7 @@ class LibnotifyNotification : public Notification {\n   RAW_PTR_EXCLUSION NotifyNotification* notification_ = nullptr;\n \n   ScopedGSignal signal_;\n+  bool on_dismissing_ = false;\n };\n \n }  // namespace electron\n", "instance_id": "electron__electron-41708", "clarity": 2, "difficulty": 0.65, "clarity_explanation": "The problem statement is mostly clear in describing the issue: Electron crashes when closing a notification in a portal environment with libnotify 0.8.3. It provides detailed context about the environment (Linux, specific Electron versions, and portal settings), expected behavior, actual behavior, and a step-by-step analysis of the crash's root cause. Additionally, it includes links to relevant code in the Electron repository and external libraries, as well as a minimal reproducible example (MRE). However, there are minor ambiguities: the problem statement does not explicitly define the desired fix or constraints for the solution (e.g., whether the fix must maintain compatibility with older libnotify versions or other environments). Edge cases, such as behavior in non-portal environments or with different libnotify versions, are not mentioned. Overall, while the issue is well-documented, these missing details prevent it from being fully comprehensive.", "difficulty_explanation": "The difficulty of this problem falls into the \"Hard\" category due to several factors. First, the scope of code changes is relatively small, confined to a single class (`LibnotifyNotification`) in two files, with minimal lines of code modified (adding a boolean flag and adjusting function calls). However, the complexity lies in understanding the interaction between Electron's notification system and the external `libnotify` library, particularly its behavior in portal environments (e.g., Flatpak/Snap). This requires knowledge of GLib signals, dynamic library loading, and the specific changes in `libnotify` 0.8.x regarding portal support, which are non-trivial concepts. Additionally, the problem involves debugging a crash caused by a double-deletion issue, necessitating a deep understanding of object lifecycle management in C++ and the asynchronous nature of signal handling in GLib. While edge cases are not extensively detailed in the problem statement, the fix must ensure that it does not introduce regressions in other environments or with different library versions, adding a layer of complexity to testing and validation. The solution also impacts a critical user-facing feature (notifications), requiring careful consideration of user experience and stability. Overall, solving this requires a solid grasp of C++ memory management, third-party library integration, and Electron's notification architecture, making it a challenging but not extremely advanced problem.", "clarity_label": -1, "difficulty_label": -1, "human_clarity": -1, "human_difficulty": -1}
{"problem_statement": "P2TR Spending Bug - Signing Transaction Failed\n### Is there an existing issue for this?\n\n- [X] I have searched the existing issues\n\n### Current behaviour\n\nSome Segwit Version 1 Addresses generated with [Achow101's Rust-Vanitygen](https://github.com/achow101/rust-vanitygen), or more generally some random Addresses imported using the `tr(<WIF Private Key>)` Descriptor, cause an issue when spending coins using them. Generally, the \"Signing transaction failed\" error occurs and the transaction is not created. Though, a workaround still allows to spend the coins.\n\nI don't know if the issue is exclusive to P2TR, but never encountered such problems with Vanity Version 0 Addresses in the past... I also did not encounter such issue with P2TR Addresses directly generated in Bitcoin Core with `getnewaddress` or so.\n\nMaybe it is the same issue as #5828, which was however not been reported with a concrete and reproducible example, and was closed since long... If so, then it would mean that other Address Types may be affected as TapRoot did not exist at this time. I have not found other duplicates, but sorry if I missed one...\n\n### Expected behaviour\n\nBeing able to spend using these Addresses without workarounds.\n\n### Steps to reproduce\n\n* Optional: Generate a Vanity P2TR Address with the [Achow101's Rust-Vanitygen](https://github.com/achow101/rust-vanitygen), modding it or converting the Private Key from Mainnet to Testnet if necessary. Or simply some [random WIF Private Key](https://learnmeabitcoin.com/technical/keys/private-key/wif/). Some Addresses will work, others exhibit the present issue... It seems that there is a significant proportion falling in the second case...\n* For convenience, you can simply use this one made for this Bug Report:\n```\ninternal_privkey: cNKAo2ZRsaWKcP481cEfj3astPyBrfq56JBtLeRhHUvTSuk2z4MR\ninternal_pubkey: ac414af4b822d67307fe81bef0a72ddf0be9e6ff129eb1270b1168126f619619\nAddress: tb1ptestamfzz5zguhrad6xuf7afua0csz5m6k2qclpnpkvsl20t856sxz2d89\n```\n* Import the Address, for example in Testnet4 via the Bitcoin-Qt Console: \n```\nimportdescriptors '[{\"desc\": \"tr(cNKAo2ZRsaWKcP481cEfj3astPyBrfq56JBtLeRhHUvTSuk2z4MR)#vhsk8sfh\", \"timestamp\":0}]'\n```\n* Optional: get some coins from a Testnet4 Faucet (or any other source) for this tb1ptestamfzz5zguhrad6xuf7afua0csz5m6k2qclpnpkvsl20t856sxz2d89 Address. When I submitted the Issue, there were some coins left...\n* Optional: Send some amount involving this Address. Immediately after importing the Address, it appears that there is no particular issue. See Transaction [a301d660523de70542d30490052f9e04ba3f9b5e26482745c7dbdc952802f103](https://mempool.space/testnet4/tx/a301d660523de70542d30490052f9e04ba3f9b5e26482745c7dbdc952802f103).\n* Restart Bitcoin Core, and try sending again some amount. The interface now shows a \"Signing transaction failed\" dialog followed by \"Transaction creation failed!\". Or, in the Console,\n```\nsendtoaddress tb1qn9rvr53m7qvrpysx48svuxsgahs88xfsskx367 0.0001\nSigning transaction failed (code -6)\n```\n* However, if a new Wallet is created, and the Descriptor is imported again as above, sending coins is possible again (until Bitcoin Core is restarted again). The process can be repeated to further reuse the Address (which is obviously not practical).\n\n### Relevant log output\n\n_No response_\n\n### How did you obtain Bitcoin Core\n\nCompiled from source\n\n### What version of Bitcoin Core are you using?\n\nmaster@228aba2c4d9ac0b2ca3edd3c2cdf0a92e55f669b\n\n### Operating system and version\n\nDebian 13 Testing\n\n### Machine specifications\n\n_No response_\n", "patch": "diff --git a/src/script/descriptor.cpp b/src/script/descriptor.cpp\nindex 2e1a30744ec11..499af47ee553f 100644\n--- a/src/script/descriptor.cpp\n+++ b/src/script/descriptor.cpp\n@@ -312,15 +312,7 @@ class ConstPubkeyProvider final : public PubkeyProvider\n     bool ToPrivateString(const SigningProvider& arg, std::string& ret) const override\n     {\n         CKey key;\n-        if (m_xonly) {\n-            for (const auto& keyid : XOnlyPubKey(m_pubkey).GetKeyIDs()) {\n-                arg.GetKey(keyid, key);\n-                if (key.IsValid()) break;\n-            }\n-        } else {\n-            arg.GetKey(m_pubkey.GetID(), key);\n-        }\n-        if (!key.IsValid()) return false;\n+        if (!GetPrivKey(/*pos=*/0, arg, key)) return false;\n         ret = EncodeSecret(key);\n         return true;\n     }\n@@ -331,7 +323,8 @@ class ConstPubkeyProvider final : public PubkeyProvider\n     }\n     bool GetPrivKey(int pos, const SigningProvider& arg, CKey& key) const override\n     {\n-        return arg.GetKey(m_pubkey.GetID(), key);\n+        return m_xonly ? arg.GetKeyByXOnly(XOnlyPubKey(m_pubkey), key) :\n+                         arg.GetKey(m_pubkey.GetID(), key);\n     }\n     std::optional<CPubKey> GetRootPubKey() const override\n     {\n@@ -1716,7 +1709,7 @@ struct KeyParser {\n         if (miniscript::IsTapscript(m_script_ctx) && end - begin == 32) {\n             XOnlyPubKey pubkey;\n             std::copy(begin, end, pubkey.begin());\n-            if (auto pubkey_provider = InferPubkey(pubkey.GetEvenCorrespondingCPubKey(), ParseContext(), *m_in)) {\n+            if (auto pubkey_provider = InferXOnlyPubkey(pubkey, ParseContext(), *m_in)) {\n                 m_keys.emplace_back();\n                 m_keys.back().push_back(std::move(pubkey_provider));\n                 return key;\ndiff --git a/src/script/signingprovider.h b/src/script/signingprovider.h\nindex efdfd9ee566b0..5b1da681f837f 100644\n--- a/src/script/signingprovider.h\n+++ b/src/script/signingprovider.h\n@@ -136,6 +136,8 @@ class TaprootBuilder\n     std::vector<std::tuple<uint8_t, uint8_t, std::vector<unsigned char>>> GetTreeTuples() const;\n     /** Returns true if there are any tapscripts */\n     bool HasScripts() const { return !m_branch.empty(); }\n+\n+    bool operator==(const TaprootBuilder& other) const { return GetTreeTuples() == other.GetTreeTuples(); }\n };\n \n /** Given a TaprootSpendData and the output key, reconstruct its script tree.\n", "instance_id": "bitcoin__bitcoin-31590", "clarity": 2, "difficulty": 0.75, "clarity_explanation": "\nThe problem statement is mostly clear in describing the issue: a \"Signing transaction failed\" error occurs when spending coins from certain Segwit Version 1 (P2TR) addresses imported using a specific descriptor in Bitcoin Core, particularly after a restart. The goal (being able to spend without workarounds) and steps to reproduce are provided with a concrete example, including a specific private key and address for testing. However, there are minor ambiguities and missing details that prevent a perfect score. For instance, the problem statement does not explicitly clarify whether the issue is tied to a specific version of Bitcoin Core beyond the commit hash provided, nor does it detail the exact conditions under which the issue manifests (e.g., specific types of transactions or address patterns beyond \"some random addresses\"). Additionally, edge cases or potential causes are not speculated upon in depth, leaving some uncertainty for a developer approaching the problem. Despite these minor gaps, the statement is actionable with the provided reproduction steps and example data.\n", "difficulty_explanation": "\nI rate the difficulty of this problem as 0.75, placing it in the \"Hard\" category due to several factors across the evaluation criteria:\n\n1. **Scope and Depth of Code Changes**: The provided code changes are relatively focused, affecting only a couple of files (`descriptor.cpp` and `signingprovider.h`) with modifications to how public and private keys are handled for P2TR addresses (specifically around XOnlyPubKey handling and Taproot-related logic). However, these changes are in a critical part of the Bitcoin Core codebase related to transaction signing and descriptor parsing, which implies a high impact on the system's correctness and security. While the diff is not extensive in terms of lines of code, the modifications require a deep understanding of the interaction between key management and Taproot-specific logic, suggesting a non-trivial integration with the broader codebase.\n\n2. **Number of Technical Concepts**: Solving this issue demands familiarity with several advanced concepts, including Bitcoin's Taproot (P2TR) address format, Segwit versioning, descriptor parsing, and the internals of Bitcoin Core's signing mechanisms. Specific knowledge of XOnlyPubKey (Schnorr signatures) and how private/public key pairs are managed in the context of Taproot is crucial. Additionally, understanding the nuances of wallet state persistence (given the issue manifests after a restart) adds another layer of complexity. These are domain-specific and advanced cryptographic concepts, not general programming knowledge, raising the difficulty.\n\n3. **Potential Edge Cases and Error Handling**: The problem statement highlights that the issue affects \"some\" addresses but not others, implying potential edge cases related to specific key patterns or wallet states. The fact that the issue disappears when creating a new wallet and re-importing the descriptor suggests a state or caching issue, which can be notoriously difficult to debug and handle. The code changes do not explicitly address error handling but modify key retrieval logic, which could introduce or resolve subtle edge cases in transaction signing. Identifying and handling these edge cases (e.g., invalid or incompatible key formats, state corruption) requires careful testing and deep insight into Bitcoin Core's behavior.\n\n4. **Overall Complexity**: While the code changes themselves are not voluminous, the problem lies in a critical and complex area of Bitcoin Core. A developer must not only understand the provided diff but also ensure that the fix does not introduce regressions in transaction signing or security vulnerabilities in Taproot handling. The need to reason about wallet state persistence and the interaction between imported descriptors and the signing process adds significant cognitive load. This is not a surface-level bug fix but a problem requiring expertise in Bitcoin's internals and careful validation.\n\nGiven these considerations, a score of 0.75 reflects the hard nature of the problem, driven by the need for specialized domain knowledge, the critical impact of the changes, and the potential for subtle edge cases. It falls short of \"Very Hard\" (0.8-1.0) because the scope of code changes is relatively contained, and the problem does not appear to require a complete architectural overhaul or novel algorithm design.\n", "clarity_label": -1, "difficulty_label": -1, "human_clarity": -1, "human_difficulty": -1}
{"problem_statement": "DNS seed \"seed.bitcoinstats.com\" doesn't support filtering while the comments says it does\n### Is there an existing issue for this?\n\n- [X] I have searched the existing issues\n\n### Current behaviour\n\nIt's stated in `chainparams.cpp` that \"seed.bitcoinstats.com\" supports filtering. However, this isn't true.\r\n\r\nhttps://github.com/bitcoin/bitcoin/blob/c05c214f2e9cfd6070a3c7680bfa09358fd9d97a/src/kernel/chainparams.cpp#L137\n\n### Expected behaviour\n\nSince \"seed.bitcoinstats.com\" supports filtering for `NODE_NETWORK`, when asked for `NODE_NETWORK`, it should return archival nodes. It doesn't.\n\n### Steps to reproduce\n\n`dig x1.seed.bitcoinstats.com`.\r\n\r\n```\r\n[I] calvin@bitcoin ~> dig x1.seed.bitcoinstats.com\r\n\r\n; <<>> DiG 9.18.21 <<>> x1.seed.bitcoinstats.com\r\n;; global options: +cmd\r\n;; Got answer:\r\n;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 60119\r\n;; flags: qr rd ra; QUERY: 1, ANSWER: 25, AUTHORITY: 0, ADDITIONAL: 1\r\n\r\n;; OPT PSEUDOSECTION:\r\n; EDNS: version: 0, flags:; udp: 1232\r\n;; QUESTION SECTION:\r\n;x1.seed.bitcoinstats.com.      IN      A\r\n\r\n;; ANSWER SECTION:\r\nx1.seed.bitcoinstats.com. 60    IN      A       13.112.109.34\r\nx1.seed.bitcoinstats.com. 60    IN      A       3.211.51.136\r\nx1.seed.bitcoinstats.com. 60    IN      A       3.8.38.104\r\nx1.seed.bitcoinstats.com. 60    IN      A       64.227.26.97\r\nx1.seed.bitcoinstats.com. 60    IN      A       69.55.55.188\r\nx1.seed.bitcoinstats.com. 60    IN      A       34.241.94.237\r\nx1.seed.bitcoinstats.com. 60    IN      A       3.124.65.19\r\nx1.seed.bitcoinstats.com. 60    IN      A       3.81.243.143\r\nx1.seed.bitcoinstats.com. 60    IN      A       51.195.28.51\r\nx1.seed.bitcoinstats.com. 60    IN      A       46.137.123.109\r\nx1.seed.bitcoinstats.com. 60    IN      A       138.68.173.152\r\nx1.seed.bitcoinstats.com. 60    IN      A       69.4.94.226\r\nx1.seed.bitcoinstats.com. 60    IN      A       142.93.200.9\r\nx1.seed.bitcoinstats.com. 60    IN      A       54.68.82.186\r\nx1.seed.bitcoinstats.com. 60    IN      A       18.202.91.9\r\nx1.seed.bitcoinstats.com. 60    IN      A       52.30.154.84\r\nx1.seed.bitcoinstats.com. 60    IN      A       116.203.99.217\r\nx1.seed.bitcoinstats.com. 60    IN      A       13.112.109.34\r\nx1.seed.bitcoinstats.com. 60    IN      A       3.211.51.136\r\nx1.seed.bitcoinstats.com. 60    IN      A       3.8.38.104\r\nx1.seed.bitcoinstats.com. 60    IN      A       64.227.26.97\r\nx1.seed.bitcoinstats.com. 60    IN      A       69.55.55.188\r\nx1.seed.bitcoinstats.com. 60    IN      A       34.241.94.237\r\nx1.seed.bitcoinstats.com. 60    IN      A       3.124.65.19\r\nx1.seed.bitcoinstats.com. 60    IN      A       3.81.243.143\r\n\r\n;; Query time: 312 msec\r\n;; SERVER: 1.1.1.1#53(1.1.1.1) (UDP)\r\n;; WHEN: Fri Apr 19 19:35:56 KST 2024\r\n;; MSG SIZE  rcvd: 453\r\n```\r\n\r\nOf the returned addresses, these address do not support `NODE_NETWORK`\r\n```\r\n13.112.109.34\r\n3.8.38.104\r\n64.227.26.97\r\n69.55.55.188\r\n34.241.94.237\r\n142.93.200.9\r\n18.202.91.9\r\n52.30.154.84\r\n116.203.99.217\r\n13.112.109.34\r\n64.227.26.97\r\n69.55.55.188\r\n34.241.94.237\r\n```\r\n\r\nOne can easily check bitnodes data: https://bitnodes.io/nodes/3.8.38.104-8333/\r\n\r\nA handful of the nodes here were also unreachable at the time of this writing.\n\n### Relevant log output\n\n_No response_\n\n### How did you obtain Bitcoin Core\n\nPre-built binaries\n\n### What version of Bitcoin Core are you using?\n\nv23.0.0 but this doesn't matter here\n\n### Operating system and version\n\nAlso doesn't matter\n\n### Machine specifications\n\nI don't think this matters for this issue\n", "patch": "diff --git a/src/kernel/chainparams.cpp b/src/kernel/chainparams.cpp\nindex 3bd662b684777..c995225064ffb 100644\n--- a/src/kernel/chainparams.cpp\n+++ b/src/kernel/chainparams.cpp\n@@ -145,7 +145,6 @@ class CMainParams : public CChainParams {\n         vSeeds.emplace_back(\"seed.bitcoin.sipa.be.\"); // Pieter Wuille, only supports x1, x5, x9, and xd\n         vSeeds.emplace_back(\"dnsseed.bluematt.me.\"); // Matt Corallo, only supports x9\n         vSeeds.emplace_back(\"dnsseed.bitcoin.dashjr-list-of-p2p-nodes.us.\"); // Luke Dashjr\n-        vSeeds.emplace_back(\"seed.bitcoinstats.com.\"); // Christian Decker, supports x1 - xf\n         vSeeds.emplace_back(\"seed.bitcoin.jonasschnelli.ch.\"); // Jonas Schnelli, only supports x1, x5, x9, and xd\n         vSeeds.emplace_back(\"seed.btc.petertodd.net.\"); // Peter Todd, only supports x1, x5, x9, and xd\n         vSeeds.emplace_back(\"seed.bitcoin.sprovoost.nl.\"); // Sjors Provoost\n", "instance_id": "bitcoin__bitcoin-30720", "clarity": 2, "difficulty": 0.15, "clarity_explanation": "The problem statement is mostly clear in identifying the issue: the DNS seed \"seed.bitcoinstats.com\" is documented as supporting filtering for `NODE_NETWORK` in the Bitcoin Core codebase, but in practice, it returns nodes that do not support this feature. The statement provides evidence through a `dig` command output and references to external data (bitnodes.io) to validate the claim. It also clearly states the expected behavior (returning archival nodes for `NODE_NETWORK`). However, there are minor ambiguities and missing details. For instance, the problem does not explicitly define what \"filtering\" entails in this context or provide a clear standard for determining whether a node supports `NODE_NETWORK`. Additionally, while the issue is demonstrated with data, there are no specific guidelines or examples of what a correct response from the DNS seed should look like. Edge cases, such as how to handle unreachable nodes or partial support for filtering, are not addressed. Overall, the problem is valid and mostly clear but lacks some precision and depth in requirements.", "difficulty_explanation": "The difficulty of this problem is very low, falling in the 0.0-0.2 range, as it involves a straightforward code modification with minimal impact on the broader codebase. The proposed solution is to remove the DNS seed \"seed.bitcoinstats.com\" from the list in `chainparams.cpp`, which is a single-line change in a single file. This does not require deep understanding of the Bitcoin Core architecture, complex logic, or interaction between multiple modules. The technical concepts involved are minimal\u2014basic knowledge of C++ and familiarity with the purpose of DNS seeds in the Bitcoin network are sufficient. There are no significant edge cases or error handling requirements introduced by this change, as it simply removes an entry rather than modifying behavior or adding new logic. The change has no impact on the system's architecture or performance. The primary challenge lies in verifying the correctness of the claim (i.e., confirming that the DNS seed does not support filtering as expected), but this is more of a research task than a coding challenge. Overall, this is a very easy fix suitable for a beginner or someone with minimal experience in the codebase.", "clarity_label": -1, "difficulty_label": -1, "human_clarity": -1, "human_difficulty": -1}
{"problem_statement": "Compilation failure with `-O0` + `-fsanitize=address`  due to inline asm\n### Is there an existing issue for this?\n\n- [X] I have searched the existing issues\n\n### Current behaviour\n\nConfigure with\r\n```\r\n./configure --enable-fuzz --enable-debug --with-sanitizers=address,fuzzer,undefined,integer CC=clang CXX=clang++\r\n```\r\n\r\nCompile fails:\r\n```\r\ncrypto/sha256_sse4.cpp:44:9: error: expected relocatable expression\r\n   44 |         \"shl    $0x6,%2;\"\r\n      |         ^\r\n<inline asm>:1:1882: note: instantiated into assembly here\r\ncrypto/sha256_sse4.cpp:44:9: error: expected relocatable expression\r\n   44 |         \"shl    $0x6,%2;\"\r\n      |         ^\r\n<inline asm>:1:2591: note: instantiated into assembly here\r\ncrypto/sha256_sse4.cpp:44:9: error: expected relocatable expression\r\n   44 |         \"shl    $0x6,%2;\"\r\n      |         ^\r\n<inline asm>:1:3284: note: instantiated into assembly here\r\ncrypto/sha256_sse4.cpp:44:9: error: expected relocatable expression\r\n   44 |         \"shl    $0x6,%2;\"\r\n      |         ^\r\n<inline asm>:1:4686: note: instantiated into assembly here\r\ncrypto/sha256_sse4.cpp:44:9: error: expected relocatable expression\r\n   44 |         \"shl    $0x6,%2;\"\r\n      |         ^\r\n<inline asm>:1:5395: note: instantiated into assembly here\r\ncrypto/sha256_sse4.cpp:44:9: error: expected relocatable expression\r\n   44 |         \"shl    $0x6,%2;\"\r\n      |         ^\r\n<inline asm>:1:6088: note: instantiated into assembly here\r\ncrypto/sha256_sse4.cpp:44:9: error: expected relocatable expression\r\n   44 |         \"shl    $0x6,%2;\"\r\n      |         ^\r\n<inline asm>:1:7490: note: instantiated into assembly here\r\ncrypto/sha256_sse4.cpp:44:9: error: expected relocatable expression\r\n   44 |         \"shl    $0x6,%2;\"\r\n      |         ^\r\n<inline asm>:1:8199: note: instantiated into assembly here\r\ncrypto/sha256_sse4.cpp:44:9: error: expected relocatable expression\r\n   44 |         \"shl    $0x6,%2;\"\r\n      |         ^\r\n<inline asm>:1:8892: note: instantiated into assembly here\r\ncrypto/sha256_sse4.cpp:44:9: error: expected relocatable expression\r\n   44 |         \"shl    $0x6,%2;\"\r\n      |         ^\r\n<inline asm>:1:10312: note: instantiated into assembly here\r\ncrypto/sha256_sse4.cpp:44:9: error: expected relocatable expression\r\n   44 |         \"shl    $0x6,%2;\"\r\n      |         ^\r\n<inline asm>:1:11021: note: instantiated into assembly here\r\ncrypto/sha256_sse4.cpp:44:9: error: expected relocatable expression\r\n   44 |         \"shl    $0x6,%2;\"\r\n      |         ^\r\n<inline asm>:1:11714: note: instantiated into assembly here\r\ncrypto/sha256_sse4.cpp:44:9: error: expected relocatable expression\r\n   44 |         \"shl    $0x6,%2;\"\r\n      |         ^\r\n<inline asm>:1:12859: note: instantiated into assembly here\r\ncrypto/sha256_sse4.cpp:44:9: error: expected relocatable expression\r\n   44 |         \"shl    $0x6,%2;\"\r\n      |         ^\r\n<inline asm>:1:13356: note: instantiated into assembly here\r\ncrypto/sha256_sse4.cpp:44:9: error: expected relocatable expression\r\n   44 |         \"shl    $0x6,%2;\"\r\n      |         ^\r\n<inline asm>:1:13853: note: instantiated into assembly here\r\ncrypto/sha256_sse4.cpp:44:9: error: expected relocatable expression\r\n   44 |         \"shl    $0x6,%2;\"\r\n      |         ^\r\n<inline asm>:1:14900: note: instantiated into assembly here\r\ncrypto/sha256_sse4.cpp:44:9: error: expected relocatable expression\r\n   44 |         \"shl    $0x6,%2;\"\r\n      |         ^\r\n<inline asm>:1:15397: note: instantiated into assembly here\r\ncrypto/sha256_sse4.cpp:44:9: error: expected relocatable expression\r\n   44 |         \"shl    $0x6,%2;\"\r\n      |         ^\r\n<inline asm>:1:15894: note: instantiated into assembly here\r\n18 errors generated.\r\nmake[2]: *** [Makefile:14531: crypto/libbitcoin_crypto_base_la-sha256_sse4.lo] Error 1\r\n```\n\n### Expected behaviour\n\nIt should successfully compile with the debug symbols so that fuzz crashes can be debugged.\r\n\r\nPreviously, it was possible to work around this issue by using `--disable-asm` however that was removed in #29407\n\n### Steps to reproduce\n\nSee above configure .\r\n\r\n`--enable-debug` and `--enable-fuzz` individually do not result in compilation failure. I am only seeing this when using them together.\n\n### Relevant log output\n\n[config.log](https://github.com/bitcoin/bitcoin/files/14854906/config.log)\r\n\n\n### How did you obtain Bitcoin Core\n\nCompiled from source\n\n### What version of Bitcoin Core are you using?\n\nmaster@0d509bab45d292caeaf34600e57b5928757c6005\n\n### Operating system and version\n\nArch w/ linux kernel 6.8.2\n\n### Machine specifications\n\n_No response_\n", "patch": "diff --git a/src/crypto/sha256_sse4.cpp b/src/crypto/sha256_sse4.cpp\nindex f4557291cefe5..f0e255a23cb56 100644\n--- a/src/crypto/sha256_sse4.cpp\n+++ b/src/crypto/sha256_sse4.cpp\n@@ -13,6 +13,13 @@\n namespace sha256_sse4\n {\n void Transform(uint32_t* s, const unsigned char* chunk, size_t blocks)\n+#if defined(__clang__) && !defined(__OPTIMIZE__)\n+  /*\n+  clang is unable to compile this with -O0 and -fsanitize=address.\n+  See upstream bug: https://github.com/llvm/llvm-project/issues/92182\n+  */\n+  __attribute__((no_sanitize(\"address\")))\n+#endif\n {\n     static const uint32_t K256 alignas(16) [] = {\n         0x428a2f98, 0x71374491, 0xb5c0fbcf, 0xe9b5dba5,\n", "instance_id": "bitcoin__bitcoin-30097", "clarity": 2, "difficulty": 0.35, "clarity_explanation": "The problem statement is mostly clear in describing the issue: a compilation failure occurs when using specific configuration flags (`-O0` and `-fsanitize=address`) due to inline assembly in the `sha256_sse4.cpp` file. The goal is implicitly understood as fixing the compilation error to allow successful builds with debug symbols for fuzzing. The steps to reproduce are provided, along with relevant log output and configuration details, which help in understanding the context. However, there are minor ambiguities and missing details. For instance, the problem statement does not explicitly state the expected solution approach (though the code changes provide a hint), nor does it discuss potential constraints or side effects of disabling optimizations or sanitizers. Additionally, edge cases or alternative configurations that might also be affected are not mentioned. Overall, while the issue is clear, the lack of explicit discussion on solution constraints or broader implications prevents it from being comprehensive.", "difficulty_explanation": "The difficulty of this problem falls into the \"Easy\" range (0.2-0.4) due to the following factors:\n\n1. **Scope and Depth of Code Changes**: The provided code change is minimal, confined to a single file (`sha256_sse4.cpp`), and involves adding a small attribute (`__attribute__((no_sanitize(\"address\")))` to disable address sanitization for the affected function. This does not impact the broader system architecture or require modifications across multiple modules. The change is localized and straightforward, requiring only a few lines of code.\n\n2. **Technical Concepts Involved**: Solving this problem requires understanding a few specific concepts, including inline assembly in C++ (to recognize why the error occurs with `-O0` and `-fsanitize=address`), compiler-specific attributes (like `__attribute__((no_sanitize(\"address\")))`), and the interaction between Clang's optimization levels and sanitizers. While these concepts are not trivial, they are relatively niche and do not require deep algorithmic or architectural knowledge. Familiarity with compiler behavior and debugging flags is sufficient, which is within the skill set of an intermediate developer.\n\n3. **Edge Cases and Error Handling**: The problem statement does not explicitly mention edge cases beyond the specific configuration causing the failure. The code change does not introduce new error handling logic; it simply bypasses the sanitizer for this function to allow compilation. There might be implicit considerations, such as ensuring that disabling the sanitizer does not mask other issues or affect fuzzing effectiveness, but these are not addressed in the problem or code change, keeping the complexity low.\n\n4. **Overall Complexity**: The issue is a compiler-specific quirk rather than a deep logical or architectural problem. The solution involves applying a known workaround (as hinted by the reference to an upstream LLVM bug) rather than designing a complex fix. While it requires some understanding of Clang's behavior and build configurations, it does not demand extensive debugging or refactoring. The difficulty is slightly elevated above \"Very Easy\" due to the need to understand compiler-specific issues and inline assembly, but it remains manageable for someone with moderate experience in C++ and build systems.\n\nThus, a score of 0.35 reflects an \"Easy\" problem that requires targeted knowledge and a simple code modification without significant impact on the broader codebase.", "clarity_label": -1, "difficulty_label": -1, "human_clarity": -1, "human_difficulty": -1}
{"problem_statement": "Windows Terminal Alt+F4 behaviour\n### Windows Terminal version\n\n1.20.11781.0\n\n### Windows build number\n\n10.0.22631.3880\n\n### Other Software\n\nAlso reproducible in:\r\nWindows Terminal Preview\r\nVersion: 1.21.1772.0\n\n### Steps to reproduce\n\n1. Start Windows Terminal.\r\n2. Open Settings -> Interaction -> Warn when closing more than one tab -> On -> Save.\r\n3. Close Settings tab and open any second terminal tab.\r\n4. Try to close terminal window with the X button in the upper right corner. It will ask for confirmation.\r\n5. Try to close terminal window with Alt+F4 shortcut. It will close window without confirmation.\r\n6. When Settings tab is active, it sometimes asks for confilmation when I press Alt+F4, but mostly not.\n\n### Expected Behavior\n\nWindows Terminal should ask for confirmation when closing window in any way: titlebar button, Alt+F4, Alt+Space menu, Taskbar menu, etc.\n\n### Actual Behavior\n\nPressing Alt+F4 shortcut will close Window Terminal window without confirmation, but pressing title bar 'close' button shows confirmation according to \"Settings -> Interaction -> Warn when closing more than one tab\" configuration.\n", "patch": "diff --git a/src/cascadia/TerminalApp/AppActionHandlers.cpp b/src/cascadia/TerminalApp/AppActionHandlers.cpp\nindex 7b4893fef1a..b2ae698205a 100644\n--- a/src/cascadia/TerminalApp/AppActionHandlers.cpp\n+++ b/src/cascadia/TerminalApp/AppActionHandlers.cpp\n@@ -118,7 +118,7 @@ namespace winrt::TerminalApp::implementation\n     void TerminalPage::_HandleCloseWindow(const IInspectable& /*sender*/,\r\n                                           const ActionEventArgs& args)\r\n     {\r\n-        CloseRequested.raise(nullptr, nullptr);\r\n+        CloseWindow();\r\n         args.Handled(true);\r\n     }\r\n \r\ndiff --git a/src/cascadia/TerminalApp/TerminalPage.h b/src/cascadia/TerminalApp/TerminalPage.h\nindex 87e7b17437b..23258c25095 100644\n--- a/src/cascadia/TerminalApp/TerminalPage.h\n+++ b/src/cascadia/TerminalApp/TerminalPage.h\n@@ -182,7 +182,6 @@ namespace winrt::TerminalApp::implementation\n         til::typed_event<IInspectable, IInspectable> SummonWindowRequested;\n         til::typed_event<IInspectable, winrt::Microsoft::Terminal::Control::WindowSizeChangedEventArgs> WindowSizeChanged;\n \n-        til::typed_event<IInspectable, IInspectable> CloseRequested;\n         til::typed_event<IInspectable, IInspectable> OpenSystemMenu;\n         til::typed_event<IInspectable, IInspectable> QuitRequested;\n         til::typed_event<IInspectable, winrt::Microsoft::Terminal::Control::ShowWindowArgs> ShowWindowChanged;\ndiff --git a/src/cascadia/TerminalApp/TerminalPage.idl b/src/cascadia/TerminalApp/TerminalPage.idl\nindex 2679d775b09..2788cedd10c 100644\n--- a/src/cascadia/TerminalApp/TerminalPage.idl\n+++ b/src/cascadia/TerminalApp/TerminalPage.idl\n@@ -95,7 +95,6 @@ namespace TerminalApp\n         event Windows.Foundation.TypedEventHandler<Object, Object> SummonWindowRequested;\n         event Windows.Foundation.TypedEventHandler<Object, Microsoft.Terminal.Control.WindowSizeChangedEventArgs> WindowSizeChanged;\n \n-        event Windows.Foundation.TypedEventHandler<Object, Object> CloseRequested;\n         event Windows.Foundation.TypedEventHandler<Object, Object> OpenSystemMenu;\n         event Windows.Foundation.TypedEventHandler<Object, Microsoft.Terminal.Control.ShowWindowArgs> ShowWindowChanged;\n \ndiff --git a/src/cascadia/TerminalApp/TerminalWindow.h b/src/cascadia/TerminalApp/TerminalWindow.h\nindex a722468a547..7467b64241d 100644\n--- a/src/cascadia/TerminalApp/TerminalWindow.h\n+++ b/src/cascadia/TerminalApp/TerminalWindow.h\n@@ -219,7 +219,6 @@ namespace winrt::TerminalApp::implementation\n         FORWARDED_TYPED_EVENT(SetTaskbarProgress, winrt::Windows::Foundation::IInspectable, winrt::Windows::Foundation::IInspectable, _root, SetTaskbarProgress);\r\n         FORWARDED_TYPED_EVENT(IdentifyWindowsRequested, Windows::Foundation::IInspectable, Windows::Foundation::IInspectable, _root, IdentifyWindowsRequested);\r\n         FORWARDED_TYPED_EVENT(SummonWindowRequested, Windows::Foundation::IInspectable, Windows::Foundation::IInspectable, _root, SummonWindowRequested);\r\n-        FORWARDED_TYPED_EVENT(CloseRequested, Windows::Foundation::IInspectable, Windows::Foundation::IInspectable, _root, CloseRequested);\r\n         FORWARDED_TYPED_EVENT(OpenSystemMenu, Windows::Foundation::IInspectable, Windows::Foundation::IInspectable, _root, OpenSystemMenu);\r\n         FORWARDED_TYPED_EVENT(QuitRequested, Windows::Foundation::IInspectable, Windows::Foundation::IInspectable, _root, QuitRequested);\r\n         FORWARDED_TYPED_EVENT(ShowWindowChanged, Windows::Foundation::IInspectable, winrt::Microsoft::Terminal::Control::ShowWindowArgs, _root, ShowWindowChanged);\r\ndiff --git a/src/cascadia/TerminalApp/TerminalWindow.idl b/src/cascadia/TerminalApp/TerminalWindow.idl\nindex 24ce090e378..f0bf2a98bd2 100644\n--- a/src/cascadia/TerminalApp/TerminalWindow.idl\n+++ b/src/cascadia/TerminalApp/TerminalWindow.idl\n@@ -122,7 +122,6 @@ namespace TerminalApp\n         event Windows.Foundation.TypedEventHandler<Object, Object> IdentifyWindowsRequested;\r\n         event Windows.Foundation.TypedEventHandler<Object, Object> IsQuakeWindowChanged;\r\n         event Windows.Foundation.TypedEventHandler<Object, Object> SummonWindowRequested;\r\n-        event Windows.Foundation.TypedEventHandler<Object, Object> CloseRequested;\r\n         event Windows.Foundation.TypedEventHandler<Object, Object> OpenSystemMenu;\r\n         event Windows.Foundation.TypedEventHandler<Object, Object> QuitRequested;\r\n         event Windows.Foundation.TypedEventHandler<Object, TerminalApp.SystemMenuChangeArgs> SystemMenuChangeRequested;\r\ndiff --git a/src/cascadia/WindowsTerminal/AppHost.cpp b/src/cascadia/WindowsTerminal/AppHost.cpp\nindex ac255aa95b2..0fd623aad61 100644\n--- a/src/cascadia/WindowsTerminal/AppHost.cpp\n+++ b/src/cascadia/WindowsTerminal/AppHost.cpp\n@@ -213,9 +213,6 @@ void AppHost::Initialize()\n     _windowCallbacks.WindowCloseButtonClicked = _window->WindowCloseButtonClicked([this]() {\r\n         _windowLogic.CloseWindow();\r\n     });\r\n-    // If the user requests a close in another way handle the same as if the 'X'\r\n-    // was clicked.\r\n-    _revokers.CloseRequested = _windowLogic.CloseRequested(winrt::auto_revoke, { this, &AppHost::_CloseRequested });\r\n \r\n     // Add an event handler to plumb clicks in the titlebar area down to the\r\n     // application layer.\r\ndiff --git a/src/cascadia/WindowsTerminal/AppHost.h b/src/cascadia/WindowsTerminal/AppHost.h\nindex fba8274b176..be987ef0c7a 100644\n--- a/src/cascadia/WindowsTerminal/AppHost.h\n+++ b/src/cascadia/WindowsTerminal/AppHost.h\n@@ -138,7 +138,6 @@ class AppHost : public std::enable_shared_from_this<AppHost>\n     struct Revokers\r\n     {\r\n         winrt::TerminalApp::TerminalWindow::Initialized_revoker Initialized;\r\n-        winrt::TerminalApp::TerminalWindow::CloseRequested_revoker CloseRequested;\r\n         winrt::TerminalApp::TerminalWindow::RequestedThemeChanged_revoker RequestedThemeChanged;\r\n         winrt::TerminalApp::TerminalWindow::FullscreenChanged_revoker FullscreenChanged;\r\n         winrt::TerminalApp::TerminalWindow::FocusModeChanged_revoker FocusModeChanged;\r\n", "instance_id": "microsoft__terminal-18434", "clarity": 2, "difficulty": 0.35, "clarity_explanation": "The problem statement is mostly clear in describing the issue with Windows Terminal's behavior regarding the Alt+F4 shortcut not prompting for confirmation when closing multiple tabs, despite the setting being enabled. It provides specific steps to reproduce the issue, expected behavior, and actual behavior, which helps in understanding the problem. However, there are minor ambiguities, such as the inconsistent behavior when the Settings tab is active (sometimes prompting for confirmation, mostly not), which is not fully explained or detailed. Additionally, the problem statement does not explicitly mention any specific edge cases or constraints beyond the general behavior, which could leave some room for interpretation during implementation. Overall, it is clear enough to understand the goal but lacks exhaustive detail on all possible scenarios or edge cases.", "difficulty_explanation": "The difficulty of this problem falls into the \"Easy\" range (0.2-0.4) due to several factors. First, the scope of code changes is relatively limited, affecting a small number of files (six files in total) and primarily involving the removal of an event (`CloseRequested`) and a direct call to `CloseWindow()` instead of raising the event. This suggests a straightforward modification to unify the closing behavior across different triggers (e.g., Alt+F4 and the titlebar close button). Second, the technical concepts required are not overly complex; they involve understanding event handling in a Windows application (specifically in the context of WinRT and the Windows Terminal codebase) and basic control flow modifications. Third, the changes do not appear to impact the broader system architecture significantly, as they are confined to specific event-handling logic. However, there is a slight increase in difficulty due to the need to ensure consistency in behavior across different closing methods, which might involve verifying that the `CloseWindow()` function respects the confirmation setting\u2014an aspect not fully detailed in the provided diff. Edge cases, such as the inconsistent behavior with the Settings tab, are mentioned in the problem statement but not explicitly addressed in the code changes, which could require additional investigation or minor adjustments. Overall, this task requires understanding some code logic and making simple modifications, fitting within the lower end of the difficulty spectrum.", "clarity_label": -1, "difficulty_label": -1, "human_clarity": -1, "human_difficulty": -1}
{"problem_statement": "No tabs in fullscreen, focus mode or not\n### Windows Terminal version (or Windows build number)\n\n1.11.2421.0\n\n### Other Software\n\n_No response_\n\n### Steps to reproduce\n\nUse F11 to switch between full screen and windowed mode. In the latter, tabs appear fine. In the former, there are never tabs shown. Setting a keybind for focus toggle will only affect the windowed mode, and I cannot get tabs in full screen mode under any circumstances.\r\n\r\nI've tried opening multiple tabs to make sure it wasn't a \"auto-hide the tabs if there's only one session open\" case.\n\n### Expected Behavior\n\nI would expect full screen mode to honor the focus mode.\n\n### Actual Behavior\n\nFocus mode is not honored and tabs will never appear in full screen mode.\n", "patch": "diff --git a/doc/cascadia/profiles.schema.json b/doc/cascadia/profiles.schema.json\nindex e9f123f7007..8c3fa8220d0 100644\n--- a/doc/cascadia/profiles.schema.json\n+++ b/doc/cascadia/profiles.schema.json\n@@ -2537,6 +2537,11 @@\n           \"description\": \"When set to true, the Terminal's tab row will display a shield icon when the Terminal is running with administrator privileges\",\n           \"type\": \"boolean\"\n         },\n+        \"showTabsFullscreen\": {\n+          \"default\": false,\n+          \"description\": \"When set to true, tabs remain visible in fullscreen mode. When set to false, tabs will be hidden when entering fullscreen mode.\",\n+          \"type\": \"boolean\"\n+        },\n         \"useAcrylicInTabRow\": {\n           \"default\": false,\n           \"description\": \"When set to true, the tab row will have an acrylic material background with 50% opacity.\",\ndiff --git a/src/cascadia/TerminalApp/TabManagement.cpp b/src/cascadia/TerminalApp/TabManagement.cpp\nindex 0eba4511a92..cf0df031750 100644\n--- a/src/cascadia/TerminalApp/TabManagement.cpp\n+++ b/src/cascadia/TerminalApp/TabManagement.cpp\n@@ -243,10 +243,12 @@ namespace winrt::TerminalApp::implementation\n     // - Handle changes in tab layout.\r\n     void TerminalPage::_UpdateTabView()\r\n     {\r\n-        // Never show the tab row when we're fullscreen. Otherwise:\r\n-        // Show tabs when there's more than 1, or the user has chosen to always\r\n-        // show the tab bar.\r\n-        const auto isVisible = (!_isFullscreen && !_isInFocusMode) &&\r\n+        // The tab row should only be visible if:\r\n+        // - we're not in focus mode\r\n+        // - we're not in full screen, or the user has enabled fullscreen tabs\r\n+        // - there is more than one tab, or the user has chosen to always show tabs\r\n+        const auto isVisible = !_isInFocusMode &&\r\n+                               (!_isFullscreen || _showTabsFullscreen) &&\r\n                                (_settings.GlobalSettings().ShowTabsInTitlebar() ||\r\n                                 (_tabs.Size() > 1) ||\r\n                                 _settings.GlobalSettings().AlwaysShowTabs());\r\ndiff --git a/src/cascadia/TerminalApp/TerminalPage.cpp b/src/cascadia/TerminalApp/TerminalPage.cpp\nindex e73ba93193b..c71596b7080 100644\n--- a/src/cascadia/TerminalApp/TerminalPage.cpp\n+++ b/src/cascadia/TerminalApp/TerminalPage.cpp\n@@ -269,6 +269,7 @@ namespace winrt::TerminalApp::implementation\n         _layoutUpdatedRevoker = _tabContent.LayoutUpdated(winrt::auto_revoke, { this, &TerminalPage::_OnFirstLayout });\n \n         _isAlwaysOnTop = _settings.GlobalSettings().AlwaysOnTop();\n+        _showTabsFullscreen = _settings.GlobalSettings().ShowTabsFullscreen();\n \n         // DON'T set up Toasts/TeachingTips here. They should be loaded and\n         // initialized the first time they're opened, in whatever method opens\n@@ -3599,6 +3600,8 @@ namespace winrt::TerminalApp::implementation\n         _isAlwaysOnTop = _settings.GlobalSettings().AlwaysOnTop();\n         AlwaysOnTopChanged.raise(*this, nullptr);\n \n+        _showTabsFullscreen = _settings.GlobalSettings().ShowTabsFullscreen();\n+\n         // Settings AllowDependentAnimations will affect whether animations are\n         // enabled application-wide, so we don't need to check it each time we\n         // want to create an animation.\n@@ -4023,6 +4026,37 @@ namespace winrt::TerminalApp::implementation\n         return _isAlwaysOnTop;\n     }\n \n+    // Method Description:\n+    // - Returns true if the tab row should be visible when we're in full screen\n+    //   state.\n+    // Arguments:\n+    // - <none>\n+    // Return Value:\n+    // - true if the tab row should be visible in full screen state\n+    bool TerminalPage::ShowTabsFullscreen() const\n+    {\n+        return _showTabsFullscreen;\n+    }\n+\n+    // Method Description:\n+    // - Updates the visibility of the tab row when in fullscreen state.\n+    void TerminalPage::SetShowTabsFullscreen(bool newShowTabsFullscreen)\n+    {\n+        if (_showTabsFullscreen == newShowTabsFullscreen)\n+        {\n+            return;\n+        }\n+\n+        _showTabsFullscreen = newShowTabsFullscreen;\n+\n+        // if we're currently in fullscreen, update tab view to make\n+        // sure tabs are given the correct visibility\n+        if (_isFullscreen)\n+        {\n+            _UpdateTabView();\n+        }\n+    }\n+\n     void TerminalPage::SetFullscreen(bool newFullscreen)\n     {\n         if (_isFullscreen == newFullscreen)\ndiff --git a/src/cascadia/TerminalApp/TerminalPage.h b/src/cascadia/TerminalApp/TerminalPage.h\nindex 87e7b17437b..f749479b090 100644\n--- a/src/cascadia/TerminalApp/TerminalPage.h\n+++ b/src/cascadia/TerminalApp/TerminalPage.h\n@@ -121,6 +121,8 @@ namespace winrt::TerminalApp::implementation\n         bool FocusMode() const;\n         bool Fullscreen() const;\n         bool AlwaysOnTop() const;\n+        bool ShowTabsFullscreen() const;\n+        void SetShowTabsFullscreen(bool newShowTabsFullscreen);\n         void SetFullscreen(bool);\n         void SetFocusMode(const bool inFocusMode);\n         void Maximized(bool newMaximized);\n@@ -229,6 +231,7 @@ namespace winrt::TerminalApp::implementation\n         bool _isFullscreen{ false };\n         bool _isMaximized{ false };\n         bool _isAlwaysOnTop{ false };\n+        bool _showTabsFullscreen{ false };\n \n         std::optional<uint32_t> _loadFromPersistedLayoutIdx{};\n \ndiff --git a/src/cascadia/TerminalApp/TerminalWindow.cpp b/src/cascadia/TerminalApp/TerminalWindow.cpp\nindex 569b236374a..055d6123ccf 100644\n--- a/src/cascadia/TerminalApp/TerminalWindow.cpp\n+++ b/src/cascadia/TerminalApp/TerminalWindow.cpp\n@@ -289,6 +289,11 @@ namespace winrt::TerminalApp::implementation\n         return _settings.GlobalSettings().AlwaysOnTop();\r\n     }\r\n \r\n+    bool TerminalWindow::GetInitialShowTabsFullscreen()\r\n+    {\r\n+        return _settings.GlobalSettings().ShowTabsFullscreen();\r\n+    }\r\n+\r\n     bool TerminalWindow::GetMinimizeToNotificationArea()\r\n     {\r\n         return _settings.GlobalSettings().MinimizeToNotificationArea();\r\n@@ -981,6 +986,11 @@ namespace winrt::TerminalApp::implementation\n         return _root ? _root->AlwaysOnTop() : false;\r\n     }\r\n \r\n+    bool TerminalWindow::ShowTabsFullscreen() const\r\n+    {\r\n+        return _root ? _root->ShowTabsFullscreen() : false;\r\n+    }\r\n+\r\n     void TerminalWindow::SetSettingsStartupArgs(const std::vector<ActionAndArgs>& actions)\r\n     {\r\n         for (const auto& action : actions)\r\ndiff --git a/src/cascadia/TerminalApp/TerminalWindow.h b/src/cascadia/TerminalApp/TerminalWindow.h\nindex a722468a547..0fd63a6362c 100644\n--- a/src/cascadia/TerminalApp/TerminalWindow.h\n+++ b/src/cascadia/TerminalApp/TerminalWindow.h\n@@ -89,6 +89,7 @@ namespace winrt::TerminalApp::implementation\n         bool Fullscreen() const;\r\n         void Maximized(bool newMaximized);\r\n         bool AlwaysOnTop() const;\r\n+        bool ShowTabsFullscreen() const;\r\n         bool AutoHideWindow();\r\n         void IdentifyWindow();\r\n \r\n@@ -106,6 +107,7 @@ namespace winrt::TerminalApp::implementation\n         Microsoft::Terminal::Settings::Model::LaunchMode GetLaunchMode();\r\n         bool GetShowTabsInTitlebar();\r\n         bool GetInitialAlwaysOnTop();\r\n+        bool GetInitialShowTabsFullscreen();\r\n         float CalcSnappedDimension(const bool widthOrHeight, const float dimension) const;\r\n \r\n         Windows::UI::Xaml::UIElement GetRoot() noexcept;\r\ndiff --git a/src/cascadia/TerminalApp/TerminalWindow.idl b/src/cascadia/TerminalApp/TerminalWindow.idl\nindex 24ce090e378..63c9169caf8 100644\n--- a/src/cascadia/TerminalApp/TerminalWindow.idl\n+++ b/src/cascadia/TerminalApp/TerminalWindow.idl\n@@ -69,6 +69,7 @@ namespace TerminalApp\n         void Maximized(Boolean newMaximized);\r\n         Boolean AlwaysOnTop { get; };\r\n         Boolean AutoHideWindow { get; };\r\n+        Boolean ShowTabsFullscreen { get; };\r\n \r\n         void IdentifyWindow();\r\n         void SetPersistedLayoutIdx(UInt32 idx);\r\n@@ -82,6 +83,7 @@ namespace TerminalApp\n         Microsoft.Terminal.Settings.Model.LaunchMode GetLaunchMode();\r\n         Boolean GetShowTabsInTitlebar();\r\n         Boolean GetInitialAlwaysOnTop();\r\n+        Boolean GetInitialShowTabsFullscreen();\r\n         Single CalcSnappedDimension(Boolean widthOrHeight, Single dimension);\r\n         void TitlebarClicked();\r\n         void CloseWindow();\r\ndiff --git a/src/cascadia/TerminalApp/TitlebarControl.cpp b/src/cascadia/TerminalApp/TitlebarControl.cpp\nindex 1debd030544..1ed82f39ca6 100644\n--- a/src/cascadia/TerminalApp/TitlebarControl.cpp\n+++ b/src/cascadia/TerminalApp/TitlebarControl.cpp\n@@ -12,6 +12,8 @@\n \r\n #include \"TitlebarControl.g.cpp\"\r\n \r\n+using namespace winrt::Windows::UI::Xaml;\r\n+\r\n namespace winrt::TerminalApp::implementation\r\n {\r\n     TitlebarControl::TitlebarControl(uint64_t handle) :\r\n@@ -77,6 +79,11 @@ namespace winrt::TerminalApp::implementation\n         }\r\n     }\r\n \r\n+    void TitlebarControl::FullscreenChanged(const bool fullscreen)\r\n+    {\r\n+        MinMaxCloseControl().Visibility(fullscreen ? Visibility::Collapsed : Visibility::Visible);\r\n+    }\r\n+\r\n     void TitlebarControl::_OnMaximizeOrRestore(byte flag)\r\n     {\r\n         POINT point1 = {};\r\ndiff --git a/src/cascadia/TerminalApp/TitlebarControl.h b/src/cascadia/TerminalApp/TitlebarControl.h\nindex 8020ff90956..1008253ba8d 100644\n--- a/src/cascadia/TerminalApp/TitlebarControl.h\n+++ b/src/cascadia/TerminalApp/TitlebarControl.h\n@@ -22,6 +22,7 @@ namespace winrt::TerminalApp::implementation\n \r\n         void SetWindowVisualState(WindowVisualState visualState);\r\n         void Root_SizeChanged(const IInspectable& sender, const Windows::UI::Xaml::SizeChangedEventArgs& e);\r\n+        void FullscreenChanged(const bool fullscreen);\r\n \r\n         void Minimize_Click(const winrt::Windows::Foundation::IInspectable& sender, const winrt::Windows::UI::Xaml::RoutedEventArgs& e);\r\n         void Maximize_Click(const winrt::Windows::Foundation::IInspectable& sender, const winrt::Windows::UI::Xaml::RoutedEventArgs& e);\r\ndiff --git a/src/cascadia/TerminalApp/TitlebarControl.idl b/src/cascadia/TerminalApp/TitlebarControl.idl\nindex b7a06ba987e..8f934fae951 100644\n--- a/src/cascadia/TerminalApp/TitlebarControl.idl\n+++ b/src/cascadia/TerminalApp/TitlebarControl.idl\n@@ -22,6 +22,7 @@ namespace TerminalApp\n     {\r\n         TitlebarControl(UInt64 parentWindowHandle);\r\n         void SetWindowVisualState(WindowVisualState visualState);\r\n+        void FullscreenChanged(Boolean fullscreen);\r\n \r\n         void HoverButton(CaptionButton button);\r\n         void PressButton(CaptionButton button);\r\ndiff --git a/src/cascadia/TerminalSettingsEditor/GlobalAppearance.xaml b/src/cascadia/TerminalSettingsEditor/GlobalAppearance.xaml\nindex f227268613d..854fd733766 100644\n--- a/src/cascadia/TerminalSettingsEditor/GlobalAppearance.xaml\n+++ b/src/cascadia/TerminalSettingsEditor/GlobalAppearance.xaml\n@@ -64,6 +64,12 @@\n                           Style=\"{StaticResource ToggleSwitchInExpanderStyle}\" />\r\n         </local:SettingContainer>\r\n \r\n+        <!--  Show tabs in full screen  -->\r\n+        <local:SettingContainer x:Uid=\"Globals_ShowTabsFullscreen\">\r\n+            <ToggleSwitch IsOn=\"{x:Bind ViewModel.ShowTabsFullscreen, Mode=TwoWay}\"\r\n+                          Style=\"{StaticResource ToggleSwitchInExpanderStyle}\" />\r\n+        </local:SettingContainer>\r\n+\r\n         <!--  Show Acrylic in Tab Row  -->\r\n         <local:SettingContainer x:Uid=\"Globals_AcrylicTabRow\">\r\n             <ToggleSwitch IsOn=\"{x:Bind ViewModel.UseAcrylicInTabRow, Mode=TwoWay}\"\r\ndiff --git a/src/cascadia/TerminalSettingsEditor/GlobalAppearanceViewModel.h b/src/cascadia/TerminalSettingsEditor/GlobalAppearanceViewModel.h\nindex 7c19b543f5b..108636a747f 100644\n--- a/src/cascadia/TerminalSettingsEditor/GlobalAppearanceViewModel.h\n+++ b/src/cascadia/TerminalSettingsEditor/GlobalAppearanceViewModel.h\n@@ -32,6 +32,7 @@ namespace winrt::Microsoft::Terminal::Settings::Editor::implementation\n         void ShowTitlebarToggled(const winrt::Windows::Foundation::IInspectable& sender, const winrt::Windows::UI::Xaml::RoutedEventArgs& args);\r\n \r\n         PERMANENT_OBSERVABLE_PROJECTED_SETTING(_GlobalSettings, AlwaysShowTabs);\r\n+        PERMANENT_OBSERVABLE_PROJECTED_SETTING(_GlobalSettings, ShowTabsFullscreen);\r\n         PERMANENT_OBSERVABLE_PROJECTED_SETTING(_GlobalSettings, ShowTabsInTitlebar);\r\n         PERMANENT_OBSERVABLE_PROJECTED_SETTING(_GlobalSettings, UseAcrylicInTabRow);\r\n         PERMANENT_OBSERVABLE_PROJECTED_SETTING(_GlobalSettings, ShowTitleInTitlebar);\r\ndiff --git a/src/cascadia/TerminalSettingsEditor/GlobalAppearanceViewModel.idl b/src/cascadia/TerminalSettingsEditor/GlobalAppearanceViewModel.idl\nindex 7f39f92709f..fb75021608c 100644\n--- a/src/cascadia/TerminalSettingsEditor/GlobalAppearanceViewModel.idl\n+++ b/src/cascadia/TerminalSettingsEditor/GlobalAppearanceViewModel.idl\n@@ -26,6 +26,7 @@ namespace Microsoft.Terminal.Settings.Editor\n         void ShowTitlebarToggled(IInspectable sender, Windows.UI.Xaml.RoutedEventArgs args);\r\n \r\n         PERMANENT_OBSERVABLE_PROJECTED_SETTING(Boolean, AlwaysShowTabs);\r\n+        PERMANENT_OBSERVABLE_PROJECTED_SETTING(Boolean, ShowTabsFullscreen);\r\n         PERMANENT_OBSERVABLE_PROJECTED_SETTING(Boolean, ShowTabsInTitlebar);\r\n         PERMANENT_OBSERVABLE_PROJECTED_SETTING(Boolean, UseAcrylicInTabRow);\r\n         PERMANENT_OBSERVABLE_PROJECTED_SETTING(Boolean, ShowTitleInTitlebar);\r\ndiff --git a/src/cascadia/TerminalSettingsEditor/Resources/en-US/Resources.resw b/src/cascadia/TerminalSettingsEditor/Resources/en-US/Resources.resw\nindex d7a0c3efe36..67990bafcbc 100644\n--- a/src/cascadia/TerminalSettingsEditor/Resources/en-US/Resources.resw\n+++ b/src/cascadia/TerminalSettingsEditor/Resources/en-US/Resources.resw\n@@ -2276,6 +2276,14 @@\n     <value>Display a shield in the title bar when Windows Terminal is running as Administrator</value>\r\n     <comment>Header for a control to toggle displaying a shield in the title bar of the app. \"Admin\" refers to elevated sessions like \"run as Admin\"</comment>\r\n   </data>\r\n+  <data name=\"Globals_ShowTabsFullscreen.Header\" xml:space=\"preserve\">\r\n+    <value>Show tabs in full screen</value>\r\n+    <comment>Header for a control to toggle if the app should show the tabs when in full screen state.</comment>\r\n+  </data>\r\n+  <data name=\"Globals_ShowTabsFullscreen.HelpText\" xml:space=\"preserve\">\r\n+    <value>When enabled, the tab bar will be visible when the app is full screen.</value>\r\n+    <comment>A description for what the \"show tabs in full screen\" setting does.</comment>\r\n+  </data>\r\n   <data name=\"Profile_PathTranslationStyle.[using:Windows.UI.Xaml.Automation]AutomationProperties.Name\" xml:space=\"preserve\">\r\n     <value>Path translation</value>\r\n     <comment>Name for a control to select how file and directory paths are translated.</comment>\r\ndiff --git a/src/cascadia/TerminalSettingsModel/GlobalAppSettings.idl b/src/cascadia/TerminalSettingsModel/GlobalAppSettings.idl\nindex b04073273ba..cee08a2656d 100644\n--- a/src/cascadia/TerminalSettingsModel/GlobalAppSettings.idl\n+++ b/src/cascadia/TerminalSettingsModel/GlobalAppSettings.idl\n@@ -57,6 +57,7 @@ namespace Microsoft.Terminal.Settings.Model\n         INHERITABLE_SETTING(Int32, InitialRows);\r\n         INHERITABLE_SETTING(Int32, InitialCols);\r\n         INHERITABLE_SETTING(Boolean, AlwaysShowTabs);\r\n+        INHERITABLE_SETTING(Boolean, ShowTabsFullscreen);\r\n         INHERITABLE_SETTING(NewTabPosition, NewTabPosition);\r\n         INHERITABLE_SETTING(Boolean, ShowTitleInTitlebar);\r\n         INHERITABLE_SETTING(Boolean, ConfirmCloseAllTabs);\r\ndiff --git a/src/cascadia/TerminalSettingsModel/MTSMSettings.h b/src/cascadia/TerminalSettingsModel/MTSMSettings.h\nindex c2553db2e47..e74a5c8b3b0 100644\n--- a/src/cascadia/TerminalSettingsModel/MTSMSettings.h\n+++ b/src/cascadia/TerminalSettingsModel/MTSMSettings.h\n@@ -68,7 +68,8 @@ Author(s):\n     X(bool, EnableUnfocusedAcrylic, \"compatibility.enableUnfocusedAcrylic\", true)                                                                                                                     \\\r\n     X(winrt::Windows::Foundation::Collections::IVector<Model::NewTabMenuEntry>, NewTabMenu, \"newTabMenu\", winrt::single_threaded_vector<Model::NewTabMenuEntry>({ Model::RemainingProfilesEntry{} })) \\\r\n     X(bool, AllowHeadless, \"compatibility.allowHeadless\", false)                                                                                                                                      \\\r\n-    X(hstring, SearchWebDefaultQueryUrl, \"searchWebDefaultQueryUrl\", L\"https://www.bing.com/search?q=%22%s%22\")\r\n+    X(hstring, SearchWebDefaultQueryUrl, \"searchWebDefaultQueryUrl\", L\"https://www.bing.com/search?q=%22%s%22\")                                                                                       \\\r\n+    X(bool, ShowTabsFullscreen, \"showTabsFullscreen\", false)\r\n \r\n // Also add these settings to:\r\n // * Profile.idl\r\ndiff --git a/src/cascadia/WindowsTerminal/AppHost.cpp b/src/cascadia/WindowsTerminal/AppHost.cpp\nindex c7db8e38e1a..ea38d7dcdfc 100644\n--- a/src/cascadia/WindowsTerminal/AppHost.cpp\n+++ b/src/cascadia/WindowsTerminal/AppHost.cpp\n@@ -193,6 +193,7 @@ void AppHost::Initialize()\n \r\n     _window->SetAlwaysOnTop(_windowLogic.GetInitialAlwaysOnTop());\r\n     _window->SetAutoHideWindow(_windowLogic.AutoHideWindow());\r\n+    _window->SetShowTabsFullscreen(_windowLogic.GetInitialShowTabsFullscreen());\r\n \r\n     // MORE EVENT HANDLERS HERE!\r\n     // MAKE SURE THEY ARE ALL:\r\n@@ -1023,6 +1024,7 @@ void AppHost::_HandleSettingsChanged(const winrt::Windows::Foundation::IInspecta\n \r\n     _window->SetMinimizeToNotificationAreaBehavior(_windowLogic.GetMinimizeToNotificationArea());\r\n     _window->SetAutoHideWindow(_windowLogic.AutoHideWindow());\r\n+    _window->SetShowTabsFullscreen(_windowLogic.ShowTabsFullscreen());\r\n     _updateTheme();\r\n }\r\n \r\ndiff --git a/src/cascadia/WindowsTerminal/IslandWindow.cpp b/src/cascadia/WindowsTerminal/IslandWindow.cpp\nindex 4c950cb986d..693569791ec 100644\n--- a/src/cascadia/WindowsTerminal/IslandWindow.cpp\n+++ b/src/cascadia/WindowsTerminal/IslandWindow.cpp\n@@ -848,6 +848,11 @@ void IslandWindow::ShowWindowChanged(const bool showOrHide)\n     }\r\n }\r\n \r\n+void IslandWindow::SetShowTabsFullscreen(const bool newShowTabsFullscreen)\r\n+{\r\n+    _showTabsFullscreen = newShowTabsFullscreen;\r\n+}\r\n+\r\n // Method Description\r\n // - Flash the taskbar icon, indicating to the user that something needs their attention\r\n void IslandWindow::FlashTaskbar()\r\ndiff --git a/src/cascadia/WindowsTerminal/IslandWindow.h b/src/cascadia/WindowsTerminal/IslandWindow.h\nindex 8432d4e8134..ef050291e07 100644\n--- a/src/cascadia/WindowsTerminal/IslandWindow.h\n+++ b/src/cascadia/WindowsTerminal/IslandWindow.h\n@@ -46,6 +46,7 @@ class IslandWindow :\n     void FullscreenChanged(const bool fullscreen);\n     void SetAlwaysOnTop(const bool alwaysOnTop);\n     void ShowWindowChanged(const bool showOrHide);\n+    virtual void SetShowTabsFullscreen(const bool newShowTabsFullscreen);\n \n     void FlashTaskbar();\n     void SetTaskbarProgress(const size_t state, const size_t progress);\n@@ -105,6 +106,7 @@ class IslandWindow :\n     bool _borderless{ false };\n     bool _alwaysOnTop{ false };\n     bool _fullscreen{ false };\n+    bool _showTabsFullscreen{ false };\n     bool _fWasMaximizedBeforeFullscreen{ false };\n     RECT _rcWindowBeforeFullscreen{};\n     RECT _rcWorkBeforeFullscreen{};\n@@ -112,6 +114,7 @@ class IslandWindow :\n \n     virtual void _SetIsBorderless(const bool borderlessEnabled);\n     virtual void _SetIsFullscreen(const bool fullscreenEnabled);\n+\n     void _RestoreFullscreenPosition(const RECT& rcWork);\n     void _SetFullscreenPosition(const RECT& rcMonitor, const RECT& rcWork);\n \ndiff --git a/src/cascadia/WindowsTerminal/NonClientIslandWindow.cpp b/src/cascadia/WindowsTerminal/NonClientIslandWindow.cpp\nindex 3c66105885c..414e4043f88 100644\n--- a/src/cascadia/WindowsTerminal/NonClientIslandWindow.cpp\n+++ b/src/cascadia/WindowsTerminal/NonClientIslandWindow.cpp\n@@ -1129,7 +1129,7 @@ void NonClientIslandWindow::_SetIsBorderless(const bool borderlessEnabled)\n \r\n // Method Description:\r\n // - Enable or disable fullscreen mode. When entering fullscreen mode, we'll\r\n-//   need to manually hide the entire titlebar.\r\n+//   need to check whether to hide the titlebar.\r\n // - See also IslandWindow::_SetIsFullscreen, which does additional work.\r\n // Arguments:\r\n // - fullscreenEnabled: If true, we're entering fullscreen mode. If false, we're leaving.\r\n@@ -1138,10 +1138,7 @@ void NonClientIslandWindow::_SetIsBorderless(const bool borderlessEnabled)\n void NonClientIslandWindow::_SetIsFullscreen(const bool fullscreenEnabled)\r\n {\r\n     IslandWindow::_SetIsFullscreen(fullscreenEnabled);\r\n-    if (_titlebar)\r\n-    {\r\n-        _titlebar.Visibility(_IsTitlebarVisible() ? Visibility::Visible : Visibility::Collapsed);\r\n-    }\r\n+    _UpdateTitlebarVisibility();\r\n     // GH#4224 - When the auto-hide taskbar setting is enabled, then we don't\r\n     // always get another window message to trigger us to remove the drag bar.\r\n     // So, make sure to update the size of the drag region here, so that it\r\n@@ -1149,16 +1146,42 @@ void NonClientIslandWindow::_SetIsFullscreen(const bool fullscreenEnabled)\n     _ResizeDragBarWindow();\r\n }\r\n \r\n+void NonClientIslandWindow::SetShowTabsFullscreen(const bool newShowTabsFullscreen)\r\n+{\r\n+    IslandWindow::SetShowTabsFullscreen(newShowTabsFullscreen);\r\n+\r\n+    // don't waste time recalculating UI elements if we're not\r\n+    // in fullscreen state - this setting doesn't affect other\r\n+    // window states\r\n+    if (_fullscreen)\r\n+    {\r\n+        _UpdateTitlebarVisibility();\r\n+    }\r\n+}\r\n+\r\n+void NonClientIslandWindow::_UpdateTitlebarVisibility()\r\n+{\r\n+    if (!_titlebar)\r\n+    {\r\n+        return;\r\n+    }\r\n+\r\n+    const auto showTitlebar = _IsTitlebarVisible();\r\n+    _titlebar.Visibility(showTitlebar ? Visibility::Visible : Visibility::Collapsed);\r\n+    _titlebar.FullscreenChanged(_fullscreen);\r\n+}\r\n+\r\n // Method Description:\r\n-// - Returns true if the titlebar is visible. For things like fullscreen mode,\r\n-//   borderless mode (aka \"focus mode\"), this will return false.\r\n+// - Returns true if the titlebar is visible. For borderless mode (aka \"focus mode\"),\r\n+//   this will return false. For fullscreen, this will return false unless the user\r\n+//   has enabled fullscreen tabs.\r\n // Arguments:\r\n // - <none>\r\n // Return Value:\r\n // - true iff the titlebar is visible\r\n bool NonClientIslandWindow::_IsTitlebarVisible() const\r\n {\r\n-    return !(_fullscreen || _borderless);\r\n+    return !_borderless && (!_fullscreen || _showTabsFullscreen);\r\n }\r\n \r\n void NonClientIslandWindow::SetTitlebarBackground(winrt::Windows::UI::Xaml::Media::Brush brush)\r\ndiff --git a/src/cascadia/WindowsTerminal/NonClientIslandWindow.h b/src/cascadia/WindowsTerminal/NonClientIslandWindow.h\nindex 76e093a2340..bdf64f98409 100644\n--- a/src/cascadia/WindowsTerminal/NonClientIslandWindow.h\n+++ b/src/cascadia/WindowsTerminal/NonClientIslandWindow.h\n@@ -46,6 +46,7 @@ class NonClientIslandWindow : public IslandWindow\n     void OnApplicationThemeChanged(const winrt::Windows::UI::Xaml::ElementTheme& requestedTheme) override;\r\n \r\n     void SetTitlebarBackground(winrt::Windows::UI::Xaml::Media::Brush brush);\r\n+    void SetShowTabsFullscreen(const bool newShowTabsFullscreen) override;\r\n \r\n     virtual void UseMica(const bool newValue, const double titlebarOpacity) override;\r\n \r\n@@ -92,6 +93,7 @@ class NonClientIslandWindow : public IslandWindow\n     void _UpdateFrameMargins() const noexcept;\r\n     void _UpdateMaximizedState();\r\n     void _UpdateIslandPosition(const UINT windowWidth, const UINT windowHeight);\r\n+    void _UpdateTitlebarVisibility();\r\n \r\n     struct Revokers\r\n     {\r\n", "instance_id": "microsoft__terminal-18171", "clarity": 2, "difficulty": 0.45, "clarity_explanation": "The problem statement is mostly clear in describing the issue: tabs are not visible in fullscreen mode in Windows Terminal, regardless of focus mode settings, and the user expects fullscreen mode to honor focus mode settings or allow tabs to be shown. The steps to reproduce are provided, along with expected and actual behavior, which helps in understanding the issue. However, there are minor ambiguities and missing details. For instance, the problem statement does not explicitly specify whether the solution should involve a user-configurable setting or a hardcoded behavior change. Additionally, it lacks mention of potential edge cases (e.g., behavior with specific configurations or themes) or constraints (e.g., performance considerations in fullscreen mode). While the intent is clear, these missing details prevent it from being comprehensive.", "difficulty_explanation": "The difficulty of this problem falls in the medium range due to several factors. First, the scope of code changes is moderate, spanning multiple files (e.g., settings schema, UI logic, window management) and requiring modifications to both logic and user interface components. This indicates a need to understand interactions between different parts of the codebase, such as settings management, tab visibility logic, and fullscreen mode handling. Second, the number of technical concepts involved is not trivial; it includes understanding Windows Terminal's settings model, UI rendering logic (e.g., visibility toggles), and potentially XAML-based UI components. However, the concepts are not overly complex for someone familiar with the codebase or Windows application development. Third, the problem does not explicitly mention edge cases, but the code changes suggest handling scenarios like toggling fullscreen mode dynamically and ensuring consistency with other settings (e.g., focus mode). The error handling requirements appear minimal, as the changes focus on visibility logic rather than complex error conditions. Overall, while the problem requires a moderate level of understanding and effort across several files, it does not involve deep architectural changes or highly complex logic, placing it in the 0.4-0.6 range, specifically at 0.45.", "clarity_label": -1, "difficulty_label": -1, "human_clarity": -1, "human_difficulty": -1}
