{"problem_statement": "`px delete` fails on recent K8s versions (1.30)\n**Describe the bug**\r\nRunning `px delete` against a recent K8s version (1.30) fails with the following error:\r\n\r\n```\r\n$ px delete --namespace testing\r\nPixie CLI\r\nThis action will delete the entire 'testing' namespace.\r\nConfirm to proceed on cluster gke_csmc-dev_us-west1-a_dev-cluster-ddelnano1. (y/n) [y] : y\r\n \u2714    Deleting namespace\r\n \u2715    Deleting cluster-scoped resources  ERR: resource name may not be empty\r\nError deleting Pixie error=resource name may not be empty\r\n```\r\n\r\nRunning against a 1.27 version cluster (1.27.16-gke.1342000) results in the correct behavior.\r\n\r\n**To Reproduce**\r\nSteps to reproduce the behavior:\r\n1. Deploy pixie to a k8s cluster (`px deploy`)\r\n2. Attempt to delete it with `px delete`\r\n\r\nThis is also reproducible without when deleting non vizier resources since it's a bug with our handling of k8s API server calls\r\n1. Create any following ConfigMap\r\n```\r\n$ kubectl create namespace testing\r\n# sample_map.yaml\r\n---\r\napiVersion: v1\r\nkind: ConfigMap\r\nmetadata:\r\n  name: pl-indexer-config\r\n  labels:\r\n    component: vizier\r\ndata:\r\n  PL_MD_INDEX_REPLICAS: \"1\"\r\n\r\n$ kubectl apply -n testing -f k8s/cloud/dev/indexer_config.yaml\r\n```\r\n2. Attempt to delete the `testing` namespace\r\n```\r\n$ px delete --namespace testing\r\n```\r\n\r\n**Expected behavior**\r\nNamespace and the resources with the `component=vizier` labels should be removed\r\n\r\n\r\n**App information (please complete the following information):**\r\n- Pixie version: 0.14.11\r\n- Pixie cli: 0.8.2 and 0.8.3\r\n- K8s cluster version: 1.30.3-gke.1639000\r\n\n", "patch": "diff --git a/src/utils/shared/k8s/delete.go b/src/utils/shared/k8s/delete.go\nindex 046b6cde570..c9728f78c32 100644\n--- a/src/utils/shared/k8s/delete.go\n+++ b/src/utils/shared/k8s/delete.go\n@@ -185,6 +185,13 @@ func (o *ObjectDeleter) runDelete(r *resource.Result) (int, error) {\n \t\tif err != nil {\n \t\t\treturn err\n \t\t}\n+\t\t// In newer versions of k8s, the resource name can be empty. This causes\n+\t\t// the delete to fail since it can't watch for the resource. See\n+\t\t// https://github.com/pixie-io/pixie/issues/2029 for more details.\n+\t\tif info.Name == \"\" {\n+\t\t\tlog.Debugf(\"Skipping resource with empty name: %+v\\n\", info)\n+\t\t\treturn nil\n+\t\t}\n \t\tdeletedInfos = append(deletedInfos, info)\n \t\tfound++\n \n", "instance_id": "pixie-io__pixie-2032", "clarity": 2, "difficulty": 0.25, "clarity_explanation": "The problem statement is mostly clear and provides a detailed description of the bug encountered when running `px delete` on Kubernetes version 1.30. It includes the error message, steps to reproduce the issue, expected behavior, and relevant version information for Pixie and Kubernetes. This makes the goal of the task understandable\u2014fixing a failure in the delete operation due to an empty resource name. However, there are minor ambiguities: the problem statement does not explicitly discuss the root cause in detail (though it hints at issues with Kubernetes API server calls), and it lacks specifics on potential edge cases beyond the empty resource name scenario. Additionally, while the expected behavior is described, there are no detailed constraints or requirements for the fix (e.g., performance considerations or compatibility with other Kubernetes versions). Thus, while the statement is valid and mostly clear, it misses some minor details that could further enhance clarity.", "difficulty_explanation": "The difficulty of this problem falls into the \"Easy\" range (0.2-0.4) due to several factors. First, the scope of the code change is minimal, confined to a single file (`delete.go`) and a small addition of 7 lines of code to handle the case of an empty resource name. This change does not impact the broader system architecture or require modifications across multiple modules. Second, the technical concepts involved are straightforward\u2014basic conditional logic in Go and a surface-level understanding of Kubernetes resource handling. No advanced algorithms, design patterns, or deep domain-specific knowledge are required beyond familiarity with Kubernetes API interactions. Third, the problem does not explicitly mention complex edge cases or error handling beyond the empty resource name issue, and the provided fix appears to address the core problem without additional complexity. While some understanding of the Kubernetes version-specific behavior is necessary, the overall task is a simple bug fix that requires minimal code logic modification. Therefore, a difficulty score of 0.25 is appropriate, reflecting an easy problem with a focused and uncomplicated solution.", "clarity_label": -1, "difficulty_label": -1, "human_clarity": -1, "human_difficulty": -1}
{"problem_statement": "[Bug]:  Inconclusive Parsing of Content-Disposition Header \n### Preflight Checklist\r\n\r\n- [X] I have read the [Contributing Guidelines](https://github.com/electron/electron/blob/main/CONTRIBUTING.md) for this project.\r\n- [X] I agree to follow the [Code of Conduct](https://github.com/electron/electron/blob/main/CODE_OF_CONDUCT.md) that this project adheres to.\r\n- [X] I have searched the [issue tracker](https://www.github.com/electron/electron/issues) for a bug report that matches the one I want to file, without success.\r\n\r\n### Electron Version\r\n\r\n30.0.0\r\n\r\n### What operating system are you using?\r\n\r\nWindows\r\n\r\n### Operating System Version\r\n\r\nMicrosoft Windows [Version 10.0.19045.4291]\r\n\r\n### What arch are you using?\r\n\r\nx64\r\n\r\n### Last Known Working Electron version\r\n\r\n_No response_\r\n\r\n### Expected Behavior\r\n\r\nThe \"content-disposition\" header shouldn't be modified and work as in Chromium. Please, take a look at the screenshots I've attached. The problem is in the function HttpResponseHeadersToV8 - https://github.com/electron/electron/blob/main/shell/browser/api/electron_api_web_request.cc#L93C22-L93C45\r\n\r\n### Actual Behavior\r\n![1a](https://github.com/electron/electron/assets/5815794/38dcc068-fd00-4c6d-a489-c1a46deeff0e)\r\n![2a](https://github.com/electron/electron/assets/5815794/34925501-ae06-4d80-a506-2540f99581be)\r\n\r\n### Testcase Gist URL\r\n\r\nhttps://gist.github.com/gdavidkov/08a8edae420a5b30e9f855f0ebb75a63\r\n\r\n### Additional Information\r\n\r\nRef: https://github.com/electron/electron/pull/25961\r\nPR: https://github.com/electron/electron/pull/31669\n", "patch": "diff --git a/shell/browser/api/electron_api_web_request.cc b/shell/browser/api/electron_api_web_request.cc\nindex 0925f3438e791..e789fc3d3dfab 100644\n--- a/shell/browser/api/electron_api_web_request.cc\n+++ b/shell/browser/api/electron_api_web_request.cc\n@@ -21,7 +21,6 @@\n #include \"gin/dictionary.h\"\n #include \"gin/handle.h\"\n #include \"gin/object_template_builder.h\"\n-#include \"net/http/http_content_disposition.h\"\n #include \"shell/browser/api/electron_api_session.h\"\n #include \"shell/browser/api/electron_api_web_contents.h\"\n #include \"shell/browser/api/electron_api_web_frame_main.h\"\n@@ -100,22 +99,6 @@ v8::Local<v8::Value> HttpResponseHeadersToV8(\n     std::string key;\n     std::string value;\n     while (headers->EnumerateHeaderLines(&iter, &key, &value)) {\n-      // Note that Web servers not developed with nodejs allow non-utf8\n-      // characters in content-disposition's filename field. Use Chromium's\n-      // HttpContentDisposition class to decode the correct encoding instead of\n-      // arbitrarily converting it to UTF8. It should also be noted that if the\n-      // encoding is not specified, HttpContentDisposition will transcode\n-      // according to the system's encoding.\n-      if (base::EqualsCaseInsensitiveASCII(\"Content-Disposition\", key) &&\n-          !value.empty()) {\n-        net::HttpContentDisposition header(value, std::string());\n-        std::string decodedFilename =\n-            header.is_attachment() ? \" attachment\" : \" inline\";\n-        // The filename must be encased in double quotes for serialization\n-        // to happen correctly.\n-        std::string filename = \"\\\"\" + header.filename() + \"\\\"\";\n-        value = decodedFilename + \"; filename=\" + filename;\n-      }\n       response_headers.EnsureList(key)->Append(value);\n     }\n   }\ndiff --git a/spec/api-web-request-spec.ts b/spec/api-web-request-spec.ts\nindex e57c7a206300a..861ffcd256793 100644\n--- a/spec/api-web-request-spec.ts\n+++ b/spec/api-web-request-spec.ts\n@@ -474,7 +474,7 @@ describe('webRequest module', () => {\n \n     it('does not change content-disposition header by default', async () => {\n       ses.webRequest.onHeadersReceived((details, callback) => {\n-        expect(details.responseHeaders!['content-disposition']).to.deep.equal([' attachment; filename=\"aa\u4e2daa.txt\"']);\n+        expect(details.responseHeaders!['content-disposition']).to.deep.equal(['attachment; filename=aa\u4e2daa.txt']);\n         callback({});\n       });\n       const { data, headers } = await ajax(defaultURL + 'contentDisposition');\n", "instance_id": "electron__electron-43611", "clarity": 2, "difficulty": 0.35, "clarity_explanation": "The problem statement is mostly clear in identifying the issue with the parsing of the \"Content-Disposition\" header in Electron, where the header is being modified in a way that deviates from Chromium's behavior. The expected and actual behaviors are described with references to screenshots and a specific function (`HttpResponseHeadersToV8`) in the codebase. Additionally, links to related PRs and a test case gist are provided, which add context. However, there are minor ambiguities: the problem statement does not explicitly detail the exact expected output format for the header or provide comprehensive examples of input/output pairs. Edge cases, such as non-UTF-8 characters or malformed headers, are mentioned indirectly but not fully specified in terms of how they should be handled. Overall, while the goal is clear, some finer details are missing, warranting a score of 2 (Mostly Clear).", "difficulty_explanation": "The difficulty of this problem falls in the \"Easy\" range (0.2-0.4) due to the following factors:\n\n1. **Scope and Depth of Code Changes**: The code changes are relatively localized, primarily involving the removal of custom parsing logic for the \"Content-Disposition\" header in `electron_api_web_request.cc` and a corresponding update to a test case in `api-web-request-spec.ts`. The changes do not impact the broader system architecture or require modifications across multiple modules. The diff shows a straightforward deletion of a block of code and a minor test update, indicating a small amount of code change.\n\n2. **Technical Concepts Involved**: Solving this issue requires a basic understanding of HTTP headers, specifically the \"Content-Disposition\" header, and familiarity with Electron's web request API. The code change involves removing custom logic that uses Chromium's `HttpContentDisposition` class, which suggests minimal complexity in terms of language features or libraries. No advanced algorithms, design patterns, or domain-specific knowledge beyond HTTP handling are needed.\n\n3. **Edge Cases and Error Handling**: The problem statement and code changes indirectly reference edge cases like non-UTF-8 characters in filenames, as the removed logic attempted to handle encoding. However, the solution (removing the custom parsing) simplifies the approach by reverting to default behavior, reducing the need to explicitly handle such edge cases in this context. The test update suggests a focus on ensuring the header is not modified, but no complex error handling is introduced or required in the fix.\n\n4. **Overall Complexity**: The task involves understanding a specific bug in header parsing and applying a straightforward fix by removing problematic code. It requires some knowledge of the Electron codebase and HTTP standards but does not demand deep architectural changes or advanced technical expertise. The test update ensures the fix aligns with expected behavior, adding a minor layer of validation.\n\nGiven these points, a difficulty score of 0.35 reflects an \"Easy\" problem that requires understanding some code logic and making simple modifications, with minimal impact on the broader system and limited complexity in edge case handling.", "clarity_label": -1, "difficulty_label": -1, "human_clarity": -1, "human_difficulty": -1}
{"problem_statement": "`Dictionary::has` doesn't use validated key\n### Tested versions\n\nv4.5.dev.custom_build [4248411ba]\n\n### System information\n\nGodot v4.5.dev (4248411ba) - Windows 10 (build 19045) - Multi-window, 2 monitors - Vulkan (Forward+) - dedicated AMD Radeon RX 6600 (Advanced Micro Devices, Inc.; 32.0.12033.1030) - 12th Gen Intel(R) Core(TM) i3-12100F (8 threads)\n\n### Issue description\n\nWhen `Dictionary` validates the key type passed in, the type may be changed to match the container type.  In most cases, the validated type is used, but `Dictionary::has` uses the original passed in type, which may cause it to not find the key in the `HashMap`.  I think this only impacts dictionaries with `float` keys, when calling `has` with an `int` - `String`/`StringName` differences seem to be handled by `StringLikeVariantComparator`.\n\nExample gdscript:\n\n```gdscript\nfunc _ready() -> void:\n\tvar d : Dictionary[float, String] = {}\n\td[1] = \"value\"\n\tprint(d.has(1))\n\tprint(d.has_all([1]))\n\tprint(d[1])\n\tprint(d)\n```\n\nOutput:\n```\nfalse\ntrue\nvalue\n{ 1.0: \"value\" }\n```\n\nExpected:\n```\ntrue\ntrue\nvalue\n{ 1.0: \"value\" }\n```\n\n### Steps to reproduce\n\nCreate a `Dictionary` with `float` key type, add a whole number key, then call `has` with the key as an `int`\n\n### Minimal reproduction project (MRP)\n\nN/A, can be reproduced in new project with gdscript above\n", "patch": "diff --git a/core/variant/dictionary.cpp b/core/variant/dictionary.cpp\nindex 6d89e3a1aed3..48164e30bde0 100644\n--- a/core/variant/dictionary.cpp\n+++ b/core/variant/dictionary.cpp\n@@ -218,7 +218,7 @@ bool Dictionary::is_empty() const {\n bool Dictionary::has(const Variant &p_key) const {\n \tVariant key = p_key;\n \tERR_FAIL_COND_V(!_p->typed_key.validate(key, \"use 'has'\"), false);\n-\treturn _p->variant_map.has(p_key);\n+\treturn _p->variant_map.has(key);\n }\n \n bool Dictionary::has_all(const Array &p_keys) const {\n", "instance_id": "godotengine__godot-105205", "clarity": 3, "difficulty": 0.25, "clarity_explanation": "The problem statement is comprehensive and well-structured. It clearly describes the issue with the `Dictionary::has` method in the Godot engine, specifically highlighting the inconsistency in key type validation when using `float` keys with `int` inputs. The goal is explicit: ensure that `Dictionary::has` uses the validated key type rather than the original input. The input, output, and expected behavior are demonstrated through a concise GDScript example, along with actual and expected outputs. Steps to reproduce are provided, and the system information and tested versions add context for reproducibility. There are no significant ambiguities, and the problem's scope is narrowly defined with a clear focus on a specific bug. The only minor omission is a lack of explicit mention of potential edge cases beyond the `float`/`int` mismatch, but the provided example and context are sufficient for understanding the issue.", "difficulty_explanation": "The difficulty of this problem is relatively low, falling into the \"Easy\" range (0.2-0.4). The issue is a straightforward bug fix that involves a single-line change in the `dictionary.cpp` file, replacing the use of the original key (`p_key`) with the validated key (`key`) in the `has` method. The scope of the code change is minimal, confined to a single function and file, with no impact on the broader system architecture or interactions between modules. The technical concepts required are basic: understanding of C++ syntax, familiarity with the `Variant` type in Godot, and a general grasp of how key validation works in the `Dictionary` class. No advanced algorithms, design patterns, or domain-specific knowledge are needed. Edge cases are implicitly covered by the problem statement (e.g., `float`/`int` mismatch), and the fix does not require additional error handling beyond what is already in place. Overall, this is a simple bug fix that requires minimal effort and understanding of the surrounding codebase.", "clarity_label": -1, "difficulty_label": -1, "human_clarity": -1, "human_difficulty": -1}
{"problem_statement": "Inspector scrolls away when editing properties with a nested property unfolded\n### Tested versions\n\n4.4.1stable mono\n\n### System information\n\nWindows 10 x64, Nvidia\n\n### Issue description\n\nThe Inspector scrolls away when editing a property. \nStrangely this only occurs when a nested property is also inside the inspector( for example a 'sky' Background inside a worldenvironment Node)\nSee video:\n\nhttps://github.com/user-attachments/assets/842d2436-4219-4096-80c0-f095894eba52\n\n\n\nMay be linked to https://github.com/godotengine/godot/pull/96542 ?\n\n### Steps to reproduce\n\nCreate a world enviromnent node inside a scene.\n\n2) Click a few properties inside worldenvironment to expand them ... e.g. Glow, Fog\n3) Note no scrolling away when clicked\n4) Now, go to 'Background' property & create a 'Sky' ->New Sky -> Panoramic Sky\n5) Go back to 'Glow' or \"Fog' and see how it scrolls away now\n\n### Minimal reproduction project (MRP)\n\nNone\n", "patch": "diff --git a/editor/editor_inspector.cpp b/editor/editor_inspector.cpp\nindex 20b2e830f5d8..1d6c5858cb4c 100644\n--- a/editor/editor_inspector.cpp\n+++ b/editor/editor_inspector.cpp\n@@ -3281,14 +3281,21 @@ bool EditorInspector::_is_property_disabled_by_feature_profile(const StringName\n }\n \n void EditorInspector::update_tree() {\n+\tif (!object) {\n+\t\treturn;\n+\t}\n+\n+\tbool root_inspector_was_following_focus = get_root_inspector()->is_following_focus();\n+\tif (root_inspector_was_following_focus) {\n+\t\t// Temporarily disable focus following on the root inspector to avoid jumping while the inspector is updating.\n+\t\tget_root_inspector()->set_follow_focus(false);\n+\t}\n+\n \t// Store currently selected and focused elements to restore after the update.\n \t// TODO: Can be useful to store more context for the focusable, such as the caret position in LineEdit.\n \tStringName current_selected = property_selected;\n \tint current_focusable = -1;\n \n-\t// Temporarily disable focus following on the root inspector to avoid jumping while the inspector is updating.\n-\tget_root_inspector()->set_follow_focus(false);\n-\n \tif (property_focusable != -1) {\n \t\t// Check that focusable is actually focusable.\n \t\tbool restore_focus = false;\n@@ -3310,14 +3317,9 @@ void EditorInspector::update_tree() {\n \t\t}\n \t}\n \n-\t// Only hide plugins if we are not editing any object.\n-\t// This should be handled outside of the update_tree call anyway (see EditorInspector::edit), but might as well keep it safe.\n-\t_clear(!object);\n-\n-\tif (!object) {\n-\t\tget_root_inspector()->set_follow_focus(true);\n-\t\treturn;\n-\t}\n+\t// The call here is for the edited object that has not changed, but the tree needs to be updated (for example, the object's property list has been modified).\n+\t// Since the edited object has not changed, there is no need to hide the plugin at this time.\n+\t_clear(false);\n \n \tList<Ref<EditorInspectorPlugin>> valid_plugins;\n \n@@ -4201,7 +4203,9 @@ void EditorInspector::update_tree() {\n \t\tEditorNode::get_singleton()->hide_unused_editors();\n \t}\n \n-\tget_root_inspector()->set_follow_focus(true);\n+\tif (root_inspector_was_following_focus) {\n+\t\tget_root_inspector()->set_follow_focus(true);\n+\t}\n }\n \n void EditorInspector::update_property(const String &p_prop) {\n", "instance_id": "godotengine__godot-104785", "clarity": 2, "difficulty": 0.45, "clarity_explanation": "\nThe problem statement is mostly clear in describing the issue: the Inspector in the Godot engine scrolls away unexpectedly when editing properties with a nested property unfolded (e.g., a 'Sky' Background inside a WorldEnvironment node). The steps to reproduce are detailed and include specific actions to trigger the bug, which is helpful. Additionally, a video link is provided to visually demonstrate the issue, and a potential related pull request is referenced, adding context. However, there are minor ambiguities and missing details. For instance, the problem statement does not explicitly define the expected behavior (e.g., should the Inspector remain static when editing properties?). There is also no mention of specific edge cases or constraints beyond the nested property scenario. Furthermore, the lack of a minimal reproduction project (MRP) makes it slightly harder to independently verify the issue without setting up a full environment. Overall, while the problem is valid and mostly clear, these minor gaps prevent it from being comprehensive.\n", "difficulty_explanation": "\nI rate the difficulty of this problem as medium (0.45) based on the following analysis of the factors:\n\n1. **Clarity and Complexity of the Problem Description**: As noted in the clarity score, the problem is mostly clear but lacks some specifics about expected behavior. The logic behind the scrolling issue isn't inherently complex, but understanding the root cause requires familiarity with the Godot engine's Inspector behavior and UI update mechanisms.\n\n2. **Scope and Depth of Code Changes**: The provided diff shows modifications in a single file (`editor_inspector.cpp`), specifically in the `update_tree()` method. The changes involve reordering logic for focus following and clearing the inspector state, which suggests a targeted fix rather than a broad architectural change. The amount of code change is small (a few lines added or modified), and it does not appear to impact the broader system architecture. However, understanding the interaction between focus following and tree updates requires some knowledge of the surrounding codebase.\n\n3. **Number of Technical Concepts to Understand**: Solving this issue requires familiarity with several concepts, including:\n   - Godot engine's Inspector UI logic and how it handles focus and scrolling.\n   - C++ programming, specifically how state management (e.g., `set_follow_focus`) and object lifecycle (`_clear`) are handled in this context.\n   - UI update mechanisms and potential race conditions or side effects during tree updates.\n   These concepts are of moderate complexity for someone familiar with UI programming or the Godot engine, but they may pose a challenge for a newcomer.\n\n4. **Potential Edge Cases and Error Handling**: The problem statement does not explicitly mention edge cases beyond the nested property scenario. However, the code changes suggest a focus on preventing unwanted scrolling during updates, which could imply handling edge cases like rapid property edits or nested property interactions. The modifications do not introduce new error handling logic but adjust existing behavior to avoid a specific issue. The complexity of edge cases appears moderate, as the fix focuses on a specific interaction rather than a wide range of scenarios.\n\nOverall, this problem falls into the medium difficulty range (0.4-0.6) because it requires understanding specific parts of the Godot engine's UI logic and making targeted changes to address a bug. It does not involve extensive refactoring or advanced algorithms, nor does it require deep system-level knowledge. However, it is not trivial, as it demands familiarity with the codebase and careful consideration of focus and update interactions to avoid introducing new issues.\n", "clarity_label": -1, "difficulty_label": -1, "human_clarity": -1, "human_difficulty": -1}
{"problem_statement": "C# inspector warning grows after second change\n### Tested versions\n\n4.4\n\n### System information\n\nW10\n\n### Issue description\n\nWhen you modify a C# script while its node is inspected, you will get `This inspector might be out of date.` warning. If you change the script again, the warning panel grows.\n\nhttps://github.com/user-attachments/assets/a0d47023-2440-46d3-aab7-0806f1ee1559\n\nFurther changes don't make it bigger.\n\n### Steps to reproduce\n\n1. Attach a C# script to a node\n2. Open the script, modify and save it\n3. The inspector should show a warning\n4. Repeat\n\n### Minimal reproduction project (MRP)\n\nN/A\n", "patch": "diff --git a/editor/editor_inspector.cpp b/editor/editor_inspector.cpp\nindex 46d787762d31..8ad90dd0a2e4 100644\n--- a/editor/editor_inspector.cpp\n+++ b/editor/editor_inspector.cpp\n@@ -3152,13 +3152,14 @@ void EditorInspector::update_tree() {\n \tColor sscolor = get_theme_color(SNAME(\"prop_subsection\"), EditorStringName(Editor));\n \tbool sub_inspectors_enabled = EDITOR_GET(\"interface/inspector/open_resources_in_current_inspector\");\n \n-\t// Get the lists of editors to add the beginning.\n-\tfor (Ref<EditorInspectorPlugin> &ped : valid_plugins) {\n-\t\tped->parse_begin(object);\n-\t\t_parse_added_editors(begin_vbox, nullptr, ped);\n-\t}\n-\tif (begin_vbox->get_child_count()) {\n+\tif (!valid_plugins.is_empty()) {\n \t\tbegin_vbox->show();\n+\n+\t\t// Get the lists of editors to add the beginning.\n+\t\tfor (Ref<EditorInspectorPlugin> &ped : valid_plugins) {\n+\t\t\tped->parse_begin(object);\n+\t\t\t_parse_added_editors(begin_vbox, nullptr, ped);\n+\t\t}\n \t}\n \n \tStringName doc_name;\n", "instance_id": "godotengine__godot-104181", "clarity": 2, "difficulty": 0.25, "clarity_explanation": "The problem statement is mostly clear in describing the issue: a warning panel in the editor inspector grows in size after a second modification to a C# script while the node is being inspected. The steps to reproduce are provided, and a visual reference (via a GitHub attachment) is included, which helps in understanding the issue. However, there are minor ambiguities and missing details. For instance, the problem statement does not explicitly define the expected behavior (e.g., should the warning panel not grow at all, or should it stop growing after a certain point?). Additionally, there are no mentions of edge cases, such as what happens with multiple scripts or different types of modifications, nor any constraints on the solution (e.g., performance considerations in the editor). While the issue is valid and reproducible, these missing details prevent it from being fully comprehensive, warranting a score of 2 (Mostly Clear).", "difficulty_explanation": "The difficulty of this problem is relatively low, falling into the Easy category (0.2-0.4). The code change provided is minimal and localized to a single file (`editor_inspector.cpp`), specifically within the `update_tree()` function. The modification involves a simple restructuring of logic to ensure the `begin_vbox` is shown only when there are valid plugins, and it does not appear to impact the broader architecture of the system. The scope of the change is small, with only a few lines altered, and it does not require understanding complex interactions across multiple modules. The technical concepts involved are basic C++ programming and familiarity with the editor's plugin system, which are not particularly advanced. There are no explicit mentions of edge cases or error handling requirements in the problem statement or code changes, and the fix does not seem to introduce new error handling logic. Overall, this task requires understanding some code logic and making a straightforward modification, justifying a difficulty score of 0.25.", "clarity_label": -1, "difficulty_label": -1, "human_clarity": -1, "human_difficulty": -1}
{"problem_statement": "ScrollContainer doesn't scroll during drag & drop like Tree does\n### Tested versions\n\n4.5 master\n\n### System information\n\nWindows 10\n\n### Issue description\n\nWhile working on #103738, I noticed the SceneTree and FileSystem will scroll while drag & drop is held near the edge, but not the inspector, which is a ScrollContainer\n\n### Steps to reproduce\n\nInspect some node and expand sections until it is scrollable.\nTry dragging something like a file near the edges, it will not scroll.\n\n### Minimal reproduction project (MRP)\n\nN/A\n", "patch": "diff --git a/editor/editor_inspector.cpp b/editor/editor_inspector.cpp\nindex 4990a415d6db..d18cf896e629 100644\n--- a/editor/editor_inspector.cpp\n+++ b/editor/editor_inspector.cpp\n@@ -1938,6 +1938,12 @@ void EditorInspectorSection::set_bg_color(const Color &p_bg_color) {\n \tqueue_redraw();\n }\n \n+void EditorInspectorSection::reset_timer() {\n+\tif (dropping_for_unfold && !dropping_unfold_timer->is_stopped()) {\n+\t\tdropping_unfold_timer->start();\n+\t}\n+}\n+\n bool EditorInspectorSection::has_revertable_properties() const {\n \treturn !revertable_properties.is_empty();\n }\n@@ -3478,6 +3484,7 @@ void EditorInspector::update_tree() {\n \t\t\tif (!vbox_per_path[root_vbox].has(acc_path)) {\n \t\t\t\t// If the section does not exists, create it.\n \t\t\t\tEditorInspectorSection *section = memnew(EditorInspectorSection);\n+\t\t\t\tget_root_inspector()->get_v_scroll_bar()->connect(SceneStringName(value_changed), callable_mp(section, &EditorInspectorSection::reset_timer).unbind(1));\n \t\t\t\tcurrent_vbox->add_child(section);\n \t\t\t\tsections.push_back(section);\n \n@@ -3878,6 +3885,7 @@ void EditorInspector::update_tree() {\n \t\t\t\t}\n \n \t\t\t\tEditorInspectorSection *section = memnew(EditorInspectorSection);\n+\t\t\t\tget_root_inspector()->get_v_scroll_bar()->connect(SceneStringName(value_changed), callable_mp(section, &EditorInspectorSection::reset_timer).unbind(1));\n \t\t\t\tfavorites_groups_vbox->add_child(section);\n \t\t\t\tparent_vbox = section->get_vbox();\n \t\t\t\tsection->setup(\"\", section_name, object, sscolor, false);\n@@ -3897,6 +3905,7 @@ void EditorInspector::update_tree() {\n \t\t\t\t\t}\n \n \t\t\t\t\tEditorInspectorSection *section = memnew(EditorInspectorSection);\n+\t\t\t\t\tget_root_inspector()->get_v_scroll_bar()->connect(SceneStringName(value_changed), callable_mp(section, &EditorInspectorSection::reset_timer).unbind(1));\n \t\t\t\t\tvbox->add_child(section);\n \t\t\t\t\tvbox = section->get_vbox();\n \t\t\t\t\tsection->setup(\"\", section_name, object, sscolor, false);\n@@ -5001,4 +5010,5 @@ EditorInspector::EditorInspector() {\n \tset_property_name_style(EditorPropertyNameProcessor::get_singleton()->get_settings_style());\n \n \tset_draw_focus_border(true);\n+\tset_scroll_on_drag_hover(true);\n }\ndiff --git a/editor/editor_inspector.h b/editor/editor_inspector.h\nindex ac7c3d03e76b..a3974c1132ad 100644\n--- a/editor/editor_inspector.h\n+++ b/editor/editor_inspector.h\n@@ -357,6 +357,7 @@ class EditorInspectorSection : public Container {\n \tvoid unfold();\n \tvoid fold();\n \tvoid set_bg_color(const Color &p_bg_color);\n+\tvoid reset_timer();\n \n \tbool has_revertable_properties() const;\n \tvoid property_can_revert_changed(const String &p_path, bool p_can_revert);\ndiff --git a/scene/gui/scroll_container.cpp b/scene/gui/scroll_container.cpp\nindex fdb134c5d0e4..ca7b730e1249 100644\n--- a/scene/gui/scroll_container.cpp\n+++ b/scene/gui/scroll_container.cpp\n@@ -361,6 +361,10 @@ void ScrollContainer::_notification(int p_what) {\n \t\tcase NOTIFICATION_TRANSLATION_CHANGED: {\n \t\t\t_updating_scrollbars = true;\n \t\t\tcallable_mp(this, is_ready() ? &ScrollContainer::_reposition_children : &ScrollContainer::_update_scrollbar_position).call_deferred();\n+\t\t\tif (p_what == NOTIFICATION_THEME_CHANGED) {\n+\t\t\t\tscroll_border = get_theme_constant(SNAME(\"scroll_border\"), SNAME(\"Tree\"));\n+\t\t\t\tscroll_speed = get_theme_constant(SNAME(\"scroll_speed\"), SNAME(\"Tree\"));\n+\t\t\t}\n \t\t} break;\n \n \t\tcase NOTIFICATION_READY: {\n@@ -387,6 +391,43 @@ void ScrollContainer::_notification(int p_what) {\n \t\t\t}\n \t\t} break;\n \n+\t\tcase NOTIFICATION_DRAG_BEGIN: {\n+\t\t\tif (scroll_on_drag_hover && is_visible_in_tree()) {\n+\t\t\t\tset_process_internal(true);\n+\t\t\t}\n+\t\t} break;\n+\n+\t\tcase NOTIFICATION_DRAG_END: {\n+\t\t\tset_process_internal(false);\n+\t\t} break;\n+\n+\t\tcase NOTIFICATION_INTERNAL_PROCESS: {\n+\t\t\tif (scroll_on_drag_hover && get_viewport()->gui_is_dragging()) {\n+\t\t\t\tPoint2 mouse_position = get_viewport()->get_mouse_position() - get_global_position();\n+\t\t\t\tTransform2D xform = get_transform();\n+\t\t\t\tif (Rect2(Point2(), xform.get_scale() * get_size()).grow(scroll_border).has_point(mouse_position)) {\n+\t\t\t\t\tPoint2 point;\n+\n+\t\t\t\t\tif ((Math::abs(mouse_position.x) < Math::abs(mouse_position.x - get_size().width)) && (Math::abs(mouse_position.x) < scroll_border)) {\n+\t\t\t\t\t\tpoint.x = mouse_position.x - scroll_border;\n+\t\t\t\t\t} else if (Math::abs(mouse_position.x - get_size().width) < scroll_border) {\n+\t\t\t\t\t\tpoint.x = mouse_position.x - (get_size().width - scroll_border);\n+\t\t\t\t\t}\n+\n+\t\t\t\t\tif ((Math::abs(mouse_position.y) < Math::abs(mouse_position.y - get_size().height)) && (Math::abs(mouse_position.y) < scroll_border)) {\n+\t\t\t\t\t\tpoint.y = mouse_position.y - scroll_border;\n+\t\t\t\t\t} else if (Math::abs(mouse_position.y - get_size().height) < scroll_border) {\n+\t\t\t\t\t\tpoint.y = mouse_position.y - (get_size().height - scroll_border);\n+\t\t\t\t\t}\n+\n+\t\t\t\t\tpoint *= scroll_speed * get_process_delta_time();\n+\t\t\t\t\tpoint += Point2(get_h_scroll(), get_v_scroll());\n+\t\t\t\t\th_scroll->set_value(point.x);\n+\t\t\t\t\tv_scroll->set_value(point.y);\n+\t\t\t\t}\n+\t\t\t}\n+\t\t} break;\n+\n \t\tcase NOTIFICATION_INTERNAL_PHYSICS_PROCESS: {\n \t\t\tif (drag_touching) {\n \t\t\t\tif (drag_touching_deaccel) {\n@@ -584,6 +625,10 @@ PackedStringArray ScrollContainer::get_configuration_warnings() const {\n \treturn warnings;\n }\n \n+void ScrollContainer::set_scroll_on_drag_hover(bool p_scroll) {\n+\tscroll_on_drag_hover = p_scroll;\n+}\n+\n HScrollBar *ScrollContainer::get_h_scroll_bar() {\n \treturn h_scroll;\n }\ndiff --git a/scene/gui/scroll_container.h b/scene/gui/scroll_container.h\nindex 887a8e3f1c35..7309c9ea6133 100644\n--- a/scene/gui/scroll_container.h\n+++ b/scene/gui/scroll_container.h\n@@ -62,12 +62,15 @@ class ScrollContainer : public Container {\n \tbool drag_touching = false;\n \tbool drag_touching_deaccel = false;\n \tbool beyond_deadzone = false;\n+\tbool scroll_on_drag_hover = false;\n \n \tScrollMode horizontal_scroll_mode = SCROLL_MODE_AUTO;\n \tScrollMode vertical_scroll_mode = SCROLL_MODE_AUTO;\n \n \tint deadzone = 0;\n \tbool follow_focus = false;\n+\tint scroll_border = 20;\n+\tint scroll_speed = 12;\n \n \tstruct ThemeCache {\n \t\tRef<StyleBox> panel_style;\n@@ -123,6 +126,8 @@ class ScrollContainer : public Container {\n \tbool is_following_focus() const;\n \tvoid set_follow_focus(bool p_follow);\n \n+\tvoid set_scroll_on_drag_hover(bool p_scroll);\n+\n \tHScrollBar *get_h_scroll_bar();\n \tVScrollBar *get_v_scroll_bar();\n \tvoid ensure_control_visible(Control *p_control);\n", "instance_id": "godotengine__godot-103943", "clarity": 2, "difficulty": 0.55, "clarity_explanation": "The problem statement is mostly clear in describing the issue: the `ScrollContainer` in the inspector does not scroll during drag-and-drop operations near the edges, unlike other components such as `SceneTree` and `FileSystem`. The goal is implicitly understood as enabling similar scrolling behavior in the inspector. The steps to reproduce are provided, which helps in understanding the context. However, there are minor ambiguities and missing details. For instance, the problem statement does not explicitly define the expected behavior (e.g., how close to the edge should trigger scrolling, the speed of scrolling, etc.), nor does it mention specific edge cases or constraints to consider. Additionally, there are no examples or references to how other components (`SceneTree`, `FileSystem`) handle this behavior, which could have provided clearer guidance. Overall, while the issue is valid and mostly clear, these minor gaps prevent it from being comprehensive.", "difficulty_explanation": "The difficulty of this problem falls into the medium range due to several factors. \n\n1. **Scope and Depth of Code Changes:** The changes span multiple files (`editor_inspector.cpp`, `editor_inspector.h`, `scroll_container.cpp`, and `scroll_container.h`), indicating a moderate level of complexity. The modifications involve adding new functionality to the `ScrollContainer` class to handle scrolling during drag-and-drop near the edges, as well as integrating this behavior into the `EditorInspector`. While the changes are not architecturally significant, they require understanding and modifying interactions between GUI components and event handling logic, which adds to the complexity. The amount of code change is moderate, with new methods, event handling logic, and property additions.\n\n2. **Number of Technical Concepts:** Solving this requires familiarity with GUI programming concepts, specifically event handling (`NOTIFICATION_DRAG_BEGIN`, `NOTIFICATION_DRAG_END`, `NOTIFICATION_INTERNAL_PROCESS`), mouse position calculations, and scroll bar manipulation in a custom GUI framework (likely Godot, based on the context). Additionally, understanding the drag-and-drop system and how it integrates with viewport and container components is necessary. These concepts are not overly advanced but require a solid grasp of GUI internals and event-driven programming, which places this problem at a medium difficulty level.\n\n3. **Edge Cases and Error Handling:** The problem statement does not explicitly mention edge cases, but the code changes suggest considerations such as ensuring scrolling only triggers near the edges (within a defined `scroll_border`), handling drag events correctly, and avoiding unintended scrolling behavior. The logic for determining proximity to edges and calculating scroll speed based on mouse position introduces moderate complexity in handling potential edge cases (e.g., rapid mouse movements, container resizing, or nested containers). However, no extensive error handling or performance optimization is evident in the changes, which limits the difficulty from reaching a higher level.\n\n4. **Overall Assessment:** This problem is not a simple bug fix or feature addition, as it involves understanding and modifying GUI behavior across multiple components. However, it does not require deep architectural changes, advanced algorithms, or domain-specific knowledge beyond GUI programming. Therefore, a difficulty score of 0.55 reflects a medium challenge, suitable for a developer with intermediate experience in GUI systems and event handling, who can navigate the codebase with moderate effort.", "clarity_label": -1, "difficulty_label": -1, "human_clarity": -1, "human_difficulty": -1}
{"problem_statement": "False positive UNUSED_VARYING\n### Tested versions\n\n- Reproducible in: v4.4.rc3.official [15ff45068], v4.4.dev7.official [46c8f8c5c]\n- Not reproducible in: v4.4.dev6.official [1f47e4c4e]\n\n### System information\n\nGodot v4.4.rc3 - Windows 10 (build 19045) - Multi-window, 1 monitor - OpenGL 3 (Compatibility) - NVIDIA GeForce GTX 1050 Ti (NVIDIA; 32.0.15.7260) - Intel(R) Core(TM) i3-10105 CPU @ 3.70GHz (8 threads)\n\n### Issue description\n\nGodot reports a varying is not being used, while it is being used.\n\n### Steps to reproduce\n\nCreate or open a shader with a varying and look for warning in the bottom of the shader editor.\n\nFound and reproduced with this shader (included in the MRP below):\n\n```\nshader_type canvas_item;\n\nuniform float level;\n\nvarying vec4 vertex_color;\n\nvoid vertex() {\n\tvertex_color = COLOR;\n}\n\nvoid fragment()\n{\n\tCOLOR = vertex_color;\n\tCOLOR.a *= level;\n}\n```\n\nHere Godot claims `vertex_color` is not being used: `Line 5 (UNUSED_VARYING):The varying 'vertex_color' is declared but never used.`\n\nNote: The shader is based on an example from the documentation at [COLOR and TEXTURE](https://docs.godotengine.org/en/stable/tutorials/shaders/shader_reference/canvas_item_shader.html#color-and-texture):\n\n```\nvarying vec4 vertex_color;\nvoid vertex() {\n  vertex_color = COLOR;\n}\nvoid fragment() {\n  COLOR = vertex_color;\n}\n```\n\n\n### Minimal reproduction project (MRP)\n\n[svwt.zip](https://github.com/user-attachments/files/19036041/svwt.zip)\n", "patch": "diff --git a/servers/rendering/shader_language.cpp b/servers/rendering/shader_language.cpp\nindex 59adb53b7866..66a43684a52a 100644\n--- a/servers/rendering/shader_language.cpp\n+++ b/servers/rendering/shader_language.cpp\n@@ -1342,7 +1342,7 @@ void ShaderLanguage::_parse_used_identifier(const StringName &p_identifier, Iden\n \t\t\tbreak;\n \t\tcase IdentifierType::IDENTIFIER_VARYING:\n \t\t\tif (HAS_WARNING(ShaderWarning::UNUSED_VARYING_FLAG) && used_varyings.has(p_identifier)) {\n-\t\t\t\tif (shader->varyings[p_identifier].stage != ShaderNode::Varying::STAGE_VERTEX && shader->varyings[p_identifier].stage != ShaderNode::Varying::STAGE_FRAGMENT) {\n+\t\t\t\tif (shader->varyings[p_identifier].stage == ShaderNode::Varying::STAGE_UNKNOWN) {\n \t\t\t\t\tused_varyings[p_identifier].used = true;\n \t\t\t\t}\n \t\t\t}\n@@ -6510,6 +6510,27 @@ ShaderLanguage::Node *ShaderLanguage::_parse_expression(BlockNode *p_block, cons\n \t\t\t\t\t\t_set_error(RTR(\"Expected constant expression.\"));\n \t\t\t\t\t\treturn nullptr;\n \t\t\t\t\t}\n+\t\t\t\t\tif (ident_type == IDENTIFIER_FUNCTION) {\n+\t\t\t\t\t\t_set_error(vformat(RTR(\"Can't use function as identifier: '%s'.\"), String(identifier)));\n+\t\t\t\t\t\treturn nullptr;\n+\t\t\t\t\t}\n+#ifdef DEBUG_ENABLED\n+\t\t\t\t\tif (check_warnings) {\n+\t\t\t\t\t\tStringName func_name;\n+\t\t\t\t\t\tBlockNode *b = p_block;\n+\n+\t\t\t\t\t\twhile (b) {\n+\t\t\t\t\t\t\tif (b->parent_function) {\n+\t\t\t\t\t\t\t\tfunc_name = b->parent_function->name;\n+\t\t\t\t\t\t\t\tbreak;\n+\t\t\t\t\t\t\t} else {\n+\t\t\t\t\t\t\t\tb = b->parent_block;\n+\t\t\t\t\t\t\t}\n+\t\t\t\t\t\t}\n+\n+\t\t\t\t\t\t_parse_used_identifier(identifier, ident_type, func_name);\n+\t\t\t\t\t}\n+#endif // DEBUG_ENABLED\n \t\t\t\t\tif (ident_type == IDENTIFIER_VARYING) {\n \t\t\t\t\t\tTkPos prev_pos = _get_tkpos();\n \t\t\t\t\t\tToken next_token = _get_token();\n@@ -6542,11 +6563,6 @@ ShaderLanguage::Node *ShaderLanguage::_parse_expression(BlockNode *p_block, cons\n \t\t\t\t\t\t\t}\n \t\t\t\t\t\t}\n \t\t\t\t\t}\n-\n-\t\t\t\t\tif (ident_type == IDENTIFIER_FUNCTION) {\n-\t\t\t\t\t\t_set_error(vformat(RTR(\"Can't use function as identifier: '%s'.\"), String(identifier)));\n-\t\t\t\t\t\treturn nullptr;\n-\t\t\t\t\t}\n #ifdef DEBUG_ENABLED\n \t\t\t\t\tif (check_position_write && ident_type == IDENTIFIER_BUILTIN_VAR) {\n \t\t\t\t\t\tif (String(identifier) == \"POSITION\") {\n@@ -6564,7 +6580,7 @@ ShaderLanguage::Node *ShaderLanguage::_parse_expression(BlockNode *p_block, cons\n \t\t\t\t\t\t\t_set_tkpos(prev_pos);\n \t\t\t\t\t\t}\n \t\t\t\t\t}\n-#endif\n+#endif // DEBUG_ENABLED\n \t\t\t\t\tif (is_const) {\n \t\t\t\t\t\tlast_type = IDENTIFIER_CONSTANT;\n \t\t\t\t\t} else {\n@@ -6656,23 +6672,6 @@ ShaderLanguage::Node *ShaderLanguage::_parse_expression(BlockNode *p_block, cons\n \t\t\t\t\tvarname->is_local = is_local;\n \t\t\t\t\texpr = varname;\n \t\t\t\t}\n-#ifdef DEBUG_ENABLED\n-\t\t\t\tif (check_warnings) {\n-\t\t\t\t\tStringName func_name;\n-\t\t\t\t\tBlockNode *b = p_block;\n-\n-\t\t\t\t\twhile (b) {\n-\t\t\t\t\t\tif (b->parent_function) {\n-\t\t\t\t\t\t\tfunc_name = b->parent_function->name;\n-\t\t\t\t\t\t\tbreak;\n-\t\t\t\t\t\t} else {\n-\t\t\t\t\t\t\tb = b->parent_block;\n-\t\t\t\t\t\t}\n-\t\t\t\t\t}\n-\n-\t\t\t\t\t_parse_used_identifier(identifier, ident_type, func_name);\n-\t\t\t\t}\n-#endif // DEBUG_ENABLED\n \t\t\t}\n \t\t} else if (tk.type == TK_OP_ADD) {\n \t\t\tcontinue; //this one does nothing\n", "instance_id": "godotengine__godot-103434", "clarity": 2, "difficulty": 0.65, "clarity_explanation": "The problem statement is mostly clear in describing the issue: Godot incorrectly reports a varying variable as unused in a shader, even though it is being used. The description includes specific versions where the issue is reproducible, system information, steps to reproduce, and a minimal reproduction project (MRP). It also provides a concrete example shader code snippet from the documentation to illustrate the problem. However, there are minor ambiguities, such as the lack of explicit mention of expected behavior beyond the warning message and potential edge cases (e.g., does this issue occur with all types of shaders or only specific ones like canvas_item?). Additionally, the problem statement does not clarify the broader impact of this bug on the system or user experience. Overall, it is clear enough to understand the issue but misses some finer details that could aid in a comprehensive understanding.", "difficulty_explanation": "The difficulty of this problem falls into the \"Hard\" category due to several factors. First, the scope of code changes is relatively focused, primarily within the `shader_language.cpp` file, specifically around identifier parsing and varying usage detection logic. However, the changes require a deep understanding of the Godot engine's shader compilation and parsing mechanisms, which are non-trivial and domain-specific. The technical concepts involved include shader language semantics, compiler design (specifically how identifiers and varyings are tracked and validated), and debugging preprocessor directives like `#ifdef DEBUG_ENABLED`. The code modifications also involve restructuring conditional logic and moving blocks of code, which suggests a need to understand the broader context of how warnings are generated and tracked in the codebase. While the problem does not appear to impact the overall system architecture, it does require careful handling to avoid introducing new bugs in the shader parsing logic. Edge cases are not explicitly mentioned in the problem statement, but the nature of shader varyings implies potential complexities (e.g., different shader stages, varying types, or interactions with other shader variables), which the developer must consider. Overall, solving this requires a solid grasp of the Godot engine internals and shader language processing, making it a challenging task for someone without prior experience in this area, hence a score of 0.65.", "clarity_label": -1, "difficulty_label": -1, "human_clarity": -1, "human_difficulty": -1}
{"problem_statement": "Game window not closing correctly if you have a dialog open\n### Tested versions\n\nGodot v4.4.beta (c394eaa45) \n\n### System information\n\nFedora Linux 40 (KDE Plasma) on Wayland - X11 display driver, Multi-window\n\n### Issue description\n\nIf you have a dialog open and press the **X** to close the game window. The game window will not close and instead move independent of the game view. \n\nhttps://github.com/user-attachments/assets/36e9dcfb-9afe-41ad-a443-649f28a5230e\n\n### Steps to reproduce\n\n^\n\n### Minimal reproduction project (MRP)\n\n[window-close.zip](https://github.com/user-attachments/files/18675433/window-close.zip)\n", "patch": "diff --git a/editor/plugins/embedded_process.cpp b/editor/plugins/embedded_process.cpp\nindex 1638c437125d..72c87bfc1c6d 100644\n--- a/editor/plugins/embedded_process.cpp\n+++ b/editor/plugins/embedded_process.cpp\n@@ -200,6 +200,12 @@ void EmbeddedProcess::reset() {\n \tqueue_redraw();\n }\n \n+void EmbeddedProcess::request_close() {\n+\tif (current_process_id != 0 && embedding_completed) {\n+\t\tDisplayServer::get_singleton()->request_close_embedded_process(current_process_id);\n+\t}\n+}\n+\n void EmbeddedProcess::_try_embed_process() {\n \tbool is_visible = is_visible_in_tree();\n \tError err = DisplayServer::get_singleton()->embed_process(window->get_window_id(), current_process_id, get_screen_embedded_window_rect(), is_visible, is_visible && application_has_focus && embedding_grab_focus);\ndiff --git a/editor/plugins/embedded_process.h b/editor/plugins/embedded_process.h\nindex 3e800923a75d..abd2c0f36e2f 100644\n--- a/editor/plugins/embedded_process.h\n+++ b/editor/plugins/embedded_process.h\n@@ -76,6 +76,7 @@ class EmbeddedProcess : public Control {\n public:\n \tvoid embed_process(OS::ProcessID p_pid);\n \tvoid reset();\n+\tvoid request_close();\n \n \tvoid set_window_size(const Size2i p_window_size);\n \tvoid set_keep_aspect(bool p_keep_aspect);\ndiff --git a/editor/plugins/game_view_plugin.cpp b/editor/plugins/game_view_plugin.cpp\nindex a6d73cf9e153..3b8a91c5fc3a 100644\n--- a/editor/plugins/game_view_plugin.cpp\n+++ b/editor/plugins/game_view_plugin.cpp\n@@ -798,16 +798,17 @@ void GameView::_window_close_request() {\n \t// Before the parent window closed, we close the embedded game. That prevents\n \t// the embedded game to be seen without a parent window for a fraction of second.\n \tif (EditorRunBar::get_singleton()->is_playing() && (embedded_process->is_embedding_completed() || embedded_process->is_embedding_in_progress())) {\n-\t\t// Try to gracefully close the window. That way, the NOTIFICATION_WM_CLOSE_REQUEST\n-\t\t// notification should be propagated in the game process.\n-\t\tembedded_process->reset();\n-\n \t\t// When the embedding is not complete, we need to kill the process.\n \t\t// If the game is paused, the close request will not be processed by the game, so it's better to kill the process.\n \t\tif (paused || embedded_process->is_embedding_in_progress()) {\n+\t\t\tembedded_process->reset();\n \t\t\t// Call deferred to prevent the _stop_pressed callback to be executed before the wrapper window\n \t\t\t// actually closes.\n \t\t\tcallable_mp(EditorRunBar::get_singleton(), &EditorRunBar::stop_playing).call_deferred();\n+\t\t} else {\n+\t\t\t// Try to gracefully close the window. That way, the NOTIFICATION_WM_CLOSE_REQUEST\n+\t\t\t// notification should be propagated in the game process.\n+\t\t\tembedded_process->request_close();\n \t\t}\n \t}\n }\ndiff --git a/platform/linuxbsd/x11/display_server_x11.cpp b/platform/linuxbsd/x11/display_server_x11.cpp\nindex 95181a1c8177..cbf963c59a0e 100644\n--- a/platform/linuxbsd/x11/display_server_x11.cpp\n+++ b/platform/linuxbsd/x11/display_server_x11.cpp\n@@ -5926,7 +5926,7 @@ Error DisplayServerX11::embed_process(WindowID p_window, OS::ProcessID p_pid, co\n \treturn OK;\n }\n \n-Error DisplayServerX11::remove_embedded_process(OS::ProcessID p_pid) {\n+Error DisplayServerX11::request_close_embedded_process(OS::ProcessID p_pid) {\n \t_THREAD_SAFE_METHOD_\n \n \tif (!embedded_processes.has(p_pid)) {\n@@ -5956,6 +5956,20 @@ Error DisplayServerX11::remove_embedded_process(OS::ProcessID p_pid) {\n \t// Restore default error handler.\n \tXSetErrorHandler(oldHandler);\n \n+\treturn OK;\n+}\n+\n+Error DisplayServerX11::remove_embedded_process(OS::ProcessID p_pid) {\n+\t_THREAD_SAFE_METHOD_\n+\n+\tif (!embedded_processes.has(p_pid)) {\n+\t\treturn ERR_DOES_NOT_EXIST;\n+\t}\n+\n+\tEmbeddedProcessData *ep = embedded_processes.get(p_pid);\n+\n+\trequest_close_embedded_process(p_pid);\n+\n \tembedded_processes.erase(p_pid);\n \tmemdelete(ep);\n \ndiff --git a/platform/linuxbsd/x11/display_server_x11.h b/platform/linuxbsd/x11/display_server_x11.h\nindex edd70d454da3..b21d9024627f 100644\n--- a/platform/linuxbsd/x11/display_server_x11.h\n+++ b/platform/linuxbsd/x11/display_server_x11.h\n@@ -540,6 +540,7 @@ class DisplayServerX11 : public DisplayServer {\n \tvirtual void window_start_resize(WindowResizeEdge p_edge, WindowID p_window) override;\n \n \tvirtual Error embed_process(WindowID p_window, OS::ProcessID p_pid, const Rect2i &p_rect, bool p_visible, bool p_grab_focus) override;\n+\tvirtual Error request_close_embedded_process(OS::ProcessID p_pid) override;\n \tvirtual Error remove_embedded_process(OS::ProcessID p_pid) override;\n \tvirtual OS::ProcessID get_focused_process_id() override;\n \ndiff --git a/platform/windows/display_server_windows.cpp b/platform/windows/display_server_windows.cpp\nindex d0ddac4b7f9e..6f92cc0d6219 100644\n--- a/platform/windows/display_server_windows.cpp\n+++ b/platform/windows/display_server_windows.cpp\n@@ -3004,7 +3004,7 @@ Error DisplayServerWindows::embed_process(WindowID p_window, OS::ProcessID p_pid\n \treturn OK;\n }\n \n-Error DisplayServerWindows::remove_embedded_process(OS::ProcessID p_pid) {\n+Error DisplayServerWindows::request_close_embedded_process(OS::ProcessID p_pid) {\n \t_THREAD_SAFE_METHOD_\n \n \tif (!embedded_processes.has(p_pid)) {\n@@ -3016,6 +3016,20 @@ Error DisplayServerWindows::remove_embedded_process(OS::ProcessID p_pid) {\n \t// Send a close message to gracefully close the process.\n \tPostMessage(ep->window_handle, WM_CLOSE, 0, 0);\n \n+\treturn OK;\n+}\n+\n+Error DisplayServerWindows::remove_embedded_process(OS::ProcessID p_pid) {\n+\t_THREAD_SAFE_METHOD_\n+\n+\tif (!embedded_processes.has(p_pid)) {\n+\t\treturn ERR_DOES_NOT_EXIST;\n+\t}\n+\n+\tEmbeddedProcessData *ep = embedded_processes.get(p_pid);\n+\n+\trequest_close_embedded_process(p_pid);\n+\n \t// This is a workaround to ensure the parent window correctly regains focus after the\n \t// embedded window is closed. When the embedded window is closed while it has focus,\n \t// the parent window (the editor) does not become active. It appears focused but is not truly activated.\ndiff --git a/platform/windows/display_server_windows.h b/platform/windows/display_server_windows.h\nindex 71de7a73769e..30f71c8c7e18 100644\n--- a/platform/windows/display_server_windows.h\n+++ b/platform/windows/display_server_windows.h\n@@ -837,6 +837,7 @@ class DisplayServerWindows : public DisplayServer {\n \n \tvirtual void enable_for_stealing_focus(OS::ProcessID pid) override;\n \tvirtual Error embed_process(WindowID p_window, OS::ProcessID p_pid, const Rect2i &p_rect, bool p_visible, bool p_grab_focus) override;\n+\tvirtual Error request_close_embedded_process(OS::ProcessID p_pid) override;\n \tvirtual Error remove_embedded_process(OS::ProcessID p_pid) override;\n \tvirtual OS::ProcessID get_focused_process_id() override;\n \ndiff --git a/servers/display_server.cpp b/servers/display_server.cpp\nindex bf3d428420a7..6dd9044617e3 100644\n--- a/servers/display_server.cpp\n+++ b/servers/display_server.cpp\n@@ -679,6 +679,11 @@ Error DisplayServer::embed_process(WindowID p_window, OS::ProcessID p_pid, const\n \treturn ERR_UNAVAILABLE;\n }\n \n+Error DisplayServer::request_close_embedded_process(OS::ProcessID p_pid) {\n+\tWARN_PRINT(\"Embedded process not supported by this display server.\");\n+\treturn ERR_UNAVAILABLE;\n+}\n+\n Error DisplayServer::remove_embedded_process(OS::ProcessID p_pid) {\n \tWARN_PRINT(\"Embedded process not supported by this display server.\");\n \treturn ERR_UNAVAILABLE;\ndiff --git a/servers/display_server.h b/servers/display_server.h\nindex 30bb533a5d39..79cf9ffc44bf 100644\n--- a/servers/display_server.h\n+++ b/servers/display_server.h\n@@ -577,6 +577,7 @@ class DisplayServer : public Object {\n \tvirtual void enable_for_stealing_focus(OS::ProcessID pid);\n \n \tvirtual Error embed_process(WindowID p_window, OS::ProcessID p_pid, const Rect2i &p_rect, bool p_visible, bool p_grab_focus);\n+\tvirtual Error request_close_embedded_process(OS::ProcessID p_pid);\n \tvirtual Error remove_embedded_process(OS::ProcessID p_pid);\n \tvirtual OS::ProcessID get_focused_process_id();\n \n", "instance_id": "godotengine__godot-102470", "clarity": 2, "difficulty": 0.65, "clarity_explanation": "The problem statement is mostly clear in describing the issue: a game window in Godot v4.4.beta does not close correctly when a dialog is open, and instead, the window moves independently of the game view. The description includes the tested version, system information, and a reference to a minimal reproduction project (MRP), which helps in understanding the context. However, there are minor ambiguities and missing details. For instance, the problem statement does not explicitly define the expected behavior (e.g., should the dialog close first, or should the game window close regardless of the dialog state?). Additionally, edge cases such as the behavior on different platforms or windowing systems (beyond Wayland/X11) are not mentioned. While the issue is reproducible with the provided MRP, the lack of detailed expected outcomes or constraints slightly lowers the clarity score. Overall, the statement is valid and mostly clear but misses some minor details that could aid in a comprehensive understanding of the problem.", "difficulty_explanation": "The difficulty of this problem falls into the \"Hard\" category (0.6-0.8) due to several factors. First, the scope of code changes spans multiple files (embedded_process.cpp/h, game_view_plugin.cpp, display_server_x11.cpp/h, display_server_windows.cpp/h, and display_server.cpp/h), indicating a need to understand and modify interactions across different modules of the Godot engine. The changes involve adding a new method (`request_close_embedded_process`) and modifying existing logic for closing embedded processes, which impacts the system's window management behavior\u2014a core architectural component. Second, the technical concepts required include knowledge of Godot's display server architecture, process embedding mechanisms, platform-specific window handling (X11 on Linux and Windows API), and thread safety (as seen in `_THREAD_SAFE_METHOD_` annotations). These are moderately complex concepts that require familiarity with low-level system interactions and the Godot engine's internals. Third, while the problem statement does not explicitly mention edge cases, the code changes suggest considerations for scenarios like incomplete embedding or paused game states, as well as platform-specific behaviors (e.g., focus restoration on Windows). Error handling is also modified to ensure graceful closure of embedded processes. Overall, solving this requires a deep understanding of the codebase, careful handling of cross-platform issues, and precise modifications to critical system components, justifying a difficulty score of 0.65.", "clarity_label": -1, "difficulty_label": -1, "human_clarity": -1, "human_difficulty": -1}
{"problem_statement": "Unable to rename a project after quitting to project list\n### Tested versions\n\nv4.4.beta2.official [a013481b0]\nv4.4.beta1.official [d33da79d3]\n\n### System information\n\nWindows 11 - Godot v4.4.beta2\n\n### Issue description\n\nAfter quitting to the project list, it is not possible to rename the project we have just quit from.\n\n### Steps to reproduce\n\n1. Open any project\n2. Quit to Project List (through the `Project` menu or the shortcut `Ctrl+Shift+Q`)\n3. Select the project you just quit from and click on `Rename`\n4. Note that you won't be able to rename the project and the following message is shown in red:\n```\nCreating a project at the engine's working directory or executable directory is not allowed, as it would prevent the project manager from starting.\n```\n\n\n### Minimal reproduction project (MRP)\n\nCan be reproduced with any project.\n", "patch": "diff --git a/editor/editor_node.cpp b/editor/editor_node.cpp\nindex 778257b3930a..eb0422211a00 100644\n--- a/editor/editor_node.cpp\n+++ b/editor/editor_node.cpp\n@@ -2074,6 +2074,13 @@ void EditorNode::restart_editor(bool p_goto_project_manager) {\n \n \tif (p_goto_project_manager) {\n \t\targs.push_back(\"--project-manager\");\n+\n+\t\t// Setup working directory.\n+\t\tconst String exec_dir = OS::get_singleton()->get_executable_path().get_base_dir();\n+\t\tif (!exec_dir.is_empty()) {\n+\t\t\targs.push_back(\"--path\");\n+\t\t\targs.push_back(exec_dir);\n+\t\t}\n \t} else {\n \t\targs.push_back(\"--path\");\n \t\targs.push_back(ProjectSettings::get_singleton()->get_resource_path());\n", "instance_id": "godotengine__godot-102307", "clarity": 2, "difficulty": 0.25, "clarity_explanation": "The problem statement is mostly clear in describing the issue: the inability to rename a project after quitting to the project list in Godot v4.4.beta versions on Windows 11. It provides specific steps to reproduce the issue, the error message encountered, and mentions that it can be reproduced with any project. However, there are minor ambiguities and missing details. For instance, the problem statement does not explicitly clarify the expected behavior (e.g., should renaming always be allowed, or are there specific conditions under which it should work?). Additionally, it lacks context about why the error message appears (i.e., what constitutes the \"engine's working directory\" or \"executable directory\"). While the issue is reproducible and the goal is implied (enable renaming), these missing details prevent it from being fully comprehensive, warranting a score of 2 (Mostly Clear).", "difficulty_explanation": "The difficulty of solving this problem appears to be on the easier side, as reflected by the provided code changes and the scope of the issue. Let's break it down based on the evaluation factors:\n\n1. **Scope and Depth of Code Changes**: The code change is minimal and localized to a single file (`editor_node.cpp`) and a specific function (`restart_editor`). It involves adding a small block of code (7 lines) to set up the working directory when restarting the editor to go to the project manager. This does not impact the broader system architecture or require modifications across multiple modules, indicating a low level of complexity in terms of codebase impact.\n\n2. **Number of Technical Concepts**: The solution requires a basic understanding of the Godot engine's editor logic, specifically how the editor restarts and handles command-line arguments (`args.push_back`). It also involves interacting with the `OS` singleton to retrieve the executable path. These are relatively straightforward concepts for someone familiar with C++ and the Godot engine, not requiring advanced language features, complex algorithms, or design patterns.\n\n3. **Edge Cases and Error Handling**: The problem statement does not explicitly mention specific edge cases beyond the general issue of renaming being blocked. The code change itself does not introduce new error handling logic but rather addresses the root cause by ensuring the correct working directory is set. Potential edge cases (e.g., what if `exec_dir` is empty or invalid?) are implicitly handled by the existing condition (`if (!exec_dir.is_empty())`), which reduces complexity. However, no extensive error handling or edge case consideration is evident in the change.\n\n4. **Overall Complexity**: The fix is a simple adjustment to the editor's restart behavior, likely addressing a bug caused by an incorrect or missing working directory path when launching the project manager. It does not require deep architectural knowledge of the Godot engine beyond understanding the editor's initialization and argument passing mechanism.\n\nGiven these factors, I assign a difficulty score of 0.25, placing it in the \"Easy\" range (0.2-0.4). The task requires understanding some code logic (editor restart and path handling) and making a simple modification, but it does not involve complex interactions, significant edge case handling, or advanced technical concepts. It is a straightforward bug fix for someone with moderate experience in C++ and familiarity with the Godot codebase.", "clarity_label": -1, "difficulty_label": -1, "human_clarity": -1, "human_difficulty": -1}
{"problem_statement": "Exported patch PCKs incorrectly mark imported resources for removal\n### Tested versions\n\n- Reproducible in: 4.4.beta [6dc78c8aa17ad46e701e0c4e7b7632c2f0e098f1]\n\n### System information\n\nWindows 11 (10.0.26100)\n\n### Issue description\n\nCurrently when exporting a PCK as a patch, where you've only changed something like a single `*.gd` file, and then inspect the resulting `*.pck` file, you'll find that pretty much every imported asset and their corresponding `*.import` file have been saved to the patch as a removal (size 0 with `PACK_FILE_REMOVAL` flag set).\n\nThe expected result would of course be for the patch to only contain the changed `*.gd` file, or its corresponding `*.gdc` file in the case of binary tokenization.\n\nIt's unclear if this is a regression or if I somehow let this slip through as part of my contribution to #97356.\n\n### Steps to reproduce\n\n- Open the MRP.\n- Export the project using \"Export PCK/ZIP\" with \"Export as Patch\" disabled.\n- Add the newly exported pack as a base pack under the \"Patches\" tab in the export dialog.\n- Add a newline somewhere in `my_script.gd`.\n- Export the project using \"Export PCK/ZIP\" with \"Export as Patch\" enabled.\n- Inspect both PCK files using whatever method you prefer (e.g. [GodotPckTool](https://github.com/hhyyrylainen/GodotPckTool)).\n- Note how the second exported PCK contains not only `my_script.gdc`, but also `icon.svg.import` and `.godot/imported/icon.svg-*.ctex`, both with a size of 0 (and flag bit 2 set).\n\n(I've also included ready-made `exports/main.pck` and `exports/patch.pck` with the MRP.)\n\n### Minimal reproduction project (MRP)\n\n[pck-removal-bug.zip](https://github.com/user-attachments/files/18563102/pck-removal-bug.zip)\n", "patch": "diff --git a/editor/export/editor_export_platform.cpp b/editor/export/editor_export_platform.cpp\nindex b931e6feba29..8b44a6f88ab0 100644\n--- a/editor/export/editor_export_platform.cpp\n+++ b/editor/export/editor_export_platform.cpp\n@@ -50,6 +50,26 @@\n #include \"scene/resources/image_texture.h\"\n #include \"scene/resources/packed_scene.h\"\n \n+class EditorExportSaveProxy {\n+\tHashSet<String> saved_paths;\n+\tEditorExportPlatform::EditorExportSaveFunction save_func;\n+\tbool tracking_saves = false;\n+\n+public:\n+\tbool has_saved(const String &p_path) const { return saved_paths.has(p_path); }\n+\n+\tError save_file(void *p_userdata, const String &p_path, const Vector<uint8_t> &p_data, int p_file, int p_total, const Vector<String> &p_enc_in_filters, const Vector<String> &p_enc_ex_filters, const Vector<uint8_t> &p_key, uint64_t p_seed) {\n+\t\tif (tracking_saves) {\n+\t\t\tsaved_paths.insert(p_path.simplify_path().trim_prefix(\"res://\"));\n+\t\t}\n+\n+\t\treturn save_func(p_userdata, p_path, p_data, p_file, p_total, p_enc_in_filters, p_enc_ex_filters, p_key, p_seed);\n+\t}\n+\n+\tEditorExportSaveProxy(EditorExportPlatform::EditorExportSaveFunction p_save_func, bool p_track_saves) :\n+\t\t\tsave_func(p_save_func), tracking_saves(p_track_saves) {}\n+};\n+\n static int _get_pad(int p_alignment, int p_n) {\n \tint rest = p_n % p_alignment;\n \tint pad = 0;\n@@ -60,17 +80,6 @@ static int _get_pad(int p_alignment, int p_n) {\n \treturn pad;\n }\n \n-template <typename T>\n-static bool _has_pack_path(const T &p_paths, const String &p_path) {\n-\tfor (const String &E : p_paths) {\n-\t\tif (E.simplify_path().trim_prefix(\"res://\") == p_path) {\n-\t\t\treturn true;\n-\t\t}\n-\t}\n-\n-\treturn false;\n-}\n-\n #define PCK_PADDING 16\n \n bool EditorExportPlatform::fill_log_messages(RichTextLabel *p_log, Error p_err) {\n@@ -1140,9 +1149,10 @@ Error EditorExportPlatform::export_project_files(const Ref<EditorExportPreset> &\n \t\t}\n \t}\n \n+\tEditorExportSaveProxy save_proxy(p_save_func, p_remove_func != nullptr);\n+\n \tError err = OK;\n \tVector<Ref<EditorExportPlugin>> export_plugins = EditorExport::get_singleton()->get_export_plugins();\n-\tVector<String> extra_paths;\n \n \tstruct SortByName {\n \t\tbool operator()(const Ref<EditorExportPlugin> &left, const Ref<EditorExportPlugin> &right) const {\n@@ -1163,12 +1173,10 @@ Error EditorExportPlatform::export_project_files(const Ref<EditorExportPreset> &\n \t\t\t}\n \t\t}\n \t\tfor (int j = 0; j < export_plugins[i]->extra_files.size(); j++) {\n-\t\t\terr = p_save_func(p_udata, export_plugins[i]->extra_files[j].path, export_plugins[i]->extra_files[j].data, 0, paths.size(), enc_in_filters, enc_ex_filters, key, seed);\n+\t\t\terr = save_proxy.save_file(p_udata, export_plugins[i]->extra_files[j].path, export_plugins[i]->extra_files[j].data, 0, paths.size(), enc_in_filters, enc_ex_filters, key, seed);\n \t\t\tif (err != OK) {\n \t\t\t\treturn err;\n \t\t\t}\n-\n-\t\t\textra_paths.push_back(export_plugins[i]->extra_files[j].path);\n \t\t}\n \n \t\texport_plugins.write[i]->_clear();\n@@ -1281,7 +1289,7 @@ Error EditorExportPlatform::export_project_files(const Ref<EditorExportPreset> &\n \t\t\t}\n \n \t\t\tfor (int j = 0; j < export_plugins[i]->extra_files.size(); j++) {\n-\t\t\t\terr = p_save_func(p_udata, export_plugins[i]->extra_files[j].path, export_plugins[i]->extra_files[j].data, idx, total, enc_in_filters, enc_ex_filters, key, seed);\n+\t\t\t\terr = save_proxy.save_file(p_udata, export_plugins[i]->extra_files[j].path, export_plugins[i]->extra_files[j].data, idx, total, enc_in_filters, enc_ex_filters, key, seed);\n \t\t\t\tif (err != OK) {\n \t\t\t\t\treturn err;\n \t\t\t\t}\n@@ -1290,8 +1298,6 @@ Error EditorExportPlatform::export_project_files(const Ref<EditorExportPreset> &\n \t\t\t\t\tpath_remaps.push_back(path);\n \t\t\t\t\tpath_remaps.push_back(export_plugins[i]->extra_files[j].path);\n \t\t\t\t}\n-\n-\t\t\t\textra_paths.push_back(export_plugins[i]->extra_files[j].path);\n \t\t\t}\n \n \t\t\tif (export_plugins[i]->skipped) {\n@@ -1313,7 +1319,7 @@ Error EditorExportPlatform::export_project_files(const Ref<EditorExportPreset> &\n \t\t\tif (importer_type == \"keep\") {\n \t\t\t\t// Just keep file as-is.\n \t\t\t\tVector<uint8_t> array = FileAccess::get_file_as_bytes(path);\n-\t\t\t\terr = p_save_func(p_udata, path, array, idx, total, enc_in_filters, enc_ex_filters, key, seed);\n+\t\t\t\terr = save_proxy.save_file(p_udata, path, array, idx, total, enc_in_filters, enc_ex_filters, key, seed);\n \n \t\t\t\tif (err != OK) {\n \t\t\t\t\treturn err;\n@@ -1356,13 +1362,13 @@ Error EditorExportPlatform::export_project_files(const Ref<EditorExportPreset> &\n \t\t\t\tsarr.resize(cs.size());\n \t\t\t\tmemcpy(sarr.ptrw(), cs.ptr(), sarr.size());\n \n-\t\t\t\terr = p_save_func(p_udata, path + \".import\", sarr, idx, total, enc_in_filters, enc_ex_filters, key, seed);\n+\t\t\t\terr = save_proxy.save_file(p_udata, path + \".import\", sarr, idx, total, enc_in_filters, enc_ex_filters, key, seed);\n \t\t\t\tif (err != OK) {\n \t\t\t\t\treturn err;\n \t\t\t\t}\n \t\t\t\t// Now actual remapped file:\n \t\t\t\tsarr = FileAccess::get_file_as_bytes(export_path);\n-\t\t\t\terr = p_save_func(p_udata, export_path, sarr, idx, total, enc_in_filters, enc_ex_filters, key, seed);\n+\t\t\t\terr = save_proxy.save_file(p_udata, export_path, sarr, idx, total, enc_in_filters, enc_ex_filters, key, seed);\n \t\t\t\tif (err != OK) {\n \t\t\t\t\treturn err;\n \t\t\t\t}\n@@ -1392,14 +1398,14 @@ Error EditorExportPlatform::export_project_files(const Ref<EditorExportPreset> &\n \t\t\t\t\tif (remap == \"path\") {\n \t\t\t\t\t\tString remapped_path = config->get_value(\"remap\", remap);\n \t\t\t\t\t\tVector<uint8_t> array = FileAccess::get_file_as_bytes(remapped_path);\n-\t\t\t\t\t\terr = p_save_func(p_udata, remapped_path, array, idx, total, enc_in_filters, enc_ex_filters, key, seed);\n+\t\t\t\t\t\terr = save_proxy.save_file(p_udata, remapped_path, array, idx, total, enc_in_filters, enc_ex_filters, key, seed);\n \t\t\t\t\t} else if (remap.begins_with(\"path.\")) {\n \t\t\t\t\t\tString feature = remap.get_slice(\".\", 1);\n \n \t\t\t\t\t\tif (remap_features.has(feature)) {\n \t\t\t\t\t\t\tString remapped_path = config->get_value(\"remap\", remap);\n \t\t\t\t\t\t\tVector<uint8_t> array = FileAccess::get_file_as_bytes(remapped_path);\n-\t\t\t\t\t\t\terr = p_save_func(p_udata, remapped_path, array, idx, total, enc_in_filters, enc_ex_filters, key, seed);\n+\t\t\t\t\t\t\terr = save_proxy.save_file(p_udata, remapped_path, array, idx, total, enc_in_filters, enc_ex_filters, key, seed);\n \t\t\t\t\t\t} else {\n \t\t\t\t\t\t\t// Remove paths if feature not enabled.\n \t\t\t\t\t\t\tconfig->erase_section_key(\"remap\", remap);\n@@ -1425,7 +1431,7 @@ Error EditorExportPlatform::export_project_files(const Ref<EditorExportPreset> &\n \t\t\t\tsarr.resize(cs.size());\n \t\t\t\tmemcpy(sarr.ptrw(), cs.ptr(), sarr.size());\n \n-\t\t\t\terr = p_save_func(p_udata, path + \".import\", sarr, idx, total, enc_in_filters, enc_ex_filters, key, seed);\n+\t\t\t\terr = save_proxy.save_file(p_udata, path + \".import\", sarr, idx, total, enc_in_filters, enc_ex_filters, key, seed);\n \n \t\t\t\tif (err != OK) {\n \t\t\t\t\treturn err;\n@@ -1446,7 +1452,7 @@ Error EditorExportPlatform::export_project_files(const Ref<EditorExportPreset> &\n \t\t\t}\n \n \t\t\tVector<uint8_t> array = FileAccess::get_file_as_bytes(export_path);\n-\t\t\terr = p_save_func(p_udata, export_path, array, idx, total, enc_in_filters, enc_ex_filters, key, seed);\n+\t\t\terr = save_proxy.save_file(p_udata, export_path, array, idx, total, enc_in_filters, enc_ex_filters, key, seed);\n \t\t\tif (err != OK) {\n \t\t\t\treturn err;\n \t\t\t}\n@@ -1510,7 +1516,7 @@ Error EditorExportPlatform::export_project_files(const Ref<EditorExportPreset> &\n \t\t\t\t\tnew_file.write[j] = utf8[j];\n \t\t\t\t}\n \n-\t\t\t\terr = p_save_func(p_udata, from + \".remap\", new_file, idx, total, enc_in_filters, enc_ex_filters, key, seed);\n+\t\t\t\terr = save_proxy.save_file(p_udata, from + \".remap\", new_file, idx, total, enc_in_filters, enc_ex_filters, key, seed);\n \t\t\t\tif (err != OK) {\n \t\t\t\t\treturn err;\n \t\t\t\t}\n@@ -1532,7 +1538,7 @@ Error EditorExportPlatform::export_project_files(const Ref<EditorExportPreset> &\n \t\t} else {\n \t\t\tarray = FileAccess::get_file_as_bytes(forced_export[i]);\n \t\t}\n-\t\terr = p_save_func(p_udata, forced_export[i], array, idx, total, enc_in_filters, enc_ex_filters, key, seed);\n+\t\terr = save_proxy.save_file(p_udata, forced_export[i], array, idx, total, enc_in_filters, enc_ex_filters, key, seed);\n \t\tif (err != OK) {\n \t\t\treturn err;\n \t\t}\n@@ -1541,7 +1547,7 @@ Error EditorExportPlatform::export_project_files(const Ref<EditorExportPreset> &\n \tDictionary int_export = get_internal_export_files(p_preset, p_debug);\n \tfor (const Variant &int_name : int_export.keys()) {\n \t\tconst PackedByteArray &array = int_export[int_name];\n-\t\terr = p_save_func(p_udata, int_name, array, idx, total, enc_in_filters, enc_ex_filters, key, seed);\n+\t\terr = save_proxy.save_file(p_udata, int_name, array, idx, total, enc_in_filters, enc_ex_filters, key, seed);\n \t\tif (err != OK) {\n \t\t\treturn err;\n \t\t}\n@@ -1553,22 +1559,16 @@ Error EditorExportPlatform::export_project_files(const Ref<EditorExportPreset> &\n \tVector<uint8_t> data = FileAccess::get_file_as_bytes(engine_cfb);\n \tDirAccess::remove_file_or_error(engine_cfb);\n \n-\terr = p_save_func(p_udata, \"res://\" + config_file, data, idx, total, enc_in_filters, enc_ex_filters, key, seed);\n+\terr = save_proxy.save_file(p_udata, \"res://\" + config_file, data, idx, total, enc_in_filters, enc_ex_filters, key, seed);\n \tif (err != OK) {\n \t\treturn err;\n \t}\n \n \tif (p_remove_func) {\n-\t\tfor (const String &E : PackedData::get_singleton()->get_file_paths()) {\n-\t\t\tString simplified_path = E.simplify_path();\n-\t\t\tif (simplified_path == config_file) {\n-\t\t\t\tcontinue;\n-\t\t\t}\n-\n-\t\t\tString pack_path = simplified_path.trim_suffix(\".remap\");\n-\n-\t\t\tif (!_has_pack_path(paths, pack_path) && !_has_pack_path(extra_paths, pack_path) && !_has_pack_path(path_remaps, pack_path) && !_has_pack_path(forced_export, pack_path)) {\n-\t\t\t\terr = p_remove_func(p_udata, E);\n+\t\tHashSet<String> currently_loaded_paths = PackedData::get_singleton()->get_file_paths();\n+\t\tfor (const String &path : currently_loaded_paths) {\n+\t\t\tif (!save_proxy.has_saved(path)) {\n+\t\t\t\terr = p_remove_func(p_udata, path);\n \t\t\t\tif (err != OK) {\n \t\t\t\t\treturn err;\n \t\t\t\t}\n", "instance_id": "godotengine__godot-102099", "clarity": 2, "difficulty": 0.65, "clarity_explanation": "The problem statement is mostly clear and provides a detailed description of the issue, including the context (exporting PCK patches in Godot), the unexpected behavior (imported resources marked for removal), and the expected outcome (only changed files should be included in the patch). It also includes specific steps to reproduce the issue, system information, and a minimal reproduction project (MRP), which are very helpful for understanding the problem. However, there are minor ambiguities: the problem statement does not explicitly define what constitutes a \"changed\" file or how the patch system should determine which files to include or exclude beyond the example given. Additionally, edge cases (e.g., handling of specific file types or complex project structures) are not mentioned, which could lead to uncertainty during implementation. Overall, the statement is valid and clear but lacks some minor details for a fully comprehensive description.", "difficulty_explanation": "The difficulty of this problem falls into the \"Hard\" category due to several factors. First, the scope of the code changes is moderate but impactful, as it involves modifying a core part of the Godot engine's export system (specifically in `editor_export_platform.cpp`). The changes introduce a new `EditorExportSaveProxy` class to track saved paths and adjust the logic for marking files for removal, which requires understanding the existing export pipeline and file handling logic. This is not a trivial change, as it affects how patches are generated and could have downstream effects on project exports.\n\nSecond, the number of technical concepts involved is significant. The solution requires knowledge of C++ (including memory management and data structures like `HashSet`), familiarity with Godot's internal APIs (e.g., `PackedData`, export plugins), and an understanding of the PCK file format and patch system. Additionally, the developer must grasp the interaction between different parts of the export process, such as file saving, path remapping, and removal logic.\n\nThird, while the problem statement does not explicitly mention edge cases, the code changes suggest potential complexities in handling various file types, remapped paths, and ensuring that only unchanged files are marked for removal. Error handling logic appears to be minimally impacted, as the changes mostly integrate with existing error reporting mechanisms.\n\nOverall, solving this problem requires a deep understanding of the Godot codebase and the export system's architecture, along with careful consideration of how the changes might affect other parts of the system. The difficulty is rated at 0.65 because, while it is not at the extreme end of complexity (e.g., requiring system-level or highly domain-specific knowledge beyond Godot), it still demands significant expertise and careful implementation to avoid introducing new bugs in a critical feature.", "clarity_label": -1, "difficulty_label": -1, "human_clarity": -1, "human_difficulty": -1}
{"problem_statement": "get_rpm() on VehicleWheel3D is calculated incorrectly\n### Tested versions\n\n- Reproducible in: 4.2 stable, 4.3 stable, 4.4.dev7, 4.4 stable\n\n### System information\n\nGodot v4.3.stable (77dcf97d8) - Windows 10.0.26100 - Vulkan (Forward+) - integrated Intel(R) UHD Graphics (Intel Corporation; 31.0.101.2130) - Intel(R) Core(TM) i7-10610U CPU @ 1.80GHz (8 Threads)\n\n### Issue description\n\nWhen you call get_rpm on a VehicleWheel3D when the steering angle is not equal to 0, it returns the wrong RPM. The only workaround I have found is to use trigonometry:\n```gdscript\nvar corrected_rpm = wheel.get_rpm() / cos(wheel.steering)\n```\n\n### Steps to reproduce\n\n- Create a VehicleBody3D\n- Create a VehicleWheel3D as a child\n- Spin up the wheel (engine_force or with friction against the ground)\n- Turn the wheel with steering on the VehicleBody3D\n- Call get_rpm() on the VehicleWheel3D which now gives the wrong rpm\n\n### Minimal reproduction project (MRP)\n\n[vehicle-bug.zip](https://github.com/user-attachments/files/18447812/vehicle-bug.zip)\n", "patch": "diff --git a/scene/3d/physics/vehicle_body_3d.cpp b/scene/3d/physics/vehicle_body_3d.cpp\nindex c5c9153059d5..c508d4ff4ffe 100644\n--- a/scene/3d/physics/vehicle_body_3d.cpp\n+++ b/scene/3d/physics/vehicle_body_3d.cpp\n@@ -852,18 +852,26 @@ void VehicleBody3D::_body_state_changed(PhysicsDirectBodyState3D *p_state) {\n \tfor (int i = 0; i < wheels.size(); i++) {\n \t\tVehicleWheel3D &wheel = *wheels[i];\n \t\tVector3 relpos = wheel.m_raycastInfo.m_hardPointWS - p_state->get_transform().origin;\n-\t\tVector3 vel = p_state->get_linear_velocity() + (p_state->get_angular_velocity()).cross(relpos); // * mPos);\n+\t\tVector3 vel = p_state->get_linear_velocity() + (p_state->get_angular_velocity()).cross(relpos);\n \n \t\tif (wheel.m_raycastInfo.m_isInContact) {\n \t\t\tconst Transform3D &chassisWorldTransform = p_state->get_transform();\n \n+\t\t\t// Get forward vector.\n \t\t\tVector3 fwd(\n \t\t\t\t\tchassisWorldTransform.basis[0][Vector3::AXIS_Z],\n \t\t\t\t\tchassisWorldTransform.basis[1][Vector3::AXIS_Z],\n \t\t\t\t\tchassisWorldTransform.basis[2][Vector3::AXIS_Z]);\n \n+\t\t\t// Apply steering rotation to forward vector for steerable wheels.\n+\t\t\tif (wheel.steers) {\n+\t\t\t\tBasis steering_mat(Vector3(0, 1, 0), wheel.m_steering);\n+\t\t\t\tfwd = steering_mat.xform(fwd);\n+\t\t\t}\n+\n \t\t\treal_t proj = fwd.dot(wheel.m_raycastInfo.m_contactNormalWS);\n \t\t\tfwd -= wheel.m_raycastInfo.m_contactNormalWS * proj;\n+\t\t\tfwd.normalize();\n \n \t\t\treal_t proj2 = fwd.dot(vel);\n \n", "instance_id": "godotengine__godot-101664", "clarity": 2, "difficulty": 0.55, "clarity_explanation": "The problem statement is mostly clear in describing the issue with `get_rpm()` on `VehicleWheel3D` when the steering angle is non-zero. It provides a specific context (Godot engine versions affected), steps to reproduce, and even a workaround using trigonometry. Additionally, a minimal reproduction project is included, which aids in understanding the issue. However, there are minor ambiguities: the problem statement does not explicitly define what the \"correct\" RPM should be or how it should behave with steering angles, leaving some room for interpretation. Constraints or expected behavior under different conditions (e.g., extreme steering angles) are also not specified. Overall, while the issue is well-described, these missing details prevent it from being fully comprehensive.", "difficulty_explanation": "The difficulty of this problem falls into the medium range due to several factors. First, the scope of code changes is relatively focused, primarily affecting a single file (`vehicle_body_3d.cpp`) and a specific section related to wheel velocity calculations. The changes involve modifying the logic for calculating the forward vector with steering angle adjustments, which requires a moderate understanding of 3D physics and vector mathematics (e.g., dot products, cross products, and basis transformations). The technical concepts involved include Godot's physics engine internals, 3D transformations, and vehicle dynamics, which are moderately complex for someone unfamiliar with game physics or the Godot codebase. However, the changes do not appear to impact the broader system architecture significantly, and the amount of code modified is small. Edge cases, such as extreme steering angles or specific contact conditions, are not explicitly mentioned in the problem statement but may need consideration during implementation (e.g., ensuring normalization of vectors prevents division by zero or unexpected behavior). Overall, solving this requires a solid grasp of specific domain knowledge (3D physics in game engines) and careful modification of existing logic, placing it in the medium difficulty range (0.4-0.6), with a slight lean towards the higher end due to the specialized knowledge required.", "clarity_label": -1, "difficulty_label": -1, "human_clarity": -1, "human_difficulty": -1}
{"problem_statement": "Exported project fails to start when UID is saved in project settings\n### Tested versions\n\n- Reproducible in Godot master (c2e4ae782a399adf42c664d3d21d8defe49ba8e5)\n\n### System information\n\nWindows 10\n\n### Issue description\n\nIf you set the main scene through the project manager dialog Godot now saves the UID in the project file:\n```\nconfig_version=5\n\n[application]\n\nconfig/name=\"test-export\"\nrun/main_scene=\"uid://dg450amr7gaby\"\nconfig/features=PackedStringArray(\"4.4\", \"GL Compatibility\")\nconfig/icon=\"res://icon.svg\"\n```\n\nThis works fine in the editor but after exporting your project, Godot can no longer run the project:\n```\nPS C:\\projects\\export> Godot Engine v4.4.dev.custom_build.c2e4ae782 (2024-12-11 17:48:18 UTC) - https://godotengine.org\nOpenGL API 3.3.0 NVIDIA 566.03 - Compatibility - Using Device: NVIDIA - NVIDIA GeForce RTX 4070 Ti\n\nERROR: No loader found for resource: res://uid:/dg450amr7gaby (expected type: )\n   at: (core\\io\\resource_loader.cpp:327)\nERROR: Failed loading scene: res://uid:/dg450amr7gaby.\n   at: (main\\main.cpp:4214)\n```\n\nThe fault is caused by this line of code:\n```\neditor_node.cpp:3973 if (!p_force_open_imported && FileAccess::exists(p_scene + \".import\")) {\n```\nIt attempts to load the file `res://uid:/dg450amr7gaby.import` which does not exist.\n\n### Steps to reproduce\n\n- Create a new project\n- Create a scene, add some stuff to it\n- Save the scene\n- Select the scene as your main scene in the project manager (IMPORTANT, If you run your scene and select \"use current scene\" it will save the proper file path and work)\n- Export your project\n\n### Minimal reproduction project (MRP)\n\n[test-export.zip](https://github.com/user-attachments/files/18125819/test-export.zip)\n\n", "patch": "diff --git a/editor/editor_node.cpp b/editor/editor_node.cpp\nindex 7591208aa02c..d89593b5aeb0 100644\n--- a/editor/editor_node.cpp\n+++ b/editor/editor_node.cpp\n@@ -2085,7 +2085,7 @@ void EditorNode::_dialog_action(String p_file) {\n \t\t\tload_scene(p_file);\n \t\t} break;\n \t\tcase SETTINGS_PICK_MAIN_SCENE: {\n-\t\t\tProjectSettings::get_singleton()->set(\"application/run/main_scene\", p_file);\n+\t\t\tProjectSettings::get_singleton()->set(\"application/run/main_scene\", ResourceUID::path_to_uid(p_file));\n \t\t\tProjectSettings::get_singleton()->save();\n \t\t\t// TODO: Would be nice to show the project manager opened with the highlighted field.\n \n@@ -2134,7 +2134,7 @@ void EditorNode::_dialog_action(String p_file) {\n \t\t} break;\n \n \t\tcase FILE_SAVE_AND_RUN_MAIN_SCENE: {\n-\t\t\tProjectSettings::get_singleton()->set(\"application/run/main_scene\", p_file);\n+\t\t\tProjectSettings::get_singleton()->set(\"application/run/main_scene\", ResourceUID::path_to_uid(p_file));\n \t\t\tProjectSettings::get_singleton()->save();\n \n \t\t\tif (file->get_file_mode() == EditorFileDialog::FILE_MODE_SAVE_FILE) {\n@@ -3962,25 +3962,25 @@ Error EditorNode::load_scene(const String &p_scene, bool p_ignore_broken_deps, b\n \t\treturn OK;\n \t}\n \n+\tString lpath = ResourceUID::ensure_path(p_scene);\n \tif (!p_set_inherited) {\n \t\tfor (int i = 0; i < editor_data.get_edited_scene_count(); i++) {\n-\t\t\tif (editor_data.get_scene_path(i) == p_scene) {\n+\t\t\tif (editor_data.get_scene_path(i) == lpath) {\n \t\t\t\t_set_current_scene(i);\n \t\t\t\treturn OK;\n \t\t\t}\n \t\t}\n \n-\t\tif (!p_force_open_imported && FileAccess::exists(p_scene + \".import\")) {\n-\t\t\topen_imported->set_text(vformat(TTR(\"Scene '%s' was automatically imported, so it can't be modified.\\nTo make changes to it, a new inherited scene can be created.\"), p_scene.get_file()));\n+\t\tif (!p_force_open_imported && FileAccess::exists(lpath + \".import\")) {\n+\t\t\topen_imported->set_text(vformat(TTR(\"Scene '%s' was automatically imported, so it can't be modified.\\nTo make changes to it, a new inherited scene can be created.\"), lpath.get_file()));\n \t\t\topen_imported->popup_centered();\n \t\t\tnew_inherited_button->grab_focus();\n-\t\t\topen_import_request = p_scene;\n+\t\t\topen_import_request = lpath;\n \t\t\treturn OK;\n \t\t}\n \t}\n \n-\tString lpath = ProjectSettings::get_singleton()->localize_path(p_scene);\n-\n+\tlpath = ProjectSettings::get_singleton()->localize_path(lpath);\n \tif (!lpath.begins_with(\"res://\")) {\n \t\tshow_accept(TTR(\"Error loading scene, it must be inside the project path. Use 'Import' to open the scene, then save it inside the project path.\"), TTR(\"OK\"));\n \t\topening_prev = false;\n@@ -4081,7 +4081,7 @@ Error EditorNode::load_scene(const String &p_scene, bool p_ignore_broken_deps, b\n \n \tset_edited_scene(new_scene);\n \n-\tString config_file_path = EditorPaths::get_singleton()->get_project_settings_dir().path_join(p_scene.get_file() + \"-editstate-\" + p_scene.md5_text() + \".cfg\");\n+\tString config_file_path = EditorPaths::get_singleton()->get_project_settings_dir().path_join(lpath.get_file() + \"-editstate-\" + lpath.md5_text() + \".cfg\");\n \tRef<ConfigFile> editor_state_cf;\n \teditor_state_cf.instantiate();\n \tError editor_state_cf_err = editor_state_cf->load(config_file_path);\ndiff --git a/editor/filesystem_dock.cpp b/editor/filesystem_dock.cpp\nindex 9bf21a543884..ac95f0346d56 100644\n--- a/editor/filesystem_dock.cpp\n+++ b/editor/filesystem_dock.cpp\n@@ -270,7 +270,7 @@ void FileSystemDock::_create_tree(TreeItem *p_parent, EditorFileSystemDirectory\n \n \t// Create all items for the files in the subdirectory.\n \tif (display_mode == DISPLAY_MODE_TREE_ONLY) {\n-\t\tString main_scene = GLOBAL_GET(\"application/run/main_scene\");\n+\t\tconst String main_scene = ResourceUID::ensure_path(GLOBAL_GET(\"application/run/main_scene\"));\n \n \t\t// Build the list of the files to display.\n \t\tList<FileInfo> file_list;\n@@ -1125,7 +1125,7 @@ void FileSystemDock::_update_file_list(bool p_keep_selection) {\n \tsort_file_info_list(file_list, file_sort);\n \n \t// Fills the ItemList control node from the FileInfos.\n-\tString main_scene = GLOBAL_GET(\"application/run/main_scene\");\n+\tconst String main_scene = ResourceUID::ensure_path(GLOBAL_GET(\"application/run/main_scene\"));\n \tfor (FileInfo &E : file_list) {\n \t\tFileInfo *finfo = &(E);\n \t\tString fname = finfo->name;\n@@ -2379,7 +2379,7 @@ void FileSystemDock::_file_option(int p_option, const Vector<String> &p_selected\n \t\tcase FILE_MAIN_SCENE: {\n \t\t\t// Set as main scene with selected scene file.\n \t\t\tif (p_selected.size() == 1) {\n-\t\t\t\tProjectSettings::get_singleton()->set(\"application/run/main_scene\", p_selected[0]);\n+\t\t\t\tProjectSettings::get_singleton()->set(\"application/run/main_scene\", ResourceUID::path_to_uid(p_selected[0]));\n \t\t\t\tProjectSettings::get_singleton()->save();\n \t\t\t\t_update_tree(get_uncollapsed_paths());\n \t\t\t\t_update_file_list(true);\ndiff --git a/main/main.cpp b/main/main.cpp\nindex b3b6d960e7a1..b8dec2154b24 100644\n--- a/main/main.cpp\n+++ b/main/main.cpp\n@@ -3817,8 +3817,8 @@ int Main::start() {\n \n #endif // TOOLS_ENABLED\n \n-\tif (script.is_empty() && game_path.is_empty() && String(GLOBAL_GET(\"application/run/main_scene\")) != \"\") {\n-\t\tgame_path = GLOBAL_GET(\"application/run/main_scene\");\n+\tif (script.is_empty() && game_path.is_empty()) {\n+\t\tgame_path = ResourceUID::ensure_path(GLOBAL_GET(\"application/run/main_scene\"));\n \t}\n \n #ifdef TOOLS_ENABLED\n", "instance_id": "godotengine__godot-100408", "clarity": 2, "difficulty": 0.55, "clarity_explanation": "The problem statement is mostly clear and provides a detailed description of the issue, including the context (exported project failing to start due to UID in project settings), steps to reproduce, and the specific error messages encountered. It also includes a minimal reproduction project (MRP) and specifies the tested version of Godot. However, there are minor ambiguities: the problem statement does not explicitly discuss expected behavior after the fix (e.g., whether the UID should be converted to a file path during export or handled differently), and it lacks mention of potential edge cases or constraints (e.g., how this impacts different export platforms or project configurations). These missing details prevent it from being fully comprehensive, but the overall intent and issue are well-articulated.", "difficulty_explanation": "The difficulty of this problem falls in the medium range due to several factors. First, the scope of code changes spans multiple files (`editor_node.cpp`, `filesystem_dock.cpp`, and `main.cpp`) in the Godot engine, requiring an understanding of how different parts of the codebase interact, particularly around resource loading and project settings management. The changes involve modifying how paths and UIDs are handled, which necessitates familiarity with Godot's `ResourceUID` system and path localization logic. The technical concepts involved include resource management, file system interactions, and configuration handling, which are moderately complex but not overly advanced. The amount of code change is relatively small, with targeted modifications to specific functions, and it does not appear to impact the broader system architecture significantly. Edge cases, such as handling invalid UIDs or ensuring compatibility across different export targets, are not explicitly mentioned in the problem statement but are implied and would require consideration during implementation. Overall, solving this requires a solid understanding of the Godot engine's internals and careful handling of resource paths, placing it at a medium difficulty level of 0.55.", "clarity_label": -1, "difficulty_label": -1, "human_clarity": -1, "human_difficulty": -1}
{"problem_statement": "Shader with instance uniforms fails in compatibility\n### Tested versions\n\nv4.4.dev4.official [36e6207bb]\n\n\n### System information\n\nGodot v4.4.dev4 - Windows 10.0.22631 - Multi-window, 2 monitors - OpenGL 3 (Compatibility) - NVIDIA GeForce RTX 2070 SUPER (NVIDIA; 32.0.15.6094) - 13th Gen Intel(R) Core(TM) i7-13700KF (24 threads)\n\n### Issue description\n\nAttached project uses both a global and 2 instance uniforms.\n\nActual error is: \n```\nE 0:00:01:0046   _display_error_with_code: SceneShaderGLES3: Fragment shader compilation failed:\n0(445) : error C1503: undefined variable \"instance_offset\"\n```\n\nLooks like definition is after use.\nFrom the output log (filtered by instance_offset):\n```\n445: \t\tvec2 m_d=vec2((((global_shader_uniforms[m_iTime].x) * 0.00050000002375) + (global_shader_uniforms[(instance_offset+1u)].x)), 0.0);\n672: uniform highp uint instance_offset;\n```\n\n\n\n### Steps to reproduce\n\nRun attached project.\n\n\n### Minimal reproduction project (MRP)\n\n[instance-test.zip](https://github.com/user-attachments/files/18031254/instance-test.zip)\n\n", "patch": "diff --git a/drivers/gles3/shaders/scene.glsl b/drivers/gles3/shaders/scene.glsl\nindex 2022c8ee436f..1867930b2922 100644\n--- a/drivers/gles3/shaders/scene.glsl\n+++ b/drivers/gles3/shaders/scene.glsl\n@@ -974,6 +974,10 @@ layout(std140) uniform MultiviewData { // ubo:8\n multiview_data;\n #endif\n \n+uniform highp mat4 world_transform;\n+uniform highp uint instance_offset;\n+uniform highp uint model_flags;\n+\n /* clang-format off */\n \n #GLOBALS\n@@ -1199,10 +1203,7 @@ ivec2 multiview_uv(ivec2 uv) {\n }\n #endif\n \n-uniform highp mat4 world_transform;\n uniform mediump float opaque_prepass_threshold;\n-uniform highp uint model_flags;\n-uniform highp uint instance_offset;\n \n #if defined(RENDER_MATERIAL)\n layout(location = 0) out vec4 albedo_output_buffer;\n", "instance_id": "godotengine__godot-100125", "clarity": 2, "difficulty": 0.35, "clarity_explanation": "The problem statement is mostly clear in describing the issue: a shader compilation error in Godot v4.4.dev4 when using instance uniforms under OpenGL 3 (Compatibility) mode. It provides specific error messages, relevant system information, steps to reproduce, and a minimal reproduction project (MRP). However, there are minor ambiguities and missing details. For instance, the problem statement does not explicitly define the expected behavior or the desired outcome after the fix (e.g., how the instance uniforms should work). Additionally, it lacks clarity on potential constraints or edge cases related to different shader configurations or hardware setups beyond the provided system information. While the error message and log output hint at the root cause (definition after use), the statement does not explicitly confirm the hypothesis or provide deeper context about the shader compilation process in Godot. Overall, it is clear enough to understand the issue and start working on a solution, but it misses some details that could make it comprehensive.", "difficulty_explanation": "The difficulty of this problem falls in the \"Easy\" range (0.2-0.4) due to the following factors:\n\n1. **Scope and Depth of Code Changes**: The provided diff shows a relatively small and focused change in a single file (`scene.glsl`). The modification involves reordering uniform declarations to ensure `instance_offset` is defined before use. This does not impact the broader system architecture or require changes across multiple modules. The amount of code change is minimal, involving only a few lines being moved.\n\n2. **Technical Concepts Involved**: Solving this issue requires a basic understanding of shader programming (specifically GLSL) and the concept of uniform variables in OpenGL. The problem hinges on a straightforward issue of declaration order, which is a fundamental concept in programming and shader compilation. No advanced algorithms, design patterns, or domain-specific knowledge beyond shader basics are needed. Familiarity with Godot's rendering pipeline is helpful but not strictly necessary to apply the fix.\n\n3. **Edge Cases and Error Handling**: The problem statement does not explicitly mention edge cases beyond the specific error in the provided setup. The code change itself does not introduce or modify error handling logic. However, there is a minor risk of unintended side effects if other parts of the shader code depend on the original order of declarations, though this seems unlikely given the nature of the fix.\n\n4. **Overall Complexity**: The issue is a simple bug fix that does not require deep understanding of the entire codebase or complex refactoring. It is a localized problem with a clear root cause (definition after use) and a straightforward solution (reordering declarations). The main challenge might be verifying that the fix works across different hardware or shader configurations, but this is not indicated as a significant concern in the problem statement or code change.\n\nGiven these points, a difficulty score of 0.35 reflects an \"Easy\" problem that requires understanding some shader logic and making a simple modification, with minimal impact on the broader system.", "clarity_label": -1, "difficulty_label": -1, "human_clarity": -1, "human_difficulty": -1}
