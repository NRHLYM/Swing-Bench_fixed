{"problem_statement": "Display a warning message for problematic OpenSSL versions\nIn ProxySQL 3.0 we stopped using statically linked OpenSSL in favor of dynamically linked.\nThis also means that an outdated version of OpenSSL can considerably slowdown ProxySQL.\nFor example, in a CI run where OpenSSL 3.0.2 is installed, the test `test_cacert_load_and_verify_duration-t` fails with:\n```\nmsg: not ok 1 - 2025-02-14 22:49:32.351206 - Total duration is '60871 ms' should be less than 20 Seconds\n```\n\nI think we need to take a series of actions:\n* [ ] export via status variables what OpenSSL version is in use\n* [ ] test `test_cacert_load_and_verify_duration-t` should check OpenSSL version using such variable, and adjust the time threshold\n* [ ] When ProxySQL prints the OpenSSL version (ex: `[INFO] Using OpenSSL version: OpenSSL 3.0.2 15 Mar 2022`) it should also display a warning for problematic known OpenSSL versions\n\n\nNote:\nMaybe (not sure) issue #4828 is related to OpenSSL version too\n", "patch": "diff --git a/lib/ProxySQL_Admin_Stats.cpp b/lib/ProxySQL_Admin_Stats.cpp\nindex c6b477f93..3e314a8c3 100644\n--- a/lib/ProxySQL_Admin_Stats.cpp\n+++ b/lib/ProxySQL_Admin_Stats.cpp\n@@ -591,6 +591,7 @@ void ProxySQL_Admin::stats___mysql_global() {\n \t}\n \n \tsqlite3_global_stats_row_step(statsdb, row_stmt, \"mysql_listener_paused\", admin_proxysql_mysql_paused);\n+\tsqlite3_global_stats_row_step(statsdb, row_stmt, \"OpenSSL_Version_Num\", OpenSSL_version_num());\n \n \tstatsdb->execute(\"COMMIT\");\n }\ndiff --git a/src/main.cpp b/src/main.cpp\nindex 7c1006c01..8f9ce9316 100644\n--- a/src/main.cpp\n+++ b/src/main.cpp\n@@ -341,8 +341,15 @@ static void init_locks(void) {\n static bool check_openssl_version() {\n \tunsigned long version = OpenSSL_version_num();\n \tconst unsigned long OPENSSL_3_0_0 = 0x30000000L;\n+\tconst unsigned long OPENSSL_3_2_0 = 0x30200000L;\n \n \tproxy_info(\"Using OpenSSL version: %s\\n\", OpenSSL_version(OPENSSL_VERSION));\n+\tif (version > OPENSSL_3_0_0 && version < OPENSSL_3_2_0) {\n+\t\tproxy_warning(\n+\t\t\t\"Detected OpenSSL version has known performance regressions, please upgrade to '3.2.0' or later.\"\n+\t\t\t\" For further details, please refer to: https://github.com/openssl/openssl/issues/18814\\n\"\n+\t\t);\n+\t}\n \tif (version < OPENSSL_3_0_0) {\n \t\tproxy_error(\"%s\\n\", \"ProxySQL server required openssl version 3.0.0 or above\");\n \t\treturn false;\n", "instance_id": "sysown__proxysql-4881", "clarity": 2, "difficulty": 0.35, "clarity_explanation": "The problem statement is mostly clear in outlining the goal of addressing performance issues related to specific OpenSSL versions in ProxySQL by displaying warnings, exporting version information via status variables, and adjusting test thresholds. It specifies the context (dynamic linking of OpenSSL in ProxySQL 3.0), provides an example of a failing test with a specific error message, and lists actionable tasks. However, there are minor ambiguities and missing details. For instance, it does not explicitly define what constitutes a \"problematic\" OpenSSL version beyond the example of 3.0.2, nor does it specify the exact threshold adjustments for the test or how the status variables should be used in practice. Additionally, the reference to issue #4828 as potentially related introduces uncertainty without actionable detail. Overall, while the intent and high-level requirements are clear, some specifics are left to interpretation, warranting a score of 2 (Mostly Clear).", "difficulty_explanation": "The difficulty of this problem falls in the Easy range (0.2-0.4) due to the relatively straightforward nature of the required changes and the limited scope of technical complexity. Analyzing the factors:\n\n1. **Scope and Depth of Code Changes:** The provided code changes are confined to two files (`ProxySQL_Admin_Stats.cpp` and `main.cpp`), with minimal modifications. In `ProxySQL_Admin_Stats.cpp`, a single line is added to export the OpenSSL version as a status variable. In `main.cpp`, a conditional check and warning message are added for specific OpenSSL versions. These changes are localized, do not impact the broader system architecture, and involve a small amount of code (less than 10 lines of meaningful additions). No deep understanding of interactions across the codebase is required beyond knowing where OpenSSL version information is accessed and logged.\n\n2. **Number of Technical Concepts:** The solution requires basic familiarity with C++ (as the codebase appears to be in C++), specifically handling version numbers as unsigned longs, using conditional logic, and interacting with OpenSSL library functions like `OpenSSL_version_num()` and `OpenSSL_version()`. No advanced algorithms, design patterns, or domain-specific knowledge beyond basic OpenSSL version handling is needed. The concepts are relatively simple and accessible to a developer with intermediate C++ experience.\n\n3. **Edge Cases and Error Handling:** The problem statement and code changes do not explicitly address complex edge cases or error handling beyond identifying a version range (between 3.0.0 and 3.2.0) for warnings. There is no indication of needing to handle scenarios like missing OpenSSL libraries, version parsing errors, or dynamic loading failures. The simplicity of the version check logic suggests minimal complexity in this area.\n\n4. **Overall Complexity:** While the problem touches on performance considerations (slowdowns due to OpenSSL versions), the solution itself does not require addressing performance directly\u2014just reporting and warning about versions. The remaining tasks mentioned in the problem statement (e.g., adjusting test thresholds) are not reflected in the provided code changes, so they are not factored into this evaluation. If those tasks were included, the difficulty might slightly increase due to test logic modifications, but it would likely remain in the Easy range.\n\nGiven these points, a difficulty score of 0.35 is appropriate, reflecting a task that requires understanding some code logic (OpenSSL version handling and logging) and making simple modifications, but does not demand deep architectural changes or advanced technical expertise.", "clarity_label": -1, "difficulty_label": -1, "human_clarity": -1, "human_difficulty": -1}
{"problem_statement": "[FEATURE] Action to check that the generated code is up to date\n- the `code_generation/` directory contains the code generator including its configuration.\r\n- It is important that the generated code is up to date. i.e.:\r\n  - no manual code changes were made to generated files; generated files should remain generated\r\n  - the generated files are up to date with the latest code generator including its input configuration\r\n\r\nThis issue is about adding a github action check that that is indeed the case.\r\n\r\n## TODO\r\n\r\n* [x] Update all files in the `code_generation/templates/` directory\r\n  * [x] Those files currently contain the string `This header file is automatically generated. DO NOT modify it manually!`\r\n  * [x] There is at least one CPP file that is clearly not a header file but does contain the string `header`. That is clearly wrong (as it's not a header but a CPP file)\r\n  * [x] Instead, the string should be: `This file is automatically generated. DO NOT modify it manually!`\r\n  * [x] Run the `code_generation/code_gen.py` file to update all generated files and check them in\r\n* [x] Create the github action\r\n  * [x] Install all dependencies (found in `code_generation/requirements.txt`)\r\n  * [x] Run `code_generation/code_gen.py`\r\n  * [x] Check that the `git status` is empty\r\n    * [x] should pass if it is empty\r\n    * [x] should fail action if it isn't empty and list the changed files\r\n    * [x] look up the exact command in the `git` documentation to do this\r\n  * [x] To prevent unnecessary checks, the action should only run if and only if the following checked-in files and directories are changed:\r\n    * [x] `code_generation/`\r\n    * [x] All files and directories that contain the string `This file is automatically generated. DO NOT modify it manually!`\r\n      * [x] In particular, those are the files that the templates `code_generation/templates/` map to\r\n      * [x] That is: `code_generation/templates/x/.../y.z` maps to `x/.../y.z`\r\n\n", "patch": "diff --git a/.github/workflows/check-code-quality.yml b/.github/workflows/check-code-quality.yml\nindex 85aabd328..dc3c5a0d8 100644\n--- a/.github/workflows/check-code-quality.yml\n+++ b/.github/workflows/check-code-quality.yml\n@@ -75,3 +75,18 @@ jobs:\n             git status --porcelain --untracked-files=no\n             exit 1\n           fi\n+      \n+      - name: Check generated code\n+        if: success()\n+        run: |\n+          pip install -r code_generation/requirements.txt\n+          python code_generation/code_gen.py\n+          if [ -n \"$(git status --porcelain)\" ]; then\n+            echo\n+            echo \"The following files are outdated or were manually updated:\"\n+            git status --porcelain\n+            exit 1\n+          else\n+            echo\n+            echo \"All the generated files are up to date.\"\n+          fi\ndiff --git a/code_generation/templates/power_grid_model_c/power_grid_model_c/src/dataset_class_maps.cpp.jinja b/code_generation/templates/power_grid_model_c/power_grid_model_c/src/dataset_class_maps.cpp.jinja\nindex ff9ff3b7d..ed849f3db 100644\n--- a/code_generation/templates/power_grid_model_c/power_grid_model_c/src/dataset_class_maps.cpp.jinja\n+++ b/code_generation/templates/power_grid_model_c/power_grid_model_c/src/dataset_class_maps.cpp.jinja\n@@ -2,7 +2,7 @@\n //\n // SPDX-License-Identifier: MPL-2.0\n \n-// This header file is automatically generated. DO NOT modify it manually!\n+// This file is automatically generated. DO NOT modify it manually!\n \n // clang-format off\n \ndiff --git a/power_grid_model_c/power_grid_model_c/src/dataset_definitions.cpp b/power_grid_model_c/power_grid_model_c/src/dataset_definitions.cpp\nindex 70bd343b9..52951134e 100644\n--- a/power_grid_model_c/power_grid_model_c/src/dataset_definitions.cpp\n+++ b/power_grid_model_c/power_grid_model_c/src/dataset_definitions.cpp\n@@ -2,7 +2,7 @@\n //\n // SPDX-License-Identifier: MPL-2.0\n \n-// This header file is automatically generated. DO NOT modify it manually!\n+// This file is automatically generated. DO NOT modify it manually!\n \n // clang-format off\n \n", "instance_id": "PowerGridModel__power-grid-model-658", "clarity": 2, "difficulty": 0.35, "clarity_explanation": "\nThe problem statement is mostly clear in describing the goal of ensuring that generated code remains up-to-date and unmodified manually, as well as implementing a GitHub Action to enforce this. It provides a detailed breakdown of tasks, such as updating template files, running a code generator, and checking for changes via `git status`. The context of the `code_generation/` directory and the mapping of templates to generated files is also explained. However, there are minor ambiguities and missing details that prevent a perfect score. For instance, the problem does not explicitly define what constitutes a \"manual change\" or how to handle cases where generated files might legitimately differ due to external factors (e.g., environment differences). Additionally, while the GitHub Action's logic is outlined, there is no mention of specific edge cases, such as what to do if dependencies fail to install or if the code generator itself encounters errors. These omissions could lead to implementation challenges or misinterpretations.\n", "difficulty_explanation": "\nI rate the difficulty of this problem as 0.35, placing it in the \"Easy\" range (0.2-0.4). Here's the reasoning based on the evaluation factors:\n\n1. **Scope and Depth of Code Changes**: The code changes are relatively localized. The GitHub Action addition involves modifying a single workflow file (`.github/workflows/check-code-quality.yml`) with a straightforward script to install dependencies, run a Python script, and check `git status`. Additionally, there are minor textual updates to template and generated files (changing \"header file\" to \"file\" in comments). These changes do not impact the broader system architecture or require deep interaction with other parts of the codebase. The overall amount of code change is small.\n\n2. **Number of Technical Concepts**: The problem requires basic familiarity with several concepts, but none are particularly complex. These include GitHub Actions (writing a simple workflow with conditional execution and shell commands), basic Git commands (`git status --porcelain`), and Python scripting (running a provided code generator script and installing dependencies via `pip`). There are no advanced algorithms, design patterns, or domain-specific knowledge required beyond general software development practices.\n\n3. **Potential Edge Cases and Error Handling**: The problem statement does not explicitly mention edge cases, but the code changes imply some basic error handling, such as failing the action if `git status` shows changes. However, more complex edge cases (e.g., dependency installation failures, code generator runtime errors, or differences in generated output due to environment variations) are not addressed in the problem or code changes. Implementing robust error handling for these scenarios would increase difficulty, but as presented, the requirements are minimal.\n\n4. **Overall Complexity**: The task is straightforward for a developer with basic experience in CI/CD pipelines and scripting. It involves understanding a small part of the codebase (`code_generation/` directory and GitHub workflows) and making simple modifications. There are no performance considerations, architectural changes, or intricate logic to implement.\n\nIn summary, this problem is easy because it involves limited code changes, basic technical concepts, and minimal complexity in logic or error handling. It is slightly above the \"Very Easy\" range (0.0-0.2) due to the need to understand GitHub Actions and coordinate multiple steps (dependency installation, script execution, and status checking), but it does not reach the \"Medium\" difficulty level (0.4-0.6) as it lacks deeper architectural impact or complex technical challenges.\n", "clarity_label": -1, "difficulty_label": -1, "human_clarity": -1, "human_difficulty": -1}
{"problem_statement": "build: Boost 1.74.0 incompatible with Clang 18\nPointed out here: https://github.com/bitcoin/bitcoin/pull/30739#pullrequestreview-2267576746.\r\nCompiling with Clang 18 and Boost 1.74.0 fails:\r\n```bash\r\nIn file included from /usr/include/boost/mpl/integral_c.hpp:32:\r\n/usr/include/boost/mpl/aux_/integral_wrapper.hpp:73:31: error: integer value -1 is outside the valid range of values [0, 3] for the enumeration type 'udt_builtin_mixture_enum' [-Wenum-constexpr-conversion]\r\n   73 |     typedef AUX_WRAPPER_INST( BOOST_MPL_AUX_STATIC_CAST(AUX_WRAPPER_VALUE_TYPE, (value - 1)) ) prior;\r\n      |                               ^\r\n/usr/include/boost/mpl/aux_/static_cast.hpp:24:47: note: expanded from macro 'BOOST_MPL_AUX_STATIC_CAST'\r\n   24 | #   define BOOST_MPL_AUX_STATIC_CAST(T, expr) static_cast<T>(expr)\r\n      |                                               ^\r\nIn file included from ../../../src/test/validation_chainstatemanager_tests.cpp:8:\r\nIn file included from ../../../src/node/chainstatemanager_args.h:9:\r\nIn file included from ../../../src/validation.h:28:\r\nIn file included from ../../../src/txmempool.h:26:\r\nIn file included from /usr/include/boost/multi_index/hashed_index.hpp:38:\r\nIn file included from /usr/include/boost/multi_index/detail/node_handle.hpp:22:\r\nIn file included from /usr/include/boost/multi_index_container_fwd.hpp:18:\r\nIn file included from /usr/include/boost/multi_index/indexed_by.hpp:17:\r\nIn file included from /usr/include/boost/mpl/vector.hpp:36:\r\nIn file included from /usr/include/boost/mpl/vector/vector20.hpp:18:\r\nIn file included from /usr/include/boost/mpl/vector/vector10.hpp:18:\r\nIn file included from /usr/include/boost/mpl/vector/vector0.hpp:24:\r\nIn file included from /usr/include/boost/mpl/vector/aux_/clear.hpp:18:\r\nIn file included from /usr/include/boost/mpl/vector/aux_/vector0.hpp:22:\r\nIn file included from /usr/include/boost/mpl/vector/aux_/iterator.hpp:19:\r\nIn file included from /usr/include/boost/mpl/plus.hpp:19:\r\nIn file included from /usr/include/boost/mpl/aux_/arithmetic_op.hpp:17:\r\nIn file included from /usr/include/boost/mpl/integral_c.hpp:32:\r\n/usr/include/boost/mpl/aux_/integral_wrapper.hpp:73:31: error: integer value -1 is outside the valid range of values [0, 3] for the enumeration type 'int_float_mixture_enum' [-Wenum-constexpr-conversion]\r\n/usr/include/boost/mpl/aux_/static_cast.hpp:24:47: note: expanded from macro 'BOOST_MPL_AUX_STATIC_CAST'\r\n   24 | #   define BOOST_MPL_AUX_STATIC_CAST(T, expr) static_cast<T>(expr)\r\n      |                                               ^\r\n2 errors generated.\r\n```\r\n\r\nThe same failure does not happen with GCC (12), but may do with later versions: https://sourceware.org/bugzilla/show_bug.cgi?id=31331.\r\n\r\nGiven our documentation currently claims that Boost `1.73.0` is supported, this should be fixed in some way, the documentation updated to drop support for this version, etc. Although, it looks like part of the fix for the Boost code only landed as of 1.86.0? https://github.com/boostorg/mpl/issues/69 (currently the latest release).\n", "patch": "diff --git a/src/txmempool.h b/src/txmempool.h\nindex d0cb41a078ec2..7fdf1c5a39ae9 100644\n--- a/src/txmempool.h\n+++ b/src/txmempool.h\n@@ -23,7 +23,17 @@\n #include <util/result.h>\n #include <util/feefrac.h>\n \n+// This works around a bug in Boost <= 1.80.0 when using Clang >=18.\n+// See https://github.com/bitcoin/bitcoin/issues/30751.\n+#if defined(__clang__)\n+#pragma clang diagnostic push\n+#pragma clang diagnostic ignored \"-Wenum-constexpr-conversion\"\n+#endif\n #include <boost/multi_index/hashed_index.hpp>\n+#if defined(__clang__)\n+#pragma clang diagnostic pop\n+#endif\n+\n #include <boost/multi_index/identity.hpp>\n #include <boost/multi_index/indexed_by.hpp>\n #include <boost/multi_index/ordered_index.hpp>\n", "instance_id": "bitcoin__bitcoin-30821", "clarity": 2, "difficulty": 0.25, "clarity_explanation": "The problem statement is mostly clear in identifying the issue: a compatibility problem between Boost 1.74.0 and Clang 18, leading to compilation errors due to enum conversion issues. It provides detailed error logs, references to related discussions, and links to external resources (e.g., Boost issue tracker and GCC bug reports). The goal is implied\u2014to resolve the compilation failure\u2014though it is not explicitly stated whether the solution should be a code workaround, a documentation update, or a dependency version change. Additionally, there are minor ambiguities regarding the expected long-term resolution (e.g., whether Boost support for versions <1.86.0 should be dropped or if a more permanent fix is needed). Constraints and edge cases are not explicitly discussed in the problem statement, though the provided links hint at broader implications. Overall, the statement is valid and clear but lacks some explicit details about the desired outcome and scope of the fix.", "difficulty_explanation": "The difficulty of this problem falls into the \"Easy\" range (0.2-0.4) due to the following factors:\n\n1. **Scope and Depth of Code Changes:** The provided code change is minimal and localized to a single file (`txmempool.h`). It involves adding a compiler-specific pragma to suppress a warning (`-Wenum-constexpr-conversion`) when using Clang, which is a straightforward workaround. The change does not impact the broader architecture of the system or require modifications across multiple modules. The amount of code change is very small (a few lines).\n\n2. **Technical Concepts Involved:** The solution requires basic knowledge of compiler-specific pragmas and an understanding of how to suppress warnings in Clang. It does not involve complex algorithms, design patterns, or deep domain-specific knowledge beyond familiarity with C++ compilation issues and Boost library usage. The concept of enum conversion warnings is relatively simple for someone with moderate C++ experience.\n\n3. **Edge Cases and Error Handling:** The problem statement does not explicitly mention edge cases, and the code change does not introduce new logic that requires handling edge cases or modifying error handling. The workaround is purely a build-time fix and does not affect runtime behavior.\n\n4. **Overall Complexity:** While the underlying issue (Boost and Clang incompatibility) might seem complex, the provided solution is a simple and pragmatic fix that does not require deep investigation or extensive modifications. However, it is worth noting that a more permanent solution (e.g., updating Boost version requirements or contributing a fix upstream) could increase the difficulty, but the current change is limited in scope.\n\nGiven these points, a difficulty score of 0.25 reflects the simplicity of the code change and the minimal technical depth required to implement the workaround. It is slightly above the \"Very Easy\" range due to the need to understand the context of the Boost-Clang compatibility issue and the implications of suppressing warnings, which requires some familiarity with C++ build systems.", "clarity_label": -1, "difficulty_label": -1, "human_clarity": -1, "human_difficulty": -1}
{"problem_statement": "Build fails with boost 1.86\nWith Boost 1.86.0-2, I get the following error during build:\r\n```\r\nIn file included from src/exprbase.h:56,\r\n                 from src/draft.h:44,\r\n                 from src/stats.cc:34\r\nsrc/utils.h: In function \u2018ledger::string ledger::sha1sum(const string&)\u2019:\r\nsrc/utils.h:602:18: error: cannot convert \u2018unsigned int [5]\u2019 to \u2018unsigned char (&)[20]\u2019\r\n  602 |   sha.get_digest(message_digest);\r\n      |                  ^~~~~~~~~~~~~~\r\n      |                  |\r\n      |                  unsigned int [5]\r\nIn file included from src/utils.h:46:\r\n/usr/include/boost/uuid/detail/sha1.hpp:179:43: note:   initializing argument 1 of \u2018void boost::uuids::detail::sha1::get_digest(unsigned char (&)[20])\u2019\r\n  179 | inline void sha1::get_digest(digest_type& digest)\r\n      |                              ~~~~~~~~~~~~~^~~~~~\r\n```\nBuild fails with boost 1.86\nWith Boost 1.86.0-2, I get the following error during build:\r\n```\r\nIn file included from src/exprbase.h:56,\r\n                 from src/draft.h:44,\r\n                 from src/stats.cc:34\r\nsrc/utils.h: In function \u2018ledger::string ledger::sha1sum(const string&)\u2019:\r\nsrc/utils.h:602:18: error: cannot convert \u2018unsigned int [5]\u2019 to \u2018unsigned char (&)[20]\u2019\r\n  602 |   sha.get_digest(message_digest);\r\n      |                  ^~~~~~~~~~~~~~\r\n      |                  |\r\n      |                  unsigned int [5]\r\nIn file included from src/utils.h:46:\r\n/usr/include/boost/uuid/detail/sha1.hpp:179:43: note:   initializing argument 1 of \u2018void boost::uuids::detail::sha1::get_digest(unsigned char (&)[20])\u2019\r\n  179 | inline void sha1::get_digest(digest_type& digest)\r\n      |                              ~~~~~~~~~~~~~^~~~~~\r\n```\n", "patch": "diff --git a/src/filters.cc b/src/filters.cc\nindex b5b7fb19f..523fa7959 100644\n--- a/src/filters.cc\n+++ b/src/filters.cc\n@@ -237,8 +237,6 @@ void anonymize_posts::render_commodity(amount_t& amt)\n \n void anonymize_posts::operator()(post_t& post)\n {\n-\tboost::uuids::detail::sha1  sha;\n-  unsigned int message_digest[5];\n   bool         copy_xact_details = false;\n \n   if (last_xact != post.xact) {\n@@ -255,12 +253,7 @@ void anonymize_posts::operator()(post_t& post)\n     std::ostringstream buf;\n     buf << reinterpret_cast<boost::uintmax_t>(post.xact->payee.c_str())\n         << integer_gen() << post.xact->payee.c_str();\n-\n-\t\tsha.reset();\n-    sha.process_bytes(buf.str().c_str(), buf.str().length());\n-    sha.get_digest(message_digest);\n-\n-    xact.payee = to_hex(message_digest);\n+    xact.payee = sha1sum(buf.str(), 8);\n     xact.note  = none;\n   } else {\n     xact.journal = post.xact->journal;\n@@ -273,12 +266,7 @@ void anonymize_posts::operator()(post_t& post)\n        acct = acct->parent) {\n     std::ostringstream buf;\n     buf << integer_gen() << acct << acct->fullname();\n-\n-    sha.reset();\n-    sha.process_bytes(buf.str().c_str(), buf.str().length());\n-    sha.get_digest(message_digest);\n-\n-    account_names.push_front(to_hex(message_digest));\n+    account_names.push_front(sha1sum(buf.str(), 8));\n   }\n \n   account_t * new_account =\n@@ -1269,7 +1257,7 @@ void budget_posts::report_budget_items(const date_t& date)\n     foreach (pending_posts_list::iterator& i, posts_to_erase)\n       pending_posts.erase(i);\n   }\n-  \n+\n   if (pending_posts.size() == 0)\n     return;\n \ndiff --git a/src/utils.h b/src/utils.h\nindex bc05ff4f9..13cf26f63 100644\n--- a/src/utils.h\n+++ b/src/utils.h\n@@ -578,29 +578,39 @@ inline int peek_next_nonws(std::istream& in) {\n     *_p = '\\0';                                         \\\n   }\n \n-inline string to_hex(unsigned int * message_digest, const int len = 1)\n-{\n+inline string digest_to_hex(\n+  const boost::uuids::detail::sha1::digest_type& message_digest,\n+  size_t len = sizeof(boost::uuids::detail::sha1::digest_type) * 2\n+) {\n   std::ostringstream buf;\n-\n-  for(int i = 0; i < 5 ; i++) {\n-    buf.width(8);\n-    buf.fill('0');\n-    buf << std::hex << message_digest[i];\n-    if (i + 1 >= len)\n-      break;                    // only output the first LEN dwords\n+  buf.setf(std::ios_base::hex, std::ios_base::basefield);\n+  buf.fill('0');\n+\n+  // sha1::digest_type is an array type and may change between Boost versions\n+  const size_t count = std::min(\n+    sizeof(message_digest) / sizeof(message_digest[0]),\n+    (len - 1) / (sizeof(message_digest[0]) * 2) + 1\n+  );\n+  for(size_t i = 0; i < count; i++) {\n+    buf.width(sizeof(message_digest[i]) * 2);\n+    buf << (unsigned int)message_digest[i];\n   }\n-  return buf.str();\n+  string hex = buf.str();\n+  hex.resize(len, '0'); // in case a partial element is requested\n+  return hex;\n }\n \n-inline string sha1sum(const string& str)\n-{\n-\tboost::uuids::detail::sha1 sha;\n+inline string sha1sum(\n+  const string& str,\n+  size_t len = sizeof(boost::uuids::detail::sha1::digest_type) * 2\n+) {\n+\tstatic boost::uuids::detail::sha1 sha;\n+  boost::uuids::detail::sha1::digest_type message_digest;\n \n+\tsha.reset();\n   sha.process_bytes(str.c_str(), str.length());\n-\n-  unsigned int message_digest[5];\n   sha.get_digest(message_digest);\n-  return to_hex(message_digest, 5);\n+  return digest_to_hex(message_digest, len);\n }\n \n extern const string version;\n", "instance_id": "ledger__ledger-2381", "clarity": 2, "difficulty": 0.35, "clarity_explanation": "The problem statement is mostly clear in identifying the issue: a build failure with Boost 1.86 due to a type mismatch in the SHA1 digest retrieval process. The error message provided in the statement explicitly points to the problematic code in `src/utils.h` and highlights the incompatibility between the expected and actual types for the `get_digest` method. However, the statement lacks additional context about the broader codebase, the purpose of the SHA1 functionality, or any specific constraints or requirements for the fix (e.g., maintaining compatibility with older Boost versions). There are also no examples or test cases provided to validate the solution. While the issue is clear enough to understand the root cause, these missing details prevent it from being comprehensive, hence a score of 2 (Mostly Clear).", "difficulty_explanation": "The difficulty of this problem falls in the Easy range (0.2-0.4) due to the following factors:\n\n1. **Scope and Depth of Code Changes**: The changes are relatively localized, primarily affecting `src/utils.h` for the SHA1 digest handling and `src/filters.cc` for updating the usage of the modified functions. The diff shows a moderate amount of code change, but it is focused on refactoring the SHA1 digest retrieval and conversion to hexadecimal format. There is no indication of widespread impact on the system's architecture or interactions with other modules beyond the immediate usage in `filters.cc`.\n\n2. **Number of Technical Concepts**: Solving this requires understanding C++ type systems, specifically array type compatibility and casting between `unsigned int` and `unsigned char` arrays. Additionally, familiarity with the Boost library (specifically `boost::uuids::detail::sha1`) and its API changes across versions is necessary. The concepts involved are not overly complex for an experienced C++ developer, though they do require attention to detail regarding type safety and Boost's internal implementation.\n\n3. **Potential Edge Cases and Error Handling**: The problem statement does not explicitly mention edge cases, and the code changes do not introduce significant new error handling logic. However, the solution must ensure that the digest-to-hex conversion handles partial digest lengths correctly (as seen in the updated `digest_to_hex` function). This adds a minor layer of complexity, but it is manageable.\n\n4. **Overall Complexity**: The fix involves updating the function signatures and logic to align with the Boost 1.86 API, which is a straightforward compatibility issue. It requires some understanding of the codebase's use of SHA1 for anonymization (as seen in `filters.cc`), but the changes are not deeply intricate or architecturally significant.\n\nGiven these considerations, a difficulty score of 0.35 reflects an Easy problem that requires understanding specific code logic and making targeted modifications to address a library compatibility issue. It is slightly above the lower end of the Easy range due to the need for familiarity with Boost's SHA1 implementation and careful handling of type conversions.", "clarity_label": -1, "difficulty_label": -1, "human_clarity": -1, "human_difficulty": -1}
{"problem_statement": "desktopCapturer crashing on linux w/XDP when the capture portal is dismissed/closed\n### Preflight Checklist\n\n- [x] I have read the [Contributing Guidelines](https://github.com/electron/electron/blob/main/CONTRIBUTING.md) for this project.\n- [x] I agree to follow the [Code of Conduct](https://github.com/electron/electron/blob/main/CODE_OF_CONDUCT.md) that this project adheres to.\n- [x] I have searched the [issue tracker](https://www.github.com/electron/electron/issues) for a bug report that matches the one I want to file, without success.\n\n### Electron Version\n\n32.0.0, 33.0.0, 34.0.0\n\n### What operating system(s) are you using?\n\nOther Linux\n\n### Operating System Version\n\nLinux bakery 6.12.9-zen1-1-zen #1 ZEN SMP PREEMPT_DYNAMIC Fri, 10 Jan 2025 00:39:35 +0000 x86_64 GNU/Linux\n\n### What arch are you using?\n\nx64\n\n### Last Known Working Electron version\n\n31.3.1 - No crashing but cannot open another portal request. 31.4.0 & later crashes\n\n### Expected Behavior\n\nDoesn't crash & allows following requests\n\n### Actual Behavior\n\nWhen the user closes the portal picker electron will crash.\n\n### Testcase Gist URL\n\nhttps://www.electronjs.org/docs/latest/api/desktop-capturer the example provided is a simple repro\n\n### Additional Information\n\nWhen attempting this from chromium the same errors will be spit out but there is no crash and can make following pick attempts so I believe theyre unrelated. Other than that theres no logs.\n```\n[10356:10356:0114/163419.616405:ERROR:screencast_portal.cc(367)] Failed to start the screen cast session.\n[10356:10356:0114/163419.616432:ERROR:base_capturer_pipewire.cc(81)] ScreenCastPortal failed: 2\n```\n", "patch": "diff --git a/shell/browser/api/electron_api_desktop_capturer.cc b/shell/browser/api/electron_api_desktop_capturer.cc\nindex b7d7177bf47a9..1fcb7fbaa54c7 100644\n--- a/shell/browser/api/electron_api_desktop_capturer.cc\n+++ b/shell/browser/api/electron_api_desktop_capturer.cc\n@@ -15,6 +15,7 @@\n #include \"chrome/browser/media/webrtc/desktop_media_list.h\"\n #include \"chrome/browser/media/webrtc/thumbnail_capturer_mac.h\"\n #include \"chrome/browser/media/webrtc/window_icon_util.h\"\n+#include \"content/public/browser/browser_thread.h\"\n #include \"content/public/browser/desktop_capture.h\"\n #include \"gin/handle.h\"\n #include \"gin/object_template_builder.h\"\n@@ -252,7 +253,8 @@ void DesktopCapturer::DesktopListListener::OnSourceThumbnailChanged(int index) {\n }\n \n void DesktopCapturer::DesktopListListener::OnDelegatedSourceListDismissed() {\n-  std::move(failure_callback_).Run();\n+  content::GetUIThreadTaskRunner({})->PostTask(FROM_HERE,\n+                                               std::move(failure_callback_));\n }\n \n void DesktopCapturer::StartHandling(bool capture_window,\n", "instance_id": "electron__electron-46112", "clarity": 2, "difficulty": 0.65, "clarity_explanation": "The problem statement is mostly clear in describing the issue: the Electron desktop capturer crashes on Linux with XDP when the capture portal is dismissed or closed. It provides relevant context such as the affected Electron versions (32.0.0 to 34.0.0), the operating system (Linux with a specific kernel version), architecture (x64), and the last known working version (31.3.1). The expected behavior (no crash and ability to make subsequent requests) and actual behavior (crash on portal dismissal) are explicitly stated. Additionally, a reference to a test case and some error logs from Chromium are provided, which helps in understanding the issue's scope. However, there are minor ambiguities and missing details. For instance, the problem statement does not specify the exact conditions under which the crash occurs (e.g., specific user actions or configurations beyond closing the portal). Edge cases, such as behavior with different Linux distributions or desktop environments, are not mentioned. Furthermore, there is no detailed explanation of the error logs or their relevance to the crash, which could be critical for debugging. Overall, while the problem is valid and mostly clear, these minor gaps prevent it from being comprehensive.", "difficulty_explanation": "The difficulty of this problem falls into the \"Hard\" category (0.6-0.8) due to several factors. First, the scope of the code change appears limited to a single file (`electron_api_desktop_capturer.cc`), and the diff shows a small modification involving task scheduling on the UI thread using `content::GetUIThreadTaskRunner`. However, the impact of this change is significant as it addresses a crash issue, which likely involves understanding the interaction between Electron's desktop capture functionality and the underlying Linux XDP (X Desktop Portal) system. This requires knowledge of multi-threading and task scheduling in the Chromium codebase, as well as familiarity with Electron's integration of WebRTC-based desktop capture APIs. Second, the technical concepts involved are moderately complex, including browser thread management (`content::BrowserThread`), callback handling, and potentially the PipeWire-based screen capture mechanism on Linux (as hinted by the error logs mentioning `base_capturer_pipewire.cc`). Third, while the problem statement does not explicitly mention edge cases, the nature of the issue (a crash on portal dismissal) implies the need to handle error conditions and ensure robustness in the UI thread task execution, which could involve subtle race conditions or state management issues. Finally, solving this requires a deep understanding of Electron's architecture, particularly how it interfaces with native desktop capture APIs on Linux, which is non-trivial and likely demands experience with both Electron and Chromium internals. The difficulty is not at the highest end (0.8-1.0) because the code change itself is small and localized, but the context and potential for hidden complexities (e.g., ensuring no regressions in other platforms or capture scenarios) push it into the hard range at 0.65.", "clarity_label": -1, "difficulty_label": -1, "human_clarity": -1, "human_difficulty": -1}
{"problem_statement": "`shell.readShortcutLink` crashes when parsing Slack shortcut\n### Preflight Checklist\n\n- [x] I have read the [Contributing Guidelines](https://github.com/electron/electron/blob/main/CONTRIBUTING.md) for this project.\n- [x] I agree to follow the [Code of Conduct](https://github.com/electron/electron/blob/main/CODE_OF_CONDUCT.md) that this project adheres to.\n- [x] I have searched the [issue tracker](https://www.github.com/electron/electron/issues) for a bug report that matches the one I want to file, without success.\n\n### Electron Version\n\n33.3.1\n\n### What operating system(s) are you using?\n\nWindows\n\n### Operating System Version\n\nWindows 11 version 26100\n\n### What arch are you using?\n\nx64\n\n### Last Known Working Electron version\n\n_No response_\n\n### Expected Behavior\n\nShortcut should be parsed/read correctly, and we should be able to handle the error if this fails.\n\n### Actual Behavior\n\nAn exception is thrown:\n\n```\n[1212:0109/171356.871:ERROR:crashpad_client_win.cc(868)] not connected\n```\n\n### Testcase Gist URL\n\nhttps://gist.github.com/dlon/f580673b27ba00d1bedfa25d2f2208c1\n\n### Additional Information\n\nThis seems related to https://github.com/electron/electron/issues/44752, but it affects other shortcuts.\n\nHere is a partial backtrace:\n```\n00 00000072`1e5fc3a0 00007ff7`f38192e9     electron!base::win::ResolveShortcutProperties+0xaaa [C:\\projects\\src\\base\\win\\shortcut.cc @ 345] \n01 00000072`1e5fc6e0 00007ff7`f36ecd16     electron!`anonymous namespace'::ReadShortcutLink+0xd9 [C:\\projects\\src\\electron\\shell\\common\\api\\electron_api_shell.cc @ 154] \n```\n\nI've reproduced the above on v33.3.1, as well as the latest beta.\n", "patch": "diff --git a/patches/chromium/.patches b/patches/chromium/.patches\nindex f6471212332bf..671a98a5b49d5 100644\n--- a/patches/chromium/.patches\n+++ b/patches/chromium/.patches\n@@ -139,3 +139,4 @@ build_disable_thin_lto_mac.patch\n build_add_public_config_simdutf_config.patch\n revert_code_health_clean_up_stale_macwebcontentsocclusion.patch\n build_remove_vr_directx_helpers_dependency.patch\n+ignore_parse_errors_for_pkey_appusermodel_toastactivatorclsid.patch\ndiff --git a/patches/chromium/ignore_parse_errors_for_pkey_appusermodel_toastactivatorclsid.patch b/patches/chromium/ignore_parse_errors_for_pkey_appusermodel_toastactivatorclsid.patch\nnew file mode 100644\nindex 0000000000000..6f97dd9b9ce80\n--- /dev/null\n+++ b/patches/chromium/ignore_parse_errors_for_pkey_appusermodel_toastactivatorclsid.patch\n@@ -0,0 +1,40 @@\n+From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001\n+From: =?UTF-8?q?David=20L=C3=B6nnhager?= <dv.lnh.d@gmail.com>\n+Date: Fri, 17 Jan 2025 14:30:48 +0100\n+Subject: Ignore parse errors for PKEY_AppUserModel_ToastActivatorCLSID\n+\n+Some shortcuts store this as a string UUID as opposed to VT_CLSID,\n+hitting NOTREACHED() and sometimes breaking parsing in Electron.\n+Ignore this error instead.\n+\n+Bug: N/A\n+Change-Id: I9fc472212b2d3afac2c8e18a2159bc2d50bbdf98\n+\n+diff --git a/AUTHORS b/AUTHORS\n+index 55dc38c1448c1960b802c136018c8be22ed61c18..5cd195df3650331fbfd62b2f964368b5f3217f3c 100644\n+--- a/AUTHORS\n++++ b/AUTHORS\n+@@ -337,6 +337,7 @@ David Futcher <david.mike.futcher@gmail.com>\n+ David Jin <davidjin@amazon.com>\n+ David Lechner <david@pybricks.com>\n+ David Leen <davileen@amazon.com>\n++David L\u00f6nnhager <dv.lnh.d@gmail.com>\n+ David Manouchehri <david@davidmanouchehri.com>\n+ David McAllister <mcdavid@amazon.com>\n+ David Michael Barr <david.barr@samsung.com>\n+diff --git a/base/win/shortcut.cc b/base/win/shortcut.cc\n+index e790adb2f1d6529ac0dd77145f5da2796264c7ae..8a7edcfaf9af963468b4b42fe55a771fb31f13a2 100644\n+--- a/base/win/shortcut.cc\n++++ b/base/win/shortcut.cc\n+@@ -342,8 +342,9 @@ bool ResolveShortcutProperties(const FilePath& shortcut_path,\n+               *(pv_toast_activator_clsid.get().puuid));\n+           break;\n+         default:\n+-          NOTREACHED() << \"Unexpected variant type: \"\n+-                       << pv_toast_activator_clsid.get().vt;\n++          // Shortcuts may use strings to represent the CLSID. This case is\n++          // ignored.\n++          break;\n+       }\n+     }\n+   }\ndiff --git a/shell/common/api/electron_api_shell.cc b/shell/common/api/electron_api_shell.cc\nindex a8031264d7cdd..d6097e7efbb84 100644\n--- a/shell/common/api/electron_api_shell.cc\n+++ b/shell/common/api/electron_api_shell.cc\n@@ -163,7 +163,8 @@ v8::Local<v8::Value> ReadShortcutLink(gin_helper::ErrorThrower thrower,\n   options.Set(\"icon\", properties.icon);\n   options.Set(\"iconIndex\", properties.icon_index);\n   options.Set(\"appUserModelId\", properties.app_id);\n-  options.Set(\"toastActivatorClsid\", properties.toast_activator_clsid);\n+  if (properties.options & ShortcutProperties::PROPERTIES_TOAST_ACTIVATOR_CLSID)\n+    options.Set(\"toastActivatorClsid\", properties.toast_activator_clsid);\n   return gin::ConvertToV8(thrower.isolate(), options);\n }\n #endif\n", "instance_id": "electron__electron-45195", "clarity": 2, "difficulty": 0.45, "clarity_explanation": "The problem statement is mostly clear, earning a score of 2 (Mostly Clear). The goal is explicitly stated: to prevent crashes when parsing certain shortcuts (e.g., Slack shortcuts) in Electron on Windows. The expected behavior (parsing shortcuts correctly and handling errors gracefully) and actual behavior (an exception being thrown) are described, along with relevant context such as the Electron version, OS details, and a partial backtrace. A test case gist is provided, which adds to the clarity. However, there are minor ambiguities that prevent a perfect score. For instance, the problem statement does not fully specify the nature of the parsing error or the exact conditions under which it occurs (beyond mentioning Slack shortcuts and referencing a related issue). Additionally, edge cases or specific constraints around shortcut formats are not detailed, which could impact the solution's completeness. Despite these gaps, the statement provides enough information to understand the issue and align with the provided code changes.", "difficulty_explanation": "I assign a difficulty score of 0.45, placing this problem in the Medium range (0.4-0.6). Here's the breakdown based on the evaluation factors:\n\n1. **Scope and Depth of Code Changes**: The changes are relatively focused, affecting two files (`base/win/shortcut.cc` in Chromium and `shell/common/api/electron_api_shell.cc` in Electron) and a patch file. The modifications are not extensive\u2014primarily a small logic change to ignore parsing errors for a specific property (`PKEY_AppUserModel_ToastActivatorCLSID`) and a conditional check before setting a property in Electron's API. The changes do not significantly impact the broader system architecture but require understanding the interaction between Chromium's shortcut parsing logic and Electron's API layer. This cross-module interaction adds a moderate layer of complexity.\n\n2. **Number of Technical Concepts**: Solving this requires familiarity with several concepts, though none are overly advanced. These include Windows-specific shortcut parsing (via Chromium's `base/win/shortcut.cc`), handling COM-related data types (e.g., CLSID and variant types), and Electron's V8 JavaScript bindings for API exposure. Additionally, understanding patch management in a large project like Electron/Chromium is necessary. While these concepts are not trivial, they are within the grasp of a developer with intermediate experience in C++ and Windows development.\n\n3. **Potential Edge Cases and Error Handling**: The problem statement implies edge cases related to shortcut formats (e.g., CLSID stored as a string instead of `VT_CLSID`), and the code change addresses this by ignoring parsing errors for a specific property. However, the statement does not explicitly list other potential edge cases, and the solution does not introduce complex error-handling logic beyond a simple conditional check. This keeps the difficulty from escalating further, though developers must still consider whether ignoring errors could mask other issues.\n\n4. **Overall Complexity**: The problem requires a targeted fix rather than a deep architectural change or complex algorithm. However, it involves navigating a large, multi-layered codebase (Chromium/Electron) and understanding Windows-specific behaviors, which adds moderate difficulty. The need to create and apply a patch to Chromium also introduces a procedural challenge.\n\nIn summary, this problem is of medium difficulty due to the need to understand specific Windows APIs, manage cross-module interactions, and apply patches in a complex codebase, but it does not require advanced algorithmic work or extensive refactoring. A score of 0.45 reflects this balance\u2014slightly above the lower end of the medium range due to the specialized knowledge required for Windows shortcut parsing.", "clarity_label": -1, "difficulty_label": -1, "human_clarity": -1, "human_difficulty": -1}
{"problem_statement": "[Bug]: Desktop capturer thumbnails are generated in a low quality\n### Preflight Checklist\r\n\r\n- [X] I have read the [Contributing Guidelines](https://github.com/electron/electron/blob/main/CONTRIBUTING.md) for this project.\r\n- [X] I agree to follow the [Code of Conduct](https://github.com/electron/electron/blob/main/CODE_OF_CONDUCT.md) that this project adheres to.\r\n- [X] I have searched the [issue tracker](https://www.github.com/electron/electron/issues) for a bug report that matches the one I want to file, without success.\r\n\r\n### Electron Version\r\n\r\n29.1.0\r\n\r\n### What operating system are you using?\r\n\r\nmacOS\r\n\r\n### Operating System Version\r\n\r\nmacOS Sonoma 14.4 (23E214)\r\n\r\n### What arch are you using?\r\n\r\narm64 (including Apple Silicon)\r\n\r\n### Last Known Working Electron version\r\n\r\n29.0.1\r\n\r\n### Expected Behavior\r\n\r\nThumbnails are generated with a good quality. (example from electron 29.0.1)\r\n![image](https://github.com/electron/electron/assets/22202138/42115640-ce22-40d4-b3dc-2586148aac1e)\r\n\r\n\r\n### Actual Behavior\r\n\r\nThumbnails are generated blurry.\r\n![image](https://github.com/electron/electron/assets/22202138/d078749f-a3cd-45cd-ada3-6c990ea658aa)\r\n\r\n\r\n### Testcase Gist URL\r\n\r\nhttps://gist.github.com/7944bd3381db8d1cf6d7a4eca86b073e\r\n\r\n### Additional Information\r\n\r\n_No response_\n", "patch": "diff --git a/patches/chromium/.patches b/patches/chromium/.patches\nindex 801b1fef7f816..6c0178b57567d 100644\n--- a/patches/chromium/.patches\n+++ b/patches/chromium/.patches\n@@ -137,3 +137,4 @@ cherry-pick-1b1f34234346.patch\n bindings_refactor_domdatastore.patch\n merge_fix_domarraybuffer_isdetached_and_comment_out_a_check.patch\n cherry-pick-98bcf9ef5cdd.patch\n+cherry-pick-c1f25647c2fc.patch\ndiff --git a/patches/chromium/cherry-pick-c1f25647c2fc.patch b/patches/chromium/cherry-pick-c1f25647c2fc.patch\nnew file mode 100644\nindex 0000000000000..f52bb35ebc6c5\n--- /dev/null\n+++ b/patches/chromium/cherry-pick-c1f25647c2fc.patch\n@@ -0,0 +1,27 @@\n+From 0000000000000000000000000000000000000000 Mon Sep 17 00:00:00 2001\n+From: Johannes Kron <kron@chromium.org>\n+Date: Tue, 13 Feb 2024 23:22:49 +0000\n+Subject: Update thumbnail size when sources are selected\n+\n+(cherry picked from commit c1f25647c2fcbf5e5a2d574feb284bc7284b944d)\n+\n+Bug: b/40281869\n+Change-Id: I2d5a3954886bc6a5742321aeab415362da19c0ce\n+Reviewed-on: https://chromium-review.googlesource.com/c/chromium/src/+/5285701\n+Commit-Queue: Johannes Kron <kron@chromium.org>\n+Reviewed-by: Elad Alon <eladalon@chromium.org>\n+Cr-Commit-Position: refs/heads/main@{#1260137}\n+\n+diff --git a/chrome/browser/media/webrtc/thumbnail_capturer_mac.mm b/chrome/browser/media/webrtc/thumbnail_capturer_mac.mm\n+index ebe194e9d4a77d74996cb575364a32b61ccfac52..b27f6348d338d8952716b51825586e5d29b75651 100644\n+--- a/chrome/browser/media/webrtc/thumbnail_capturer_mac.mm\n++++ b/chrome/browser/media/webrtc/thumbnail_capturer_mac.mm\n+@@ -365,6 +365,8 @@ void API_AVAILABLE(macos(14.0))\n+     gfx::Size thumbnail_size) {\n+   DCHECK(task_runner_->RunsTasksInCurrentSequence());\n+ \n++  thumbnail_size_ = thumbnail_size;\n++\n+   // The iteration is in reverse order so that the sources\n+   // first in the list are captured first. This way we make sure that the first\n+   // thumbnails in the view are captured first.\n", "instance_id": "electron__electron-42049", "clarity": 2, "difficulty": 0.25, "clarity_explanation": "The problem statement is mostly clear in describing the issue: desktop capturer thumbnails are generated in low quality in Electron version 29.1.0 on macOS Sonoma 14.4 (arm64), compared to the expected good quality in version 29.0.1. It includes visual examples of the expected and actual behavior, which aids in understanding the issue. Additionally, a test case gist URL is provided for reproducibility. However, the statement lacks specific technical details about the root cause of the quality degradation or explicit constraints and requirements for the fix (e.g., acceptable thumbnail resolution or quality metrics). Edge cases, such as different screen resolutions or specific macOS configurations, are not mentioned. While the goal is clear, these missing minor details prevent it from being comprehensive.", "difficulty_explanation": "The difficulty of this problem is rated as easy (0.25) based on the provided factors. The code change is minimal, involving a single patch to update the thumbnail size in a specific file (`thumbnail_capturer_mac.mm`) within the Chromium codebase used by Electron. The modification is localized to a single line update (`thumbnail_size_ = thumbnail_size;`), indicating a straightforward bug fix with no significant impact on the broader system architecture. The scope of understanding required is limited to the specific functionality of thumbnail capturing on macOS, and the technical concepts involved are relatively basic\u2014primarily understanding variable assignment and the context of thumbnail size in the WebRTC module. There are no complex algorithms, design patterns, or domain-specific challenges evident in the change. Additionally, the problem statement and code changes do not highlight specific edge cases or error handling requirements beyond the core issue of thumbnail quality. While familiarity with the Chromium codebase and macOS-specific APIs may be necessary, the overall effort and complexity of the fix are low, aligning with an easy difficulty level.", "clarity_label": -1, "difficulty_label": -1, "human_clarity": -1, "human_difficulty": -1}
{"problem_statement": "Duplicate coinbase transaction space reservation in CreateNewBlock\nIn `BlockAssembler::CreateNewBlock`, we initiate `nBlockWeight` to 4000 WU, reserving space for\r\ncoinbase transaction.\r\n\r\nLatter on, while iterating on transactions for block inclusion in `addPackagesTxs`, we verify that candidate package doesn't overflow the max block weight. This check is done in `TestPackage` against `nBlockMaxWeight`. However, default value is DEFAULT_BLOCK_MAX_WEIGHT which is equal to MAX_BLOCK_WEIGHT - 4000 (L20 in `src/policy/policy.cpp`). So block weight assembled is starting at 4000 WU and can't overflow 3996000 WU.\r\n\r\nDo we have duplicated coinbase transaction space reservation ? I can see this a safety margin to avoid creating invalid blocks if you create inflated coinbase transaction, at the price of few weight units leftover.\r\n\r\nIf so, maybe we should leave it as it is but document this behavior, I was surprised hitting this while scratching unrelated tests.\r\n\r\nSee [comment](https://github.com/bitcoin/bitcoin/pull/11100#discussion_r135124178) in #11100\n", "patch": "diff --git a/doc/release-notes-31384.md b/doc/release-notes-31384.md\nnew file mode 100644\nindex 0000000000000..9256ec16f4621\n--- /dev/null\n+++ b/doc/release-notes-31384.md\n@@ -0,0 +1,34 @@\n+- Node and Mining\n+\n+---\n+\n+- **PR #31384** fixed an issue where block reserved weight for fixed-size block header, transactions count,\n+  and coinbase transaction was done in two separate places.\n+  Before this pull request, the policy default for the maximum block weight was `3,996,000` WU, calculated by\n+  subtracting `4,000 WU` from the `4,000,000 WU` consensus limit to account for the fixed-size block header,\n+  transactions count, and coinbase transaction. During block assembly, Bitcoin Core clamped custom `-blockmaxweight`\n+  value to not be more than the policy default.\n+\n+  Additionally, the mining code added another `4,000 WU` to the initial reservation, reducing the effective block template\n+  size to `3,992,000 WU`.\n+\n+  Due to this issue, the total reserved weight was always `8,000 WU`, meaning that even when specifying a `-blockmaxweight`\n+  higher than the policy default, the actual block size never exceeded `3,992,000 WU`.\n+\n+  The fix consolidates the reservation into a single place and introduces a new startup option,\n+  `-blockreservedweight` (default: `8,000 WU`). This startup option specifies the reserved weight for\n+  the fixed-size block header, transactions count, and coinbase transaction.\n+  The default value of `-blockreservedweight` was chosen to preserve the previous behavior.\n+\n+  **Upgrade Note:** The default `-blockreservedweight` ensures backward compatibility for users who relied on the previous behavior.\n+\n+  Users who manually set `-blockmaxweight` to its maximum value of `4,000,000 WU` should be aware that this\n+  value previously had no effect since it was clamped to `3,996,000 WU`.\n+\n+  Users lowering `-blockreservedweight` should ensure that the total weight (for the block header, transaction count, and coinbase transaction)\n+   does not exceed the reduced value.\n+\n+  As a safety check, Bitcoin core will **fail to start** when `-blockreservedweight` init parameter value is lower than `2000` weight units.\n+\n+  Bitcoin Core will also **fail to start** if the `-blockmaxweight` or `-blockreservedweight` init parameter exceeds\n+  consensus limit of `4,000,000` weight units.\ndiff --git a/src/init.cpp b/src/init.cpp\nindex 1f597cb7cb29e..03c525d5b4983 100644\n--- a/src/init.cpp\n+++ b/src/init.cpp\n@@ -19,6 +19,7 @@\n #include <common/args.h>\n #include <common/system.h>\n #include <consensus/amount.h>\n+#include <consensus/consensus.h>\n #include <deploymentstatus.h>\n #include <hash.h>\n #include <httprpc.h>\n@@ -648,6 +649,7 @@ void SetupServerArgs(ArgsManager& argsman, bool can_listen_ipc)\n \n \n     argsman.AddArg(\"-blockmaxweight=<n>\", strprintf(\"Set maximum BIP141 block weight (default: %d)\", DEFAULT_BLOCK_MAX_WEIGHT), ArgsManager::ALLOW_ANY, OptionsCategory::BLOCK_CREATION);\n+    argsman.AddArg(\"-blockreservedweight=<n>\", strprintf(\"Reserve space for the fixed-size block header plus the largest coinbase transaction the mining software may add to the block. (default: %d).\", DEFAULT_BLOCK_RESERVED_WEIGHT), ArgsManager::ALLOW_ANY, OptionsCategory::BLOCK_CREATION);\n     argsman.AddArg(\"-blockmintxfee=<amt>\", strprintf(\"Set lowest fee rate (in %s/kvB) for transactions to be included in block creation. (default: %s)\", CURRENCY_UNIT, FormatMoney(DEFAULT_BLOCK_MIN_TX_FEE)), ArgsManager::ALLOW_ANY, OptionsCategory::BLOCK_CREATION);\n     argsman.AddArg(\"-blockversion=<n>\", \"Override block version to test forking scenarios\", ArgsManager::ALLOW_ANY | ArgsManager::DEBUG_ONLY, OptionsCategory::BLOCK_CREATION);\n \n@@ -1015,6 +1017,23 @@ bool AppInitParameterInteraction(const ArgsManager& args)\n         }\n     }\n \n+    if (args.IsArgSet(\"-blockmaxweight\")) {\n+        const auto max_block_weight = args.GetIntArg(\"-blockmaxweight\", DEFAULT_BLOCK_MAX_WEIGHT);\n+        if (max_block_weight > MAX_BLOCK_WEIGHT) {\n+            return InitError(strprintf(_(\"Specified -blockmaxweight (%d) exceeds consensus maximum block weight (%d)\"), max_block_weight, MAX_BLOCK_WEIGHT));\n+        }\n+    }\n+\n+    if (args.IsArgSet(\"-blockreservedweight\")) {\n+        const auto block_reserved_weight = args.GetIntArg(\"-blockreservedweight\", DEFAULT_BLOCK_RESERVED_WEIGHT);\n+        if (block_reserved_weight > MAX_BLOCK_WEIGHT) {\n+            return InitError(strprintf(_(\"Specified -blockreservedweight (%d) exceeds consensus maximum block weight (%d)\"), block_reserved_weight, MAX_BLOCK_WEIGHT));\n+        }\n+        if (block_reserved_weight < MINIMUM_BLOCK_RESERVED_WEIGHT) {\n+            return InitError(strprintf(_(\"Specified -blockreservedweight (%d) is lower than minimum safety value of (%d)\"), block_reserved_weight, MINIMUM_BLOCK_RESERVED_WEIGHT));\n+        }\n+    }\n+\n     nBytesPerSigOp = args.GetIntArg(\"-bytespersigop\", nBytesPerSigOp);\n \n     if (!g_wallet_init_interface.ParameterInteraction()) return false;\ndiff --git a/src/ipc/capnp/mining.capnp b/src/ipc/capnp/mining.capnp\nindex 50b07bda708b7..e57d6679e184a 100644\n--- a/src/ipc/capnp/mining.capnp\n+++ b/src/ipc/capnp/mining.capnp\n@@ -35,7 +35,7 @@ interface BlockTemplate $Proxy.wrap(\"interfaces::BlockTemplate\") {\n \n struct BlockCreateOptions $Proxy.wrap(\"node::BlockCreateOptions\") {\n     useMempool @0 :Bool $Proxy.name(\"use_mempool\");\n-    coinbaseMaxAdditionalWeight @1 :UInt64 $Proxy.name(\"coinbase_max_additional_weight\");\n+    blockReservedWeight @1 :UInt64 $Proxy.name(\"block_reserved_weight\");\n     coinbaseOutputMaxAdditionalSigops @2 :UInt64 $Proxy.name(\"coinbase_output_max_additional_sigops\");\n }\n \ndiff --git a/src/node/miner.cpp b/src/node/miner.cpp\nindex 0ff5a1eadead1..b595d91ed97a7 100644\n--- a/src/node/miner.cpp\n+++ b/src/node/miner.cpp\n@@ -67,11 +67,12 @@ void RegenerateCommitments(CBlock& block, ChainstateManager& chainman)\n \n static BlockAssembler::Options ClampOptions(BlockAssembler::Options options)\n {\n-    Assert(options.coinbase_max_additional_weight <= DEFAULT_BLOCK_MAX_WEIGHT);\n+    Assert(options.block_reserved_weight <= MAX_BLOCK_WEIGHT);\n+    Assert(options.block_reserved_weight >= MINIMUM_BLOCK_RESERVED_WEIGHT);\n     Assert(options.coinbase_output_max_additional_sigops <= MAX_BLOCK_SIGOPS_COST);\n-    // Limit weight to between coinbase_max_additional_weight and DEFAULT_BLOCK_MAX_WEIGHT for sanity:\n-    // Coinbase (reserved) outputs can safely exceed -blockmaxweight, but the rest of the block template will be empty.\n-    options.nBlockMaxWeight = std::clamp<size_t>(options.nBlockMaxWeight, options.coinbase_max_additional_weight, DEFAULT_BLOCK_MAX_WEIGHT);\n+    // Limit weight to between block_reserved_weight and MAX_BLOCK_WEIGHT for sanity:\n+    // block_reserved_weight can safely exceed -blockmaxweight, but the rest of the block template will be empty.\n+    options.nBlockMaxWeight = std::clamp<size_t>(options.nBlockMaxWeight, options.block_reserved_weight, MAX_BLOCK_WEIGHT);\n     return options;\n }\n \n@@ -91,14 +92,15 @@ void ApplyArgsManOptions(const ArgsManager& args, BlockAssembler::Options& optio\n         if (const auto parsed{ParseMoney(*blockmintxfee)}) options.blockMinFeeRate = CFeeRate{*parsed};\n     }\n     options.print_modified_fee = args.GetBoolArg(\"-printpriority\", options.print_modified_fee);\n+    options.block_reserved_weight = args.GetIntArg(\"-blockreservedweight\", options.block_reserved_weight);\n }\n \n void BlockAssembler::resetBlock()\n {\n     inBlock.clear();\n \n-    // Reserve space for coinbase tx\n-    nBlockWeight = m_options.coinbase_max_additional_weight;\n+    // Reserve space for fixed-size block header, txs count, and coinbase tx.\n+    nBlockWeight = m_options.block_reserved_weight;\n     nBlockSigOpsCost = m_options.coinbase_output_max_additional_sigops;\n \n     // These counters do not include coinbase tx\n@@ -386,7 +388,7 @@ void BlockAssembler::addPackageTxs(int& nPackagesSelected, int& nDescendantsUpda\n             ++nConsecutiveFailed;\n \n             if (nConsecutiveFailed > MAX_CONSECUTIVE_FAILURES && nBlockWeight >\n-                    m_options.nBlockMaxWeight - m_options.coinbase_max_additional_weight) {\n+                    m_options.nBlockMaxWeight - m_options.block_reserved_weight) {\n                 // Give up if we're close to full and haven't succeeded in a while\n                 break;\n             }\ndiff --git a/src/node/miner.h b/src/node/miner.h\nindex 3c4c66b0badf0..18e19ea158d7c 100644\n--- a/src/node/miner.h\n+++ b/src/node/miner.h\n@@ -176,7 +176,9 @@ class BlockAssembler\n     /** Construct a new block template */\n     std::unique_ptr<CBlockTemplate> CreateNewBlock();\n \n+    /** The number of transactions in the last assembled block (excluding coinbase transaction) */\n     inline static std::optional<int64_t> m_last_block_num_txs{};\n+    /** The weight of the last assembled block (including reserved weight for block header, txs count and coinbase tx) */\n     inline static std::optional<int64_t> m_last_block_weight{};\n \n private:\ndiff --git a/src/node/types.h b/src/node/types.h\nindex 4b0de084ab3d0..290bbc23f1401 100644\n--- a/src/node/types.h\n+++ b/src/node/types.h\n@@ -14,6 +14,7 @@\n #define BITCOIN_NODE_TYPES_H\n \n #include <cstddef>\n+#include <policy/policy.h>\n #include <script/script.h>\n \n namespace node {\n@@ -34,11 +35,10 @@ struct BlockCreateOptions {\n      */\n     bool use_mempool{true};\n     /**\n-     * The maximum additional weight which the pool will add to the coinbase\n-     * scriptSig, witness and outputs. This must include any additional\n-     * weight needed for larger CompactSize encoded lengths.\n+     * The default reserved weight for the fixed-size block header,\n+     * transaction count and coinbase transaction.\n      */\n-    size_t coinbase_max_additional_weight{4000};\n+    size_t block_reserved_weight{DEFAULT_BLOCK_RESERVED_WEIGHT};\n     /**\n      * The maximum additional sigops which the pool will add in coinbase\n      * transaction outputs.\ndiff --git a/src/policy/policy.h b/src/policy/policy.h\nindex 4412f2db87ab1..2151ec13dd04a 100644\n--- a/src/policy/policy.h\n+++ b/src/policy/policy.h\n@@ -20,7 +20,14 @@ class CFeeRate;\n class CScript;\n \n /** Default for -blockmaxweight, which controls the range of block weights the mining code will create **/\n-static constexpr unsigned int DEFAULT_BLOCK_MAX_WEIGHT{MAX_BLOCK_WEIGHT - 4000};\n+static constexpr unsigned int DEFAULT_BLOCK_MAX_WEIGHT{MAX_BLOCK_WEIGHT};\n+/** Default for -blockreservedweight **/\n+static constexpr unsigned int DEFAULT_BLOCK_RESERVED_WEIGHT{8000};\n+/** This accounts for the block header, var_int encoding of the transaction count and a minimally viable\n+ * coinbase transaction. It adds an additional safety margin, because even with a thorough understanding\n+ * of block serialization, it's easy to make a costly mistake when trying to squeeze every last byte.\n+ * Setting a lower value is prevented at startup. */\n+static constexpr unsigned int MINIMUM_BLOCK_RESERVED_WEIGHT{2000};\n /** Default for -blockmintxfee, which sets the minimum feerate for a transaction in blocks created by mining code **/\n static constexpr unsigned int DEFAULT_BLOCK_MIN_TX_FEE{1000};\n /** The maximum weight for transactions we're willing to relay/mine */\ndiff --git a/src/rpc/mining.cpp b/src/rpc/mining.cpp\nindex 5e3d1120e3201..702925785bfc8 100644\n--- a/src/rpc/mining.cpp\n+++ b/src/rpc/mining.cpp\n@@ -419,8 +419,8 @@ static RPCHelpMan getmininginfo()\n                     RPCResult::Type::OBJ, \"\", \"\",\n                     {\n                         {RPCResult::Type::NUM, \"blocks\", \"The current block\"},\n-                        {RPCResult::Type::NUM, \"currentblockweight\", /*optional=*/true, \"The block weight of the last assembled block (only present if a block was ever assembled)\"},\n-                        {RPCResult::Type::NUM, \"currentblocktx\", /*optional=*/true, \"The number of block transactions of the last assembled block (only present if a block was ever assembled)\"},\n+                        {RPCResult::Type::NUM, \"currentblockweight\", /*optional=*/true, \"The block weight (including reserved weight for block header, txs count and coinbase tx) of the last assembled block (only present if a block was ever assembled)\"},\n+                        {RPCResult::Type::NUM, \"currentblocktx\", /*optional=*/true, \"The number of block transactions (excluding coinbase) of the last assembled block (only present if a block was ever assembled)\"},\n                         {RPCResult::Type::STR_HEX, \"bits\", \"The current nBits, compact representation of the block difficulty target\"},\n                         {RPCResult::Type::NUM, \"difficulty\", \"The current difficulty\"},\n                         {RPCResult::Type::STR_HEX, \"target\", \"The current target\"},\n", "instance_id": "bitcoin__bitcoin-31384", "clarity": 2, "difficulty": 0.65, "clarity_explanation": "The problem statement is mostly clear in identifying the issue of duplicate space reservation for the coinbase transaction in the `CreateNewBlock` function of Bitcoin Core's block assembly logic. It explains the discrepancy between the initial reservation of 4000 WU (weight units) and the policy default of `MAX_BLOCK_WEIGHT - 4000`, leading to an effective double reservation. The goal of addressing this duplication, either by fixing it or documenting it, is evident. However, the statement lacks specificity on the desired solution\u2014whether to consolidate the reservation logic or simply document the behavior. Additionally, it does not explicitly mention edge cases or constraints related to block weight limits beyond the general observation of a safety margin. The linked comment provides some context, but critical details about expected behavior under various configurations are missing. Thus, while the problem is valid and mostly clear, minor ambiguities remain, warranting a score of 2 (Mostly Clear).", "difficulty_explanation": "The difficulty of this problem falls into the \"Hard\" category (0.6-0.8) due to several factors. First, the scope of code changes spans multiple files (`init.cpp`, `miner.cpp`, `policy.h`, etc.), requiring modifications to core components of Bitcoin Core's mining and block assembly logic. This involves understanding and altering the interaction between command-line arguments, policy defaults, and runtime block creation, which impacts the system's behavior significantly. Second, the number of technical concepts involved is substantial, including knowledge of Bitcoin's block weight system (BIP141), consensus rules, mining policies, and parameter validation. The changes also introduce a new configuration option (`-blockreservedweight`), necessitating careful handling of backward compatibility and safety checks (e.g., enforcing minimum and maximum weight limits). Third, while the problem statement does not explicitly mention edge cases, the code changes address several, such as ensuring the reserved weight does not fall below a safety threshold (2000 WU) and preventing values exceeding consensus limits, which adds complexity to error handling. Finally, the need to maintain compatibility with existing behavior (via default values) and to document the changes thoroughly in release notes indicates a deep understanding of the codebase and its user base. A score of 0.65 reflects the challenge of navigating these complexities, though it does not reach the \"Very Hard\" range as it does not involve entirely new system-level designs or highly intricate domain-specific algorithms.", "clarity_label": -1, "difficulty_label": -1, "human_clarity": -1, "human_difficulty": -1}
{"problem_statement": "wallet: setting changes are subject to race conditions\n### Is there an existing issue for this?\n\n- [X] I have searched the existing issues\n\n### Current behaviour\n\nCreating two wallets with `load_on_startup=true` simultaneously will result in only one of the wallets being added to the startup file.\n\n### Expected behaviour\n\nBoth wallets should be added.\n\n### Steps to reproduce\n\nI don't have an easy script to reproduce this, but the issue is quite visible in the code:\r\nhttps://github.com/bitcoin/bitcoin/blob/389cf32aca0be6c4b01151c92cc3be79c120f197/src/wallet/wallet.cpp#L94\r\n\r\nThe setting gets read from a backing JSON file, manipulated in memory, and then saved to the file, without any lock being taken out.\r\n\r\nIt's likely possible to demonstrate this with a quick BASH or python script that fires up bitcoind and creates two wallets simultaneously.\n\n### Relevant log output\n\n_No response_\n\n### How did you obtain Bitcoin Core\n\nPre-built binaries\n\n### What version of Bitcoin Core are you using?\n\n27.1\n\n### Operating system and version\n\nMacOS Sonoma 14.6.1\n\n### Machine specifications\n\n_No response_\n", "patch": "diff --git a/src/interfaces/chain.h b/src/interfaces/chain.h\nindex af45f81f95e45..be596b17657cb 100644\n--- a/src/interfaces/chain.h\n+++ b/src/interfaces/chain.h\n@@ -96,6 +96,17 @@ struct BlockInfo {\n     BlockInfo(const uint256& hash LIFETIMEBOUND) : hash(hash) {}\n };\n \n+//! The action to be taken after updating a settings value.\n+//! WRITE indicates that the updated value must be written to disk,\n+//! while SKIP_WRITE indicates that the change will be kept in memory-only\n+//! without persisting it.\n+enum class SettingsAction {\n+    WRITE,\n+    SKIP_WRITE\n+};\n+\n+using SettingsUpdate = std::function<std::optional<interfaces::SettingsAction>(common::SettingsValue&)>;\n+\n //! Interface giving clients (wallet processes, maybe other analysis tools in\n //! the future) ability to access to the chain state, receive notifications,\n //! estimate fees, and submit transactions.\n@@ -344,9 +355,16 @@ class Chain\n     //! Return <datadir>/settings.json setting value.\n     virtual common::SettingsValue getRwSetting(const std::string& name) = 0;\n \n-    //! Write a setting to <datadir>/settings.json. Optionally just update the\n-    //! setting in memory and do not write the file.\n-    virtual bool updateRwSetting(const std::string& name, const common::SettingsValue& value, bool write=true) = 0;\n+    //! Updates a setting in <datadir>/settings.json.\n+    //! Depending on the action returned by the update function, this will either\n+    //! update the setting in memory or write the updated settings to disk.\n+    virtual bool updateRwSetting(const std::string& name, const SettingsUpdate& update_function) = 0;\n+\n+    //! Replace a setting in <datadir>/settings.json with a new value.\n+    virtual bool overwriteRwSetting(const std::string& name, common::SettingsValue& value, bool write = true) = 0;\n+\n+    //! Delete a given setting in <datadir>/settings.json.\n+    virtual bool deleteRwSettings(const std::string& name, bool write = true) = 0;\n \n     //! Synchronously send transactionAddedToMempool notifications about all\n     //! current mempool transactions to the specified handler and return after\ndiff --git a/src/node/interfaces.cpp b/src/node/interfaces.cpp\nindex 9fe08eb3dd3d4..54b986c926afd 100644\n--- a/src/node/interfaces.cpp\n+++ b/src/node/interfaces.cpp\n@@ -814,14 +814,32 @@ class ChainImpl : public Chain\n         });\n         return result;\n     }\n-    bool updateRwSetting(const std::string& name, const common::SettingsValue& value, bool write) override\n+    bool updateRwSetting(const std::string& name,\n+                         const interfaces::SettingsUpdate& update_settings_func) override\n     {\n+        std::optional<interfaces::SettingsAction> action;\n         args().LockSettings([&](common::Settings& settings) {\n-            if (value.isNull()) {\n-                settings.rw_settings.erase(name);\n-            } else {\n-                settings.rw_settings[name] = value;\n-            }\n+            auto* ptr_value = common::FindKey(settings.rw_settings, name);\n+            // Create value if it doesn't exist\n+            auto& value = ptr_value ? *ptr_value : settings.rw_settings[name];\n+            action = update_settings_func(value);\n+        });\n+        if (!action) return false;\n+        // Now dump value to disk if requested\n+        return *action == interfaces::SettingsAction::SKIP_WRITE || args().WriteSettingsFile();\n+    }\n+    bool overwriteRwSetting(const std::string& name, common::SettingsValue& value, bool write) override\n+    {\n+        if (value.isNull()) return deleteRwSettings(name, write);\n+        return updateRwSetting(name, [&](common::SettingsValue& settings) {\n+            settings = std::move(value);\n+            return write ? interfaces::SettingsAction::WRITE : interfaces::SettingsAction::SKIP_WRITE;\n+        });\n+    }\n+    bool deleteRwSettings(const std::string& name, bool write) override\n+    {\n+        args().LockSettings([&](common::Settings& settings) {\n+            settings.rw_settings.erase(name);\n         });\n         return !write || args().WriteSettingsFile();\n     }\ndiff --git a/src/wallet/load.cpp b/src/wallet/load.cpp\nindex e26347d437af3..129b5c7c2a0a7 100644\n--- a/src/wallet/load.cpp\n+++ b/src/wallet/load.cpp\n@@ -69,7 +69,7 @@ bool VerifyWallets(WalletContext& context)\n             // Pass write=false because no need to write file and probably\n             // better not to. If unnamed wallet needs to be added next startup\n             // and the setting is empty, this code will just run again.\n-            chain.updateRwSetting(\"wallet\", wallets, /* write= */ false);\n+            chain.overwriteRwSetting(\"wallet\", wallets, /*write=*/false);\n         }\n     }\n \ndiff --git a/src/wallet/wallet.cpp b/src/wallet/wallet.cpp\nindex 5584b43520aa6..e2d7429f94dbc 100644\n--- a/src/wallet/wallet.cpp\n+++ b/src/wallet/wallet.cpp\n@@ -93,25 +93,30 @@ namespace wallet {\n \n bool AddWalletSetting(interfaces::Chain& chain, const std::string& wallet_name)\n {\n-    common::SettingsValue setting_value = chain.getRwSetting(\"wallet\");\n-    if (!setting_value.isArray()) setting_value.setArray();\n-    for (const common::SettingsValue& value : setting_value.getValues()) {\n-        if (value.isStr() && value.get_str() == wallet_name) return true;\n-    }\n-    setting_value.push_back(wallet_name);\n-    return chain.updateRwSetting(\"wallet\", setting_value);\n+    const auto update_function = [&wallet_name](common::SettingsValue& setting_value) {\n+        if (!setting_value.isArray()) setting_value.setArray();\n+        for (const auto& value : setting_value.getValues()) {\n+            if (value.isStr() && value.get_str() == wallet_name) return interfaces::SettingsAction::SKIP_WRITE;\n+        }\n+        setting_value.push_back(wallet_name);\n+        return interfaces::SettingsAction::WRITE;\n+    };\n+    return chain.updateRwSetting(\"wallet\", update_function);\n }\n \n bool RemoveWalletSetting(interfaces::Chain& chain, const std::string& wallet_name)\n {\n-    common::SettingsValue setting_value = chain.getRwSetting(\"wallet\");\n-    if (!setting_value.isArray()) return true;\n-    common::SettingsValue new_value(common::SettingsValue::VARR);\n-    for (const common::SettingsValue& value : setting_value.getValues()) {\n-        if (!value.isStr() || value.get_str() != wallet_name) new_value.push_back(value);\n-    }\n-    if (new_value.size() == setting_value.size()) return true;\n-    return chain.updateRwSetting(\"wallet\", new_value);\n+    const auto update_function = [&wallet_name](common::SettingsValue& setting_value) {\n+        if (!setting_value.isArray()) return interfaces::SettingsAction::SKIP_WRITE;\n+        common::SettingsValue new_value(common::SettingsValue::VARR);\n+        for (const auto& value : setting_value.getValues()) {\n+            if (!value.isStr() || value.get_str() != wallet_name) new_value.push_back(value);\n+        }\n+        if (new_value.size() == setting_value.size()) return interfaces::SettingsAction::SKIP_WRITE;\n+        setting_value = std::move(new_value);\n+        return interfaces::SettingsAction::WRITE;\n+    };\n+    return chain.updateRwSetting(\"wallet\", update_function);\n }\n \n static void UpdateWalletSetting(interfaces::Chain& chain,\n", "instance_id": "bitcoin__bitcoin-30697", "clarity": 2, "difficulty": 0.65, "clarity_explanation": "The problem statement is mostly clear in identifying the issue: a race condition when creating multiple wallets with `load_on_startup=true`, resulting in only one wallet being added to the startup file. The current and expected behaviors are explicitly stated, and a specific code location is referenced, which helps in understanding the root cause (lack of locking when reading/writing to a JSON settings file). However, there are minor ambiguities and missing details. For instance, the problem statement does not provide a concrete reproduction script (though it suggests one could be created), and it lacks explicit mention of edge cases or specific constraints (e.g., performance requirements or file system behaviors on different operating systems). Additionally, there are no examples of input/output or detailed logs to illustrate the failure. While the issue is understandable, these missing details prevent it from being fully comprehensive.", "difficulty_explanation": "The difficulty of this problem falls into the \"Hard\" category due to several factors. First, the scope of code changes spans multiple files (`chain.h`, `interfaces.cpp`, `load.cpp`, and `wallet.cpp`), requiring modifications to the settings management interface and its usage in the wallet module. This indicates a need to understand interactions between different parts of the Bitcoin Core codebase, particularly how settings are read, updated, and persisted to disk. Second, the technical concepts involved include race condition handling, thread safety (via locking mechanisms), and JSON-based settings management, which are moderately complex and require a solid understanding of C++ concurrency primitives and the Bitcoin Core architecture. Third, the changes introduce a new functional approach to settings updates (`SettingsUpdate` function type) and an enum for controlling write behavior, which adds a layer of abstraction and requires careful integration with existing code. While the amount of code change is not massive, the impact is significant as it touches a critical part of the system (settings persistence) that could affect wallet initialization and overall application stability. Finally, potential edge cases\u2014such as concurrent access to the settings file by multiple processes, file system errors during writes, or handling corrupted JSON data\u2014are not explicitly addressed in the problem statement but are implied by the nature of the issue and must be considered during implementation. This combination of cross-module changes, concurrency concerns, and implicit edge case handling pushes the difficulty to the higher end of the spectrum, though not to the extreme of requiring advanced domain-specific knowledge beyond typical systems programming expertise.", "clarity_label": -1, "difficulty_label": -1, "human_clarity": -1, "human_difficulty": -1}
{"problem_statement": "Ctrl+Insert does not copy the selected text from Command Palette\n# Environment\r\n\r\n```none\r\nWindows build number: 10.0.19042.867\r\nWindows Terminal version (if applicable): 1.6.10571.0\r\n```\r\n\r\n# Steps to reproduce\r\n\r\n1. Delete any saved Windows Terminal settings.\r\n2. Start Windows Terminal.\r\n3. Use the mouse to select some text in the pane.\r\n4. Press Ctrl+Shift+P to open the command palette.\r\n5. Type `abc`.\r\n6. Press Ctrl+A to select the text `abc`.\r\n7. Press Ctrl+Insert.\r\n\r\n# Expected behavior\r\n\r\nThe text `abc` should be copied to the clipboard, and the command palette should remain open.\r\n\r\n# Actual behavior\r\n\r\nThe command palette closes, and the text that you selected in the pane is copied to the clipboard.\r\n\r\n# Notes\r\n\r\nIf you copy by pressing Ctrl+C instead of Ctrl+Insert, then it works as expected.\n", "patch": "diff --git a/src/cascadia/TerminalApp/CommandPalette.cpp b/src/cascadia/TerminalApp/CommandPalette.cpp\nindex 4817cd52424..bcee25c72dd 100644\n--- a/src/cascadia/TerminalApp/CommandPalette.cpp\n+++ b/src/cascadia/TerminalApp/CommandPalette.cpp\n@@ -359,7 +359,7 @@ namespace winrt::TerminalApp::implementation\n             _switchToMode(CommandPaletteMode::CommandlineMode);\n             e.Handled(true);\n         }\n-        else if (key == VirtualKey::C && ctrlDown)\n+        else if ((key == VirtualKey::C || key == VirtualKey::Insert) && ctrlDown)\n         {\n             _searchBox().CopySelectionToClipboard();\n             e.Handled(true);\n", "instance_id": "microsoft__terminal-18483", "clarity": 2, "difficulty": 0.25, "clarity_explanation": "The problem statement is mostly clear and provides a detailed description of the issue, including the environment, steps to reproduce, expected behavior, and actual behavior. It specifies the exact bug (Ctrl+Insert not copying selected text from the Command Palette) and contrasts it with the working behavior of Ctrl+C. However, there are minor ambiguities, such as the lack of explicit mention of potential edge cases (e.g., behavior with no text selected, or interaction with other keyboard shortcuts) and constraints (e.g., whether this should work across different Windows Terminal versions or configurations). Additionally, there are no examples beyond the basic reproduction steps, which could have further clarified the scope of the issue. Overall, the statement is valid and clear but misses some minor details that could make it comprehensive.", "difficulty_explanation": "The difficulty of this problem is relatively low, falling into the \"Easy\" category. The issue is a straightforward bug fix involving a small, localized code change in a single file (CommandPalette.cpp). The modification simply extends an existing condition to handle the Ctrl+Insert key combination in the same way as Ctrl+C, requiring minimal understanding of the broader codebase or architecture\u2014just basic knowledge of event handling and key bindings in C++ with the WinRT framework. The scope of the change is minimal, with no impact on other modules or system architecture, and the amount of code changed is trivial (a single line modification). There are no complex technical concepts involved beyond understanding virtual key codes and clipboard operations, which are standard in GUI application development. While the problem statement does not explicitly mention edge cases, the nature of the fix suggests minimal additional error handling is needed beyond what is already in place for Ctrl+C. Overall, this is a simple bug fix that a developer with basic to intermediate experience in C++ and GUI programming can resolve quickly.", "clarity_label": -1, "difficulty_label": -1, "human_clarity": -1, "human_difficulty": -1}
{"problem_statement": "[WCAG 2.2] [Windows Terminal - Multiple Tab]: No single pointer alternative is provided to move the tabs.\n### Windows Terminal version\n\n1.22.2362.0\n\n### Windows build number\n\n27695.1000\n\n### Other Software\n\n**Test Environment:**\r\nOS: Windows 11 Version Dev (OS Build 27695.1000)\r\nApp: Windows Terminal Preview\n\n### Steps to reproduce\n\n**Repro steps:**\r\n1. Open the 'windows terminal' application.\r\n2. Open Multiple tabs and navigate among the tabs.\r\n3. Now, verify whether any single pointer alternative is provided to move the tabs or not.\r\n5. Observe the issue.\r\n\r\n**User experience:**\r\nUsers who struggle with performing dragging movements will feel difficulty to move tabs, if there is no single pointer alternative is provided to perform the action.\r\n\r\n**WCAG Reference Link:**\r\n[Understanding Success Criterion 2.5.7: Dragging Movements | WAI | W3C](https://www.w3.org/WAI/WCAG22/Understanding/dragging-movements)\r\n\r\n**Attachment:**\r\n[No single pointer alternative is provided to move the tabs.zip](https://github.com/user-attachments/files/16958526/No.single.pointer.alternative.is.provided.to.move.the.tabs.zip)\n\n### Expected Behavior\n\nA single pointer alternative mechanism should be provided to the users to move the tabs.\n\n### Actual Behavior\n\nUser can be able to move the tabs here & there by using mouse, but no alternative method is available for the user to perform action using single pointer.\n", "patch": "diff --git a/src/cascadia/TerminalApp/Resources/en-US/Resources.resw b/src/cascadia/TerminalApp/Resources/en-US/Resources.resw\nindex 26823366401..217f4e88879 100644\n--- a/src/cascadia/TerminalApp/Resources/en-US/Resources.resw\n+++ b/src/cascadia/TerminalApp/Resources/en-US/Resources.resw\n@@ -193,6 +193,9 @@\n   <data name=\"TabCloseSubMenu\" xml:space=\"preserve\">\r\n     <value>Close</value>\r\n   </data>\r\n+  <data name=\"TabMoveSubMenu\" xml:space=\"preserve\">\r\n+    <value>Move tab</value>\r\n+  </data>\r\n   <data name=\"TabCloseAfter\" xml:space=\"preserve\">\r\n     <value>Close tabs to the right</value>\r\n   </data>\r\n@@ -941,4 +944,10 @@\n   <data name=\"CloseSnippetsPaneButton.[using:Windows.UI.Xaml.Controls]ToolTipService.ToolTip\" xml:space=\"preserve\">\r\n     <value>Close pane</value>\r\n   </data>\r\n-</root>\r\n+  <data name=\"TabMoveLeft\" xml:space=\"preserve\">\r\n+    <value>Move left</value>\r\n+  </data>\r\n+  <data name=\"TabMoveRight\" xml:space=\"preserve\">\r\n+    <value>Move right</value>\r\n+  </data>\r\n+</root>\n\\ No newline at end of file\ndiff --git a/src/cascadia/TerminalApp/TabBase.cpp b/src/cascadia/TerminalApp/TabBase.cpp\nindex 2d5e8da4433..0cedab37d0a 100644\n--- a/src/cascadia/TerminalApp/TabBase.cpp\n+++ b/src/cascadia/TerminalApp/TabBase.cpp\n@@ -7,6 +7,7 @@\n #include \"TabBase.g.cpp\"\r\n #include \"Utils.h\"\r\n #include \"ColorHelper.h\"\r\n+#include \"../inc/WindowingBehavior.h\"\r\n \r\n using namespace winrt;\r\n using namespace winrt::Windows::UI::Xaml;\r\n@@ -56,10 +57,72 @@ namespace winrt::TerminalApp::implementation\n                 tab->RequestFocusActiveControl.raise();\r\n             }\r\n         });\r\n+        _AppendMoveMenuItems(contextMenuFlyout);\r\n         _AppendCloseMenuItems(contextMenuFlyout);\r\n         TabViewItem().ContextFlyout(contextMenuFlyout);\r\n     }\r\n \r\n+    void TabBase::_AppendMoveMenuItems(winrt::Windows::UI::Xaml::Controls::MenuFlyout flyout)\r\n+    {\r\n+        auto weakThis{ get_weak() };\r\n+\r\n+        // Move to new window\r\n+        {\r\n+            Controls::FontIcon moveTabToNewWindowTabSymbol;\r\n+            moveTabToNewWindowTabSymbol.FontFamily(Media::FontFamily{ L\"Segoe Fluent Icons, Segoe MDL2 Assets\" });\r\n+            moveTabToNewWindowTabSymbol.Glyph(L\"\\xE8A7\");\r\n+\r\n+            _moveToNewWindowMenuItem.Click([weakThis](auto&&, auto&&) {\r\n+                if (auto tab{ weakThis.get() })\r\n+                {\r\n+                    MoveTabArgs args{ winrt::to_hstring(NewWindow), MoveTabDirection::Forward };\r\n+                    ActionAndArgs actionAndArgs{ ShortcutAction::MoveTab, args };\r\n+                    tab->_dispatch.DoAction(*tab, actionAndArgs);\r\n+                }\r\n+            });\r\n+            _moveToNewWindowMenuItem.Text(RS_(L\"MoveTabToNewWindowText\"));\r\n+            _moveToNewWindowMenuItem.Icon(moveTabToNewWindowTabSymbol);\r\n+\r\n+            const auto moveTabToNewWindowToolTip = RS_(L\"MoveTabToNewWindowToolTip\");\r\n+            WUX::Controls::ToolTipService::SetToolTip(_moveToNewWindowMenuItem, box_value(moveTabToNewWindowToolTip));\r\n+            Automation::AutomationProperties::SetHelpText(_moveToNewWindowMenuItem, moveTabToNewWindowToolTip);\r\n+        }\r\n+\r\n+        // Move left\r\n+        {\r\n+            _moveLeftMenuItem.Click([weakThis](auto&&, auto&&) {\r\n+                if (auto tab{ weakThis.get() })\r\n+                {\r\n+                    MoveTabArgs args{ hstring{}, MoveTabDirection::Backward };\r\n+                    ActionAndArgs actionAndArgs{ ShortcutAction::MoveTab, args };\r\n+                    tab->_dispatch.DoAction(*tab, actionAndArgs);\r\n+                }\r\n+            });\r\n+            _moveLeftMenuItem.Text(RS_(L\"TabMoveLeft\"));\r\n+        }\r\n+\r\n+        // Move right\r\n+        {\r\n+            _moveRightMenuItem.Click([weakThis](auto&&, auto&&) {\r\n+                if (auto tab{ weakThis.get() })\r\n+                {\r\n+                    MoveTabArgs args{ hstring{}, MoveTabDirection::Forward };\r\n+                    ActionAndArgs actionAndArgs{ ShortcutAction::MoveTab, args };\r\n+                    tab->_dispatch.DoAction(*tab, actionAndArgs);\r\n+                }\r\n+            });\r\n+            _moveRightMenuItem.Text(RS_(L\"TabMoveRight\"));\r\n+        }\r\n+\r\n+        // Create a sub-menu for our extended move tab items.\r\n+        Controls::MenuFlyoutSubItem moveSubMenu;\r\n+        moveSubMenu.Text(RS_(L\"TabMoveSubMenu\"));\r\n+        moveSubMenu.Items().Append(_moveToNewWindowMenuItem);\r\n+        moveSubMenu.Items().Append(_moveRightMenuItem);\r\n+        moveSubMenu.Items().Append(_moveLeftMenuItem);\r\n+        flyout.Items().Append(moveSubMenu);\r\n+    }\r\n+\r\n     // Method Description:\r\n     // - Append the close menu items to the context menu flyout\r\n     // Arguments:\r\n@@ -75,7 +138,9 @@ namespace winrt::TerminalApp::implementation\n         _closeTabsAfterMenuItem.Click([weakThis](auto&&, auto&&) {\r\n             if (auto tab{ weakThis.get() })\r\n             {\r\n-                tab->_CloseTabsAfter();\r\n+                CloseTabsAfterArgs args{ tab->_TabViewIndex };\r\n+                ActionAndArgs closeTabsAfter{ ShortcutAction::CloseTabsAfter, args };\r\n+                tab->_dispatch.DoAction(*tab, closeTabsAfter);\r\n             }\r\n         });\r\n         _closeTabsAfterMenuItem.Text(RS_(L\"TabCloseAfter\"));\r\n@@ -88,7 +153,9 @@ namespace winrt::TerminalApp::implementation\n         _closeOtherTabsMenuItem.Click([weakThis](auto&&, auto&&) {\r\n             if (auto tab{ weakThis.get() })\r\n             {\r\n-                tab->_CloseOtherTabs();\r\n+                CloseOtherTabsArgs args{ tab->_TabViewIndex };\r\n+                ActionAndArgs closeOtherTabs{ ShortcutAction::CloseOtherTabs, args };\r\n+                tab->_dispatch.DoAction(*tab, closeOtherTabs);\r\n             }\r\n         });\r\n         _closeOtherTabsMenuItem.Text(RS_(L\"TabCloseOther\"));\r\n@@ -129,33 +196,27 @@ namespace winrt::TerminalApp::implementation\n     }\r\n \r\n     // Method Description:\r\n-    // - Enable the Close menu items based on tab index and total number of tabs\r\n+    // - Enable menu items based on tab index and total number of tabs\r\n     // Arguments:\r\n     // - <none>\r\n     // Return Value:\r\n     // - <none>\r\n-    void TabBase::_EnableCloseMenuItems()\r\n+    void TabBase::_EnableMenuItems()\r\n     {\r\n-        // close other tabs is enabled only if there are other tabs\r\n-        _closeOtherTabsMenuItem.IsEnabled(TabViewNumTabs() > 1);\r\n-        // close tabs after is enabled only if there are other tabs on the right\r\n-        _closeTabsAfterMenuItem.IsEnabled(TabViewIndex() < TabViewNumTabs() - 1);\r\n-    }\r\n+        const auto tabIndex = TabViewIndex();\r\n+        const auto numOfTabs = TabViewNumTabs();\r\n \r\n-    void TabBase::_CloseTabsAfter()\r\n-    {\r\n-        CloseTabsAfterArgs args{ _TabViewIndex };\r\n-        ActionAndArgs closeTabsAfter{ ShortcutAction::CloseTabsAfter, args };\r\n+        // enabled if there are other tabs\r\n+        _closeOtherTabsMenuItem.IsEnabled(numOfTabs > 1);\r\n \r\n-        _dispatch.DoAction(closeTabsAfter);\r\n-    }\r\n+        // enabled if there are other tabs on the right\r\n+        _closeTabsAfterMenuItem.IsEnabled(tabIndex < numOfTabs - 1);\r\n \r\n-    void TabBase::_CloseOtherTabs()\r\n-    {\r\n-        CloseOtherTabsArgs args{ _TabViewIndex };\r\n-        ActionAndArgs closeOtherTabs{ ShortcutAction::CloseOtherTabs, args };\r\n+        // enabled if not left-most tab\r\n+        _moveLeftMenuItem.IsEnabled(tabIndex > 0);\r\n \r\n-        _dispatch.DoAction(closeOtherTabs);\r\n+        // enabled if not last tab\r\n+        _moveRightMenuItem.IsEnabled(tabIndex < numOfTabs - 1);\r\n     }\r\n \r\n     void TabBase::UpdateTabViewIndex(const uint32_t idx, const uint32_t numTabs)\r\n@@ -164,7 +225,7 @@ namespace winrt::TerminalApp::implementation\n \r\n         TabViewIndex(idx);\r\n         TabViewNumTabs(numTabs);\r\n-        _EnableCloseMenuItems();\r\n+        _EnableMenuItems();\r\n         _UpdateSwitchToTabKeyChord();\r\n     }\r\n \r\ndiff --git a/src/cascadia/TerminalApp/TabBase.h b/src/cascadia/TerminalApp/TabBase.h\nindex 9a538550b8d..aa4928c669b 100644\n--- a/src/cascadia/TerminalApp/TabBase.h\n+++ b/src/cascadia/TerminalApp/TabBase.h\n@@ -54,6 +54,9 @@ namespace winrt::TerminalApp::implementation\n         winrt::Windows::UI::Xaml::FocusState _focusState{ winrt::Windows::UI::Xaml::FocusState::Unfocused };\r\n         winrt::Windows::UI::Xaml::Controls::MenuFlyoutItem _closeOtherTabsMenuItem{};\r\n         winrt::Windows::UI::Xaml::Controls::MenuFlyoutItem _closeTabsAfterMenuItem{};\r\n+        winrt::Windows::UI::Xaml::Controls::MenuFlyoutItem _moveToNewWindowMenuItem{};\r\n+        winrt::Windows::UI::Xaml::Controls::MenuFlyoutItem _moveRightMenuItem{};\r\n+        winrt::Windows::UI::Xaml::Controls::MenuFlyoutItem _moveLeftMenuItem{};\r\n         winrt::TerminalApp::ShortcutActionDispatch _dispatch;\r\n         Microsoft::Terminal::Settings::Model::IActionMapView _actionMap{ nullptr };\r\n         winrt::hstring _keyChord{};\r\n@@ -69,10 +72,9 @@ namespace winrt::TerminalApp::implementation\n \r\n         virtual void _MakeTabViewItem();\r\n \r\n+        void _AppendMoveMenuItems(winrt::Windows::UI::Xaml::Controls::MenuFlyout flyout);\r\n         winrt::Windows::UI::Xaml::Controls::MenuFlyoutSubItem _AppendCloseMenuItems(winrt::Windows::UI::Xaml::Controls::MenuFlyout flyout);\r\n-        void _EnableCloseMenuItems();\r\n-        void _CloseTabsAfter();\r\n-        void _CloseOtherTabs();\r\n+        void _EnableMenuItems();\r\n         void _UpdateSwitchToTabKeyChord();\r\n         void _UpdateToolTip();\r\n \r\ndiff --git a/src/cascadia/TerminalApp/TerminalTab.cpp b/src/cascadia/TerminalApp/TerminalTab.cpp\nindex 0a01e83d13e..e81e452708e 100644\n--- a/src/cascadia/TerminalApp/TerminalTab.cpp\n+++ b/src/cascadia/TerminalApp/TerminalTab.cpp\n@@ -10,7 +10,6 @@\n #include \"Utils.h\"\r\n #include \"ColorHelper.h\"\r\n #include \"AppLogic.h\"\r\n-#include \"../inc/WindowingBehavior.h\"\r\n \r\n using namespace winrt;\r\n using namespace winrt::Windows::UI::Xaml;\r\n@@ -1443,23 +1442,6 @@ namespace winrt::TerminalApp::implementation\n             Automation::AutomationProperties::SetHelpText(splitTabMenuItem, splitTabToolTip);\r\n         }\r\n \r\n-        Controls::MenuFlyoutItem moveTabToNewWindowMenuItem;\r\n-        {\r\n-            // \"Move tab to new window\"\r\n-            Controls::FontIcon moveTabToNewWindowTabSymbol;\r\n-            moveTabToNewWindowTabSymbol.FontFamily(Media::FontFamily{ L\"Segoe Fluent Icons, Segoe MDL2 Assets\" });\r\n-            moveTabToNewWindowTabSymbol.Glyph(L\"\\xE8A7\");\r\n-\r\n-            moveTabToNewWindowMenuItem.Click({ get_weak(), &TerminalTab::_moveTabToNewWindowClicked });\r\n-            moveTabToNewWindowMenuItem.Text(RS_(L\"MoveTabToNewWindowText\"));\r\n-            moveTabToNewWindowMenuItem.Icon(moveTabToNewWindowTabSymbol);\r\n-\r\n-            const auto moveTabToNewWindowToolTip = RS_(L\"MoveTabToNewWindowToolTip\");\r\n-\r\n-            WUX::Controls::ToolTipService::SetToolTip(moveTabToNewWindowMenuItem, box_value(moveTabToNewWindowToolTip));\r\n-            Automation::AutomationProperties::SetHelpText(moveTabToNewWindowMenuItem, moveTabToNewWindowToolTip);\r\n-        }\r\n-\r\n         Controls::MenuFlyoutItem closePaneMenuItem = _closePaneMenuItem;\r\n         {\r\n             // \"Close pane\"\r\n@@ -1535,12 +1517,15 @@ namespace winrt::TerminalApp::implementation\n         contextMenuFlyout.Items().Append(renameTabMenuItem);\r\n         contextMenuFlyout.Items().Append(duplicateTabMenuItem);\r\n         contextMenuFlyout.Items().Append(splitTabMenuItem);\r\n-        contextMenuFlyout.Items().Append(moveTabToNewWindowMenuItem);\r\n+        _AppendMoveMenuItems(contextMenuFlyout);\r\n         contextMenuFlyout.Items().Append(exportTabMenuItem);\r\n         contextMenuFlyout.Items().Append(findMenuItem);\r\n         contextMenuFlyout.Items().Append(restartConnectionMenuItem);\r\n         contextMenuFlyout.Items().Append(menuSeparator);\r\n \r\n+        auto closeSubMenu = _AppendCloseMenuItems(contextMenuFlyout);\r\n+        closeSubMenu.Items().Append(closePaneMenuItem);\r\n+\r\n         // GH#5750 - When the context menu is dismissed with ESC, toss the focus\r\n         // back to our control.\r\n         contextMenuFlyout.Closed([weakThis](auto&&, auto&&) {\r\n@@ -1560,8 +1545,6 @@ namespace winrt::TerminalApp::implementation\n                 }\r\n             }\r\n         });\r\n-        auto closeSubMenu = _AppendCloseMenuItems(contextMenuFlyout);\r\n-        closeSubMenu.Items().Append(closePaneMenuItem);\r\n \r\n         TabViewItem().ContextFlyout(contextMenuFlyout);\r\n     }\r\n@@ -2001,13 +1984,6 @@ namespace winrt::TerminalApp::implementation\n         actionAndArgs.Action(ShortcutAction::ExportBuffer);\r\n         _dispatch.DoAction(*this, actionAndArgs);\r\n     }\r\n-    void TerminalTab::_moveTabToNewWindowClicked(const winrt::Windows::Foundation::IInspectable& /* sender */,\r\n-                                                 const winrt::Windows::UI::Xaml::RoutedEventArgs& /* args */)\r\n-    {\r\n-        MoveTabArgs args{ winrt::to_hstring(NewWindow), MoveTabDirection::Forward };\r\n-        ActionAndArgs actionAndArgs{ ShortcutAction::MoveTab, args };\r\n-        _dispatch.DoAction(*this, actionAndArgs);\r\n-    }\r\n     void TerminalTab::_findClicked(const winrt::Windows::Foundation::IInspectable& /* sender */,\r\n                                    const winrt::Windows::UI::Xaml::RoutedEventArgs& /* args */)\r\n     {\r\ndiff --git a/src/cascadia/TerminalApp/TerminalTab.h b/src/cascadia/TerminalApp/TerminalTab.h\nindex f38895a3da6..5a2f67b295d 100644\n--- a/src/cascadia/TerminalApp/TerminalTab.h\n+++ b/src/cascadia/TerminalApp/TerminalTab.h\n@@ -196,7 +196,6 @@ namespace winrt::TerminalApp::implementation\n         void _splitTabClicked(const winrt::Windows::Foundation::IInspectable& sender, const winrt::Windows::UI::Xaml::RoutedEventArgs& e);\r\n         void _closePaneClicked(const winrt::Windows::Foundation::IInspectable& sender, const winrt::Windows::UI::Xaml::RoutedEventArgs& e);\r\n         void _exportTextClicked(const winrt::Windows::Foundation::IInspectable& sender, const winrt::Windows::UI::Xaml::RoutedEventArgs& e);\r\n-        void _moveTabToNewWindowClicked(const winrt::Windows::Foundation::IInspectable& sender, const winrt::Windows::UI::Xaml::RoutedEventArgs& e);\r\n         void _findClicked(const winrt::Windows::Foundation::IInspectable& sender, const winrt::Windows::UI::Xaml::RoutedEventArgs& e);\r\n \r\n         void _bubbleRestartTerminalRequested(TerminalApp::TerminalPaneContent sender, const winrt::Windows::Foundation::IInspectable& args);\r\n", "instance_id": "microsoft__terminal-18107", "clarity": 2, "difficulty": 0.45, "clarity_explanation": "The problem statement is mostly clear in describing the issue: the lack of a single pointer alternative for moving tabs in Windows Terminal, which is a violation of WCAG 2.2 accessibility guidelines. It provides context about the user experience issue, references the relevant WCAG criterion, and includes steps to reproduce the problem. The expected behavior (providing a single pointer alternative) and actual behavior (only mouse dragging is available) are explicitly stated. However, there are minor ambiguities and missing details. For instance, the problem statement does not specify what kind of single pointer alternative is expected (e.g., keyboard shortcuts, context menu options) or provide examples of acceptable solutions. Additionally, edge cases or specific constraints (e.g., behavior with a single tab or maximum tabs) are not mentioned. While the intent is clear, these missing details prevent it from being fully comprehensive.", "difficulty_explanation": "The difficulty of this problem falls into the medium range due to several factors. First, the scope of code changes involves multiple files (TabBase.cpp, TerminalTab.cpp, TerminalTab.h, TabBase.h, and resource files), indicating a need to understand and modify interactions across different parts of the codebase. The changes primarily focus on adding context menu items for moving tabs (left, right, and to a new window) as an accessibility feature, which requires understanding the existing UI framework (WinRT/XAML) and event handling mechanisms. The technical concepts involved include familiarity with Windows UI programming, context menu creation, and action dispatching in the Windows Terminal architecture, which are moderately complex for someone unfamiliar with the codebase or WinRT. The amount of code change is moderate, with new menu items and associated logic being added, but it does not appear to impact the broader system architecture significantly. Edge cases, such as disabling menu items based on tab position (first or last tab), are handled in the code changes, but the problem statement does not explicitly call out complex error handling or performance considerations. Overall, this task requires a solid understanding of the codebase and UI programming concepts but does not reach the level of hard or very hard due to the localized nature of the changes and the absence of deep architectural or algorithmic complexity.", "clarity_label": -1, "difficulty_label": -1, "human_clarity": -1, "human_difficulty": -1}
