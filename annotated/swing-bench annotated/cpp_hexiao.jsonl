{"problem_statement": "gltfpack: Keep `EXT_mesh_gpu_instancing`\n### Discussed in https://github.com/zeux/meshoptimizer/discussions/680\r\n\r\n<div type='discussions-op-text'>\r\n\r\n<sup>Originally posted by **BoyBaykiller** April 22, 2024</sup>\r\nI am running `gltfpack -v -mi -noq -tc -i .\\SimpleInstancing.gltf -o .\\Compressed\\Output.gltf` over [this](https://github.com/KhronosGroup/glTF-Sample-Models/tree/main/2.0/SimpleInstancing/glTF) gltf model.\r\nIt uses the EXT_mesh_gpu_instancing extension to define a bunch of instanced cubes. I can render it correctly as it, but after running it through the command the EXT_mesh_gpu_instancing extension is removed, resulting in only a single cube being rendered.</div>\n", "patch": "diff --git a/extern/cgltf.h b/extern/cgltf.h\nindex 17dc0ca5d..ac392aba4 100644\n--- a/extern/cgltf.h\n+++ b/extern/cgltf.h\n@@ -1697,7 +1697,20 @@ cgltf_result cgltf_validate(cgltf_data* data)\n \t{\n \t\tif (data->nodes[i].weights && data->nodes[i].mesh)\n \t\t{\n-\t\t\tCGLTF_ASSERT_IF (data->nodes[i].mesh->primitives_count && data->nodes[i].mesh->primitives[0].targets_count != data->nodes[i].weights_count, cgltf_result_invalid_gltf);\n+\t\t\tCGLTF_ASSERT_IF(data->nodes[i].mesh->primitives_count && data->nodes[i].mesh->primitives[0].targets_count != data->nodes[i].weights_count, cgltf_result_invalid_gltf);\n+\t\t}\n+\n+\t\tif (data->nodes[i].has_mesh_gpu_instancing)\n+\t\t{\n+\t\t\tCGLTF_ASSERT_IF(data->nodes[i].mesh == NULL, cgltf_result_invalid_gltf);\n+\t\t\tCGLTF_ASSERT_IF(data->nodes[i].mesh_gpu_instancing.attributes_count == 0, cgltf_result_invalid_gltf);\n+\n+\t\t\tcgltf_accessor* first = data->nodes[i].mesh_gpu_instancing.attributes[0].data;\n+\n+\t\t\tfor (cgltf_size k = 0; k < data->nodes[i].mesh_gpu_instancing.attributes_count; ++k)\n+\t\t\t{\n+\t\t\t\tCGLTF_ASSERT_IF(data->nodes[i].mesh_gpu_instancing.attributes[k].data->count != first->count, cgltf_result_invalid_gltf);\n+\t\t\t}\n \t\t}\n \t}\n \ndiff --git a/gltf/README.md b/gltf/README.md\nindex a6be16405..ffe6d1e12 100644\n--- a/gltf/README.md\n+++ b/gltf/README.md\n@@ -83,6 +83,7 @@ gltfpack supports most Khronos extensions and some multi-vendor extensions in th\n - KHR_mesh_quantization\n - KHR_texture_basisu\n - KHR_texture_transform\n+- EXT_mesh_gpu_instancing\n - EXT_meshopt_compression\n \n Even if the source file does not use extensions, gltfpack may use some extensions in the output file either by default or when certain options are used:\ndiff --git a/gltf/gltfpack.cpp b/gltf/gltfpack.cpp\nindex 2db6eff77..dee7a930a 100644\n--- a/gltf/gltfpack.cpp\n+++ b/gltf/gltfpack.cpp\n@@ -281,7 +281,10 @@ static void process(cgltf_data* data, const char* input_path, const char* output\n \tfor (size_t i = 0; i < meshes.size(); ++i)\n \t{\n \t\tMesh& mesh = meshes[i];\n-\t\tassert(mesh.instances.empty());\n+\n+\t\t// mesh is already instanced, skip\n+\t\tif (!mesh.instances.empty())\n+\t\t\tcontinue;\n \n \t\t// mesh is already world space, skip\n \t\tif (mesh.nodes.empty())\n@@ -664,9 +667,6 @@ static void process(cgltf_data* data, const char* input_path, const char* output\n \n \t\tappend(json_meshes, \"}\");\n \n-\t\tassert(mesh.nodes.empty() || mesh.instances.empty());\n-\t\text_instancing = ext_instancing || !mesh.instances.empty();\n-\n \t\tif (mesh.nodes.size())\n \t\t{\n \t\t\tfor (size_t j = 0; j < mesh.nodes.size(); ++j)\n@@ -691,7 +691,8 @@ static void process(cgltf_data* data, const char* input_path, const char* output\n \t\t\t\t}\n \t\t\t}\n \t\t}\n-\t\telse if (mesh.instances.size())\n+\n+\t\tif (mesh.instances.size())\n \t\t{\n \t\t\tassert(mesh.scene >= 0);\n \t\t\tcomma(json_roots[mesh.scene]);\n@@ -704,7 +705,8 @@ static void process(cgltf_data* data, const char* input_path, const char* output\n \n \t\t\tnode_offset++;\n \t\t}\n-\t\telse\n+\n+\t\tif (mesh.nodes.empty() && mesh.instances.empty())\n \t\t{\n \t\t\tassert(mesh.scene >= 0);\n \t\t\tcomma(json_roots[mesh.scene]);\n@@ -716,6 +718,7 @@ static void process(cgltf_data* data, const char* input_path, const char* output\n \t\t}\n \n \t\tmesh_offset++;\n+\t\text_instancing = ext_instancing || !mesh.instances.empty();\n \n \t\t// skip all meshes that we've written in this iteration\n \t\tassert(pi > i);\ndiff --git a/gltf/parsegltf.cpp b/gltf/parsegltf.cpp\nindex 91f0c020f..f83356b70 100644\n--- a/gltf/parsegltf.cpp\n+++ b/gltf/parsegltf.cpp\n@@ -275,6 +275,54 @@ static void parseMeshesGltf(cgltf_data* data, std::vector<Mesh>& meshes, std::ve\n \t}\n }\n \n+static void parseMeshInstancesGltf(std::vector<Transform>& instances, cgltf_node* node)\n+{\n+\tcgltf_accessor* translation = NULL;\n+\tcgltf_accessor* rotation = NULL;\n+\tcgltf_accessor* scale = NULL;\n+\n+\tfor (size_t i = 0; i < node->mesh_gpu_instancing.attributes_count; ++i)\n+\t{\n+\t\tcgltf_attribute& attr = node->mesh_gpu_instancing.attributes[i];\n+\n+\t\tif (strcmp(attr.name, \"TRANSLATION\") == 0 && attr.data->type == cgltf_type_vec3)\n+\t\t\ttranslation = attr.data;\n+\t\telse if (strcmp(attr.name, \"ROTATION\") == 0 && attr.data->type == cgltf_type_vec4)\n+\t\t\trotation = attr.data;\n+\t\telse if (strcmp(attr.name, \"SCALE\") == 0 && attr.data->type == cgltf_type_vec3)\n+\t\t\tscale = attr.data;\n+\t}\n+\n+\tsize_t count = node->mesh_gpu_instancing.attributes[0].data->count;\n+\n+\tinstances.reserve(instances.size() + count);\n+\n+\tcgltf_node instance = {};\n+\tinstance.parent = node;\n+\tinstance.has_translation = translation != NULL;\n+\tinstance.has_rotation = rotation != NULL;\n+\tinstance.has_scale = scale != NULL;\n+\tinstance.rotation[3] = 1.f;\n+\tinstance.scale[0] = 1.f;\n+\tinstance.scale[1] = 1.f;\n+\tinstance.scale[2] = 1.f;\n+\n+\tfor (size_t i = 0; i < count; ++i)\n+\t{\n+\t\tif (translation)\n+\t\t\tcgltf_accessor_read_float(translation, i, instance.translation, sizeof(float));\n+\t\tif (rotation)\n+\t\t\tcgltf_accessor_read_float(rotation, i, instance.rotation, sizeof(float));\n+\t\tif (scale)\n+\t\t\tcgltf_accessor_read_float(scale, i, instance.scale, sizeof(float));\n+\n+\t\tTransform xf;\n+\t\tcgltf_node_transform_world(&instance, xf.data);\n+\n+\t\tinstances.push_back(xf);\n+\t}\n+}\n+\n static void parseMeshNodesGltf(cgltf_data* data, std::vector<Mesh>& meshes, const std::vector<std::pair<size_t, size_t> >& mesh_remap)\n {\n \tfor (size_t i = 0; i < data->nodes_count; ++i)\n@@ -289,7 +337,7 @@ static void parseMeshNodesGltf(cgltf_data* data, std::vector<Mesh>& meshes, cons\n \t\t{\n \t\t\tMesh* mesh = &meshes[mi];\n \n-\t\t\tif (!mesh->nodes.empty() && mesh->skin != node.skin)\n+\t\t\tif (mesh->skin != node.skin && (!mesh->nodes.empty() || !mesh->instances.empty()))\n \t\t\t{\n \t\t\t\t// this should be extremely rare - if the same mesh is used with different skins, we need to duplicate it\n \t\t\t\t// in this case we don't spend any effort on keeping the number of duplicates to the minimum, because this\n@@ -298,8 +346,16 @@ static void parseMeshNodesGltf(cgltf_data* data, std::vector<Mesh>& meshes, cons\n \t\t\t\tmesh = &meshes.back();\n \t\t\t}\n \n-\t\t\tmesh->nodes.push_back(&node);\n-\t\t\tmesh->skin = node.skin;\n+\t\t\tif (node.has_mesh_gpu_instancing)\n+\t\t\t{\n+\t\t\t\tmesh->scene = 0; // we need to assign scene index since instances are attached to a scene; for now we assume 0\n+\t\t\t\tparseMeshInstancesGltf(mesh->instances, &node);\n+\t\t\t}\n+\t\t\telse\n+\t\t\t{\n+\t\t\t\tmesh->skin = node.skin;\n+\t\t\t\tmesh->nodes.push_back(&node);\n+\t\t\t}\n \t\t}\n \t}\n \n@@ -308,7 +364,7 @@ static void parseMeshNodesGltf(cgltf_data* data, std::vector<Mesh>& meshes, cons\n \t\tMesh& mesh = meshes[i];\n \n \t\t// because the rest of gltfpack assumes that empty nodes array = world-space mesh, we need to filter unused meshes\n-\t\tif (mesh.nodes.empty())\n+\t\tif (mesh.nodes.empty() && mesh.instances.empty())\n \t\t{\n \t\t\tmesh.streams.clear();\n \t\t\tmesh.indices.clear();\n@@ -530,8 +586,6 @@ static cgltf_data* parseGltf(cgltf_data* data, cgltf_result result, std::vector<\n \t\t*error = getError(result, data);\n \telse if (requiresExtension(data, \"KHR_draco_mesh_compression\"))\n \t\t*error = \"file requires Draco mesh compression support\";\n-\telse if (requiresExtension(data, \"EXT_mesh_gpu_instancing\"))\n-\t\t*error = \"file requires mesh instancing support\";\n \telse if (needsDummyBuffers(data))\n \t\t*error = \"buffer has no data\";\n \n@@ -543,6 +597,8 @@ static cgltf_data* parseGltf(cgltf_data* data, cgltf_result result, std::vector<\n \n \tif (requiresExtension(data, \"KHR_mesh_quantization\"))\n \t\tfprintf(stderr, \"Warning: file uses quantized geometry; repacking may result in increased quantization error\\n\");\n+\tif (requiresExtension(data, \"EXT_mesh_gpu_instancing\") && data->scenes_count > 1)\n+\t\tfprintf(stderr, \"Warning: file uses instancing and has more than one scene; results may be incorrect\\n\");\n \n \tstd::vector<std::pair<size_t, size_t> > mesh_remap;\n \n", "instance_id": "zeux__meshoptimizer-696", "clarity": 2, "difficulty": 0.55, "clarity_explanation": "The problem statement is mostly clear in identifying the issue: the `gltfpack` tool removes the `EXT_mesh_gpu_instancing` extension when processing a glTF model, resulting in incorrect rendering (only one cube instead of multiple instanced cubes). The goal is implied\u2014to preserve or support the `EXT_mesh_gpu_instancing` extension during processing. However, the statement lacks explicit details about the expected behavior (e.g., how the extension should be handled or preserved) and does not mention specific constraints or edge cases (e.g., compatibility with other extensions or performance implications). Additionally, there are no examples beyond the referenced model, and the input/output formats are not detailed in the statement itself. While the issue is valid and the intent is understandable, these missing minor details prevent it from being comprehensive.", "difficulty_explanation": "The difficulty of this problem falls into the medium range due to several factors. First, the scope of code changes spans multiple files (`cgltf.h`, `gltfpack.cpp`, `parsegltf.cpp`, and documentation in `README.md`), requiring a moderate understanding of the codebase structure and interactions between parsing, processing, and validation logic for glTF models. The changes involve adding support for the `EXT_mesh_gpu_instancing` extension, which includes parsing instance attributes (translation, rotation, scale) and ensuring they are correctly handled during mesh processing. This requires familiarity with glTF specifications and the `cgltf` library, as well as concepts like mesh instancing and transformation matrices, which are moderately complex. The code modifications are not trivial\u2014they include new validation logic, parsing functions, and conditional handling of instanced meshes versus regular nodes, indicating a need for careful integration into the existing workflow. Edge cases, such as ensuring consistency across instance attributes or handling multiple scenes (as warned in the code), add some complexity, though they are not extensively detailed in the problem statement. However, the changes do not appear to impact the core architecture significantly, nor do they require advanced domain-specific knowledge beyond glTF processing. Therefore, a score of 0.55 reflects a medium difficulty level, requiring a solid understanding of the codebase and moderate effort to implement and test the solution.", "clarity_label": 1, "difficulty_label": 1, "human_clarity": -1, "human_difficulty": -1}
{"problem_statement": "[Bug]: When `window.webContents.navigationHistory.goBack()` is called, the title set by the HTML's `<title>` tag will override the title set by `window.setTitle()`.\n### Preflight Checklist\n\n- [x] I have read the [Contributing Guidelines](https://github.com/electron/electron/blob/main/CONTRIBUTING.md) for this project.\n- [x] I agree to follow the [Code of Conduct](https://github.com/electron/electron/blob/main/CODE_OF_CONDUCT.md) that this project adheres to.\n- [x] I have searched the [issue tracker](https://www.github.com/electron/electron/issues) for a bug report that matches the one I want to file, without success.\n\n### Electron Version\n\n32.0.1\n\n### What operating system(s) are you using?\n\nWindows\n\n### Operating System Version\n\nWindows 11\t23H2\t22631.4169\tWindows Feature Experience Pack 1000.22700.1034.0\n\n### What arch are you using?\n\nx64\n\n### Last Known Working Electron version\n\n_No response_\n\n### Expected Behavior\n\n```\nconst window = new BrowserWindow();\nwindow.setTitle('myTitle');\n// After a route change in my HTML file, execute:\nwindow.webContents.navigationHistory.goBack();\n// => The title of the window should not be overridden by the HTML's title when `goBack()` is called.\n```\n\n### Actual Behavior\n\n```\nconst window = new BrowserWindow();\nwindow.setTitle('myTitle');\n// After a route change in my HTML file, execute:\nwindow.webContents.navigationHistory.goBack();\n// => At this point, the title of the window is no longer 'myTitle', but the content of the title tag in the HTML file.\n```\n\n### Testcase Gist URL\n\n_No response_\n\n### Additional Information\n\nThe front-end uses Vue.js + Vue-Router\n", "patch": "diff --git a/shell/browser/api/electron_api_web_contents.cc b/shell/browser/api/electron_api_web_contents.cc\nindex 53a24ac6f5943..c01e3c5fda2aa 100644\n--- a/shell/browser/api/electron_api_web_contents.cc\n+++ b/shell/browser/api/electron_api_web_contents.cc\n@@ -2057,6 +2057,17 @@ void WebContents::DidFinishNavigation(\n       if (is_main_frame) {\n         Emit(\"did-navigate\", url, http_response_code, http_status_text);\n       }\n+\n+      content::NavigationEntry* entry = navigation_handle->GetNavigationEntry();\n+\n+      // This check is needed due to an issue in Chromium\n+      // Upstream is open to patching:\n+      // https://bugs.chromium.org/p/chromium/issues/detail?id=1178663\n+      // If a history entry has been made and the forward/back call has been\n+      // made, proceed with setting the new title\n+      if (entry &&\n+          (entry->GetTransitionType() & ui::PAGE_TRANSITION_FORWARD_BACK))\n+        WebContents::TitleWasSet(entry);\n     }\n     if (is_guest())\n       Emit(\"load-commit\", url, is_main_frame);\n@@ -2077,15 +2088,6 @@ void WebContents::DidFinishNavigation(\n            frame_process_id, frame_routing_id);\n     }\n   }\n-  content::NavigationEntry* entry = navigation_handle->GetNavigationEntry();\n-\n-  // This check is needed due to an issue in Chromium\n-  // Check the Chromium issue to keep updated:\n-  // https://bugs.chromium.org/p/chromium/issues/detail?id=1178663\n-  // If a history entry has been made and the forward/back call has been made,\n-  // proceed with setting the new title\n-  if (entry && (entry->GetTransitionType() & ui::PAGE_TRANSITION_FORWARD_BACK))\n-    WebContents::TitleWasSet(entry);\n }\n \n void WebContents::TitleWasSet(content::NavigationEntry* entry) {\ndiff --git a/spec/api-web-contents-spec.ts b/spec/api-web-contents-spec.ts\nindex aa2c7d5297453..3f529c118d2e3 100644\n--- a/spec/api-web-contents-spec.ts\n+++ b/spec/api-web-contents-spec.ts\n@@ -631,6 +631,17 @@ describe('webContents module', () => {\n         w.webContents.navigationHistory.goBack();\n         expect(w.webContents.navigationHistory.getActiveIndex()).to.equal(0);\n       });\n+\n+      it('should have the same window title if navigating back within the page', async () => {\n+        const title = 'Test';\n+        w.webContents.on('did-finish-load', () => {\n+          w.setTitle(title);\n+          w.loadURL(`file://${fixturesPath}/pages/navigation-history-anchor-in-page.html#next`);\n+        });\n+        await w.loadURL(`file://${fixturesPath}/pages/navigation-history-anchor-in-page.html`);\n+        w.webContents.navigationHistory.goBack();\n+        expect(w.getTitle()).to.equal(title);\n+      });\n     });\n \n     describe('navigationHistory.canGoForward and navigationHistory.goForward API', () => {\n@@ -653,6 +664,16 @@ describe('webContents module', () => {\n         w.webContents.navigationHistory.goForward();\n         expect(w.webContents.navigationHistory.getActiveIndex()).to.equal(1);\n       });\n+\n+      it('should have the same window title if navigating forward within the page', async () => {\n+        const title = 'Test';\n+        w.webContents.on('did-finish-load', () => {\n+          w.setTitle(title);\n+          w.loadURL(`file://${fixturesPath}/pages/navigation-history-anchor-in-page.html#next`);\n+        });\n+        await w.loadURL(`file://${fixturesPath}/pages/navigation-history-anchor-in-page.html`);\n+        expect(w.getTitle()).to.equal(title);\n+      });\n     });\n \n     describe('navigationHistory.canGoToOffset(index) and navigationHistory.goToOffset(index) API', () => {\ndiff --git a/spec/fixtures/pages/navigation-history-anchor-in-page.html b/spec/fixtures/pages/navigation-history-anchor-in-page.html\nnew file mode 100644\nindex 0000000000000..03406b81f2a39\n--- /dev/null\n+++ b/spec/fixtures/pages/navigation-history-anchor-in-page.html\n@@ -0,0 +1,5 @@\n+<html>\n+<body>\n+  <span id=\"next\">This is content.</span>\n+</body>\n+</html>\n", "instance_id": "electron__electron-45981", "clarity": 2, "difficulty": 0.55, "clarity_explanation": "The problem statement is mostly clear in describing the issue: when `window.webContents.navigationHistory.goBack()` is called in Electron, the window title set by `window.setTitle()` is unexpectedly overridden by the HTML `<title>` tag of the navigated page. The expected and actual behaviors are provided with code snippets, which helps in understanding the bug. Additionally, the context of the front-end framework (Vue.js + Vue-Router) and the operating system (Windows 11) are mentioned, which adds some useful background. However, there are minor ambiguities and missing details. For instance, the problem statement does not explicitly discuss edge cases (e.g., what happens with multiple navigation steps or different types of navigation transitions) or constraints (e.g., whether this behavior is specific to certain Electron versions or HTML structures). There is also no test case gist provided, which could have further clarified the reproduction steps. Overall, while the core issue is well-articulated, the lack of comprehensive edge case discussion and detailed reproduction steps prevents it from being fully comprehensive.", "difficulty_explanation": "The difficulty of this problem falls into the medium range due to several factors. First, the scope of code changes involves modifications in multiple files: `electron_api_web_contents.cc` (C++ backend logic in Electron) and `api-web-contents-spec.ts` (TypeScript test specs), along with the addition of a new test fixture HTML file. The changes in the C++ file require understanding Chromium's navigation handling logic, specifically the `NavigationEntry` and `PAGE_TRANSITION_FORWARD_BACK` concepts, which are moderately complex and tied to Chromium's internals. The code change itself is relatively small but impactful, as it relocates a critical logic block for title setting within the navigation flow to address the bug, requiring a good grasp of event timing in navigation handling. Second, the technical concepts involved include familiarity with Electron's API, Chromium's navigation system, and integration testing in TypeScript, which collectively demand a moderate level of expertise. Third, while the problem statement does not explicitly mention edge cases, the code changes and test additions implicitly address scenarios like in-page anchor navigation, which adds a layer of complexity to ensure the title remains consistent across different navigation types. However, the changes do not significantly impact the broader system architecture, nor do they introduce complex error handling or performance considerations. Overall, this problem requires understanding multiple concepts and making targeted but non-trivial modifications across a few files, justifying a difficulty score of 0.55, on the higher end of medium difficulty.", "clarity_label": 1, "difficulty_label": 1, "human_clarity": -1, "human_difficulty": -1}
{"problem_statement": "[Bug]: Electron crashes with libnotify 0.8.3 in portal environment when closing notification\n### Preflight Checklist\r\n\r\n- [X] I have read the [Contributing Guidelines](https://github.com/electron/electron/blob/main/CONTRIBUTING.md) for this project.\r\n- [X] I agree to follow the [Code of Conduct](https://github.com/electron/electron/blob/main/CODE_OF_CONDUCT.md) that this project adheres to.\r\n- [X] I have searched the [issue tracker](https://www.github.com/electron/electron/issues) for a bug report that matches the one I want to file, without success.\r\n\r\n### Electron Version\r\n\r\n25.0.0, 27.0.3 and 28.0.0-beta.2\r\n\r\n### What operating system are you using?\r\n\r\nOther Linux\r\n\r\n### Operating System Version\r\n\r\n- Arch Linux\r\n- `uname -a`: `Linux hostname 6.5.7-arch1-1 #1 SMP PREEMPT_DYNAMIC Tue, 10 Oct 2023 21:10:21 +0000 x86_64 GNU/Linux`\r\n\r\n### What arch are you using?\r\n\r\nx64\r\n\r\n### Last Known Working Electron version\r\n\r\nNot sure\r\n\r\n### Expected Behavior\r\n\r\nElectron does not crash when running `notification.close()`.\r\n\r\n### Actual Behavior\r\n\r\nElectron crashes with `notification.close()` when in portal (flatpak/snap, or `NOTIFY_FORCE_PORTAL=1` is set).\r\n\r\n### Testcase Gist URL\r\n\r\n_No response_\r\n\r\n### Additional Information\r\n\r\nAn MRE modified from electron-quick-start: https://github.com/taoky/electron-libnotify-portal-crash-mre.\r\n\r\nScreencast:\r\n\r\nhttps://github.com/electron/electron/assets/2109893/9bc49b03-ddef-4599-93e6-e7b4fb168b29\r\n\r\nMy analysis:\r\n\r\n1. `LibnotifyNotification::Show()` binds \"closed\" glib signal to `LibnotifyNotification::OnNotificationClosed` https://github.com/electron/electron/blob/7999ea39e2ee9702e64e4125e8e89c314e9f468f/shell/browser/notifications/linux/libnotify_notification.cc#L91-L94\r\n2. When closing (dismissing) notification, `LibnotifyNotification::Dismiss()` is called which runs `libnotify_loader_.notify_notification_close()`: https://github.com/electron/electron/blob/7999ea39e2ee9702e64e4125e8e89c314e9f468f/shell/browser/notifications/linux/libnotify_notification.cc#L167\r\n3. In `notify_notification_close()`, as libnotify 0.8.x adds supports for portal environment, it will call `remove_portal_notification()` instead of using gdbus call (<https://gitlab.gnome.org/GNOME/libnotify/-/blob/0.8.3/libnotify/notification.c#L1761>), then it calls `close_notification()` (<https://gitlab.gnome.org/GNOME/libnotify/-/blob/0.8.3/libnotify/notification.c#L825>), and nightmare happens: it `g_signal_emit (notification, signals[SIGNAL_CLOSED], 0);` (<https://gitlab.gnome.org/GNOME/libnotify/-/blob/0.8.3/libnotify/notification.c#L707>).\r\n4. `LibnotifyNotification::OnNotificationClosed()` happily calls `NotificationDismissed()`, which finally calls `Destroy()`, and then `presenter()->RemoveNotification(this)`, and `this` is then `delete`d inside.\r\n5. `Notification::Close()` in electron_api_notification.cc has no idea about `notification_` being deleted, it continues, and crashes:\r\nhttps://github.com/electron/electron/blob/7999ea39e2ee9702e64e4125e8e89c314e9f468f/shell/browser/api/electron_api_notification.cc#L217C6-L227\n", "patch": "diff --git a/shell/browser/notifications/linux/libnotify_notification.cc b/shell/browser/notifications/linux/libnotify_notification.cc\nindex 0dcfad8aa6dd5..62c5480edf965 100644\n--- a/shell/browser/notifications/linux/libnotify_notification.cc\n+++ b/shell/browser/notifications/linux/libnotify_notification.cc\n@@ -159,21 +159,21 @@ void LibnotifyNotification::Show(const NotificationOptions& options) {\n \n void LibnotifyNotification::Dismiss() {\n   if (!notification_) {\n-    Destroy();\n     return;\n   }\n \n   GError* error = nullptr;\n+  on_dismissing_ = true;\n   libnotify_loader_.notify_notification_close(notification_, &error);\n   if (error) {\n     log_and_clear_error(error, \"notify_notification_close\");\n-    Destroy();\n   }\n+  on_dismissing_ = false;\n }\n \n void LibnotifyNotification::OnNotificationClosed(\n     NotifyNotification* notification) {\n-  NotificationDismissed();\n+  NotificationDismissed(!on_dismissing_);\n }\n \n void LibnotifyNotification::OnNotificationView(NotifyNotification* notification,\ndiff --git a/shell/browser/notifications/linux/libnotify_notification.h b/shell/browser/notifications/linux/libnotify_notification.h\nindex 8aacd0952062a..315419fc5c734 100644\n--- a/shell/browser/notifications/linux/libnotify_notification.h\n+++ b/shell/browser/notifications/linux/libnotify_notification.h\n@@ -33,6 +33,7 @@ class LibnotifyNotification : public Notification {\n   RAW_PTR_EXCLUSION NotifyNotification* notification_ = nullptr;\n \n   ScopedGSignal signal_;\n+  bool on_dismissing_ = false;\n };\n \n }  // namespace electron\n", "instance_id": "electron__electron-41709", "clarity": 2, "difficulty": 0.65, "clarity_explanation": "\nThe problem statement is mostly clear in describing the issue: Electron crashes when closing notifications in a portal environment with libnotify 0.8.3. It provides detailed context about the environment (Linux, specific Electron versions, and portal settings), expected behavior, actual behavior, and a step-by-step analysis of the crash's root cause. Additionally, it includes links to relevant code in the Electron repository and external libraries, as well as a minimal reproducible example (MRE). However, there are minor ambiguities that prevent a perfect score. For instance, the problem statement does not explicitly define the expected fix or constraints for the solution (e.g., whether the fix must avoid breaking other environments). Edge cases, such as behavior in non-portal environments or with different libnotify versions, are not mentioned. While the analysis is thorough, it assumes familiarity with Electron's notification system and libnotify internals, which might not be immediately clear to all developers. Overall, the statement is valid and clear but lacks some minor details.\n", "difficulty_explanation": "\nI rate the difficulty of this problem as 0.65, placing it in the \"Hard\" category due to several factors:\n\n1. **Clarity and Complexity of the Problem Description**: While the problem is mostly clear, the underlying issue involves intricate interactions between Electron's notification system and the libnotify library in a portal environment (e.g., Flatpak/Snap). Understanding the crash requires tracing the signal handling and object lifecycle management, which adds to the logical complexity.\n\n2. **Scope and Depth of Code Changes**: The provided code changes are relatively small and localized to a single file (`libnotify_notification.cc` and its header). The fix introduces a boolean flag (`on_dismissing_`) to track whether the dismissal is in progress, preventing premature destruction of the notification object. However, the change impacts a critical part of the notification handling logic, which is central to Electron's cross-platform behavior on Linux. While it does not affect the broader system architecture, it requires careful consideration of object lifecycle and signal handling to avoid introducing new bugs.\n\n3. **Number of Technical Concepts**: Solving this problem requires a deep understanding of several concepts: (a) C++ memory management and object lifecycle in the context of Electron's notification system, (b) GLib signal handling (specifically how libnotify emits signals like \"closed\"), (c) the behavior of libnotify in portal environments, and (d) Electron's internal architecture for notifications. These concepts are moderately complex and require familiarity with both Electron's codebase and Linux-specific libraries.\n\n4. **Edge Cases and Error Handling**: The problem statement does not explicitly mention edge cases, but the nature of the bug (a crash during notification closure) implies potential issues with concurrent signal handling, different libnotify versions, or non-portal environments. The code change adds logic to handle the dismissal state, but it does not address broader error conditions (e.g., what happens if `notify_notification_close` fails for other reasons). Implementing a robust solution may require additional error handling and testing across various environments, increasing the difficulty.\n\nOverall, this problem is hard because it demands a nuanced understanding of Electron's notification system, Linux-specific libraries, and signal handling intricacies. While the code change itself is small, the potential for subtle bugs and the need to validate the fix across different environments elevate the difficulty. It falls short of \"Very Hard\" (0.8-1.0) because it does not involve system-level redesign or advanced domain-specific knowledge beyond the Electron and libnotify ecosystems.\n", "clarity_label": 1, "difficulty_label": 1, "human_clarity": -1, "human_difficulty": -1}
{"problem_statement": "Unit tests fail under `lldb` supervision\n### Tested versions\n\na210fe6dbd27cc01bffacb0ce2816e0cf303af5e / 4.0+\n\n### System information\n\nGodot v4.4.1.stable - macOS Sequoia (15.3.0) - Multi-window, 1 monitor - Metal (Forward+) - integrated Apple M1 Max (Apple7) - Apple M1 Max (10 threads)\n\n### Issue description\n\nWhen using `lldb`, `test_os.h` fails `[OS] Execute`.\nThis is a regression from https://github.com/godotengine/godot/pull/42069 (4.0), cc @Calinou.\n\n### Steps to reproduce\n\n1. Be on macOS (may fail on linux too)\n2. run  `\u276f lldb bin/godot.macos.editor.arm64 -- --test`\n3. run `run`\n4. Observe the error:\n\n```\n./tests/core/os/test_os.h:199: ERROR: CHECK( exit_code == 0 ) is NOT correct!\n  values: CHECK( 230 == 0 )\n  logged: Running the command `sh -c \"ls > /dev/null\"` returns a zero (successful) exit code.\n\nProcess 42405 stopped\n* thread #1, queue = 'com.apple.main-thread', stop reason = EXC_BREAKPOINT (code=1, subcode=0x1005063b0)\n    frame #0: 0x00000001005063b0 godot.macos.editor.arm64.master`TestOS::DOCTEST_ANON_FUNC_4825() at test_os.h:197:2 [opt]\n   194          CHECK_MESSAGE(\n   195                          err == OK,\n   196                          \"(Running the command `sh -c \\\"ls > /dev/null\\\"` returns the expected Godot error code (OK).\");\n-> 197          CHECK_MESSAGE(\n   198                          exit_code == 0,\n   199                          \"Running the command `sh -c \\\"ls > /dev/null\\\"` returns a zero (successful) exit code.\");\n   200  #endif\nTarget 0: (godot.macos.editor.arm64.master) stopped.\nwarning: godot.macos.editor.arm64.master was compiled with optimization - stepping may behave oddly; variables may not be available.\n```\n\nThe rest of the unit tests run through, so deleting the test is a temporary fix.\n\n### Minimal reproduction project (MRP)\n\nN/A\n", "patch": "diff --git a/drivers/unix/os_unix.cpp b/drivers/unix/os_unix.cpp\nindex d3e4ca92defb..10f8b0ba38a3 100644\n--- a/drivers/unix/os_unix.cpp\n+++ b/drivers/unix/os_unix.cpp\n@@ -805,6 +805,57 @@ Dictionary OS_Unix::execute_with_pipe(const String &p_path, const List<String> &\n #endif\n }\n \n+int OS_Unix::_wait_for_pid_completion(const pid_t p_pid, int *r_status, int p_options) {\n+\twhile (true) {\n+\t\tif (waitpid(p_pid, r_status, p_options) != -1) {\n+\t\t\t// Thread exited normally.\n+\t\t\treturn 0;\n+\t\t}\n+\t\tconst int error = errno;\n+\t\tif (error == EINTR) {\n+\t\t\t// We're in a debugger, should call waitpid again.\n+\t\t\t// See https://stackoverflow.com/a/45472920/730797.\n+\t\t\tcontinue;\n+\t\t}\n+\t\treturn error;\n+\t}\n+}\n+\n+bool OS_Unix::_check_pid_is_running(const pid_t p_pid, int *r_status) const {\n+\tconst ProcessInfo *pi = process_map->getptr(p_pid);\n+\n+\tif (pi && !pi->is_running) {\n+\t\t// Can return cached value.\n+\t\tif (r_status) {\n+\t\t\t*r_status = pi->exit_code;\n+\t\t}\n+\t\treturn false;\n+\t}\n+\n+\tint status = 0;\n+\tconst int result = _wait_for_pid_completion(p_pid, &status, WNOHANG);\n+\tif (result == 0) {\n+\t\t// Thread is still running.\n+\t\treturn true;\n+\t}\n+\n+\tERR_FAIL_COND_V_MSG(result == -1, false, vformat(\"Thread %d exited with errno: %d\", (int)p_pid, errno));\n+\t// Thread exited normally.\n+\n+\tstatus = WIFEXITED(status) ? WEXITSTATUS(status) : status;\n+\n+\tif (pi) {\n+\t\tpi->is_running = false;\n+\t\tpi->exit_code = status;\n+\t}\n+\n+\tif (r_status) {\n+\t\t*r_status = status;\n+\t}\n+\n+\treturn false;\n+}\n+\n Error OS_Unix::execute(const String &p_path, const List<String> &p_arguments, String *r_pipe, int *r_exitcode, bool read_stderr, Mutex *p_pipe_mutex, bool p_open_console) {\n #ifdef __EMSCRIPTEN__\n \t// Don't compile this code at all to avoid undefined references.\n@@ -870,12 +921,12 @@ Error OS_Unix::execute(const String &p_path, const List<String> &p_arguments, St\n \t\traise(SIGKILL);\n \t}\n \n-\tint status;\n-\twaitpid(pid, &status, 0);\n+\tint status = 0;\n+\tconst int result = _wait_for_pid_completion(pid, &status, 0);\n \tif (r_exitcode) {\n \t\t*r_exitcode = WIFEXITED(status) ? WEXITSTATUS(status) : status;\n \t}\n-\treturn OK;\n+\treturn result ? FAILED : OK;\n #endif\n }\n \n@@ -929,7 +980,7 @@ Error OS_Unix::kill(const ProcessID &p_pid) {\n \tif (!ret) {\n \t\t//avoid zombie process\n \t\tint st;\n-\t\t::waitpid(p_pid, &st, 0);\n+\t\t_wait_for_pid_completion(p_pid, &st, 0);\n \t}\n \treturn ret ? ERR_INVALID_PARAMETER : OK;\n }\n@@ -940,42 +991,19 @@ int OS_Unix::get_process_id() const {\n \n bool OS_Unix::is_process_running(const ProcessID &p_pid) const {\n \tMutexLock lock(process_map_mutex);\n-\tconst ProcessInfo *pi = process_map->getptr(p_pid);\n-\n-\tif (pi && !pi->is_running) {\n-\t\treturn false;\n-\t}\n-\n-\tint status = 0;\n-\tif (waitpid(p_pid, &status, WNOHANG) != 0) {\n-\t\tif (pi) {\n-\t\t\tpi->is_running = false;\n-\t\t\tpi->exit_code = status;\n-\t\t}\n-\t\treturn false;\n-\t}\n-\n-\treturn true;\n+\treturn _check_pid_is_running(p_pid, nullptr);\n }\n \n int OS_Unix::get_process_exit_code(const ProcessID &p_pid) const {\n \tMutexLock lock(process_map_mutex);\n-\tconst ProcessInfo *pi = process_map->getptr(p_pid);\n \n-\tif (pi && !pi->is_running) {\n-\t\treturn pi->exit_code;\n+\tint exit_code = 0;\n+\tif (_check_pid_is_running(p_pid, &exit_code)) {\n+\t\t// Thread is still running\n+\t\treturn -1;\n \t}\n \n-\tint status = 0;\n-\tif (waitpid(p_pid, &status, WNOHANG) != 0) {\n-\t\tstatus = WIFEXITED(status) ? WEXITSTATUS(status) : status;\n-\t\tif (pi) {\n-\t\t\tpi->is_running = false;\n-\t\t\tpi->exit_code = status;\n-\t\t}\n-\t\treturn status;\n-\t}\n-\treturn -1;\n+\treturn exit_code;\n }\n \n String OS_Unix::get_locale() const {\ndiff --git a/drivers/unix/os_unix.h b/drivers/unix/os_unix.h\nindex 8fde52b5ff00..febc7c79cd89 100644\n--- a/drivers/unix/os_unix.h\n+++ b/drivers/unix/os_unix.h\n@@ -71,6 +71,9 @@ class OS_Unix : public OS {\n \tvoid _load_iconv();\n #endif\n \n+\tstatic int _wait_for_pid_completion(const pid_t p_pid, int *r_status, int p_options);\n+\tbool _check_pid_is_running(const pid_t p_pid, int *r_status) const;\n+\n protected:\n \t// UNIX only handles the core functions.\n \t// inheriting platforms under unix (eg. X11) should handle the rest\n", "instance_id": "godotengine__godot-105114", "clarity": 2, "difficulty": 0.65, "clarity_explanation": "The problem statement is mostly clear in describing the issue: unit tests fail under `lldb` supervision on macOS (and potentially Linux) due to a specific test in `test_os.h` failing when executing a command. It provides detailed steps to reproduce the issue, including the exact error message and context about the failing test. Additionally, it references a related regression from a previous pull request, which adds useful context. However, there are minor ambiguities and missing details. For instance, the problem statement does not explicitly clarify the root cause of the failure under `lldb` (e.g., whether it's a debugger-specific behavior or a broader issue with process handling). It also lacks explicit mention of expected behavior beyond passing the test and does not discuss potential edge cases or constraints (e.g., specific `lldb` versions or system configurations). While a temporary fix (deleting the test) is mentioned, the desired permanent solution is implied but not detailed. Overall, the statement is valid and mostly clear but misses some minor details that could aid in fully understanding the issue without additional investigation.", "difficulty_explanation": "The difficulty of this problem falls into the \"Hard\" category due to several factors. First, the scope of code changes is moderate, involving modifications to process handling logic in `os_unix.cpp` and `os_unix.h`, specifically around how processes are executed and monitored using `waitpid`. The changes are localized to a single module but require a deep understanding of UNIX process management (e.g., handling `EINTR` signals in debuggers, interpreting `waitpid` return values, and managing process status). Second, the technical concepts involved are moderately complex, including low-level system calls, signal handling, and debugger-specific behavior (e.g., `EINTR` interruptions under `lldb`), which require familiarity with UNIX internals and debugging environments. Third, the problem impacts a critical part of the system (process execution in the Godot engine), necessitating careful consideration of side effects and compatibility across platforms (macOS and potentially Linux). Fourth, while the problem statement does not explicitly mention edge cases, the code changes introduce logic to handle interruptions (`EINTR`) and non-blocking checks (`WNOHANG`), indicating a need to manage subtle error conditions and ensure robustness in a debugger context. Overall, solving this requires a solid grasp of system programming and the ability to navigate nuanced interactions between the application and debugging tools, justifying a difficulty score of 0.65. It is not \"Very Hard\" as it does not involve architectural redesign or highly specialized domain knowledge beyond UNIX systems programming.", "clarity_label": 1, "difficulty_label": 1, "human_clarity": -1, "human_difficulty": -1}
{"problem_statement": "Layout Mode becomes `2` when parent type is changed\n### Tested versions\n\n4.5 dev1\nProbably earlier too\n\n### System information\n\nW10\n\n### Issue description\n\nWhen a Control node is under a Container and the Container is changed to Control, the child's Layout Mode changes to `2` (which is Container, but without name?)\n\nhttps://github.com/user-attachments/assets/f0bb6975-4a6a-4516-92b1-93e795917629\n\n### Steps to reproduce\n\n1. Add a Container node\n2. Add a Control as its child\n3. Change Type of the Container to Control\n4. Check the Layout Mode of its child\n\n### Minimal reproduction project (MRP)\n\nN/A\n", "patch": "diff --git a/scene/gui/control.cpp b/scene/gui/control.cpp\nindex a64de8fb3c5d..57bc748bfe90 100644\n--- a/scene/gui/control.cpp\n+++ b/scene/gui/control.cpp\n@@ -481,9 +481,9 @@ void Control::_validate_property(PropertyInfo &p_property) const {\n \t}\n \n \t// Validate which positioning properties should be displayed depending on the parent and the layout mode.\n-\tNode *parent_node = get_parent_control();\n-\tif (!parent_node) {\n-\t\t// If there is no parent, display both anchor and container options.\n+\tControl *parent_control = get_parent_control();\n+\tif (!parent_control) {\n+\t\t// If there is no parent control, display both anchor and container options.\n \n \t\t// Set the layout mode to be disabled with the proper value.\n \t\tif (p_property.name == \"layout_mode\") {\n@@ -496,7 +496,7 @@ void Control::_validate_property(PropertyInfo &p_property) const {\n \t\tif (!use_custom_anchors && (p_property.name.begins_with(\"anchor_\") || p_property.name.begins_with(\"offset_\") || p_property.name.begins_with(\"grow_\"))) {\n \t\t\tp_property.usage ^= PROPERTY_USAGE_EDITOR;\n \t\t}\n-\t} else if (Object::cast_to<Container>(parent_node)) {\n+\t} else if (Object::cast_to<Container>(parent_control)) {\n \t\t// If the parent is a container, display only container-related properties.\n \t\tif (p_property.name.begins_with(\"anchor_\") || p_property.name.begins_with(\"offset_\") || p_property.name.begins_with(\"grow_\") || p_property.name == \"anchors_preset\") {\n \t\t\tp_property.usage ^= PROPERTY_USAGE_DEFAULT;\n@@ -508,7 +508,7 @@ void Control::_validate_property(PropertyInfo &p_property) const {\n \t\t\tp_property.usage |= PROPERTY_USAGE_READ_ONLY;\n \t\t} else if (p_property.name == \"size_flags_horizontal\" || p_property.name == \"size_flags_vertical\") {\n \t\t\t// Filter allowed size flags based on the parent container configuration.\n-\t\t\tContainer *parent_container = Object::cast_to<Container>(parent_node);\n+\t\t\tContainer *parent_container = Object::cast_to<Container>(parent_control);\n \t\t\tVector<int> size_flags;\n \t\t\tif (p_property.name == \"size_flags_horizontal\") {\n \t\t\t\tsize_flags = parent_container->get_allowed_size_flags_horizontal();\n@@ -548,7 +548,7 @@ void Control::_validate_property(PropertyInfo &p_property) const {\n \t\t\t}\n \t\t}\n \t} else {\n-\t\t// If the parent is NOT a container or not a control at all, display only anchoring-related properties.\n+\t\t// If the parent is a non-container control, display only anchoring-related properties.\n \t\tif (p_property.name.begins_with(\"size_flags_\")) {\n \t\t\tp_property.usage ^= PROPERTY_USAGE_EDITOR;\n \n@@ -570,7 +570,7 @@ void Control::_validate_property(PropertyInfo &p_property) const {\n \t}\n \n \t// Disable the property if it's managed by the parent container.\n-\tif (!Object::cast_to<Container>(parent_node)) {\n+\tif (!Object::cast_to<Container>(parent_control)) {\n \t\treturn;\n \t}\n \tbool property_is_managed_by_container = false;\n@@ -905,11 +905,11 @@ void Control::_update_layout_mode() {\n }\n \n Control::LayoutMode Control::_get_layout_mode() const {\n-\tNode *parent_node = get_parent_control();\n+\tControl *parent_control = get_parent_control();\n \t// In these modes the property is read-only.\n-\tif (!parent_node) {\n+\tif (!parent_control) {\n \t\treturn LayoutMode::LAYOUT_MODE_UNCONTROLLED;\n-\t} else if (Object::cast_to<Container>(parent_node)) {\n+\t} else if (Object::cast_to<Container>(parent_control)) {\n \t\treturn LayoutMode::LAYOUT_MODE_CONTAINER;\n \t}\n \n@@ -918,20 +918,25 @@ Control::LayoutMode Control::_get_layout_mode() const {\n \t\treturn LayoutMode::LAYOUT_MODE_ANCHORS;\n \t}\n \n-\t// Otherwise fallback on what's stored.\n-\treturn data.stored_layout_mode;\n+\t// Only position/anchors modes are valid for non-container control parent.\n+\tif (data.stored_layout_mode == LayoutMode::LAYOUT_MODE_POSITION || data.stored_layout_mode == LayoutMode::LAYOUT_MODE_ANCHORS) {\n+\t\treturn data.stored_layout_mode;\n+\t}\n+\n+\t// Otherwise fallback to position mode.\n+\treturn LayoutMode::LAYOUT_MODE_POSITION;\n }\n \n Control::LayoutMode Control::_get_default_layout_mode() const {\n-\tNode *parent_node = get_parent_control();\n+\tControl *parent_control = get_parent_control();\n \t// In these modes the property is read-only.\n-\tif (!parent_node) {\n+\tif (!parent_control) {\n \t\treturn LayoutMode::LAYOUT_MODE_UNCONTROLLED;\n-\t} else if (Object::cast_to<Container>(parent_node)) {\n+\t} else if (Object::cast_to<Container>(parent_control)) {\n \t\treturn LayoutMode::LAYOUT_MODE_CONTAINER;\n \t}\n \n-\t// Otherwise fallback on the position mode.\n+\t// Otherwise fallback to the position mode.\n \treturn LayoutMode::LAYOUT_MODE_POSITION;\n }\n \n", "instance_id": "godotengine__godot-104614", "clarity": 2, "difficulty": 0.45, "clarity_explanation": "The problem statement is mostly clear in describing the issue: when a Container node is changed to a Control node, the child node's Layout Mode unexpectedly changes to '2' (interpreted as Container mode without a name). The steps to reproduce are provided, which helps in understanding the context and replicating the issue. However, there are minor ambiguities and missing details. For instance, the problem statement does not explicitly define what the expected behavior should be (e.g., what should the Layout Mode be after the parent type change?). Additionally, there are no mentions of specific edge cases or constraints that might affect the behavior, such as different types of Control or Container nodes or hierarchical structures. While a visual asset is referenced, it is not accessible in this context, which slightly reduces clarity. Overall, the statement is valid and mostly clear but lacks some critical details about expected outcomes and edge cases.", "difficulty_explanation": "The difficulty of this problem falls in the medium range due to several factors. First, the scope of code changes is relatively focused, primarily within a single file (control.cpp), and involves modifications to a few functions related to layout mode handling. The changes do not appear to impact the broader system architecture significantly, as they are localized to logic around parent-child relationships and layout mode determination. However, understanding the codebase requires familiarity with specific technical concepts, such as the Godot engine's node hierarchy, the distinction between Control and Container nodes, and the layout mode system (e.g., LAYOUT_MODE_CONTAINER, LAYOUT_MODE_POSITION). The code changes also involve type casting and conditional logic based on parent node types, which adds a layer of complexity. Additionally, while the problem statement does not explicitly mention edge cases, the code modifications suggest a need to handle scenarios where a parent is neither a Container nor a Control, or where stored layout modes are invalid, requiring careful validation and fallback logic. Overall, solving this requires a moderate understanding of the domain (Godot engine GUI system) and careful modification of existing logic, placing it at the lower end of the medium difficulty range (0.45).", "clarity_label": 1, "difficulty_label": 1, "human_clarity": -1, "human_difficulty": -1}
{"problem_statement": "NavigationRegion2D visible even though not enabled in Debug\n### Tested versions\n\nv4.4.stable.steam.4c311cbee\n\n### System information\n\nWindows 11 - Godot Engine v4.4.stable.steam.4c311cbee\n\n### Issue description\n\nIf you enable the option Debug > Visible Avoidance, the navigation mesh will also become visible (regardless of whether Visible Navigation is enabled). This was not the case in previous versions.\n\n### Steps to reproduce\n\nCheck Debug > Visible Avoidance\n\n### Minimal reproduction project (MRP)\n\n[new-game.zip](https://github.com/user-attachments/files/19086046/new-game.zip)\n", "patch": "diff --git a/scene/2d/navigation_region_2d.cpp b/scene/2d/navigation_region_2d.cpp\nindex 365d5ba4f68e..ef83027fa0c4 100644\n--- a/scene/2d/navigation_region_2d.cpp\n+++ b/scene/2d/navigation_region_2d.cpp\n@@ -181,7 +181,7 @@ void NavigationRegion2D::_notification(int p_what) {\n \n \t\tcase NOTIFICATION_DRAW: {\n #ifdef DEBUG_ENABLED\n-\t\t\tif (is_inside_tree() && (Engine::get_singleton()->is_editor_hint() || NavigationServer2D::get_singleton()->get_debug_enabled()) && navigation_polygon.is_valid()) {\n+\t\t\tif (is_inside_tree() && (Engine::get_singleton()->is_editor_hint() || (NavigationServer2D::get_singleton()->get_debug_enabled() && NavigationServer2D::get_singleton()->get_debug_navigation_enabled())) && navigation_polygon.is_valid()) {\n \t\t\t\t_update_debug_mesh();\n \t\t\t\t_update_debug_edge_connections_mesh();\n \t\t\t\t_update_debug_baking_rect();\n", "instance_id": "godotengine__godot-103784", "clarity": 2, "difficulty": 0.25, "clarity_explanation": "The problem statement is mostly clear in describing the issue: when the \"Debug > Visible Avoidance\" option is enabled in Godot Engine v4.4, the navigation mesh becomes visible even if \"Visible Navigation\" is not enabled, which differs from previous behavior. The statement includes the tested version, system information, steps to reproduce, and a minimal reproduction project (MRP), which are helpful for understanding the context. However, there are minor ambiguities and missing details. For instance, it does not explicitly state the expected behavior (e.g., should the navigation mesh remain hidden unless \"Visible Navigation\" is enabled?) or provide details on potential edge cases or related debug settings that might interact with this behavior. Additionally, the problem statement does not clarify the impact or priority of this issue (e.g., is it purely cosmetic, or does it affect functionality?). Despite these minor gaps, the issue is valid and understandable, warranting a score of 2 (Mostly Clear).", "difficulty_explanation": "The difficulty of solving this problem is relatively low, falling into the \"Easy\" range (0.2-0.4). Let's break it down based on the evaluation factors:\n\n1. **Scope and Depth of Code Changes**: The provided code change is minimal and confined to a single line in a single file (`navigation_region_2d.cpp`). It modifies a conditional statement in the `NOTIFICATION_DRAW` block to include an additional check (`NavigationServer2D::get_singleton()->get_debug_navigation_enabled()`). This change does not impact the broader system architecture or require modifications across multiple modules. The amount of code change is trivial, involving only a logical condition update.\n\n2. **Number of Technical Concepts**: Solving this issue requires a basic understanding of the Godot Engine's debug rendering logic and the `NavigationServer2D` singleton's API. The concepts involved are straightforward\u2014conditional logic and familiarity with debug flags in the engine. No advanced algorithms, design patterns, or domain-specific knowledge beyond basic game engine debugging are needed. For a developer familiar with Godot or similar engines, this is a simple task.\n\n3. **Potential Edge Cases and Error Handling**: The problem statement does not mention specific edge cases, and the code change does not introduce or modify error handling logic. The modification is purely about toggling visibility based on debug settings, and there are no apparent complex edge cases (e.g., performance issues or conflicts with other debug features) indicated in the diff or problem description. If edge cases exist (e.g., interactions with other debug settings), they are not highlighted, and the fix appears self-contained.\n\n4. **Overall Complexity**: The task involves understanding a small part of the rendering logic for debug visualization in Godot and applying a simple fix by adding a condition to respect the \"Visible Navigation\" debug setting. This does not require deep knowledge of the codebase beyond the immediate context of the `NavigationRegion2D` class and its interaction with `NavigationServer2D`. The fix is localized and does not have broader implications for performance or architecture.\n\nGiven these factors, I assign a difficulty score of 0.25, as the problem requires minimal code changes, basic understanding of the relevant code logic, and no significant handling of edge cases or complex interactions. It is a straightforward bug fix that a junior or mid-level developer with some familiarity with the codebase could handle with ease.", "clarity_label": 1, "difficulty_label": 1, "human_clarity": -1, "human_difficulty": -1}
{"problem_statement": "Creating render pipeline for a `RDShaderFile` that doesn't have vertex shader causes crash\n### Tested versions\n\n4.4.rc3\n\n### System information\n\nGodot v4.4.rc.mono - EndeavourOS  SMP PREEMPT_DYNAMIC Sat, 22 Feb 2025 00:37:05 +0000 on Wayland - X11 display driver, Multi-window, 1 monitor - Vulkan (Mobile) - integrated AMD Radeon Graphics (RADV RENOIR) - AMD Ryzen 7 4800U with Radeon Graphics (16 threads)\n\n### Issue description\n\nIf a glsl file only has `#[fragment]` but no `#[vertex]`, it can be successfully compiled and loaded in script. And if it is used in `RenderingDevice.render_pipeline_create`, the game will crash (if it's a tool script, the whole editor will crash).\n\n### Steps to reproduce\n\nRun the MRP, then the game crashes:\n```\nStop reason: signal SIGSEGV: address not mapped to object (fault address: 0x0)\nStop reason: signal SIGSEGV: invalid permissions for mapped object (fault address: 0x7fffa7e21fd0)\n```\nCall stack:\n```\n___lldb_unnamed_symbol2415 (@___lldb_unnamed_symbol2415:686)\n___lldb_unnamed_symbol2417 (@___lldb_unnamed_symbol2417:62)\n___lldb_unnamed_symbol2420 (@___lldb_unnamed_symbol2420:108)\nRenderingDeviceDriverVulkan::render_pipeline_create(RenderingDeviceDriver::ShaderID, RenderingDeviceDriver::VertexFormatID, RenderingDeviceCommons::RenderPrimitive, RenderingDeviceCommons::PipelineRasterizationState, RenderingDeviceCommons::PipelineMultisampleState, RenderingDeviceCommons::PipelineDepthStencilState, RenderingDeviceCommons::PipelineColorBlendState, VectorView<int>, BitField<RenderingDeviceCommons::PipelineDynamicStateFlags>, RenderingDeviceDriver::RenderPassID, unsigned int, VectorView<RenderingDeviceCommons::PipelineSpecializationConstant>) (/home/luo/godot/drivers/vulkan/rendering_device_driver_vulkan.cpp:5246)\nRenderingDevice::render_pipeline_create(RID, long, long, RenderingDeviceCommons::RenderPrimitive, RenderingDeviceCommons::PipelineRasterizationState const&, RenderingDeviceCommons::PipelineMultisampleState const&, RenderingDeviceCommons::PipelineDepthStencilState const&, RenderingDeviceCommons::PipelineColorBlendState const&, BitField<RenderingDeviceCommons::PipelineDynamicStateFlags>, unsigned int, Vector<RenderingDeviceCommons::PipelineSpecializationConstant> const&) (/home/luo/godot/servers/rendering/rendering_device.cpp:3957)\nRenderingDevice::_render_pipeline_create(RID, long, long, RenderingDeviceCommons::RenderPrimitive, Ref<RDPipelineRasterizationState> const&, Ref<RDPipelineMultisampleState> const&, Ref<RDPipelineDepthStencilState> const&, Ref<RDPipelineColorBlendState> const&, BitField<RenderingDeviceCommons::PipelineDynamicStateFlags>, unsigned int, TypedArray<RDPipelineSpecializationConstant> const&) (/home/luo/godot/servers/rendering/rendering_device.cpp:8269)\nvoid call_with_variant_args_ret_helper<__UnexistingClass, RID, RID, long, long, RenderingDeviceCommons::RenderPrimitive, Ref<RDPipelineRasterizationState> const&, Ref<RDPipelineMultisampleState> const&, Ref<RDPipelineDepthStencilState> const&, Ref<RDPipelineColorBlendState> const&, BitField<RenderingDeviceCommons::PipelineDynamicStateFlags>, unsigned int, TypedArray<RDPipelineSpecializationConstant> const&, 0ul, 1ul, 2ul, 3ul, 4ul, 5ul, 6ul, 7ul, 8ul, 9ul, 10ul>(__UnexistingClass*, RID (__UnexistingClass::*)(RID, long, long, RenderingDeviceCommons::RenderPrimitive, Ref<RDPipelineRasterizationState> const&, Ref<RDPipelineMultisampleState> const&, Ref<RDPipelineDepthStencilState> const&, Ref<RDPipelineColorBlendState> const&, BitField<RenderingDeviceCommons::PipelineDynamicStateFlags>, unsigned int, TypedArray<RDPipelineSpecializationConstant> const&), Variant const**, Variant&, Callable::CallError&, IndexSequence<0ul, 1ul, 2ul, 3ul, 4ul, 5ul, 6ul, 7ul, 8ul, 9ul, 10ul>) (/home/luo/godot/core/variant/binder_common.h:767)\nvoid call_with_variant_args_ret_dv<__UnexistingClass, RID, RID, long, long, RenderingDeviceCommons::RenderPrimitive, Ref<RDPipelineRasterizationState> const&, Ref<RDPipelineMultisampleState> const&, Ref<RDPipelineDepthStencilState> const&, Ref<RDPipelineColorBlendState> const&, BitField<RenderingDeviceCommons::PipelineDynamicStateFlags>, unsigned int, TypedArray<RDPipelineSpecializationConstant> const&>(__UnexistingClass*, RID (__UnexistingClass::*)(RID, long, long, RenderingDeviceCommons::RenderPrimitive, Ref<RDPipelineRasterizationState> const&, Ref<RDPipelineMultisampleState> const&, Ref<RDPipelineDepthStencilState> const&, Ref<RDPipelineColorBlendState> const&, BitField<RenderingDeviceCommons::PipelineDynamicStateFlags>, unsigned int, TypedArray<RDPipelineSpecializationConstant> const&), Variant const**, int, Variant&, Callable::CallError&, Vector<Variant> const&) (/home/luo/godot/core/variant/binder_common.h:546)\nMethodBindTR<RID, RID, long, long, RenderingDeviceCommons::RenderPrimitive, Ref<RDPipelineRasterizationState> const&, Ref<RDPipelineMultisampleState> const&, Ref<RDPipelineDepthStencilState> const&, Ref<RDPipelineColorBlendState> const&, BitField<RenderingDeviceCommons::PipelineDynamicStateFlags>, unsigned int, TypedArray<RDPipelineSpecializationConstant> const&>::call(Object*, Variant const**, int, Callable::CallError&) const (/home/luo/godot/core/object/method_bind.h:524)\nGDScriptFunction::call(GDScriptInstance*, Variant const**, int, Callable::CallError&, GDScriptFunction::CallState*) (/home/luo/godot/modules/gdscript/gdscript_vm.cpp:2013)\nGDScriptInstance::callp(StringName const&, Variant const**, int, Callable::CallError&) (/home/luo/godot/modules/gdscript/gdscript.cpp:2053)\nNode::_gdvirtual__ready_call() (/home/luo/godot/scene/main/node.h:391)\nNode::_notification(int) (/home/luo/godot/scene/main/node.cpp:227)\nNode::_notificationv(int, bool) (/home/luo/godot/scene/main/node.h:49)\nCanvasItem::_notificationv(int, bool) (/home/luo/godot/scene/main/canvas_item.h:44)\nNode2D::_notificationv(int, bool) (/home/luo/godot/scene/2d/node_2d.h:37)\nObject::notification(int, bool) (/home/luo/godot/core/object/object.cpp:911)\nNode::_propagate_ready() (/home/luo/godot/scene/main/node.cpp:282)\nNode::_propagate_ready() (/home/luo/godot/scene/main/node.cpp:273)\nNode::_set_tree(SceneTree*) (/home/luo/godot/scene/main/node.cpp:3289)\n```\n\n### Minimal reproduction project (MRP)\n\n[RDShaderFileCrash.zip](https://github.com/user-attachments/files/19043836/RDShaderFileCrash.zip)\n", "patch": "diff --git a/servers/rendering/rendering_device.cpp b/servers/rendering/rendering_device.cpp\nindex 9a3e4fd9d7fa..638b529676a0 100644\n--- a/servers/rendering/rendering_device.cpp\n+++ b/servers/rendering/rendering_device.cpp\n@@ -3850,6 +3850,9 @@ RID RenderingDevice::render_pipeline_create(RID p_shader, FramebufferFormatID p_\n \tERR_FAIL_NULL_V(shader, RID());\n \tERR_FAIL_COND_V_MSG(shader->is_compute, RID(), \"Compute shaders can't be used in render pipelines\");\n \n+\t// Validate pre-raster shader. One of stages must be vertex shader or mesh shader (not implemented yet).\n+\tERR_FAIL_COND_V_MSG(!shader->stage_bits.has_flag(RDD::PIPELINE_STAGE_VERTEX_SHADER_BIT), RID(), \"Pre-raster shader (vertex shader) is not provided for pipeline creation.\");\n+\n \tFramebufferFormat fb_format;\n \t{\n \t\t_THREAD_SAFE_METHOD_\n", "instance_id": "godotengine__godot-103480", "clarity": 2, "difficulty": 0.3, "clarity_explanation": "The problem statement is mostly clear in describing the issue: a crash occurs in the Godot engine when a `RDShaderFile` lacking a vertex shader is used in `RenderingDevice.render_pipeline_create`. It provides detailed system information, steps to reproduce, a call stack, and a minimal reproduction project (MRP). However, there are minor ambiguities and missing details. For instance, the problem statement does not explicitly discuss expected behavior or constraints for shader files (e.g., whether a vertex shader is mandatory by design or if this is an oversight). Additionally, while the crash is well-documented, there is no mention of specific edge cases beyond the absence of a vertex shader, nor any discussion of potential side effects of the proposed fix. Overall, the statement is valid and clear but lacks some minor details that would make it comprehensive.", "difficulty_explanation": "The difficulty of this problem falls into the \"Easy\" range (0.2-0.4). The issue is a specific bug in the Godot engine related to shader pipeline creation, and the provided code change is a simple validation check added to `rendering_device.cpp` to ensure a vertex shader is present before proceeding with pipeline creation. Let's break this down based on the evaluation factors:\n\n1. **Scope and Depth of Code Changes**: The modification is localized to a single file (`rendering_device.cpp`) and involves adding just a few lines of code for validation. It does not impact the broader system architecture or require changes across multiple modules. The change is minimal in terms of lines of code and does not involve complex refactoring.\n\n2. **Number of Technical Concepts**: Solving this requires a basic understanding of the Godot engine's rendering pipeline and shader handling, specifically the role of vertex shaders in render pipelines. The fix uses straightforward error checking with existing flags (`shader->stage_bits.has_flag`), which does not demand advanced language features, algorithms, or design patterns. Familiarity with C++ (used in Godot's core) and error handling macros (`ERR_FAIL_COND_V_MSG`) is sufficient, and these are not particularly complex concepts for an experienced developer.\n\n3. **Edge Cases and Error Handling**: The problem statement focuses on a specific scenario (missing vertex shader), and the code change addresses this directly with a simple error condition. There is no indication of additional edge cases or complex error handling requirements beyond this check. The fix prevents the crash by failing early with a descriptive message, which is a basic error handling approach.\n\n4. **Overall Complexity**: While the domain (game engine rendering) might seem complex, the actual fix is a small, targeted intervention that does not require deep architectural changes or advanced knowledge beyond understanding the rendering pipeline's basic requirements. It is a bug fix that involves adding a guard clause, which aligns with an \"Easy\" difficulty level.\n\nThus, a score of 0.30 reflects a problem that requires understanding some code logic and making a simple modification, fitting well within the easy range. It does not rise to a medium difficulty as it lacks complexity in scope, concepts, or edge case handling.", "clarity_label": 1, "difficulty_label": 1, "human_clarity": -1, "human_difficulty": -1}
{"problem_statement": "Bottom FileSystem dock does not save layout options\n### Tested versions\n\n- Reproducible in: 4.4.beta1.mono to 4.4.rc1.mono\n- Not reproducible in: 4.4.dev7.mono and earlier\n\n### System information\n\nGodot v4.4.rc1.mono - macOS Sequoia (15.3.1) - Multi-window, 1 monitor - Metal (Forward+) - integrated Apple M2 Max (Apple8) - Apple M2 Max (12 threads)\n\n### Issue description\n\nThe bottom panel FileSystem dock does not save layout options (Split Mode, View items as list/thumbnails). Reopening the editor causes these layout options to be reset.\nThis issue exists only when the FileSystem dock is placed at the bottom panel, and does not exist when it is placed in any of the 8 slots on the side.\n\n### Steps to reproduce\n\nhttps://github.com/user-attachments/assets/b135bbb2-69f4-45ee-9ada-6a11bcfeb299\n\n1. Open any project.\n2. Move the FileSystem dock to the bottom panel.\n3. In the FileSystem dock, change Split Mode to top/bottom, and set View items as a list.\n4. Close Godot and reopen the project.\n5. Notice the FileSystem dock layout gets reset.\n\n### Minimal reproduction project (MRP)\n\nN/A\n", "patch": "diff --git a/editor/editor_dock_manager.cpp b/editor/editor_dock_manager.cpp\nindex 51c15f3db911..32269f91a109 100644\n--- a/editor/editor_dock_manager.cpp\n+++ b/editor/editor_dock_manager.cpp\n@@ -547,10 +547,10 @@ void EditorDockManager::load_docks_from_config(Ref<ConfigFile> p_layout, const S\n \t\t\t\tcontinue;\n \t\t\t}\n \t\t\tControl *dock = dock_map[name];\n-\t\t\tdock->call(SNAME(\"_load_layout_from_config\"), p_layout, p_section);\n \n \t\t\tif (!all_docks[dock].enabled) {\n \t\t\t\t// Don't open disabled docks.\n+\t\t\t\tdock->call(SNAME(\"_load_layout_from_config\"), p_layout, p_section);\n \t\t\t\tcontinue;\n \t\t\t}\n \t\t\tbool at_bottom = false;\n@@ -563,6 +563,7 @@ void EditorDockManager::load_docks_from_config(Ref<ConfigFile> p_layout, const S\n \t\t\t} else if (i >= 0) {\n \t\t\t\t_move_dock(dock, dock_slot[i], 0);\n \t\t\t}\n+\t\t\tdock->call(SNAME(\"_load_layout_from_config\"), p_layout, p_section);\n \n \t\t\tif (closed_docks.has(name)) {\n \t\t\t\t_move_dock(dock, closed_dock_parent);\n", "instance_id": "godotengine__godot-103266", "clarity": 2, "difficulty": 0.35, "clarity_explanation": "The problem statement is mostly clear and provides a detailed description of the issue, including the specific versions of the software where the bug is reproducible, the system information, and the steps to reproduce the issue. The goal is evident: the FileSystem dock at the bottom panel does not save layout options, and this behavior needs to be fixed. The steps to reproduce are well-documented with a reference to a visual asset, and the issue's scope is narrowed down to a specific placement of the dock (bottom panel). However, there are minor ambiguities, such as the lack of explicit mention of expected behavior for edge cases (e.g., what should happen if the configuration file is corrupted or missing) and no detailed specification of the desired output format or constraints for the fix. Additionally, while the problem is clear, it does not provide a minimal reproduction project (MRP), which could have further clarified the context for developers unfamiliar with the codebase. Hence, I rate the clarity as \"Mostly Clear\" with a score of 2.", "difficulty_explanation": "The difficulty of this problem falls into the \"Easy\" category with a score of 0.35. Here's the breakdown based on the evaluation factors:\n\n1. **Scope and Depth of Code Changes:** The provided code changes are minimal and localized to a single file (`editor_dock_manager.cpp`). The modification involves moving a function call (`_load_layout_from_config`) to ensure it is executed regardless of whether the dock is enabled or disabled. This change does not impact the broader system architecture and is confined to a specific logic block related to loading dock configurations. The amount of code change is small, with only a few lines altered.\n\n2. **Number of Technical Concepts:** Solving this issue requires a basic understanding of the Godot engine's editor codebase, specifically how docks are managed and how configuration loading works. The developer needs to understand the purpose of the `_load_layout_from_config` method and the flow of the `load_docks_from_config` function. No advanced language features, complex algorithms, or design patterns are involved. The concepts are relatively straightforward for someone familiar with C++ and the Godot engine.\n\n3. **Potential Edge Cases and Error Handling:** The problem statement does not explicitly mention edge cases, such as invalid or missing configuration data, and the code changes do not introduce new error handling logic. However, a developer might need to consider whether calling `_load_layout_from_config` in all cases could lead to unintended side effects (e.g., loading invalid configurations for disabled docks). These edge cases are not complex and can likely be handled with minimal additional effort if needed.\n\n4. **Overall Complexity:** The fix is a simple adjustment to the order of operations in the code, requiring only a basic understanding of the existing logic. It does not involve deep architectural changes, performance optimizations, or intricate domain-specific knowledge beyond the Godot editor's dock management system. The problem is a bug fix rather than a feature implementation or refactoring, which keeps the difficulty low.\n\nGiven these factors, I assess the difficulty as 0.35, indicating an \"Easy\" problem that requires understanding some code logic and making a simple modification. It is slightly above the lowest end of the \"Easy\" range (0.2-0.4) due to the need for familiarity with the Godot codebase, which might pose a minor learning curve for someone new to the project.", "clarity_label": 1, "difficulty_label": 1, "human_clarity": -1, "human_difficulty": -1}
{"problem_statement": "[4.4 Beta 3] Embedded game window lags when changing positions and scale.\n### Tested versions\n\n- Reproductible in: v4.4.beta3.official [06acfccf8]\n\n### System information\n\nGodot v4.4.beta3 - Fedora Linux 41 (KDE Plasma) on Wayland - X11 display driver, Multi-window, 2 monitors - Vulkan (Forward+) - dedicated NVIDIA GeForce RTX 4070 (nvidia; 565.77) - AMD Ryzen 9 7900X 12-Core Processor (24 threads)\n\n### Issue description\n\nWhen embedding the game window (either on a floating workspace or on the editor \"Game\" tab) and moving the \"main\" window, the embedded window will lag behind. This did not happen in earlier versions of the engine and I don't know if it happens on Windows.\n\nBETA 2\n\nhttps://github.com/user-attachments/assets/1e1b4f09-66a6-49bb-aee1-3af18d63956d\n\n---\n\nBETA 3\n\nhttps://github.com/user-attachments/assets/c5c0705d-1ae6-49c4-82ec-fa4ead231005\n\n### Steps to reproduce\n\n- Run a project on 4.4.beta3 with `Embed game on Next Play` enabled;\n- Move / scale the main window that's holding the embedded window around.\n\n### Minimal reproduction project (MRP)\n\nNot including an MRP since this can be replicated with an empty project.\n", "patch": "diff --git a/editor/plugins/embedded_process.cpp b/editor/plugins/embedded_process.cpp\nindex 72c87bfc1c6d..17c6ede2d248 100644\n--- a/editor/plugins/embedded_process.cpp\n+++ b/editor/plugins/embedded_process.cpp\n@@ -40,6 +40,12 @@ void EmbeddedProcess::_notification(int p_what) {\n \t\tcase NOTIFICATION_ENTER_TREE: {\n \t\t\twindow = get_window();\n \t\t} break;\n+\t\tcase NOTIFICATION_PROCESS: {\n+\t\t\tif (updated_embedded_process_queued) {\n+\t\t\t\tupdated_embedded_process_queued = false;\n+\t\t\t\t_update_embedded_process();\n+\t\t\t}\n+\t\t} break;\n \t\tcase NOTIFICATION_DRAW: {\n \t\t\t_draw();\n \t\t} break;\n@@ -179,6 +185,7 @@ void EmbeddedProcess::embed_process(OS::ProcessID p_pid) {\n \tstart_embedding_time = OS::get_singleton()->get_ticks_msec();\n \tembedding_grab_focus = has_focus();\n \ttimer_update_embedded_process->start();\n+\tset_process(true);\n \tset_notify_transform(true);\n \n \t// Attempt to embed the process, but if it has just started and the window is not ready yet,\n@@ -196,6 +203,7 @@ void EmbeddedProcess::reset() {\n \tembedding_grab_focus = false;\n \ttimer_embedding->stop();\n \ttimer_update_embedded_process->stop();\n+\tset_process(false);\n \tset_notify_transform(false);\n \tqueue_redraw();\n }\n@@ -251,11 +259,6 @@ void EmbeddedProcess::_timer_update_embedded_process_timeout() {\n \t\t\tqueue_update_embedded_process();\n \t\t}\n \t}\n-\n-\tif (updated_embedded_process_queued) {\n-\t\tupdated_embedded_process_queued = false;\n-\t\t_update_embedded_process();\n-\t}\n }\n \n void EmbeddedProcess::_update_embedded_process() {\n", "instance_id": "godotengine__godot-102618", "clarity": 2, "difficulty": 0.45, "clarity_explanation": "The problem statement is mostly clear in describing the issue: the embedded game window lags when the main window is moved or scaled in Godot v4.4.beta3, which is a regression from earlier versions. It provides specific version details, system information, steps to reproduce, and visual evidence through linked assets. However, there are minor ambiguities and missing details. For instance, it does not explicitly state the expected behavior (though it can be inferred as \"no lag\"), and it lacks information on whether this issue occurs across all platforms or is specific to certain configurations (e.g., Wayland on Linux). Additionally, edge cases or specific conditions under which the lag is more pronounced are not mentioned. Overall, the problem is understandable and reproducible, but it could benefit from more precise expectations and constraints.", "difficulty_explanation": "The difficulty of this problem falls in the medium range due to several factors. First, the scope of code changes is relatively localized to a single file (`embedded_process.cpp`) and involves modifications to the event handling and process update logic in the Godot engine. The changes include moving the update logic from a timer-based approach to a per-frame process notification, which requires understanding the engine's notification system and how embedded windows are managed. This indicates a moderate level of complexity in terms of codebase interaction.\n\nSecond, the technical concepts involved include familiarity with Godot's internal architecture (specifically, its notification and rendering systems), C++ programming, and potentially platform-specific windowing behaviors (e.g., Wayland on Linux). While these concepts are not extremely advanced, they do require a solid understanding of game engine internals, which may not be trivial for someone unfamiliar with Godot's codebase.\n\nThird, the amount of code change is small (a few lines added or moved), and it does not appear to impact the broader system architecture significantly. However, the change could have subtle implications on performance or synchronization between the main and embedded windows, which adds a layer of complexity.\n\nFinally, while the problem statement does not explicitly mention edge cases, the nature of the issue (lag in window positioning/scaling) suggests potential challenges in handling different window states, user interactions, or platform-specific quirks. Error handling does not seem to be a major focus of the provided code changes, but ensuring the update logic does not introduce new issues (e.g., excessive redraws or missed updates) requires careful consideration.\n\nOverall, I rate this as a medium difficulty problem (0.45) because it requires a moderate understanding of the Godot engine's internals and careful handling of update logic, but it does not involve extensive refactoring, complex algorithms, or deep system-level changes.", "clarity_label": 1, "difficulty_label": 1, "human_clarity": -1, "human_difficulty": -1}
{"problem_statement": "[4.4.dev7] The `Default Environment` setting is reset after the \"cold\" project loading (`res://` | `uid://` issue)\n### Tested versions\n\n- reproducible in 4.4.dev7 (maybe 4.4.x)\n- not reproducible: 4.3.stable\n\n### System information\n\nGodot v4.4.dev7 - Windows 11 (build 26100) - Multi-window, 1 monitor - Vulkan (Forward+) - dedicated NVIDIA GeForce RTX 3060 Ti (NVIDIA; 32.0.15.6636) - 12th Gen Intel(R) Core(TM) i5-12400 (12 threads)\n\n### Issue description\n\nThe default environment setting (`rendering/environment/defaults/default_environment`) is reset after the **\"cold\"** project loading (deleting the `.godot` folder and loading project for the first time). However, it stays on place if it was saved as `res://...` path, not as `uid://...` value. Seems like `uid` related bug.\n\n### Steps to reproduce\n\nSteps for 4.4.dev7: \n- create new project;\n- create an `Environment` asset;\n- set it as default in `Project Settings`;\n- close the project;\n- delete the `.godot` folder;\n- open the project.\n\nNot reproduced with 4.3 -> 4.4 migration because its value will still be saved as `res://`, not `uid://`.\n\n### Minimal reproduction project (MRP)\n\n[test.zip](https://github.com/user-attachments/files/18270863/test.zip)\n\n", "patch": "diff --git a/core/io/resource_uid.cpp b/core/io/resource_uid.cpp\nindex 8a8c86087d45..a73adf9d7478 100644\n--- a/core/io/resource_uid.cpp\n+++ b/core/io/resource_uid.cpp\n@@ -154,6 +154,19 @@ String ResourceUID::get_id_path(ID p_id) const {\n \tERR_FAIL_COND_V_MSG(p_id == INVALID_ID, String(), \"Invalid UID.\");\n \tMutexLock l(mutex);\n \tconst ResourceUID::Cache *cache = unique_ids.getptr(p_id);\n+\n+#if TOOLS_ENABLED\n+\t// On startup, the scan_for_uid_on_startup callback should be set and will\n+\t// execute EditorFileSystem::scan_for_uid, which scans all project files\n+\t// to reload the UID cache before the first scan.\n+\t// Note: EditorFileSystem::scan_for_uid sets scan_for_uid_on_startup to nullptr\n+\t//       once the first scan_for_uid is complete.\n+\tif (!cache && scan_for_uid_on_startup) {\n+\t\tscan_for_uid_on_startup();\n+\t\tcache = unique_ids.getptr(p_id);\n+\t}\n+#endif\n+\n \tERR_FAIL_COND_V_MSG(!cache, String(), vformat(\"Unrecognized UID: \\\"%s\\\".\", id_to_text(p_id)));\n \tconst CharString &cs = cache->cs;\n \treturn String::utf8(cs.ptr());\ndiff --git a/core/io/resource_uid.h b/core/io/resource_uid.h\nindex 6d96953fcc1d..2912168dcb4b 100644\n--- a/core/io/resource_uid.h\n+++ b/core/io/resource_uid.h\n@@ -37,6 +37,8 @@\n \n class FileAccess;\n \n+typedef void (*ResourceUIDScanForUIDOnStartup)();\n+\n class ResourceUID : public Object {\n \tGDCLASS(ResourceUID, Object)\n public:\n@@ -63,6 +65,8 @@ class ResourceUID : public Object {\n \tstatic void _bind_methods();\n \n public:\n+\tinline static ResourceUIDScanForUIDOnStartup scan_for_uid_on_startup = nullptr;\n+\n \tString id_to_text(ID p_id) const;\n \tID text_to_id(const String &p_text) const;\n \ndiff --git a/editor/editor_file_system.cpp b/editor/editor_file_system.cpp\nindex 2d10e4305eaa..4c5663c3b99f 100644\n--- a/editor/editor_file_system.cpp\n+++ b/editor/editor_file_system.cpp\n@@ -48,6 +48,9 @@\n #include \"scene/resources/packed_scene.h\"\n \n EditorFileSystem *EditorFileSystem::singleton = nullptr;\n+int EditorFileSystem::nb_files_total = 0;\n+EditorFileSystem::ScannedDirectory *EditorFileSystem::first_scan_root_dir = nullptr;\n+\n //the name is the version, to keep compatibility with different versions of Godot\n #define CACHE_FILE_NAME \"filesystem_cache10\"\n \n@@ -237,16 +240,72 @@ EditorFileSystem::ScannedDirectory::~ScannedDirectory() {\n \t}\n }\n \n-void EditorFileSystem::_first_scan_filesystem() {\n-\tEditorProgress ep = EditorProgress(\"first_scan_filesystem\", TTR(\"Project initialization\"), 5);\n+void EditorFileSystem::_load_first_scan_root_dir() {\n \tRef<DirAccess> d = DirAccess::create(DirAccess::ACCESS_RESOURCES);\n \tfirst_scan_root_dir = memnew(ScannedDirectory);\n \tfirst_scan_root_dir->full_path = \"res://\";\n+\n+\tnb_files_total = _scan_new_dir(first_scan_root_dir, d);\n+}\n+\n+void EditorFileSystem::scan_for_uid() {\n+\t// Load file structure into memory.\n+\t_load_first_scan_root_dir();\n+\n+\t// Load extensions for which an .import should exists.\n+\tList<String> extensionsl;\n+\tHashSet<String> import_extensions;\n+\tResourceFormatImporter::get_singleton()->get_recognized_extensions(&extensionsl);\n+\tfor (const String &E : extensionsl) {\n+\t\timport_extensions.insert(E);\n+\t}\n+\n+\t// Scan the file system to load uid.\n+\t_scan_for_uid_directory(first_scan_root_dir, import_extensions);\n+\n+\t// It's done, resetting the callback method to prevent a second scan.\n+\tResourceUID::scan_for_uid_on_startup = nullptr;\n+}\n+\n+void EditorFileSystem::_scan_for_uid_directory(const ScannedDirectory *p_scan_dir, const HashSet<String> &p_import_extensions) {\n+\tfor (ScannedDirectory *scan_sub_dir : p_scan_dir->subdirs) {\n+\t\t_scan_for_uid_directory(scan_sub_dir, p_import_extensions);\n+\t}\n+\n+\tfor (const String &scan_file : p_scan_dir->files) {\n+\t\tconst String ext = scan_file.get_extension().to_lower();\n+\n+\t\tif (ext == \"uid\" || ext == \"import\") {\n+\t\t\tcontinue;\n+\t\t}\n+\n+\t\tconst String path = p_scan_dir->full_path.path_join(scan_file);\n+\t\tResourceUID::ID uid = ResourceUID::INVALID_ID;\n+\t\tif (p_import_extensions.has(ext)) {\n+\t\t\tif (FileAccess::exists(path + \".import\")) {\n+\t\t\t\tuid = ResourceFormatImporter::get_singleton()->get_resource_uid(path);\n+\t\t\t}\n+\t\t} else {\n+\t\t\tuid = ResourceLoader::get_resource_uid(path);\n+\t\t}\n+\n+\t\tif (uid != ResourceUID::INVALID_ID) {\n+\t\t\tif (!ResourceUID::get_singleton()->has_id(uid)) {\n+\t\t\t\tResourceUID::get_singleton()->add_id(uid, path);\n+\t\t\t}\n+\t\t}\n+\t}\n+}\n+\n+void EditorFileSystem::_first_scan_filesystem() {\n+\tEditorProgress ep = EditorProgress(\"first_scan_filesystem\", TTR(\"Project initialization\"), 5);\n \tHashSet<String> existing_class_names;\n \tHashSet<String> extensions;\n \n-\tep.step(TTR(\"Scanning file structure...\"), 0, true);\n-\tnb_files_total = _scan_new_dir(first_scan_root_dir, d);\n+\tif (!first_scan_root_dir) {\n+\t\tep.step(TTR(\"Scanning file structure...\"), 0, true);\n+\t\t_load_first_scan_root_dir();\n+\t}\n \n \t// Preloading GDExtensions file extensions to prevent looping on all the resource loaders\n \t// for each files in _first_scan_process_scripts.\n@@ -440,6 +499,7 @@ void EditorFileSystem::_scan_filesystem() {\n \t\tsd = first_scan_root_dir;\n \t\t// Will be updated on scan.\n \t\tResourceUID::get_singleton()->clear();\n+\t\tResourceUID::scan_for_uid_on_startup = nullptr;\n \t\tprocessed_files = memnew(HashSet<String>());\n \t} else {\n \t\tRef<DirAccess> d = DirAccess::create(DirAccess::ACCESS_RESOURCES);\ndiff --git a/editor/editor_file_system.h b/editor/editor_file_system.h\nindex 5b78b86a3f3f..4f9302e045f8 100644\n--- a/editor/editor_file_system.h\n+++ b/editor/editor_file_system.h\n@@ -182,7 +182,7 @@ class EditorFileSystem : public Node {\n \tstatic void _thread_func(void *_userdata);\n \n \tEditorFileSystemDirectory *new_filesystem = nullptr;\n-\tScannedDirectory *first_scan_root_dir = nullptr;\n+\tstatic ScannedDirectory *first_scan_root_dir;\n \n \tbool filesystem_changed_queued = false;\n \tbool scanning = false;\n@@ -192,13 +192,17 @@ class EditorFileSystem : public Node {\n \tfloat scan_total;\n \tString filesystem_settings_version_for_import;\n \tbool revalidate_import_files = false;\n-\tint nb_files_total = 0;\n+\tstatic int nb_files_total;\n \n \tvoid _notify_filesystem_changed();\n \tvoid _scan_filesystem();\n \tvoid _first_scan_filesystem();\n \tvoid _first_scan_process_scripts(const ScannedDirectory *p_scan_dir, List<String> &p_gdextension_extensions, HashSet<String> &p_existing_class_names, HashSet<String> &p_extensions);\n \n+\tstatic void _scan_for_uid_directory(const ScannedDirectory *p_scan_dir, const HashSet<String> &p_import_extensions);\n+\n+\tstatic void _load_first_scan_root_dir();\n+\n \tHashSet<String> late_update_files;\n \n \tvoid _save_late_updated_files();\n@@ -255,7 +259,7 @@ class EditorFileSystem : public Node {\n \tHashSet<String> valid_extensions;\n \tHashSet<String> import_extensions;\n \n-\tint _scan_new_dir(ScannedDirectory *p_dir, Ref<DirAccess> &da);\n+\tstatic int _scan_new_dir(ScannedDirectory *p_dir, Ref<DirAccess> &da);\n \tvoid _process_file_system(const ScannedDirectory *p_scan_dir, EditorFileSystemDirectory *p_dir, ScanProgress &p_progress, HashSet<String> *p_processed_files);\n \n \tThread thread_sources;\n@@ -412,6 +416,8 @@ class EditorFileSystem : public Node {\n \n \tstatic bool _should_skip_directory(const String &p_path);\n \n+\tstatic void scan_for_uid();\n+\n \tvoid add_import_format_support_query(Ref<EditorFileSystemImportFormatSupportQuery> p_query);\n \tvoid remove_import_format_support_query(Ref<EditorFileSystemImportFormatSupportQuery> p_query);\n \tEditorFileSystem();\ndiff --git a/main/main.cpp b/main/main.cpp\nindex c65e6ba8acb4..6cd9c89fa8b7 100644\n--- a/main/main.cpp\n+++ b/main/main.cpp\n@@ -3444,6 +3444,17 @@ Error Main::setup2(bool p_show_boot_logo) {\n \t// This loads global classes, so it must happen before custom loaders and savers are registered\n \tScriptServer::init_languages();\n \n+#if TOOLS_ENABLED\n+\n+\t// Setting up the callback to execute a scan for UIDs on disk when a UID\n+\t// does not exist in the UID cache on startup. This prevents invalid UID errors\n+\t// when opening a project without a UID cache file or with an invalid cache.\n+\tif (editor) {\n+\t\tResourceUID::scan_for_uid_on_startup = EditorFileSystem::scan_for_uid;\n+\t}\n+\n+#endif\n+\n \ttheme_db->initialize_theme();\n \taudio_server->load_default_bus_layout();\n \n@@ -3496,9 +3507,21 @@ void Main::setup_boot_logo() {\n \n \tif (show_logo) { //boot logo!\n \t\tconst bool boot_logo_image = GLOBAL_DEF_BASIC(\"application/boot_splash/show_image\", true);\n-\t\tconst String boot_logo_path = ResourceUID::ensure_path(GLOBAL_DEF_BASIC(PropertyInfo(Variant::STRING, \"application/boot_splash/image\", PROPERTY_HINT_FILE, \"*.png\"), String())).strip_edges();\n \t\tconst bool boot_logo_scale = GLOBAL_DEF_BASIC(\"application/boot_splash/fullsize\", true);\n \t\tconst bool boot_logo_filter = GLOBAL_DEF_BASIC(\"application/boot_splash/use_filter\", true);\n+\t\tString boot_logo_path = GLOBAL_DEF_BASIC(PropertyInfo(Variant::STRING, \"application/boot_splash/image\", PROPERTY_HINT_FILE, \"*.png\"), String());\n+\n+\t\t// If the UID cache is missing or invalid, it could be 'normal' for the UID to not exist in memory.\n+\t\t// It's too soon to scan the project files since the ResourceFormatImporter is not loaded yet,\n+\t\t// so to prevent printing errors, we will just skip the custom boot logo this time.\n+\t\tif (boot_logo_path.begins_with(\"uid://\")) {\n+\t\t\tconst ResourceUID::ID logo_id = ResourceUID::get_singleton()->text_to_id(boot_logo_path);\n+\t\t\tif (ResourceUID::get_singleton()->has_id(logo_id)) {\n+\t\t\t\tboot_logo_path = ResourceUID::get_singleton()->get_id_path(logo_id).strip_edges();\n+\t\t\t} else {\n+\t\t\t\tboot_logo_path = String();\n+\t\t\t}\n+\t\t}\n \n \t\tRef<Image> boot_logo;\n \n@@ -4215,7 +4238,7 @@ int Main::start() {\n \n #ifdef TOOLS_ENABLED\n \t\t\tif (editor) {\n-\t\t\t\tif (!recovery_mode && (game_path != String(GLOBAL_GET(\"application/run/main_scene\")) || !editor_node->has_scenes_in_session())) {\n+\t\t\t\tif (!recovery_mode && (game_path != ResourceUID::ensure_path(String(GLOBAL_GET(\"application/run/main_scene\"))) || !editor_node->has_scenes_in_session())) {\n \t\t\t\t\tError serr = editor_node->load_scene(local_game_path);\n \t\t\t\t\tif (serr != OK) {\n \t\t\t\t\t\tERR_PRINT(\"Failed to load scene\");\n", "instance_id": "godotengine__godot-102513", "clarity": 2, "difficulty": 0.75, "clarity_explanation": "\nThe problem statement is mostly clear in describing the issue: the default environment setting in Godot 4.4.dev7 is reset after a \"cold\" project loading due to a UID-related bug. It provides specific steps to reproduce the issue, mentions the affected versions, and includes system information and a minimal reproduction project. However, there are minor ambiguities and missing details. For instance, the problem statement does not explicitly define what a \"cold\" project loading entails beyond deleting the `.godot` folder, nor does it clarify the expected behavior of the default environment setting after such a load. Additionally, while the issue is linked to `uid://` versus `res://` paths, there is no detailed explanation of why or how this distinction causes the reset. Edge cases or specific constraints related to different project configurations or environments are also not mentioned. Overall, the statement is valid and clear enough to understand the core issue, but it lacks some depth in technical context and edge case specification.\n", "difficulty_explanation": "\nI rate the difficulty of this problem as 0.75, placing it in the \"Hard\" category due to several factors:\n\n1. **Clarity and Complexity of the Problem Description**: While the issue is mostly clear, solving it requires inferring the root cause of the UID-related bug, which is not fully detailed in the problem statement. Understanding why `uid://` paths fail during a cold load compared to `res://` paths involves non-trivial investigation into Godot's resource loading and UID caching mechanisms.\n\n2. **Scope and Depth of Code Changes**: The provided code changes span multiple files (`resource_uid.cpp`, `resource_uid.h`, `editor_file_system.cpp`, `editor_file_system.h`, `main.cpp`) and involve significant modifications to the resource UID handling and editor file system scanning logic. The changes impact core components of the Godot engine, such as how resources are identified and loaded at startup. This requires a deep understanding of the interactions between the editor, file system, and resource management systems. The amount of code changed is moderate but affects critical paths, increasing the risk of introducing new bugs or performance issues.\n\n3. **Number of Technical Concepts**: Solving this problem demands familiarity with several advanced concepts in the Godot engine, including:\n   - Resource UID management and caching.\n   - Editor file system initialization and scanning.\n   - Resource loading and path resolution mechanisms (`uid://` vs `res://`).\n   - Thread safety (mutex usage in `resource_uid.cpp`).\n   - Build-time conditional compilation (`TOOLS_ENABLED`).\n   Additionally, the solution involves understanding C++ language features like static members, function pointers, and memory management, as well as domain-specific knowledge of game engine architecture. These concepts are moderately to highly complex for someone not already familiar with Godot's internals.\n\n4. **Potential Edge Cases and Error Handling**: The problem statement does not explicitly mention edge cases, but the code changes reveal several implicit considerations, such as handling missing or invalid UID caches, ensuring proper initialization during startup, and avoiding errors when resource paths cannot be resolved. The solution introduces logic to scan for UIDs on startup if a cache miss occurs, which could lead to performance concerns or race conditions if not handled carefully. Error handling is modified (e.g., skipping custom boot logos if UID resolution fails), indicating a need to anticipate and mitigate potential failures in resource loading.\n\nOverall, this problem requires a deep understanding of Godot's codebase architecture, particularly in resource management and editor initialization. The changes have a significant impact on how projects are loaded and could affect stability if not thoroughly tested. While not at the extreme end of difficulty (e.g., implementing a new system from scratch), it demands substantial expertise and careful consideration of side effects, justifying a score of 0.75.\n", "clarity_label": 1, "difficulty_label": 1, "human_clarity": -1, "human_difficulty": -1}
{"problem_statement": "Embed Game focus over modal popups\n### Tested versions\n\n- Reproductible in 4.4 beta 2 and master\n\n### System information\n\nGodot v4.4.beta2 - Windows 11 (build 26100) - Multi-window, 1 monitor - Vulkan (Forward+) - dedicated NVIDIA GeForce RTX 3060 (NVIDIA; 32.0.15.6636) - 11th Gen Intel(R) Core(TM) i5-11600KF @ 3.90GHz (12 threads)\n\n### Issue description\n\nThe embedding is enabled in the editor and the game is running. If a modal popup is visible and the use click on the game window, the game window appears in front of the modal popup. If this popup is small enough, it disappears and the editor is not available (ex: stop button).\n\nhttps://github.com/user-attachments/assets/9ce74cc1-e7f0-44e8-87b8-fc60c69519e5\n\n\n\n### Steps to reproduce\n\n- Enable Embed Game and disable Make Floating\n- Run the game\n- While inside the Game tab, display a modal popup (ex: Settings, Create node, etc...)\n- Click the game window\n\n### Minimal reproduction project (MRP)\n\nn/a\n", "patch": "diff --git a/editor/plugins/embedded_process.cpp b/editor/plugins/embedded_process.cpp\nindex 1638c437125d..a348607a6e94 100644\n--- a/editor/plugins/embedded_process.cpp\n+++ b/editor/plugins/embedded_process.cpp\n@@ -67,20 +67,10 @@ void EmbeddedProcess::_notification(int p_what) {\n \t\t} break;\n \t\tcase NOTIFICATION_APPLICATION_FOCUS_IN: {\n \t\t\tapplication_has_focus = true;\n-\t\t\tif (embedded_process_was_focused) {\n-\t\t\t\tembedded_process_was_focused = false;\n-\t\t\t\t// Refocus the embedded process if it was focused when the application lost focus,\n-\t\t\t\t// but do not refocus if the embedded process is currently focused (indicating it just lost focus)\n-\t\t\t\t// or if the current window is a different popup or secondary window.\n-\t\t\t\tif (embedding_completed && current_process_id != focused_process_id && window && window->has_focus()) {\n-\t\t\t\t\tgrab_focus();\n-\t\t\t\t\tqueue_update_embedded_process();\n-\t\t\t\t}\n-\t\t\t}\n+\t\t\tlast_application_focus_time = OS::get_singleton()->get_ticks_msec();\n \t\t} break;\n \t\tcase NOTIFICATION_APPLICATION_FOCUS_OUT: {\n \t\t\tapplication_has_focus = false;\n-\t\t\tembedded_process_was_focused = embedding_completed && current_process_id == focused_process_id;\n \t\t} break;\n \t}\n }\n@@ -286,14 +276,27 @@ void EmbeddedProcess::_check_mouse_over() {\n \t// This method checks if the mouse is over the embedded process while the current application is focused.\n \t// The goal is to give focus to the embedded process as soon as the mouse hovers over it,\n \t// allowing the user to interact with it immediately without needing to click first.\n-\tif (!is_visible_in_tree() || !embedding_completed || !application_has_focus || !window || !window->has_focus() || Input::get_singleton()->is_mouse_button_pressed(MouseButton::LEFT) || Input::get_singleton()->is_mouse_button_pressed(MouseButton::RIGHT)) {\n+\tif (!embedding_completed || !application_has_focus || !window || has_focus() || !is_visible_in_tree() || !window->has_focus() || Input::get_singleton()->is_mouse_button_pressed(MouseButton::LEFT) || Input::get_singleton()->is_mouse_button_pressed(MouseButton::RIGHT)) {\n+\t\treturn;\n+\t}\n+\n+\t// Before checking whether the mouse is truly inside the embedded process, ensure\n+\t// the editor has enough time to re-render. When a breakpoint is hit in the script editor,\n+\t// `_check_mouse_over` may be triggered before the editor hides the game workspace.\n+\t// This prevents the embedded process from regaining focus immediately after the editor has taken it.\n+\tif (OS::get_singleton()->get_ticks_msec() - last_application_focus_time < 500) {\n \t\treturn;\n \t}\n \n-\tbool focused = has_focus();\n+\t// Input::is_mouse_button_pressed is not sufficient to detect the mouse button state\n+\t// while the floating game window is being resized.\n+\tBitField<MouseButtonMask> mouse_button_mask = DisplayServer::get_singleton()->mouse_get_button_state();\n+\tif (!mouse_button_mask.is_empty()) {\n+\t\treturn;\n+\t}\n \n \t// Not stealing focus from a textfield.\n-\tif (!focused && get_viewport()->gui_get_focus_owner() && get_viewport()->gui_get_focus_owner()->is_text_field()) {\n+\tif (get_viewport()->gui_get_focus_owner() && get_viewport()->gui_get_focus_owner()->is_text_field()) {\n \t\treturn;\n \t}\n \n@@ -309,14 +312,17 @@ void EmbeddedProcess::_check_mouse_over() {\n \t\treturn;\n \t}\n \n-\t// When we already have the focus and the user moves the mouse over the embedded process,\n-\t// we just need to refocus the process.\n-\tif (focused) {\n-\t\tqueue_update_embedded_process();\n-\t} else {\n-\t\tgrab_focus();\n-\t\tqueue_redraw();\n+\t// When there's a modal window, we don't want to grab the focus to prevent\n+\t// the game window to go in front of the modal window.\n+\tif (_get_current_modal_window()) {\n+\t\treturn;\n \t}\n+\n+\t// Force \"regrabbing\" the game window focus.\n+\tlast_updated_embedded_process_focused = false;\n+\n+\tgrab_focus();\n+\tqueue_redraw();\n }\n \n void EmbeddedProcess::_check_focused_process_id() {\n@@ -325,17 +331,48 @@ void EmbeddedProcess::_check_focused_process_id() {\n \t\tfocused_process_id = process_id;\n \t\tif (focused_process_id == current_process_id) {\n \t\t\t// The embedded process got the focus.\n-\t\t\temit_signal(SNAME(\"embedded_process_focused\"));\n-\t\t\tif (has_focus()) {\n-\t\t\t\t// Redraw to updated the focus style.\n-\t\t\t\tqueue_redraw();\n-\t\t\t} else {\n-\t\t\t\tgrab_focus();\n+\n+\t\t\t// Refocus the current model when focusing the embedded process.\n+\t\t\tWindow *modal_window = _get_current_modal_window();\n+\t\t\tif (!modal_window) {\n+\t\t\t\temit_signal(SNAME(\"embedded_process_focused\"));\n+\t\t\t\tif (has_focus()) {\n+\t\t\t\t\t// Redraw to updated the focus style.\n+\t\t\t\t\tqueue_redraw();\n+\t\t\t\t} else {\n+\t\t\t\t\tgrab_focus();\n+\t\t\t\t}\n \t\t\t}\n \t\t} else if (has_focus()) {\n \t\t\trelease_focus();\n \t\t}\n \t}\n+\n+\t// Ensure that the opened modal dialog is refocused when the focused process is the embedded process.\n+\tif (!application_has_focus && focused_process_id == current_process_id) {\n+\t\tWindow *modal_window = _get_current_modal_window();\n+\t\tif (modal_window) {\n+\t\t\tif (modal_window->get_mode() == Window::MODE_MINIMIZED) {\n+\t\t\t\tmodal_window->set_mode(Window::MODE_WINDOWED);\n+\t\t\t}\n+\t\t\tcallable_mp(modal_window, &Window::grab_focus).call_deferred();\n+\t\t}\n+\t}\n+}\n+\n+Window *EmbeddedProcess::_get_current_modal_window() {\n+\tVector<DisplayServer::WindowID> wl = DisplayServer::get_singleton()->get_window_list();\n+\tfor (const DisplayServer::WindowID &window_id : wl) {\n+\t\tWindow *w = Window::get_from_id(window_id);\n+\t\tif (!w) {\n+\t\t\tcontinue;\n+\t\t}\n+\n+\t\tif (w->is_exclusive()) {\n+\t\t\treturn w;\n+\t\t}\n+\t}\n+\treturn nullptr;\n }\n \n void EmbeddedProcess::_bind_methods() {\ndiff --git a/editor/plugins/embedded_process.h b/editor/plugins/embedded_process.h\nindex 3e800923a75d..6f56f255e618 100644\n--- a/editor/plugins/embedded_process.h\n+++ b/editor/plugins/embedded_process.h\n@@ -37,7 +37,7 @@ class EmbeddedProcess : public Control {\n \tGDCLASS(EmbeddedProcess, Control);\n \n \tbool application_has_focus = true;\n-\tbool embedded_process_was_focused = false;\n+\tuint64_t last_application_focus_time = 0;\n \tOS::ProcessID focused_process_id = 0;\n \tOS::ProcessID current_process_id = 0;\n \tbool embedding_grab_focus = false;\n@@ -68,6 +68,7 @@ class EmbeddedProcess : public Control {\n \tvoid _check_focused_process_id();\n \tbool _is_embedded_process_updatable();\n \tRect2i _get_global_embedded_window_rect();\n+\tWindow *_get_current_modal_window();\n \n protected:\n \tstatic void _bind_methods();\ndiff --git a/platform/windows/display_server_windows.cpp b/platform/windows/display_server_windows.cpp\nindex d0ddac4b7f9e..1a407bdd4b2f 100644\n--- a/platform/windows/display_server_windows.cpp\n+++ b/platform/windows/display_server_windows.cpp\n@@ -2986,7 +2986,8 @@ Error DisplayServerWindows::embed_process(WindowID p_window, OS::ProcessID p_pid\n \t// (e.g., a screen to the left of the main screen).\n \tconst Rect2i adjusted_rect = Rect2i(p_rect.position + _get_screens_origin(), p_rect.size);\n \n-\tSetWindowPos(ep->window_handle, nullptr, adjusted_rect.position.x, adjusted_rect.position.y, adjusted_rect.size.x, adjusted_rect.size.y, SWP_NOZORDER | SWP_NOACTIVATE | SWP_ASYNCWINDOWPOS);\n+\t// Use HWND_BOTTOM to prevent reordering of the embedded window over another popup.\n+\tSetWindowPos(ep->window_handle, HWND_BOTTOM, adjusted_rect.position.x, adjusted_rect.position.y, adjusted_rect.size.x, adjusted_rect.size.y, SWP_NOZORDER | SWP_NOACTIVATE | SWP_ASYNCWINDOWPOS);\n \n \tif (ep->is_visible != p_visible) {\n \t\tif (p_visible) {\n", "instance_id": "godotengine__godot-102247", "clarity": 2, "difficulty": 0.65, "clarity_explanation": "The problem statement is mostly clear in describing the issue: when a modal popup is visible in the Godot editor and the user clicks on the embedded game window, the game window appears in front of the modal popup, potentially obscuring it or making the editor inaccessible. The steps to reproduce are provided, along with system information and a visual reference (though not accessible in text). However, there are minor ambiguities and missing details. For instance, the expected behavior is implied (modal popups should remain in front) but not explicitly stated. Additionally, edge cases such as specific types of modal popups, multi-monitor setups, or interactions with other editor features are not mentioned. While the issue is reproducible and the goal is inferable, a more comprehensive statement would include explicit desired outcomes and potential constraints or edge cases to consider.", "difficulty_explanation": "The difficulty of this problem falls into the \"Hard\" category due to several factors. First, the scope of code changes spans multiple files (`embedded_process.cpp`, `embedded_process.h`, and `display_server_windows.cpp`), indicating a need to understand interactions between different components of the Godot editor's codebase. The changes involve significant logic modifications, such as handling focus management, detecting modal windows, and adjusting window z-ordering with system-level calls (e.g., `SetWindowPos` with `HWND_BOTTOM`). Second, the number of technical concepts involved is substantial, including understanding Godot's windowing system, focus handling, modal dialog behavior, and platform-specific APIs (Windows API for window management). Third, the problem requires addressing edge cases like ensuring the editor has time to re-render before focus changes, handling mouse button states during window resizing, and managing minimized modal windows. Finally, the changes impact critical user interaction flows in the editor, requiring careful consideration to avoid introducing new bugs or regressions. While not at the extreme end of difficulty (e.g., requiring system-level redesign or advanced domain knowledge beyond UI handling), this problem demands a deep understanding of the codebase and careful implementation, justifying a score of 0.65.", "clarity_label": 1, "difficulty_label": 1, "human_clarity": -1, "human_difficulty": -1}
{"problem_statement": "Follow Focus not working as expected in a rotated `ScrollContainer`\n### Tested versions\nBad: v4.0.stable.official [92bee43ad], master\n\n### System information\n\nGodot v4.4.dev (e19746352) - Linux Mint 22 (Wilma) on X11 - X11 display driver, Multi-window, 1 monitor - Vulkan (Forward+) - dedicated NVIDIA GeForce GTX 1050 Ti (nvidia; 535.183.01) - Intel(R) Core(TM) i5-7300HQ CPU @ 2.50GHz (4 threads)\n\n### Issue description\n\nhttps://github.com/user-attachments/assets/443244ff-871d-42f7-b653-a80cc0ff159d\n\nNavigating down in a rotating `ScrollContainer` with follow focus enabled, the focused control is not fully visible. Note the StyleBox border.\n\n### Steps to reproduce\n\n1. Import and run the MRP;\n2. Select any node inside the `ScrollContainer` and navigate using `Tab`/`Shift + Tab`.\n3. Navigate down to reproduce the issue.\n\n### Minimal reproduction project (MRP)\n\n[MRP.zip](https://github.com/user-attachments/files/18432280/MRP.zip)\n", "patch": "diff --git a/scene/gui/scroll_container.cpp b/scene/gui/scroll_container.cpp\nindex f3c50c626c17..3bad76baada4 100644\n--- a/scene/gui/scroll_container.cpp\n+++ b/scene/gui/scroll_container.cpp\n@@ -292,16 +292,20 @@ void ScrollContainer::_gui_focus_changed(Control *p_control) {\n void ScrollContainer::ensure_control_visible(Control *p_control) {\n \tERR_FAIL_COND_MSG(!is_ancestor_of(p_control), \"Must be an ancestor of the control.\");\n \n-\tRect2 global_rect = get_global_rect();\n-\tRect2 other_rect = p_control->get_global_rect();\n+\t// Just eliminate the rotation of this ScrollContainer.\n+\tTransform2D other_in_this = get_global_transform().affine_inverse() * p_control->get_global_transform();\n+\n+\tSize2 size = get_size();\n+\tRect2 other_rect = other_in_this.xform(Rect2(Point2(), p_control->get_size()));\n+\n \tfloat side_margin = v_scroll->is_visible() ? v_scroll->get_size().x : 0.0f;\n \tfloat bottom_margin = h_scroll->is_visible() ? h_scroll->get_size().y : 0.0f;\n \n-\tVector2 diff = Vector2(MAX(MIN(other_rect.position.x - (is_layout_rtl() ? side_margin : 0.0f), global_rect.position.x), other_rect.position.x + other_rect.size.x - global_rect.size.x + (!is_layout_rtl() ? side_margin : 0.0f)),\n-\t\t\tMAX(MIN(other_rect.position.y, global_rect.position.y), other_rect.position.y + other_rect.size.y - global_rect.size.y + bottom_margin));\n+\tVector2 diff = Vector2(MAX(MIN(other_rect.position.x - (is_layout_rtl() ? side_margin : 0.0f), 0.0f), other_rect.position.x + other_rect.size.x - size.x + (!is_layout_rtl() ? side_margin : 0.0f)),\n+\t\t\tMAX(MIN(other_rect.position.y, 0.0f), other_rect.position.y + other_rect.size.y - size.y + bottom_margin));\n \n-\tset_h_scroll(get_h_scroll() + (diff.x - global_rect.position.x));\n-\tset_v_scroll(get_v_scroll() + (diff.y - global_rect.position.y));\n+\tset_h_scroll(get_h_scroll() + diff.x);\n+\tset_v_scroll(get_v_scroll() + diff.y);\n }\n \n void ScrollContainer::_reposition_children() {\n", "instance_id": "godotengine__godot-101625", "clarity": 2, "difficulty": 0.55, "clarity_explanation": "The problem statement is mostly clear in describing the issue: the \"Follow Focus\" feature in a rotated `ScrollContainer` does not work as expected, resulting in the focused control not being fully visible. It provides context with tested versions, system information, steps to reproduce, and a minimal reproduction project (MRP). However, there are minor ambiguities and missing details. For instance, the problem statement does not explicitly define what \"fully visible\" means in the context of a rotated container (e.g., whether it accounts for rotation-induced clipping or specific alignment). Additionally, it lacks explicit mention of expected behavior or constraints for edge cases like extreme rotations or nested containers. While the issue is reproducible with the provided steps and MRP, these minor gaps prevent it from being comprehensive.", "difficulty_explanation": "The difficulty of this problem falls in the medium range due to several factors. First, the scope of code changes is relatively focused, confined to a single function (`ensure_control_visible`) in a single file (`scroll_container.cpp`) within the Godot engine codebase. The changes involve modifying the logic for calculating scroll positions to account for rotation by using a transformation matrix (`affine_inverse`) to adjust coordinates, which requires understanding 2D transformations and the Godot rendering system. This introduces a moderate level of complexity, as it involves specific technical concepts like affine transformations and coordinate systems in a GUI context. Additionally, the problem requires understanding how `ScrollContainer` interacts with its children and scroll bars, though it does not appear to impact broader system architecture. Edge cases, such as extreme rotations, right-to-left layouts (RTL), or visibility of scroll bars, are implicitly handled in the code changes but not extensively detailed in the problem statement, adding a layer of complexity in ensuring robustness. Overall, solving this requires a solid grasp of GUI rendering logic and transformation math, along with familiarity with Godot's internals, placing it at a medium difficulty level of 0.55. It is not overly complex or system-wide but goes beyond a simple bug fix due to the need for domain-specific knowledge and careful handling of coordinate transformations.", "clarity_label": 1, "difficulty_label": 1, "human_clarity": -1, "human_difficulty": -1}
{"problem_statement": "Sometimes when exporting in \"--headless\" mode, shaders with \"global uniform\" doesn't work\n### Tested versions\n\nReproduced: v4.3.stable.mono\n\n### System information\n\nGodot v4.3.stable.mono - Windows 10.0.19045 - Vulkan (Forward+) - dedicated NVIDIA GeForce RTX 2060 (NVIDIA; 32.0.15.6094) - AMD Ryzen 5 1600 Six-Core Processor (12 Threads)\n\n### Issue description\n\nSimilar to https://github.com/godotengine/godot/issues/102362, which seems only visual, but in some cases might change into completely breaking a shader.\nThe issue happens when you have shader with global uniforms (correctly added to the Project Settings) and export it.\n\nBehavior of exporting the project normally or via cmd and that of exporting it **via cmd with --headless** mode is different. Doing it the first method works correctly, doing it the second method breaks the shaders with global uniforms. \n\nBut importantly, the working of the exported shader will be based on **how the project was exported for the first time** \n\nSo:\n1. Export normally -> shader works in the build\n2. Export with --headless -> shader still work in the build\n\nBUT:\n1. Export with --headless -> shader does NOT work in the build\n2. **Export normally -> shader STILL does NOT work in the build**\n\nI traced this behavior to the \".godot/exported\" folder - if you remove it, you \"restart\" the process, as above.\n\nI noticed it first when setting up my CI pipeline (with Github Actions). As there is no .godot folder on the machine, and it uses --headless, it's gonna break the shaders every time. Only fix I found was including .godot/exported in the source control.\n\n\n### Steps to reproduce\n\n1. In empty project, create shader that uses \"global uniform\". Then create material using that shader and apply it on some mesh (not sure if required)\n2. Add the required global uniforms in Project Settings\n3. Remove the  \".godot/exported\" folder (if exists)\n4. Export the project using command line using \"--headless\" mode. (In case of MRP I use godot --headless --export-release \"Windows Desktop\" \"build/Shader Test.exe\")\n5. Notice the shader does not use the uniform correctly in the build\n\n### Minimal reproduction project (MRP)\n\n[shader-test.zip](https://github.com/user-attachments/files/18642930/shader-test.zip)\n", "patch": "diff --git a/servers/rendering/dummy/storage/material_storage.cpp b/servers/rendering/dummy/storage/material_storage.cpp\nindex e8b553ca7636..b22971a750cd 100644\n--- a/servers/rendering/dummy/storage/material_storage.cpp\n+++ b/servers/rendering/dummy/storage/material_storage.cpp\n@@ -30,6 +30,8 @@\n \n #include \"material_storage.h\"\n \n+#include \"core/config/project_settings.h\"\n+\n using namespace RendererDummy;\n \n MaterialStorage *MaterialStorage::singleton = nullptr;\n@@ -42,6 +44,103 @@ MaterialStorage::MaterialStorage() {\n \n MaterialStorage::~MaterialStorage() {\n \tsingleton = nullptr;\n+\tglobal_shader_variables.clear();\n+}\n+\n+void MaterialStorage::global_shader_parameter_add(const StringName &p_name, RS::GlobalShaderParameterType p_type, const Variant &p_value) {\n+\tERR_FAIL_COND(global_shader_variables.has(p_name));\n+\n+\tglobal_shader_variables[p_name] = p_type;\n+}\n+\n+void MaterialStorage::global_shader_parameter_remove(const StringName &p_name) {\n+\tif (!global_shader_variables.has(p_name)) {\n+\t\treturn;\n+\t}\n+\n+\tglobal_shader_variables.erase(p_name);\n+}\n+\n+Vector<StringName> MaterialStorage::global_shader_parameter_get_list() const {\n+\tVector<StringName> names;\n+\tfor (const KeyValue<StringName, RS::GlobalShaderParameterType> &E : global_shader_variables) {\n+\t\tnames.push_back(E.key);\n+\t}\n+\tnames.sort_custom<StringName::AlphCompare>();\n+\treturn names;\n+}\n+\n+RS::GlobalShaderParameterType MaterialStorage::global_shader_parameter_get_type(const StringName &p_name) const {\n+\tif (!global_shader_variables.has(p_name)) {\n+\t\tprint_line(\"don't have name, sorry\");\n+\t\treturn RS::GLOBAL_VAR_TYPE_MAX;\n+\t}\n+\n+\treturn global_shader_variables[p_name];\n+}\n+\n+void MaterialStorage::global_shader_parameters_load_settings(bool p_load_textures) {\n+\tList<PropertyInfo> settings;\n+\tProjectSettings::get_singleton()->get_property_list(&settings);\n+\n+\tfor (const PropertyInfo &E : settings) {\n+\t\tif (E.name.begins_with(\"shader_globals/\")) {\n+\t\t\tStringName name = E.name.get_slice(\"/\", 1);\n+\t\t\tDictionary d = GLOBAL_GET(E.name);\n+\n+\t\t\tERR_CONTINUE(!d.has(\"type\"));\n+\t\t\tERR_CONTINUE(!d.has(\"value\"));\n+\n+\t\t\tString type = d[\"type\"];\n+\n+\t\t\tstatic const char *global_var_type_names[RS::GLOBAL_VAR_TYPE_MAX] = {\n+\t\t\t\t\"bool\",\n+\t\t\t\t\"bvec2\",\n+\t\t\t\t\"bvec3\",\n+\t\t\t\t\"bvec4\",\n+\t\t\t\t\"int\",\n+\t\t\t\t\"ivec2\",\n+\t\t\t\t\"ivec3\",\n+\t\t\t\t\"ivec4\",\n+\t\t\t\t\"rect2i\",\n+\t\t\t\t\"uint\",\n+\t\t\t\t\"uvec2\",\n+\t\t\t\t\"uvec3\",\n+\t\t\t\t\"uvec4\",\n+\t\t\t\t\"float\",\n+\t\t\t\t\"vec2\",\n+\t\t\t\t\"vec3\",\n+\t\t\t\t\"vec4\",\n+\t\t\t\t\"color\",\n+\t\t\t\t\"rect2\",\n+\t\t\t\t\"mat2\",\n+\t\t\t\t\"mat3\",\n+\t\t\t\t\"mat4\",\n+\t\t\t\t\"transform_2d\",\n+\t\t\t\t\"transform\",\n+\t\t\t\t\"sampler2D\",\n+\t\t\t\t\"sampler2DArray\",\n+\t\t\t\t\"sampler3D\",\n+\t\t\t\t\"samplerCube\",\n+\t\t\t\t\"samplerExternalOES\"\n+\t\t\t};\n+\n+\t\t\tRS::GlobalShaderParameterType gvtype = RS::GLOBAL_VAR_TYPE_MAX;\n+\n+\t\t\tfor (int i = 0; i < RS::GLOBAL_VAR_TYPE_MAX; i++) {\n+\t\t\t\tif (global_var_type_names[i] == type) {\n+\t\t\t\t\tgvtype = RS::GlobalShaderParameterType(i);\n+\t\t\t\t\tbreak;\n+\t\t\t\t}\n+\t\t\t}\n+\n+\t\t\tERR_CONTINUE(gvtype == RS::GLOBAL_VAR_TYPE_MAX); //type invalid\n+\n+\t\t\tif (!global_shader_variables.has(name)) {\n+\t\t\t\tglobal_shader_parameter_add(name, gvtype, Variant());\n+\t\t\t}\n+\t\t}\n+\t}\n }\n \n RID MaterialStorage::shader_allocate() {\n@@ -131,3 +230,56 @@ void MaterialStorage::get_shader_parameter_list(RID p_shader, List<PropertyInfo>\n \t\tp_param_list->push_back(pi);\n \t}\n }\n+\n+RID MaterialStorage::material_allocate() {\n+\treturn material_owner.allocate_rid();\n+}\n+\n+void MaterialStorage::material_initialize(RID p_rid) {\n+\tmaterial_owner.initialize_rid(p_rid, DummyMaterial());\n+}\n+\n+void MaterialStorage::material_free(RID p_rid) {\n+\tDummyMaterial *material = material_owner.get_or_null(p_rid);\n+\tERR_FAIL_NULL(material);\n+\n+\tmaterial_owner.free(p_rid);\n+}\n+\n+void MaterialStorage::material_set_shader(RID p_material, RID p_shader) {\n+\tDummyMaterial *material = material_owner.get_or_null(p_material);\n+\tERR_FAIL_NULL(material);\n+\n+\tmaterial->shader = p_shader;\n+}\n+\n+void MaterialStorage::material_set_next_pass(RID p_material, RID p_next_material) {\n+\tDummyMaterial *material = material_owner.get_or_null(p_material);\n+\tERR_FAIL_NULL(material);\n+\n+\tmaterial->next_pass = p_next_material;\n+}\n+\n+void MaterialStorage::material_get_instance_shader_parameters(RID p_material, List<InstanceShaderParam> *r_parameters) {\n+\tDummyMaterial *material = material_owner.get_or_null(p_material);\n+\tERR_FAIL_NULL(material);\n+\tDummyShader *shader = shader_owner.get_or_null(material->shader);\n+\n+\tif (shader) {\n+\t\tfor (const KeyValue<StringName, ShaderLanguage::ShaderNode::Uniform> &E : shader->uniforms) {\n+\t\t\tif (E.value.scope != ShaderLanguage::ShaderNode::Uniform::SCOPE_INSTANCE) {\n+\t\t\t\tcontinue;\n+\t\t\t}\n+\n+\t\t\tRendererMaterialStorage::InstanceShaderParam p;\n+\t\t\tp.info = ShaderLanguage::uniform_to_property_info(E.value);\n+\t\t\tp.info.name = E.key; //supply name\n+\t\t\tp.index = E.value.instance_index;\n+\t\t\tp.default_value = ShaderLanguage::constant_value_to_variant(E.value.default_value, E.value.type, E.value.array_size, E.value.hint);\n+\t\t\tr_parameters->push_back(p);\n+\t\t}\n+\t}\n+\tif (material->next_pass.is_valid()) {\n+\t\tmaterial_get_instance_shader_parameters(material->next_pass, r_parameters);\n+\t}\n+}\ndiff --git a/servers/rendering/dummy/storage/material_storage.h b/servers/rendering/dummy/storage/material_storage.h\nindex 9422c395e2e6..ef46cf3b9b4f 100644\n--- a/servers/rendering/dummy/storage/material_storage.h\n+++ b/servers/rendering/dummy/storage/material_storage.h\n@@ -42,6 +42,8 @@ class MaterialStorage : public RendererMaterialStorage {\n private:\n \tstatic MaterialStorage *singleton;\n \n+\tHashMap<StringName, RS::GlobalShaderParameterType> global_shader_variables;\n+\n \tstruct DummyShader {\n \t\tHashMap<StringName, ShaderLanguage::ShaderNode::Uniform> uniforms;\n \t};\n@@ -50,6 +52,13 @@ class MaterialStorage : public RendererMaterialStorage {\n \n \tShaderCompiler dummy_compiler;\n \n+\tstruct DummyMaterial {\n+\t\tRID shader;\n+\t\tRID next_pass;\n+\t};\n+\n+\tmutable RID_Owner<DummyMaterial> material_owner;\n+\n public:\n \tstatic MaterialStorage *get_singleton() { return singleton; }\n \n@@ -58,16 +67,16 @@ class MaterialStorage : public RendererMaterialStorage {\n \n \t/* GLOBAL SHADER UNIFORM API */\n \n-\tvirtual void global_shader_parameter_add(const StringName &p_name, RS::GlobalShaderParameterType p_type, const Variant &p_value) override {}\n-\tvirtual void global_shader_parameter_remove(const StringName &p_name) override {}\n-\tvirtual Vector<StringName> global_shader_parameter_get_list() const override { return Vector<StringName>(); }\n+\tvirtual void global_shader_parameter_add(const StringName &p_name, RS::GlobalShaderParameterType p_type, const Variant &p_value) override;\n+\tvirtual void global_shader_parameter_remove(const StringName &p_name) override;\n+\tvirtual Vector<StringName> global_shader_parameter_get_list() const override;\n \n \tvirtual void global_shader_parameter_set(const StringName &p_name, const Variant &p_value) override {}\n \tvirtual void global_shader_parameter_set_override(const StringName &p_name, const Variant &p_value) override {}\n \tvirtual Variant global_shader_parameter_get(const StringName &p_name) const override { return Variant(); }\n-\tvirtual RS::GlobalShaderParameterType global_shader_parameter_get_type(const StringName &p_name) const override { return RS::GLOBAL_VAR_TYPE_MAX; }\n+\tvirtual RS::GlobalShaderParameterType global_shader_parameter_get_type(const StringName &p_name) const override;\n \n-\tvirtual void global_shader_parameters_load_settings(bool p_load_textures = true) override {}\n+\tvirtual void global_shader_parameters_load_settings(bool p_load_textures = true) override;\n \tvirtual void global_shader_parameters_clear() override {}\n \n \tvirtual int32_t global_shader_parameters_instance_allocate(RID p_instance) override { return 0; }\n@@ -95,23 +104,26 @@ class MaterialStorage : public RendererMaterialStorage {\n \tvirtual RS::ShaderNativeSourceCode shader_get_native_source_code(RID p_shader) const override { return RS::ShaderNativeSourceCode(); }\n \n \t/* MATERIAL API */\n-\tvirtual RID material_allocate() override { return RID(); }\n-\tvirtual void material_initialize(RID p_rid) override {}\n-\tvirtual void material_free(RID p_rid) override {}\n+\n+\tbool owns_material(RID p_rid) { return material_owner.owns(p_rid); }\n+\n+\tvirtual RID material_allocate() override;\n+\tvirtual void material_initialize(RID p_rid) override;\n+\tvirtual void material_free(RID p_rid) override;\n \n \tvirtual void material_set_render_priority(RID p_material, int priority) override {}\n-\tvirtual void material_set_shader(RID p_shader_material, RID p_shader) override {}\n+\tvirtual void material_set_shader(RID p_shader_material, RID p_shader) override;\n \n \tvirtual void material_set_param(RID p_material, const StringName &p_param, const Variant &p_value) override {}\n \tvirtual Variant material_get_param(RID p_material, const StringName &p_param) const override { return Variant(); }\n \n-\tvirtual void material_set_next_pass(RID p_material, RID p_next_material) override {}\n+\tvirtual void material_set_next_pass(RID p_material, RID p_next_material) override;\n \n \tvirtual bool material_is_animated(RID p_material) override { return false; }\n \tvirtual bool material_casts_shadows(RID p_material) override { return false; }\n \tvirtual RS::CullMode material_get_cull_mode(RID p_material) const override { return RS::CULL_MODE_DISABLED; }\n \n-\tvirtual void material_get_instance_shader_parameters(RID p_material, List<InstanceShaderParam> *r_parameters) override {}\n+\tvirtual void material_get_instance_shader_parameters(RID p_material, List<InstanceShaderParam> *r_parameters) override;\n \tvirtual void material_update_dependency(RID p_material, DependencyTracker *p_instance) override {}\n };\n \ndiff --git a/servers/rendering/dummy/storage/utilities.h b/servers/rendering/dummy/storage/utilities.h\nindex 4e20dee640e5..02e163fd8e8e 100644\n--- a/servers/rendering/dummy/storage/utilities.h\n+++ b/servers/rendering/dummy/storage/utilities.h\n@@ -77,6 +77,9 @@ class Utilities : public RendererUtilities {\n \t\t} else if (RendererDummy::MaterialStorage::get_singleton()->owns_shader(p_rid)) {\n \t\t\tRendererDummy::MaterialStorage::get_singleton()->shader_free(p_rid);\n \t\t\treturn true;\n+\t\t} else if (RendererDummy::MaterialStorage::get_singleton()->owns_material(p_rid)) {\n+\t\t\tRendererDummy::MaterialStorage::get_singleton()->material_free(p_rid);\n+\t\t\treturn true;\n \t\t}\n \t\treturn false;\n \t}\n", "instance_id": "godotengine__godot-101210", "clarity": 2, "difficulty": 0.65, "clarity_explanation": "\nThe problem statement is mostly clear in describing the issue: shaders with global uniforms fail to work correctly when a project is exported in \"--headless\" mode using Godot v4.3. It provides specific steps to reproduce the issue, mentions the affected versions, and includes a minimal reproduction project (MRP). The description also highlights the dependency on the initial export method and the role of the \".godot/exported\" folder, which adds useful context. However, there are minor ambiguities and missing details. For instance, the exact nature of \"breaking\" the shader is not fully specified (e.g., does it fail to compile, render incorrectly, or crash?). Additionally, while the steps to reproduce are provided, edge cases or specific constraints (e.g., types of global uniforms affected, specific export configurations) are not explicitly mentioned. These gaps prevent the statement from being fully comprehensive, warranting a score of 2 (Mostly Clear).\n", "difficulty_explanation": "\nI assign a difficulty score of 0.65, placing this problem in the \"Hard\" range (0.6-0.8), due to the following factors:\n\n1. **Clarity and Complexity of the Problem Description**: While the problem is mostly clear, the underlying cause (difference in behavior between headless and normal export modes) suggests a non-trivial issue likely tied to how Godot handles shader compilation or project settings in different environments. Understanding the root cause requires familiarity with Godot's export pipeline and rendering system.\n\n2. **Scope and Depth of Code Changes**: The provided code changes are significant, affecting multiple methods in the dummy rendering storage module of Godot (`material_storage.cpp` and `material_storage.h`). The modifications involve adding support for global shader parameters and material management in a dummy backend, which was previously unimplemented (stubbed out with empty methods). The changes span across multiple functions (e.g., `global_shader_parameter_add`, `material_allocate`, etc.) and introduce new data structures and logic. While the changes are localized to a few files, they impact a critical part of the rendering subsystem, requiring an understanding of how the dummy backend interacts with the rest of the engine.\n\n3. **Number of Technical Concepts**: Solving this problem requires knowledge of several concepts, including:\n   - Godot's rendering architecture, specifically the role of dummy storage in headless mode.\n   - Shader compilation and uniform handling in graphics programming.\n   - Project settings management and how they are loaded/exported in different modes.\n   - C++ programming with Godot's custom data structures (e.g., `RID`, `HashMap`, `StringName`) and conventions.\n   These concepts are moderately complex, especially for someone unfamiliar with game engine internals or graphics programming.\n\n4. **Potential Edge Cases and Error Handling**: The problem statement does not explicitly mention edge cases, but the code changes introduce logic for handling shader parameter types, material allocation, and uniform scopes. Potential edge cases include invalid or unsupported uniform types, missing project settings, or recursive material dependencies (via `next_pass`). The code includes basic error checking (e.g., `ERR_FAIL_COND`, `ERR_CONTINUE`), but handling all possible failure modes in a robust way adds to the complexity. Additionally, ensuring compatibility with different export configurations and platforms (as hinted by the CI pipeline issue) increases the challenge.\n\nOverall, this problem requires a deep understanding of Godot's internals, particularly its rendering and export systems, and involves complex modifications to a critical component. It is not at the extreme end of difficulty (e.g., requiring system-level redesign or advanced domain knowledge beyond game engines), but it is challenging enough to warrant a score of 0.65. This reflects the need for specialized knowledge and careful implementation to avoid introducing new bugs in a sensitive area of the codebase.\n", "clarity_label": 1, "difficulty_label": 1, "human_clarity": -1, "human_difficulty": -1}
{"problem_statement": "Documentation tooltip trigger area includes end-of-line and whitespace surrounding a symbol\n### Tested versions\n\nv4.4.dev7.official [46c8f8c5c]\n\n### System information\n\nGodot v4.4.dev7 - Windows 11 (build 22631) - Multi-window, 1 monitor - OpenGL 3 (Compatibility) - Intel(R) Iris(R) Xe Graphics (Intel Corporation; 32.0.101.5768) - 11th Gen Intel(R) Core(TM) i7-1185G7 @ 3.00GHz (8 threads)\n\n### Issue description\n\nThe symbol info / documentation tooltips (#91060) are triggered by hovering in the empty space at the end of a line or the whitespace surrounding a symbol.\n\nhttps://github.com/user-attachments/assets/d15df433-edad-4044-8bb5-b02c89c869ec\n\n\n### Steps to reproduce\n\nStop the mouse cursor in the space surrounding a hoverable symbol.\n\n### Minimal reproduction project (MRP)\n\nN/A\n", "patch": "diff --git a/doc/classes/TextEdit.xml b/doc/classes/TextEdit.xml\nindex 89e2a2017af1..826a491888df 100644\n--- a/doc/classes/TextEdit.xml\n+++ b/doc/classes/TextEdit.xml\n@@ -349,9 +349,12 @@\n \t\t<method name=\"get_line_column_at_pos\" qualifiers=\"const\">\n \t\t\t<return type=\"Vector2i\" />\n \t\t\t<param index=\"0\" name=\"position\" type=\"Vector2i\" />\n-\t\t\t<param index=\"1\" name=\"allow_out_of_bounds\" type=\"bool\" default=\"true\" />\n+\t\t\t<param index=\"1\" name=\"clamp_line\" type=\"bool\" default=\"true\" />\n+\t\t\t<param index=\"2\" name=\"clamp_column\" type=\"bool\" default=\"true\" />\n \t\t\t<description>\n-\t\t\t\tReturns the line and column at the given position. In the returned vector, [code]x[/code] is the column, [code]y[/code] is the line. If [param allow_out_of_bounds] is [code]false[/code] and the position is not over the text, both vector values will be set to [code]-1[/code].\n+\t\t\t\tReturns the line and column at the given position. In the returned vector, [code]x[/code] is the column and [code]y[/code] is the line.\n+\t\t\t\tIf [param clamp_line] is [code]false[/code] and [param position] is below the last line, [code]Vector2i(-1, -1)[/code] is returned.\n+\t\t\t\tIf [param clamp_column] is [code]false[/code] and [param position] is outside the column range of the line, [code]Vector2i(-1, -1)[/code] is returned.\n \t\t\t</description>\n \t\t</method>\n \t\t<method name=\"get_line_count\" qualifiers=\"const\">\ndiff --git a/misc/extension_api_validation/4.3-stable.expected b/misc/extension_api_validation/4.3-stable.expected\nindex 7b5889f464b9..9c96811f875f 100644\n--- a/misc/extension_api_validation/4.3-stable.expected\n+++ b/misc/extension_api_validation/4.3-stable.expected\n@@ -309,3 +309,10 @@ Validate extension JSON: API was removed: classes/EditorSceneFormatImporter/meth\n \n This virtual method, and the internal public `get_import_flags`, were never used by the engine, since it was open sourced.\n So we're removing it despite the compat breakage as there's no way for users to rely on this affecting engine behavior.\n+\n+\n+GH-100913\n+---------\n+Validate extension JSON: Error: Field 'classes/TextEdit/methods/get_line_column_at_pos/arguments': size changed value in new API, from 2 to 3.\n+\n+Added optional argument to disallow positions that are outside the column range of the line. Compatibility method registered.\ndiff --git a/scene/gui/code_edit.cpp b/scene/gui/code_edit.cpp\nindex 7f8b4dca7862..be8b6f075d9c 100644\n--- a/scene/gui/code_edit.cpp\n+++ b/scene/gui/code_edit.cpp\n@@ -421,7 +421,7 @@ void CodeEdit::gui_input(const Ref<InputEvent> &p_gui_input) {\n \t\t\t\t\t\tmpos.x = get_size().x - mpos.x;\n \t\t\t\t\t}\n \n-\t\t\t\t\tPoint2i pos = get_line_column_at_pos(mpos, false);\n+\t\t\t\t\tPoint2i pos = get_line_column_at_pos(mpos, false, false);\n \t\t\t\t\tint line = pos.y;\n \t\t\t\t\tint col = pos.x;\n \n@@ -443,18 +443,18 @@ void CodeEdit::gui_input(const Ref<InputEvent> &p_gui_input) {\n \n \t\tif (symbol_lookup_on_click_enabled) {\n \t\t\tif (mm->is_command_or_control_pressed() && mm->get_button_mask().is_empty()) {\n-\t\t\t\tsymbol_lookup_pos = get_line_column_at_pos(mpos);\n+\t\t\t\tsymbol_lookup_pos = get_line_column_at_pos(mpos, false, false);\n \t\t\t\tsymbol_lookup_new_word = get_word_at_pos(mpos);\n \t\t\t\tif (symbol_lookup_new_word != symbol_lookup_word) {\n \t\t\t\t\temit_signal(SNAME(\"symbol_validate\"), symbol_lookup_new_word);\n \t\t\t\t}\n-\t\t\t} else if (!mm->is_command_or_control_pressed() || (!mm->get_button_mask().is_empty() && symbol_lookup_pos != get_line_column_at_pos(mpos))) {\n+\t\t\t} else if (!mm->is_command_or_control_pressed() || (!mm->get_button_mask().is_empty() && symbol_lookup_pos != get_line_column_at_pos(mpos, false, false))) {\n \t\t\t\tset_symbol_lookup_word_as_valid(false);\n \t\t\t}\n \t\t}\n \n \t\tif (symbol_tooltip_on_hover_enabled) {\n-\t\t\tsymbol_tooltip_pos = get_line_column_at_pos(mpos, false);\n+\t\t\tsymbol_tooltip_pos = get_line_column_at_pos(mpos, false, false);\n \t\t\tsymbol_tooltip_word = get_word_at_pos(mpos);\n \t\t\tsymbol_tooltip_timer->start();\n \t\t}\n@@ -2388,7 +2388,7 @@ bool CodeEdit::is_symbol_lookup_on_click_enabled() const {\n \n String CodeEdit::get_text_for_symbol_lookup() const {\n \tPoint2i mp = get_local_mouse_pos();\n-\tPoint2i pos = get_line_column_at_pos(mp, false);\n+\tPoint2i pos = get_line_column_at_pos(mp, false, false);\n \tint line = pos.y;\n \tint col = pos.x;\n \ndiff --git a/scene/gui/text_edit.compat.inc b/scene/gui/text_edit.compat.inc\nindex bf73229868ef..d15740390e9d 100644\n--- a/scene/gui/text_edit.compat.inc\n+++ b/scene/gui/text_edit.compat.inc\n@@ -34,8 +34,13 @@ void TextEdit::_set_selection_mode_compat_86978(SelectionMode p_mode, int p_line\n \tset_selection_mode(p_mode);\n }\n \n+Point2i TextEdit::_get_line_column_at_pos_bind_compat_100913(const Point2i &p_pos, bool p_allow_out_of_bounds) const {\n+\treturn get_line_column_at_pos(p_pos, p_allow_out_of_bounds, true);\n+}\n+\n void TextEdit::_bind_compatibility_methods() {\n \tClassDB::bind_compatibility_method(D_METHOD(\"set_selection_mode\", \"mode\", \"line\", \"column\", \"caret_index\"), &TextEdit::_set_selection_mode_compat_86978, DEFVAL(-1), DEFVAL(-1), DEFVAL(0));\n+\tClassDB::bind_compatibility_method(D_METHOD(\"get_line_column_at_pos\", \"position\", \"allow_out_of_bounds\"), &TextEdit::_get_line_column_at_pos_bind_compat_100913, DEFVAL(true));\n }\n \n #endif\ndiff --git a/scene/gui/text_edit.cpp b/scene/gui/text_edit.cpp\nindex addbff1e979a..b707a5a93342 100644\n--- a/scene/gui/text_edit.cpp\n+++ b/scene/gui/text_edit.cpp\n@@ -4397,9 +4397,12 @@ Point2 TextEdit::get_local_mouse_pos() const {\n }\n \n String TextEdit::get_word_at_pos(const Vector2 &p_pos) const {\n-\tPoint2i pos = get_line_column_at_pos(p_pos);\n+\tPoint2i pos = get_line_column_at_pos(p_pos, false, false);\n \tint row = pos.y;\n \tint col = pos.x;\n+\tif (row < 0 || col < 0) {\n+\t\treturn \"\";\n+\t}\n \n \tString s = text[row];\n \tif (s.length() == 0) {\n@@ -4435,7 +4438,7 @@ String TextEdit::get_word_at_pos(const Vector2 &p_pos) const {\n \treturn String();\n }\n \n-Point2i TextEdit::get_line_column_at_pos(const Point2i &p_pos, bool p_allow_out_of_bounds) const {\n+Point2i TextEdit::get_line_column_at_pos(const Point2i &p_pos, bool p_clamp_line, bool p_clamp_column) const {\n \tfloat rows = p_pos.y - theme_cache.style_normal->get_margin(SIDE_TOP);\n \tif (!editable) {\n \t\trows -= theme_cache.style_readonly->get_offset().y / 2;\n@@ -4462,10 +4465,10 @@ Point2i TextEdit::get_line_column_at_pos(const Point2i &p_pos, bool p_allow_out_\n \n \tint visible_lines = get_visible_line_count_in_range(first_vis_line, row);\n \tif (rows > visible_lines) {\n-\t\tif (!p_allow_out_of_bounds) {\n-\t\t\treturn Point2i(-1, -1);\n+\t\tif (p_clamp_line) {\n+\t\t\treturn Point2i(text[row].length(), row);\n \t\t}\n-\t\treturn Point2i(text[row].length(), row);\n+\t\treturn Point2i(-1, -1);\n \t}\n \n \tint colx = p_pos.x - (theme_cache.style_normal->get_margin(SIDE_LEFT) + gutters_width + gutter_padding);\n@@ -4482,6 +4485,11 @@ Point2i TextEdit::get_line_column_at_pos(const Point2i &p_pos, bool p_allow_out_\n \t} else {\n \t\tcolx -= wrap_indent;\n \t}\n+\n+\tif (!p_clamp_column && (colx < 0 || colx > TS->shaped_text_get_size(text_rid).x)) {\n+\t\treturn Point2i(-1, -1);\n+\t}\n+\n \tint col = TS->shaped_text_hit_test_position(text_rid, colx);\n \tif (!caret_mid_grapheme_enabled) {\n \t\tcol = TS->shaped_text_closest_character_pos(text_rid, col);\n@@ -6740,7 +6748,7 @@ void TextEdit::_bind_methods() {\n \n \tClassDB::bind_method(D_METHOD(\"get_word_at_pos\", \"position\"), &TextEdit::get_word_at_pos);\n \n-\tClassDB::bind_method(D_METHOD(\"get_line_column_at_pos\", \"position\", \"allow_out_of_bounds\"), &TextEdit::get_line_column_at_pos, DEFVAL(true));\n+\tClassDB::bind_method(D_METHOD(\"get_line_column_at_pos\", \"position\", \"clamp_line\", \"clamp_column\"), &TextEdit::get_line_column_at_pos, DEFVAL(true), DEFVAL(true));\n \tClassDB::bind_method(D_METHOD(\"get_pos_at_line_column\", \"line\", \"column\"), &TextEdit::get_pos_at_line_column);\n \tClassDB::bind_method(D_METHOD(\"get_rect_at_line_column\", \"line\", \"column\"), &TextEdit::get_rect_at_line_column);\n \ndiff --git a/scene/gui/text_edit.h b/scene/gui/text_edit.h\nindex ef5110963023..8609b86eccf0 100644\n--- a/scene/gui/text_edit.h\n+++ b/scene/gui/text_edit.h\n@@ -658,6 +658,7 @@ class TextEdit : public Control {\n \n #ifndef DISABLE_DEPRECATED\n \tvoid _set_selection_mode_compat_86978(SelectionMode p_mode, int p_line = -1, int p_column = -1, int p_caret = 0);\n+\tPoint2i _get_line_column_at_pos_bind_compat_100913(const Point2i &p_pos, bool p_allow_out_of_bounds = true) const;\n \tstatic void _bind_compatibility_methods();\n #endif // DISABLE_DEPRECATED\n \n@@ -860,7 +861,7 @@ class TextEdit : public Control {\n \n \tString get_word_at_pos(const Vector2 &p_pos) const;\n \n-\tPoint2i get_line_column_at_pos(const Point2i &p_pos, bool p_allow_out_of_bounds = true) const;\n+\tPoint2i get_line_column_at_pos(const Point2i &p_pos, bool p_clamp_line = true, bool p_clamp_column = true) const;\n \tPoint2i get_pos_at_line_column(int p_line, int p_column) const;\n \tRect2i get_rect_at_line_column(int p_line, int p_column) const;\n \n", "instance_id": "godotengine__godot-100913", "clarity": 2, "difficulty": 0.45, "clarity_explanation": "The problem statement is mostly clear in describing the issue: tooltips for symbol information in a text editor are triggered incorrectly by hovering over whitespace or end-of-line areas surrounding a symbol. The goal is implied to be restricting tooltip triggers to the actual symbol area. However, there are minor ambiguities and missing details. For instance, the problem does not explicitly state the desired behavior (e.g., should tooltips only trigger on the exact symbol boundaries?) or provide specific constraints about acceptable hover areas. Additionally, edge cases such as multi-line symbols, different font sizes, or varying text layouts are not mentioned. While the issue is valid and the general intent is understandable, these missing details prevent it from being comprehensive.", "difficulty_explanation": "The difficulty of this problem falls into the medium range due to several factors. First, the scope of code changes involves multiple files (e.g., `text_edit.cpp`, `code_edit.cpp`, documentation updates in `TextEdit.xml`, and compatibility handling in `text_edit.compat.inc`), indicating a need to understand interactions between different parts of the codebase, particularly in the GUI and text rendering logic of the Godot engine. The changes modify the behavior of the `get_line_column_at_pos` method to add stricter clamping of line and column positions, which requires understanding how mouse position mapping works in the text editor component. The amount of code change is moderate, with updates to method signatures, logic for position validation, and compatibility bindings for backward compatibility.\n\nTechnically, the problem requires knowledge of C++ (as the codebase is in C++), familiarity with Godot's internal text rendering and input handling systems, and an understanding of method binding for compatibility. The concepts involved are not overly complex but do require specific domain knowledge of GUI components and event handling in Godot. Edge cases are implicitly present (e.g., handling positions outside valid text bounds, wrapped lines, or empty lines), and the code changes address these by returning invalid positions (`-1, -1`) when clamping is disabled, which adds a layer of error handling complexity. However, the problem does not impact core system architecture or require advanced algorithms, keeping it from being classified as hard. Overall, this rates as a medium difficulty task (0.45), suitable for a developer with moderate experience in C++ and some familiarity with the Godot engine's internals.", "clarity_label": 1, "difficulty_label": 1, "human_clarity": -1, "human_difficulty": -1}
{"problem_statement": "Editor Settings Shortcuts: Undoing changes to built-in actions creates empty action\n### Tested versions\n\nv4.3.stable.official [77dcf97d8]\n\n### System information\n\nGodot v4.3.stable - Windows 10.0.22631 - Vulkan (Forward+) - dedicated NVIDIA GeForce GTX 980 Ti (NVIDIA; 32.0.15.6603) - 13th Gen Intel(R) Core(TM) i7-13700K (24 Threads)\n\n### Issue description\n\nTwo issues happen when undoing/redoing changes to the built-in actions in the Shortcuts list:\n \n1. Undo/redo have a 1 second delay\n2. Undoing back to the default shortcut results in an empty shortcut rather than the default.\n\nhttps://github.com/user-attachments/assets/b24c9694-a1d1-4979-9b5e-63cc22127cc2\n\n\n\n### Steps to reproduce\n\n- Change one of the built-in editor shortcuts\n- Undo with Ctrl-Z\n\n### Minimal reproduction project (MRP)\n\nN/A\n", "patch": "diff --git a/editor/editor_settings_dialog.cpp b/editor/editor_settings_dialog.cpp\nindex 8989b9cf9b9b..2f7dfe16072e 100644\n--- a/editor/editor_settings_dialog.cpp\n+++ b/editor/editor_settings_dialog.cpp\n@@ -314,6 +314,10 @@ void EditorSettingsDialog::_event_config_confirmed() {\n \n void EditorSettingsDialog::_update_builtin_action(const String &p_name, const Array &p_events) {\n \tArray old_input_array = EditorSettings::get_singleton()->get_builtin_action_overrides(p_name);\n+\tif (old_input_array.is_empty()) {\n+\t\tList<Ref<InputEvent>> defaults = InputMap::get_singleton()->get_builtins_with_feature_overrides_applied()[current_edited_identifier];\n+\t\told_input_array = _event_list_to_array_helper(defaults);\n+\t}\n \n \tEditorUndoRedoManager *undo_redo = EditorUndoRedoManager::get_singleton();\n \tundo_redo->create_action(vformat(TTR(\"Edit Built-in Action: %s\"), p_name));\n@@ -321,11 +325,11 @@ void EditorSettingsDialog::_update_builtin_action(const String &p_name, const Ar\n \tundo_redo->add_undo_method(EditorSettings::get_singleton(), \"mark_setting_changed\", \"builtin_action_overrides\");\n \tundo_redo->add_do_method(EditorSettings::get_singleton(), \"set_builtin_action_override\", p_name, p_events);\n \tundo_redo->add_undo_method(EditorSettings::get_singleton(), \"set_builtin_action_override\", p_name, old_input_array);\n+\tundo_redo->add_do_method(this, \"_update_shortcuts\");\n+\tundo_redo->add_undo_method(this, \"_update_shortcuts\");\n \tundo_redo->add_do_method(this, \"_settings_changed\");\n \tundo_redo->add_undo_method(this, \"_settings_changed\");\n \tundo_redo->commit_action();\n-\n-\t_update_shortcuts();\n }\n \n void EditorSettingsDialog::_update_shortcut_events(const String &p_path, const Array &p_events) {\n", "instance_id": "godotengine__godot-100069", "clarity": 2, "difficulty": 0.35, "clarity_explanation": "The problem statement is mostly clear in describing the issue with the undo/redo functionality for built-in editor shortcuts in the Godot engine. It specifies two distinct issues: a 1-second delay during undo/redo operations and the problem of undoing to an empty shortcut instead of the default. The steps to reproduce are provided, which helps in understanding the context. However, there are minor ambiguities and missing details. For instance, the problem statement does not explicitly define what constitutes a \"default shortcut\" in terms of data or behavior, nor does it mention any specific constraints or edge cases (e.g., what happens with multiple undo operations or custom shortcuts). Additionally, there is no mention of expected performance requirements for fixing the delay issue. While the attached video link (presumably showing the issue) is helpful, it is not a substitute for a detailed textual description of expected behavior. Thus, the clarity score is 2 (Mostly Clear) due to these minor gaps in the problem definition.", "difficulty_explanation": "The difficulty of this problem falls in the Easy range (0.2-0.4) due to the following factors:\n\n1. **Scope and Depth of Code Changes**: The provided diff shows modifications to a single file (`editor_settings_dialog.cpp`) and specifically to the `_update_builtin_action` method. The changes involve a small number of lines (adding logic to handle default shortcuts and updating undo/redo methods). There is no indication of widespread impact across multiple modules or significant architectural changes. The code change is localized and straightforward, focusing on enhancing the undo/redo behavior by fetching default input events when the override array is empty.\n\n2. **Number of Technical Concepts**: Solving this requires understanding a few specific concepts within the Godot engine's codebase, such as the `InputMap` and `EditorSettings` singletons, undo/redo management via `EditorUndoRedoManager`, and how input events are stored and manipulated as arrays. These are moderately complex for someone unfamiliar with Godot, but for a developer with experience in game engine development or C++ (as used in Godot), these are relatively standard. No advanced algorithms, design patterns, or external libraries are involved beyond the engine's internal APIs.\n\n3. **Edge Cases and Error Handling**: The problem statement does not explicitly mention edge cases, but the code change implies handling the case where a built-in action has no overrides (i.e., reverting to defaults). The modification does not introduce complex error handling logic beyond ensuring the default input events are correctly fetched and applied. There might be implicit edge cases, such as ensuring the `InputMap` data is always valid or handling multiple undo/redo operations, but these are not addressed in the diff and do not seem to significantly increase complexity.\n\n4. **Overall Complexity**: While the 1-second delay issue mentioned in the problem statement is not directly addressed in the provided code changes (which focus on the empty shortcut issue), the provided diff suggests a straightforward fix for the second issue. The delay issue might require separate profiling or optimization (not shown in the diff), but based on the current scope, it does not appear to be a major factor in the difficulty. The task requires understanding some internal logic of the Godot editor but does not demand deep architectural changes or advanced technical expertise.\n\nGiven these considerations, I assign a difficulty score of 0.35, placing it on the higher end of the Easy range due to the need for domain-specific knowledge of Godot's editor internals and undo/redo system, but still within a manageable scope for a developer with moderate experience in C++ and game engines.", "clarity_label": 1, "difficulty_label": 1, "human_clarity": -1, "human_difficulty": -1}
{"problem_statement": "Header inconsistency after invalidate/reconsider block\nDemonstration using regtest.\r\n```bash\r\n# getblockchaininfo\r\n  \"chain\": \"regtest\",\r\n  \"blocks\": 0,\r\n  \"headers\": 0,\r\n```\r\n\r\nMine a block\r\n```bash\r\n# getblockchaininfo\r\n  \"chain\": \"regtest\",\r\n  \"blocks\": 1,\r\n  \"headers\": 1,\r\n```\r\nCall invalidateblock\r\n```bash\r\n# getblockchaininfo\r\n  \"chain\": \"regtest\",\r\n  \"blocks\": 0,\r\n  \"headers\": 0,\r\n# getchaintips\r\n    \"height\": 1,\r\n    \"hash\": \"06702ef73c7d8629294f8b6386646f888d60979932ba2ee45e3495d8f25006b5\",\r\n    \"branchlen\": 1,\r\n    \"status\": \"invalid\"\r\n  },\r\n  {\r\n    \"height\": 0,\r\n    \"hash\": \"0f9188f13cb7b2c71f2a335e3a4fc328bf5beb436012afca590b1a11466e2206\",\r\n    \"branchlen\": 0,\r\n    \"status\": \"active\"\r\n```\r\nCall reconsiderblock\r\n```bash\r\n# getchaintips\r\n    \"height\": 1,\r\n    \"hash\": \"06702ef73c7d8629294f8b6386646f888d60979932ba2ee45e3495d8f25006b5\",\r\n    \"branchlen\": 0,\r\n    \"status\": \"active\"\r\n```\r\n\r\nHeader count returned by getblockchaininfo is now < # of blocks.\r\n```bash\r\n# getblockchaininfo\r\n  \"chain\": \"regtest\",\r\n  \"blocks\": 1,\r\n  \"headers\": 0,\r\n```\n", "patch": "diff --git a/src/rpc/blockchain.cpp b/src/rpc/blockchain.cpp\nindex 7ffd03e71af5a..4a7af39b15144 100644\n--- a/src/rpc/blockchain.cpp\n+++ b/src/rpc/blockchain.cpp\n@@ -1648,6 +1648,7 @@ void ReconsiderBlock(ChainstateManager& chainman, uint256 block_hash) {\n         }\n \n         chainman.ActiveChainstate().ResetBlockFailureFlags(pblockindex);\n+        chainman.RecalculateBestHeader();\n     }\n \n     BlockValidationState state;\ndiff --git a/src/validation.cpp b/src/validation.cpp\nindex 8e4ea8eda2f62..dcaa8dba26602 100644\n--- a/src/validation.cpp\n+++ b/src/validation.cpp\n@@ -2045,8 +2045,9 @@ void Chainstate::InvalidChainFound(CBlockIndex* pindexNew)\n     if (!m_chainman.m_best_invalid || pindexNew->nChainWork > m_chainman.m_best_invalid->nChainWork) {\n         m_chainman.m_best_invalid = pindexNew;\n     }\n+    SetBlockFailureFlags(pindexNew);\n     if (m_chainman.m_best_header != nullptr && m_chainman.m_best_header->GetAncestor(pindexNew->nHeight) == pindexNew) {\n-        m_chainman.m_best_header = m_chain.Tip();\n+        m_chainman.RecalculateBestHeader();\n     }\n \n     LogPrintf(\"%s: invalid block=%s  height=%d  log2_work=%f  date=%s\\n\", __func__,\n@@ -3785,6 +3786,17 @@ bool Chainstate::InvalidateBlock(BlockValidationState& state, CBlockIndex* pinde\n     return true;\n }\n \n+void Chainstate::SetBlockFailureFlags(CBlockIndex* invalid_block)\n+{\n+    AssertLockHeld(cs_main);\n+\n+    for (auto& [_, block_index] : m_blockman.m_block_index) {\n+        if (block_index.GetAncestor(invalid_block->nHeight) == invalid_block && !(block_index.nStatus & BLOCK_FAILED_MASK)) {\n+            block_index.nStatus |= BLOCK_FAILED_CHILD;\n+        }\n+    }\n+}\n+\n void Chainstate::ResetBlockFailureFlags(CBlockIndex *pindex) {\n     AssertLockHeld(cs_main);\n \n@@ -6396,6 +6408,17 @@ std::optional<int> ChainstateManager::GetSnapshotBaseHeight() const\n     return base ? std::make_optional(base->nHeight) : std::nullopt;\n }\n \n+void ChainstateManager::RecalculateBestHeader()\n+{\n+    AssertLockHeld(cs_main);\n+    m_best_header = ActiveChain().Tip();\n+    for (auto& entry : m_blockman.m_block_index) {\n+        if (!(entry.second.nStatus & BLOCK_FAILED_MASK) && m_best_header->nChainWork < entry.second.nChainWork) {\n+            m_best_header = &entry.second;\n+        }\n+    }\n+}\n+\n bool ChainstateManager::ValidatedSnapshotCleanup()\n {\n     AssertLockHeld(::cs_main);\ndiff --git a/src/validation.h b/src/validation.h\nindex 059ae52bdf4ca..29ff6bd94cd4e 100644\n--- a/src/validation.h\n+++ b/src/validation.h\n@@ -735,6 +735,9 @@ class Chainstate\n         EXCLUSIVE_LOCKS_REQUIRED(!m_chainstate_mutex)\n         LOCKS_EXCLUDED(::cs_main);\n \n+    /** Set invalidity status to all descendants of a block */\n+    void SetBlockFailureFlags(CBlockIndex* pindex) EXCLUSIVE_LOCKS_REQUIRED(::cs_main);\n+\n     /** Remove invalidity status from a block and its descendants. */\n     void ResetBlockFailureFlags(CBlockIndex* pindex) EXCLUSIVE_LOCKS_REQUIRED(cs_main);\n \n@@ -1321,6 +1324,11 @@ class ChainstateManager\n     //! nullopt.\n     std::optional<int> GetSnapshotBaseHeight() const EXCLUSIVE_LOCKS_REQUIRED(::cs_main);\n \n+    //! If, due to invalidation / reconsideration of blocks, the previous\n+    //! best header is no longer valid / guaranteed to be the most-work\n+    //! header in our block-index not known to be invalid, recalculate it.\n+    void RecalculateBestHeader() EXCLUSIVE_LOCKS_REQUIRED(::cs_main);\n+\n     CCheckQueue<CScriptCheck>& GetCheckQueue() { return m_script_check_queue; }\n \n     ~ChainstateManager();\n", "instance_id": "bitcoin__bitcoin-30666", "clarity": 2, "difficulty": 0.65, "clarity_explanation": "The problem statement is mostly clear in describing the issue of header inconsistency after invalidating and reconsidering a block in a blockchain context (likely Bitcoin or a similar system, given the regtest and RPC commands). It provides a step-by-step demonstration using command-line interactions to show the discrepancy between the block count and header count after specific operations (invalidateblock and reconsiderblock). The goal of fixing the header count inconsistency is implied, and the provided code changes align with addressing this issue. However, there are minor ambiguities: the problem statement does not explicitly define the expected behavior (e.g., what the header count should be after reconsiderblock), nor does it mention specific edge cases or constraints that might affect the solution. Additionally, domain-specific terms like \"headers\" and \"best header\" are used without explanation, which could be unclear to someone unfamiliar with blockchain internals. Overall, it is mostly clear but lacks some explicit details and context for a fully comprehensive description.", "difficulty_explanation": "The difficulty of this problem falls into the \"Hard\" category due to several factors. First, the scope of code changes spans multiple files (rpc/blockchain.cpp, validation.cpp, and validation.h), indicating a need to understand and modify interactions between different components of the codebase. The changes involve core blockchain logic, such as recalculating the best header and managing block invalidity flags, which suggests a deep understanding of the system's architecture is required. Second, the technical concepts involved are moderately complex, including blockchain-specific mechanisms (e.g., block validation, chain work comparison, block status flags), thread safety with mutex locks (e.g., AssertLockHeld(cs_main)), and the need to ensure consistency across the block index. Third, while the problem statement does not explicitly mention edge cases, the nature of blockchain systems implies potential complexities such as handling forks, ensuring no invalid blocks are mistakenly considered as the best header, and maintaining consistency during concurrent operations. The code changes introduce new methods like RecalculateBestHeader and SetBlockFailureFlags, which require careful implementation to avoid performance issues or logical errors in a critical system component. Overall, this problem requires a solid grasp of the codebase's internals and careful handling of system invariants, justifying a difficulty score of 0.65.", "clarity_label": 1, "difficulty_label": 1, "human_clarity": -1, "human_difficulty": -1}
{"problem_statement": "depends: Cross-compiling `qt` for `arm-linux-gnueabihf` fails\nOn Ubuntu 24.04 with glibc 2.39:\r\n```\r\ncompiling ../3rdparty/zlib/src/gzclose.c\r\nIn file included from /usr/arm-linux-gnueabihf/include/features.h:394,\r\n                 from /usr/arm-linux-gnueabihf/include/bits/libc-header-start.h:33,\r\n                 from /usr/arm-linux-gnueabihf/include/stdio.h:28,\r\n                 from ../3rdparty/zlib/src/gzguts.h:40,\r\n                 from ../3rdparty/zlib/src/gzclose.c:6:\r\n/usr/arm-linux-gnueabihf/include/features-time64.h:26:5: error: #error \"_TIME_BITS=64 is allowed only with _FILE_OFFSET_BITS=64\"\r\n   26 | #   error \"_TIME_BITS=64 is allowed only with _FILE_OFFSET_BITS=64\"\r\n      |     ^~~~~\r\n```\r\n\r\nSome similar issues in https://bugreports.qt.io suggest to switch from the builtin `zlib` to a system one. But that doesn't look like an option for us.\n", "patch": "diff --git a/depends/packages/qt.mk b/depends/packages/qt.mk\nindex 0acf4cf565504..d057b2d410a18 100644\n--- a/depends/packages/qt.mk\n+++ b/depends/packages/qt.mk\n@@ -22,6 +22,7 @@ $(package)_patches += fix-macos-linker.patch\n $(package)_patches += memory_resource.patch\n $(package)_patches += utc_from_string_no_optimize.patch\n $(package)_patches += windows_lto.patch\n+$(package)_patches += zlib-timebits64.patch\n \n $(package)_qttranslations_file_name=qttranslations-$($(package)_suffix)\n $(package)_qttranslations_sha256_hash=24d4c58bc2a40c0f44f59ee64af4192c7d0038c1e45af61646cfc5b65058f271\n@@ -251,6 +252,7 @@ define $(package)_preprocess_cmds\n   patch -p1 -i $($(package)_patch_dir)/utc_from_string_no_optimize.patch && \\\n   patch -p1 -i $($(package)_patch_dir)/guix_cross_lib_path.patch && \\\n   patch -p1 -i $($(package)_patch_dir)/windows_lto.patch && \\\n+  patch -p1 -i $($(package)_patch_dir)/zlib-timebits64.patch && \\\n   mkdir -p qtbase/mkspecs/macx-clang-linux &&\\\n   cp -f qtbase/mkspecs/macx-clang/qplatformdefs.h qtbase/mkspecs/macx-clang-linux/ &&\\\n   cp -f $($(package)_patch_dir)/mac-qmake.conf qtbase/mkspecs/macx-clang-linux/qmake.conf && \\\ndiff --git a/depends/patches/qt/zlib-timebits64.patch b/depends/patches/qt/zlib-timebits64.patch\nnew file mode 100644\nindex 0000000000000..139c1dfa77f3e\n--- /dev/null\n+++ b/depends/patches/qt/zlib-timebits64.patch\n@@ -0,0 +1,31 @@\n+From a566e156b3fa07b566ddbf6801b517a9dba04fa3 Mon Sep 17 00:00:00 2001\n+From: Mark Adler <madler@alumni.caltech.edu>\n+Date: Sat, 29 Jul 2023 22:13:09 -0700\n+Subject: [PATCH] Avoid compiler complaints if _TIME_BITS defined when building\n+ zlib.\n+\n+zlib does not use time_t, so _TIME_BITS is irrelevant. However it\n+may be defined anyway as part of a sledgehammer indiscriminately\n+applied to all builds.\n+\n+From https://github.com/madler/zlib/commit/a566e156b3fa07b566ddbf6801b517a9dba04fa3.patch\n+---\n+ qtbase/src/3rdparty/zlib/src/gzguts.h | 5 ++---\n+ 1 file changed, 2 insertions(+), 3 deletions(-)\n+\n+diff --git a/qtbase/src/3rdparty/zlib/src/gzguts.h b/qtbase/src/3rdparty/zlib/src/gzguts.h\n+index e23f831f5..f9375047e 100644\n+--- a/qtbase/src/3rdparty/zlib/src/gzguts.h\n++++ b/qtbase/src/3rdparty/zlib/src/gzguts.h\n+@@ -26,9 +26,8 @@\n+ #  ifndef _LARGEFILE_SOURCE\n+ #    define _LARGEFILE_SOURCE 1\n+ #  endif\n+-#  ifdef _FILE_OFFSET_BITS\n+-#    undef _FILE_OFFSET_BITS\n+-#  endif\n++#  undef _FILE_OFFSET_BITS\n++#  undef _TIME_BITS\n+ #endif\n+ \n+ #ifdef HAVE_HIDDEN\n", "instance_id": "bitcoin__bitcoin-29985", "clarity": 2, "difficulty": 0.45, "clarity_explanation": "The problem statement is mostly clear in describing the issue: a compilation error occurs when cross-compiling Qt for `arm-linux-gnueabihf` on Ubuntu 24.04 due to a conflict with `_TIME_BITS=64` and `_FILE_OFFSET_BITS=64` in the zlib library. The error message and context are provided, which helps in understanding the root cause. However, there are minor ambiguities and missing details. For instance, the statement mentions that switching to a system zlib is not an option but does not explain why, which could be relevant for alternative solutions. Additionally, there are no explicit mentions of expected behavior post-fix or specific constraints for the solution (e.g., compatibility with other platforms). Despite these minor gaps, the problem's goal (fixing the compilation error) is evident, and the provided error log and reference to similar issues provide sufficient context for an experienced developer to proceed.", "difficulty_explanation": "The difficulty of this problem falls into the medium range due to several factors. First, the scope of code changes is relatively narrow, focusing on a specific patch to the zlib library within the Qt build system, as seen in the modifications to `qt.mk` and the addition of a new patch file. The changes are localized to a single area (zlib's header file) and involve adding a patch to undefine `_TIME_BITS`, which is a straightforward fix once the issue is understood. However, the problem requires understanding cross-compilation challenges, familiarity with build systems (e.g., Makefiles and patching in Qt's build process), and knowledge of C preprocessor directives and their implications on system headers. Additionally, the developer needs to grasp the interaction between glibc versions, architecture-specific headers, and third-party libraries like zlib. While the patch itself is small, identifying the root cause (the conflict between `_TIME_BITS` and `_FILE_OFFSET_BITS`) and ensuring the fix does not introduce regressions in other environments adds moderate complexity. Edge cases are not explicitly mentioned in the problem statement, but a developer must consider potential impacts on other architectures or glibc versions, though the provided patch seems to address the issue generically. Overall, this problem requires a moderate level of expertise in build systems and cross-compilation but does not involve deep architectural changes or highly complex logic, justifying a score of 0.45.", "clarity_label": 1, "difficulty_label": 1, "human_clarity": -1, "human_difficulty": -1}
{"problem_statement": "Show a more descriptive error message when the ConptyConnection fails to start for some reason\n# Description of the new feature/enhancement\r\n\r\nShow a speaking error message, when it is necessary to run Terminal with admin privileges. See https://github.com/microsoft/terminal/issues/4272 for the problem\r\n\r\n# Proposed technical implementation details (optional)\r\n\r\n<!-- \r\nA clear and concise description of what you want to happen.\r\n-->\nShow a more descriptive error message when the ConptyConnection fails to start for some reason\n# Description of the new feature/enhancement\r\n\r\nShow a speaking error message, when it is necessary to run Terminal with admin privileges. See https://github.com/microsoft/terminal/issues/4272 for the problem\r\n\r\n# Proposed technical implementation details (optional)\r\n\r\n<!-- \r\nA clear and concise description of what you want to happen.\r\n-->\n", "patch": "diff --git a/.github/actions/spelling/allow/allow.txt b/.github/actions/spelling/allow/allow.txt\nindex 630edfebce7..a936b3df359 100644\n--- a/.github/actions/spelling/allow/allow.txt\n+++ b/.github/actions/spelling/allow/allow.txt\n@@ -11,6 +11,7 @@ colorbrewer\n commandlines\n consvc\n copyable\n+CText\n dalet\n dcs\n deselection\ndiff --git a/src/cascadia/TerminalConnection/ConptyConnection.cpp b/src/cascadia/TerminalConnection/ConptyConnection.cpp\nindex 0a0b26aa934..075eb734356 100644\n--- a/src/cascadia/TerminalConnection/ConptyConnection.cpp\n+++ b/src/cascadia/TerminalConnection/ConptyConnection.cpp\n@@ -428,6 +428,20 @@ namespace winrt::Microsoft::Terminal::TerminalConnection::implementation\n             TerminalOutput.raise(L\"\\r\\n\");\n             TerminalOutput.raise(badPathText);\n         }\n+        // If the requested action requires elevation, display appropriate message\n+        else if (hr == HRESULT_FROM_WIN32(ERROR_ELEVATION_REQUIRED))\n+        {\n+            const auto elevationText = RS_(L\"ElevationRequired\");\n+            TerminalOutput.raise(L\"\\r\\n\");\n+            TerminalOutput.raise(elevationText);\n+        }\n+        // If the requested executable was not found, display appropriate message\n+        else if (hr == HRESULT_FROM_WIN32(ERROR_FILE_NOT_FOUND))\n+        {\n+            const auto fileNotFoundText = RS_(L\"FileNotFound\");\n+            TerminalOutput.raise(L\"\\r\\n\");\n+            TerminalOutput.raise(fileNotFoundText);\n+        }\n \n         _transitionToState(ConnectionState::Failed);\n \ndiff --git a/src/cascadia/TerminalConnection/Resources/en-US/Resources.resw b/src/cascadia/TerminalConnection/Resources/en-US/Resources.resw\nindex 3532e310491..82c7291a607 100644\n--- a/src/cascadia/TerminalConnection/Resources/en-US/Resources.resw\n+++ b/src/cascadia/TerminalConnection/Resources/en-US/Resources.resw\n@@ -209,7 +209,7 @@\n   </data>\r\n   <data name=\"CtrlDToClose\" xml:space=\"preserve\">\r\n     <value>You can now close this terminal with Ctrl+D, or press Enter to restart.</value>\r\n-\t  <comment>\"Ctrl+D\" and \"Enter\" represent keys the user will press (control+D and Enter).</comment>\r\n+    <comment>\"Ctrl+D\" and \"Enter\" represent keys the user will press (control+D and Enter).</comment>\r\n   </data>\r\n   <data name=\"ProcessFailedToLaunch\" xml:space=\"preserve\">\r\n     <value>[error {0} when launching `{1}']</value>\r\n@@ -220,4 +220,10 @@\n     <value>Could not access starting directory \"{0}\"</value>\r\n     <comment>The first argument {0} is a path to a directory on the filesystem, as provided by the user.</comment>\r\n   </data>\r\n-</root>\r\n+  <data name=\"ElevationRequired\" xml:space=\"preserve\">\r\n+    <value>The requested operation requires elevation.</value>\r\n+  </data>\r\n+  <data name=\"FileNotFound\" xml:space=\"preserve\">\r\n+    <value>The system cannot find the file specified.</value>\r\n+  </data>\r\n+</root>\n\\ No newline at end of file\n", "instance_id": "microsoft__terminal-18462", "clarity": 2, "difficulty": 0.25, "clarity_explanation": "The problem statement is mostly clear in its intent to enhance error messaging for the ConptyConnection when it fails to start, specifically addressing scenarios like the need for admin privileges or file not found errors. It references a related GitHub issue for context, which is helpful. However, there are minor ambiguities and missing details. For instance, the problem statement does not explicitly define all possible failure scenarios that should be covered beyond elevation and file not found errors, nor does it specify the exact format or tone of the error messages. Additionally, there are no examples of expected output or user interaction, which could help clarify the desired outcome. Despite these minor gaps, the overall goal is understandable, and the code changes align with the stated intent, making it \"Mostly Clear.\"", "difficulty_explanation": "The difficulty of this problem is rated as Easy (0.25) based on the following analysis of the factors:\n\n1. **Scope and Depth of Code Changes:** The modifications are localized to a single file (`ConptyConnection.cpp`) for the core logic, with additional minor updates to a resource file (`Resources.resw`) for error message strings and a spelling allowance file. The changes involve adding straightforward conditional checks for specific error codes (`ERROR_ELEVATION_REQUIRED` and `ERROR_FILE_NOT_FOUND`) and outputting corresponding error messages. There is no impact on the broader system architecture or interactions with other modules, and the amount of code change is minimal (a few lines of logic and resource additions).\n\n2. **Number of Technical Concepts:** The solution requires basic knowledge of C++ (specifically handling HRESULT error codes and string resources), familiarity with the Windows API error codes, and understanding of the project's resource system for localized strings (using `RS_` macro). These concepts are relatively simple and do not involve complex algorithms, design patterns, or domain-specific knowledge beyond basic Windows terminal behavior.\n\n3. **Potential Edge Cases and Error Handling:** The problem focuses on specific error conditions already identified in the code changes (elevation required and file not found). There are no additional complex edge cases mentioned or implied in the problem statement that need to be handled. The error handling logic added is straightforward, involving direct mapping of error codes to predefined messages.\n\n4. **Overall Complexity:** This task involves simple modifications to existing error handling logic without requiring deep understanding of the codebase or significant refactoring. It is a small, self-contained enhancement that a developer with basic to intermediate skills in C++ and familiarity with the project could implement without much difficulty.\n\nThus, the difficulty score of 0.25 reflects an Easy problem that requires minimal effort and understanding to implement, fitting within the 0.2-0.4 range for tasks involving simple function modifications and basic error handling.", "clarity_label": 1, "difficulty_label": 1, "human_clarity": -1, "human_difficulty": -1}
{"problem_statement": "Focus should move to next tab when closing a tab\n<!-- \r\n\ud83d\udea8\ud83d\udea8\ud83d\udea8\ud83d\udea8\ud83d\udea8\ud83d\udea8\ud83d\udea8\ud83d\udea8\ud83d\udea8\ud83d\udea8\r\n\r\nI ACKNOWLEDGE THE FOLLOWING BEFORE PROCEEDING:\r\n1. If I delete this entire template and go my own path, the core team may close my issue without further explanation or engagement.\r\n2. If I list multiple bugs/concerns in this one issue, the core team may close my issue without further explanation or engagement.\r\n3. If I write an issue that has many duplicates, the core team may close my issue without further explanation or engagement (and without necessarily spending time to find the exact duplicate ID number).\r\n4. If I leave the title incomplete when filing the issue, the core team may close my issue without further explanation or engagement.\r\n5. If I file something completely blank in the body, the core team may close my issue without further explanation or engagement.\r\n\r\nAll good? Then proceed!\r\n-->\r\n\r\n# Description of the new feature/enhancement\r\n\r\n<!-- \r\nA clear and concise description of what the problem is that the new feature would solve.\r\nDescribe why and how a user would use this new functionality (if applicable).\r\n-->\r\n\r\nWhen a tab is closed, focus should move to the tab to the right instead of to the left.\r\n\r\nIn Firefox and Chrome, when a tab is closed by clicking on \ud83d\uddd9, the cursor naturally lands on the following tab, and the browser shows the content of that tab, allowing the user to close multiple tabs by chain-clicking.\r\n\r\nIn Terminal, when a tab is closed by clicking on \ud83d\uddd9 (or by any other method), the previous tab is shown even though the cursor is on the following tab. The user must move their cursor from the \ud83d\uddd9, click elsewhere on the tab to preview its contents, and then decide whether to close it. An absentminded user may close important tabs because of this unexpected behavior, particularly because Terminal does not confirm tab closing #6549. Before the user moves their cursor, the tab does not show its usual hover effect, adding to the confusion.\r\n\r\n# Proposed technical implementation details (optional)\r\n\r\n<!-- \r\nA clear and concise description of what you want to happen.\r\n-->\r\n\n", "patch": "diff --git a/src/cascadia/TerminalApp/TabManagement.cpp b/src/cascadia/TerminalApp/TabManagement.cpp\nindex 30b8ec15b81..0eba4511a92 100644\n--- a/src/cascadia/TerminalApp/TabManagement.cpp\n+++ b/src/cascadia/TerminalApp/TabManagement.cpp\n@@ -491,14 +491,14 @@ namespace winrt::TerminalApp::implementation\n                 // Because this will always return -1 in this scenario unfortunately.\r\n                 //\r\n                 // So, what we're going to try to do is move the focus to the tab\r\n-                // to the left, within the bounds of how many tabs we have.\r\n+                // to the right, within the bounds of how many tabs we have.\r\n                 //\r\n                 // EX: we have 4 tabs: [A, B, C, D]. If we close:\r\n                 // * A (tabIndex=0): We'll want to focus tab B (now in index 0)\r\n-                // * B (tabIndex=1): We'll want to focus tab A (now in index 0)\r\n-                // * C (tabIndex=2): We'll want to focus tab B (now in index 1)\r\n+                // * B (tabIndex=1): We'll want to focus tab C (now in index 1)\r\n+                // * C (tabIndex=2): We'll want to focus tab D (now in index 2)\r\n                 // * D (tabIndex=3): We'll want to focus tab C (now in index 2)\r\n-                const auto newSelectedIndex = std::clamp<int32_t>(tabIndex - 1, 0, _tabs.Size() - 1);\r\n+                const auto newSelectedIndex = std::clamp<int32_t>(tabIndex, 0, _tabs.Size() - 1);\r\n                 // _UpdatedSelectedTab will do the work of setting up the new tab as\r\n                 // the focused one, and unfocusing all the others.\r\n                 auto newSelectedTab{ _tabs.GetAt(newSelectedIndex) };\r\n", "instance_id": "microsoft__terminal-18022", "clarity": 2, "difficulty": 0.15, "clarity_explanation": "The problem statement is mostly clear in describing the desired behavior change: when a tab is closed in a terminal application, the focus should move to the tab on the right rather than the left, aligning with the behavior of popular web browsers like Firefox and Chrome. The description provides context on why this change is important, highlighting user experience issues such as potential confusion and accidental tab closures. However, there are minor ambiguities and missing details. For instance, the problem statement does not explicitly address what should happen if the rightmost tab is closed (though the code change implies a fallback to the previous tab). Additionally, there are no specific examples or test cases provided to cover edge cases, such as closing the last tab or handling a single-tab scenario. While the intent is clear, these missing details prevent it from being fully comprehensive.", "difficulty_explanation": "The difficulty of this problem is very low, falling in the 0.0-0.2 range. The code change required is minimal and localized to a single file (`TabManagement.cpp`) and a specific function within it. The modification involves changing a simple logic for determining the next selected tab index after a tab closure, which is achieved by altering a single line of code (adjusting the `std::clamp` operation to focus on the right tab instead of the left). This does not require deep understanding of the broader codebase or complex interactions between modules, nor does it impact the system's architecture. The technical concepts involved are basic\u2014simple arithmetic for index calculation and familiarity with C++ standard library functions like `std::clamp`. There are no significant edge cases or error handling requirements introduced by this change beyond what is already handled in the existing code (e.g., clamping the index within valid bounds). Overall, this is a straightforward bug fix or minor feature adjustment that a junior developer with basic C++ knowledge could implement with minimal guidance.", "clarity_label": 1, "difficulty_label": 1, "human_clarity": -1, "human_difficulty": -1}
{"problem_statement": "Crash when choosing 'Close all other panes'\n### Windows Terminal version\n\n1.22.2362.0\n\n### Windows build number\n\n10.0.27699.0\n\n### Other Software\n\n_No response_\n\n### Steps to reproduce\n\n1.\tOpen Windows Terminal.\r\n2.\tSplit panes so there are at least two panes.\r\n3.\tCtrl+Shift+P and choose \u2018Close all other panes\u2019\r\n\n\n### Expected Behavior\n\nNo crash.\n\n### Actual Behavior\n\nTerminal crashes with an access violation:\r\n\r\n```\r\n(3c78.4aa0): Access violation - code c0000005 (first/second chance not available)\r\nFor analysis of this file, run !analyze -v\r\nTerminalApp!winrt::impl::consume_TerminalApp_IPaneContent<winrt::TerminalApp::IPaneContent>::TaskbarProgress+0x34 [inlined in TerminalApp!Pane::CollectTaskbarStates+0x82]:\r\n00007ffb`45483032 488b01          mov     rax,qword ptr [rcx] ds:00000000`00000000=????????????????\r\n```\r\n\r\nHere is the call stack:\r\n\r\n```\r\nTerminalApp!winrt::impl::consume_TerminalApp_IPaneContent<winrt::TerminalApp::IPaneContent>::TaskbarProgress\r\nTerminalApp!Pane::CollectTaskbarStates\r\nTerminalApp!Pane::CollectTaskbarStates\r\nTerminalApp!winrt::TerminalApp::implementation::TerminalTab::GetCombinedTaskbarState\r\nTerminalApp!winrt::TerminalApp::implementation::TerminalPage::TaskbarState\r\nTerminalApp!winrt::TerminalApp::implementation::TerminalWindow::TaskbarState\r\nTerminalApp!winrt::impl::produce<winrt::TerminalApp::implementation::TerminalWindow,winrt::TerminalApp::ITerminalWindow>::get_TaskbarState\r\nWindowsTerminal\r\nWindowsTerminal\r\nTerminalApp!winrt::Windows::Foundation::TypedEventHandler<winrt::Windows::Foundation::IInspectable,winrt::Windows::Foundation::IInspectable>::operator()\r\nTerminalApp!wil::details::dispatcher_handler::operator()\r\nTerminalApp!winrt::impl::delegate<winrt::Windows::UI::Core::DispatchedHandler,wil::details::dispatcher_handler>::Invoke\r\nWindows_UI!Microsoft::WRL::Details::DelegateArgTraits<long (__cdecl Windows::System::IDispatcherQueueHandler::*)(void)>::DelegateInvokeHelper<Microsoft::WRL::Implements<Microsoft::WRL::RuntimeClassFlags<2>,Windows::System::IDispatcherQueueHandler,Microsoft::WRL::FtmBase>,<lambda_980f345bc6e4ac8a906323c24a5fe9b1>,-1>::Invoke\r\nCoreMessaging!Windows::System::DispatcherQueue::DeferInvokeCallback\r\nCoreMessaging!CFlat::SehSafe::Execute<<lambda_654db17c35df07198786f0867aa10de6> >\r\nCoreMessaging!Microsoft::CoreUI::ActionCallback::ImportAdapter$\r\nCoreMessaging!Microsoft::CoreUI::Dispatch::DeferredCall::Callback_Dispatch\r\nCoreMessaging!Microsoft::CoreUI::Dispatch::DeferredCallDispatcher::Callback_OnDispatch\r\nCoreMessaging!Microsoft::CoreUI::Dispatch::Dispatcher::Callback_DispatchLoop\r\nCoreMessaging!Microsoft::CoreUI::Dispatch::EventLoop::Callback_RunCoreLoop\r\nuser32!_fnDWORD\r\nntdll!KiUserCallbackDispatcherContinue\r\nwin32u!NtUserGetMessage\r\nuser32!GetMessageW\r\nWindowsTerminal\r\nWindowsTerminal\r\nWindowsTerminal\r\nucrtbase!thread_start<unsigned int (__cdecl*)(void *),1>\r\nKERNEL32!BaseThreadInitThunk\r\nntdll!RtlUserThreadStart\r\n```\n", "patch": "diff --git a/src/cascadia/TerminalApp/Pane.cpp b/src/cascadia/TerminalApp/Pane.cpp\nindex a210b701528..dc235b06024 100644\n--- a/src/cascadia/TerminalApp/Pane.cpp\n+++ b/src/cascadia/TerminalApp/Pane.cpp\n@@ -2956,13 +2956,13 @@ bool Pane::ContainsReadOnly() const\n // - <none>\r\n void Pane::CollectTaskbarStates(std::vector<winrt::TerminalApp::TaskbarState>& states)\r\n {\r\n-    if (_IsLeaf())\r\n+    if (_content)\r\n     {\r\n         auto tbState{ winrt::make<winrt::TerminalApp::implementation::TaskbarState>(_content.TaskbarState(),\r\n                                                                                     _content.TaskbarProgress()) };\r\n         states.push_back(tbState);\r\n     }\r\n-    else\r\n+    else if (_firstChild && _secondChild)\r\n     {\r\n         _firstChild->CollectTaskbarStates(states);\r\n         _secondChild->CollectTaskbarStates(states);\r\n", "instance_id": "microsoft__terminal-17886", "clarity": 2, "difficulty": 0.3, "clarity_explanation": "The problem statement is mostly clear in describing the issue: a crash occurs in Windows Terminal when selecting \"Close all other panes\" under specific conditions (having at least two panes open). The steps to reproduce are well-defined, and the expected behavior (no crash) versus actual behavior (crash with access violation) is explicitly stated. Additionally, a detailed call stack is provided, which helps in identifying the problematic area of the codebase. However, there are minor ambiguities and missing details. For instance, the problem statement does not specify whether this issue occurs under specific configurations or environments beyond the provided Windows Terminal and build versions. Edge cases, such as the behavior with different types of content in panes or varying numbers of panes, are not mentioned. These omissions prevent the statement from being fully comprehensive, warranting a score of 2 (Mostly Clear).", "difficulty_explanation": "The difficulty of this problem falls into the \"Easy\" range (0.2-0.4) due to several factors. First, the scope of the code change is minimal, confined to a single file (`Pane.cpp`) and a small modification in the `CollectTaskbarStates` method. The change addresses a null pointer dereference issue by adding a check for `_content` before accessing it and ensuring both child panes exist before recursion. This indicates a straightforward bug fix rather than a complex feature addition or architectural change. Second, the technical concepts involved are basic: understanding null pointer checks and conditional logic in C++ within the context of the Windows Terminal codebase. No advanced algorithms, design patterns, or domain-specific knowledge beyond general C++ programming and familiarity with the project's structure are required. Third, while the crash itself is a critical issue, the provided call stack and code diff pinpoint the root cause (likely accessing a null `_content` after closing panes), reducing the debugging effort. Edge cases and error handling are not extensively discussed in the problem statement, but the fix itself does not introduce complex error handling logic beyond a simple null check. Overall, this problem requires understanding some code logic and making a simple modification, justifying a difficulty score of 0.30.", "clarity_label": 1, "difficulty_label": 1, "human_clarity": -1, "human_difficulty": -1}
{"problem_statement": "Better icons for Visual Studio Developer Command Prompt/Powershell profiles\n<!-- \r\n\ud83d\udea8\ud83d\udea8\ud83d\udea8\ud83d\udea8\ud83d\udea8\ud83d\udea8\ud83d\udea8\ud83d\udea8\ud83d\udea8\ud83d\udea8\r\n\r\nI ACKNOWLEDGE THE FOLLOWING BEFORE PROCEEDING:\r\n1. If I delete this entire template and go my own path, the core team may close my issue without further explanation or engagement.\r\n2. If I list multiple bugs/concerns in this one issue, the core team may close my issue without further explanation or engagement.\r\n3. If I write an issue that has many duplicates, the core team may close my issue without further explanation or engagement (and without necessarily spending time to find the exact duplicate ID number).\r\n4. If I leave the title incomplete when filing the issue, the core team may close my issue without further explanation or engagement.\r\n5. If I file something completely blank in the body, the core team may close my issue without further explanation or engagement.\r\n\r\nAll good? Then proceed!\r\n-->\r\n\r\n# Description of the new feature/enhancement\r\nCustom icons for the `Developer PowerShell for VS 2022` and `Developer Command Prompt for VS 2022` profiles would be a nice touch.\r\n\r\n![5tXWrREqj0](https://github.com/user-attachments/assets/2456f899-1a19-4dfe-848c-e8543d339584)\r\n\r\n\r\n<!-- \r\nA clear and concise description of what the problem is that the new feature would solve.\r\nDescribe why and how a user would use this new functionality (if applicable).\r\n-->\r\n\r\n# Proposed technical implementation details (optional)\r\nInclude images in the app's `ProfileIcons/` directory and automatically use them for said profiles. I threw these together in GIMP. If they are satisfactory, feel free to use them.\r\n\r\n![cmd_vs](https://github.com/user-attachments/assets/1d3da7f9-1de7-40f1-9932-196fa10ec130)\r\n\r\n![powershell5_vs](https://github.com/user-attachments/assets/1cb5ab60-31b2-4825-8666-74eca7b243fa)\r\n\r\n\r\n<!-- \r\nA clear and concise description of what you want to happen.\r\n-->\r\n\n", "patch": "diff --git a/src/cascadia/CascadiaPackage/ProfileIcons/vs-cmd.scale-100.png b/src/cascadia/CascadiaPackage/ProfileIcons/vs-cmd.scale-100.png\nnew file mode 100644\nindex 00000000000..9e712ad8d95\nBinary files /dev/null and b/src/cascadia/CascadiaPackage/ProfileIcons/vs-cmd.scale-100.png differ\ndiff --git a/src/cascadia/CascadiaPackage/ProfileIcons/vs-cmd.scale-150.png b/src/cascadia/CascadiaPackage/ProfileIcons/vs-cmd.scale-150.png\nnew file mode 100644\nindex 00000000000..82aa697c74f\nBinary files /dev/null and b/src/cascadia/CascadiaPackage/ProfileIcons/vs-cmd.scale-150.png differ\ndiff --git a/src/cascadia/CascadiaPackage/ProfileIcons/vs-cmd.scale-200.png b/src/cascadia/CascadiaPackage/ProfileIcons/vs-cmd.scale-200.png\nnew file mode 100644\nindex 00000000000..ea8c240656d\nBinary files /dev/null and b/src/cascadia/CascadiaPackage/ProfileIcons/vs-cmd.scale-200.png differ\ndiff --git a/src/cascadia/CascadiaPackage/ProfileIcons/vs-powershell.scale-100.png b/src/cascadia/CascadiaPackage/ProfileIcons/vs-powershell.scale-100.png\nnew file mode 100644\nindex 00000000000..54a8c126ff7\nBinary files /dev/null and b/src/cascadia/CascadiaPackage/ProfileIcons/vs-powershell.scale-100.png differ\ndiff --git a/src/cascadia/CascadiaPackage/ProfileIcons/vs-powershell.scale-150.png b/src/cascadia/CascadiaPackage/ProfileIcons/vs-powershell.scale-150.png\nnew file mode 100644\nindex 00000000000..66486474a59\nBinary files /dev/null and b/src/cascadia/CascadiaPackage/ProfileIcons/vs-powershell.scale-150.png differ\ndiff --git a/src/cascadia/CascadiaPackage/ProfileIcons/vs-powershell.scale-200.png b/src/cascadia/CascadiaPackage/ProfileIcons/vs-powershell.scale-200.png\nnew file mode 100644\nindex 00000000000..68aa47b458f\nBinary files /dev/null and b/src/cascadia/CascadiaPackage/ProfileIcons/vs-powershell.scale-200.png differ\ndiff --git a/src/cascadia/CascadiaPackage/ProfileIcons/vs-pwsh.scale-100.png b/src/cascadia/CascadiaPackage/ProfileIcons/vs-pwsh.scale-100.png\nnew file mode 100644\nindex 00000000000..1fa174e5ac7\nBinary files /dev/null and b/src/cascadia/CascadiaPackage/ProfileIcons/vs-pwsh.scale-100.png differ\ndiff --git a/src/cascadia/CascadiaPackage/ProfileIcons/vs-pwsh.scale-150.png b/src/cascadia/CascadiaPackage/ProfileIcons/vs-pwsh.scale-150.png\nnew file mode 100644\nindex 00000000000..57615ac57ee\nBinary files /dev/null and b/src/cascadia/CascadiaPackage/ProfileIcons/vs-pwsh.scale-150.png differ\ndiff --git a/src/cascadia/CascadiaPackage/ProfileIcons/vs-pwsh.scale-200.png b/src/cascadia/CascadiaPackage/ProfileIcons/vs-pwsh.scale-200.png\nnew file mode 100644\nindex 00000000000..d7f31d5d715\nBinary files /dev/null and b/src/cascadia/CascadiaPackage/ProfileIcons/vs-pwsh.scale-200.png differ\ndiff --git a/src/cascadia/TerminalSettingsModel/CascadiaSettingsSerialization.cpp b/src/cascadia/TerminalSettingsModel/CascadiaSettingsSerialization.cpp\nindex 3d576f60603..6febe041d67 100644\n--- a/src/cascadia/TerminalSettingsModel/CascadiaSettingsSerialization.cpp\n+++ b/src/cascadia/TerminalSettingsModel/CascadiaSettingsSerialization.cpp\n@@ -20,9 +20,6 @@\n #include \"SshHostGenerator.h\"\r\n #endif\r\n \r\n-// userDefault.h is like the above, but with a default template for the user's settings.json.\r\n-#include <LegacyProfileGeneratorNamespaces.h>\r\n-\r\n #include \"ApplicationState.h\"\r\n #include \"DefaultTerminal.h\"\r\n #include \"FileUtils.h\"\r\n@@ -465,6 +462,11 @@ bool SettingsLoader::FixupUserSettings()\n         CommandlinePatch{ DEFAULT_WINDOWS_POWERSHELL_GUID, L\"powershell.exe\", L\"%SystemRoot%\\\\System32\\\\WindowsPowerShell\\\\v1.0\\\\powershell.exe\" },\r\n     };\r\n \r\n+    static constexpr std::array iconsToClearFromVisualStudioProfiles{\r\n+        std::wstring_view{ L\"ms-appx:///ProfileIcons/{61c54bbd-c2c6-5271-96e7-009a87ff44bf}.png\" },\r\n+        std::wstring_view{ L\"ms-appx:///ProfileIcons/{0caa0dad-35be-5f56-a8ff-afceeeaa6101}.png\" },\r\n+    };\r\n+\r\n     auto fixedUp = userSettings.fixupsAppliedDuringLoad;\r\n     fixedUp = userSettings.globals->FixupsAppliedDuringLoad() || fixedUp;\r\n \r\n@@ -473,28 +475,39 @@ bool SettingsLoader::FixupUserSettings()\n     {\r\n         fixedUp = RemapColorSchemeForProfile(profile) || fixedUp;\r\n \r\n-        if (!profile->HasCommandline())\r\n+        if (profile->HasCommandline())\r\n         {\r\n-            continue;\r\n+            for (const auto& patch : commandlinePatches)\r\n+            {\r\n+                if (profile->Guid() == patch.guid && til::equals_insensitive_ascii(profile->Commandline(), patch.before))\r\n+                {\r\n+                    profile->ClearCommandline();\r\n+\r\n+                    // GH#12842:\r\n+                    // With the commandline field on the user profile gone, it's actually unknown what\r\n+                    // commandline it'll inherit, since a user profile can have multiple parents. We have to\r\n+                    // make sure we restore the correct commandline in case we don't inherit the expected one.\r\n+                    if (profile->Commandline() != patch.after)\r\n+                    {\r\n+                        profile->Commandline(winrt::hstring{ patch.after });\r\n+                    }\r\n+\r\n+                    fixedUp = true;\r\n+                    break;\r\n+                }\r\n+            }\r\n         }\r\n \r\n-        for (const auto& patch : commandlinePatches)\r\n+        if (profile->HasIcon() && profile->HasSource() && profile->Source() == VisualStudioGenerator::Namespace)\r\n         {\r\n-            if (profile->Guid() == patch.guid && til::equals_insensitive_ascii(profile->Commandline(), patch.before))\r\n+            for (auto&& icon : iconsToClearFromVisualStudioProfiles)\r\n             {\r\n-                profile->ClearCommandline();\r\n-\r\n-                // GH#12842:\r\n-                // With the commandline field on the user profile gone, it's actually unknown what\r\n-                // commandline it'll inherit, since a user profile can have multiple parents. We have to\r\n-                // make sure we restore the correct commandline in case we don't inherit the expected one.\r\n-                if (profile->Commandline() != patch.after)\r\n+                if (profile->Icon() == icon)\r\n                 {\r\n-                    profile->Commandline(winrt::hstring{ patch.after });\r\n+                    profile->ClearIcon();\r\n+                    fixedUp = true;\r\n+                    break;\r\n                 }\r\n-\r\n-                fixedUp = true;\r\n-                break;\r\n             }\r\n         }\r\n     }\r\ndiff --git a/src/cascadia/TerminalSettingsModel/Profile.cpp b/src/cascadia/TerminalSettingsModel/Profile.cpp\nindex 0f568b37e53..66382c857b1 100644\n--- a/src/cascadia/TerminalSettingsModel/Profile.cpp\n+++ b/src/cascadia/TerminalSettingsModel/Profile.cpp\n@@ -329,7 +329,7 @@ Json::Value Profile::ToJson() const\n     // Recall: Icon isn't actually a setting in the MTSM_PROFILE_SETTINGS. We\r\n     // defined it manually in Profile, so make sure we only serialize the Icon\r\n     // if the user actually changed it here.\r\n-    JsonUtils::SetValueForKey(json, IconKey, (writeBasicSettings && HasIcon()) ? Icon() : _Icon);\r\n+    JsonUtils::SetValueForKey(json, IconKey, _Icon);\r\n \r\n     // PermissiveStringConverter is unnecessary for serialization\r\n     JsonUtils::SetValueForKey(json, PaddingKey, _Padding);\r\ndiff --git a/src/cascadia/TerminalSettingsModel/VisualStudioGenerator.cpp b/src/cascadia/TerminalSettingsModel/VisualStudioGenerator.cpp\nindex 3fd3bca8a71..2fcfb1cc528 100644\n--- a/src/cascadia/TerminalSettingsModel/VisualStudioGenerator.cpp\n+++ b/src/cascadia/TerminalSettingsModel/VisualStudioGenerator.cpp\n@@ -9,9 +9,11 @@\n \r\n using namespace winrt::Microsoft::Terminal::Settings::Model;\r\n \r\n+std::wstring_view VisualStudioGenerator::Namespace{ L\"Windows.Terminal.VisualStudio\" };\r\n+\r\n std::wstring_view VisualStudioGenerator::GetNamespace() const noexcept\r\n {\r\n-    return std::wstring_view{ L\"Windows.Terminal.VisualStudio\" };\r\n+    return Namespace;\r\n }\r\n \r\n void VisualStudioGenerator::GenerateProfiles(std::vector<winrt::com_ptr<implementation::Profile>>& profiles) const\r\ndiff --git a/src/cascadia/TerminalSettingsModel/VisualStudioGenerator.h b/src/cascadia/TerminalSettingsModel/VisualStudioGenerator.h\nindex 766d2cd7775..ef36284db74 100644\n--- a/src/cascadia/TerminalSettingsModel/VisualStudioGenerator.h\n+++ b/src/cascadia/TerminalSettingsModel/VisualStudioGenerator.h\n@@ -26,6 +26,7 @@ namespace winrt::Microsoft::Terminal::Settings::Model\n     class VisualStudioGenerator : public IDynamicProfileGenerator\r\n     {\r\n     public:\r\n+        static std::wstring_view Namespace;\r\n         std::wstring_view GetNamespace() const noexcept override;\r\n         void GenerateProfiles(std::vector<winrt::com_ptr<implementation::Profile>>& profiles) const override;\r\n \r\ndiff --git a/src/cascadia/TerminalSettingsModel/VsDevCmdGenerator.h b/src/cascadia/TerminalSettingsModel/VsDevCmdGenerator.h\nindex dd5d42dba38..eab94e89546 100644\n--- a/src/cascadia/TerminalSettingsModel/VsDevCmdGenerator.h\n+++ b/src/cascadia/TerminalSettingsModel/VsDevCmdGenerator.h\n@@ -41,7 +41,7 @@ namespace winrt::Microsoft::Terminal::Settings::Model\n \r\n         std::wstring GetProfileIconPath() const\r\n         {\r\n-            return L\"ms-appx:///ProfileIcons/{0caa0dad-35be-5f56-a8ff-afceeeaa6101}.png\";\r\n+            return L\"ms-appx:///ProfileIcons/vs-cmd.png\";\r\n         }\r\n \r\n         std::wstring GetProfileName(const VsSetupConfiguration::VsSetupInstance& instance) const;\r\ndiff --git a/src/cascadia/TerminalSettingsModel/VsDevShellGenerator.h b/src/cascadia/TerminalSettingsModel/VsDevShellGenerator.h\nindex b7d14e8b951..7557b503c0b 100644\n--- a/src/cascadia/TerminalSettingsModel/VsDevShellGenerator.h\n+++ b/src/cascadia/TerminalSettingsModel/VsDevShellGenerator.h\n@@ -38,7 +38,7 @@ namespace winrt::Microsoft::Terminal::Settings::Model\n \r\n         std::wstring GetProfileIconPath() const\r\n         {\r\n-            return L\"ms-appx:///ProfileIcons/{61c54bbd-c2c6-5271-96e7-009a87ff44bf}.png\";\r\n+            return L\"ms-appx:///ProfileIcons/vs-powershell.png\";\r\n         }\r\n \r\n         std::wstring GetProfileName(const VsSetupConfiguration::VsSetupInstance& instance) const;\r\n", "instance_id": "microsoft__terminal-17706", "clarity": 2, "difficulty": 0.35, "clarity_explanation": "The problem statement is mostly clear in its intent to add custom icons for Visual Studio Developer Command Prompt and PowerShell profiles. It provides a description of the desired feature and includes images of the proposed icons, which helps in understanding the goal. However, there are minor ambiguities and missing details. For instance, the problem statement does not explicitly define how the icons should be integrated into the application (beyond placing them in a directory) or specify any constraints or requirements for icon formats, sizes, or naming conventions beyond what is shown in the code changes. Additionally, there is no mention of potential edge cases, such as what should happen if the icons are missing or if there are conflicts with existing icons. While the proposed technical implementation is provided, it lacks depth in terms of integration logic or expected behavior in the application. Overall, the statement is valid and clear in its primary objective but misses some finer details that would make it comprehensive.", "difficulty_explanation": "The difficulty of this problem falls into the \"Easy\" range (0.2-0.4) due to the relatively straightforward nature of the task. Let's break it down based on the evaluation factors:\n\n1. **Scope and Depth of Code Changes**: The code changes involve adding new icon files to a specific directory and modifying a few source files to reference these icons for Visual Studio profiles. The changes span multiple files but are mostly localized to updating paths and clearing outdated icon references. The modifications do not appear to impact the broader system architecture significantly, as they are confined to profile settings and icon handling. The amount of code change is moderate, with a mix of binary file additions (icons) and textual changes in C++ files.\n\n2. **Number of Technical Concepts**: Solving this problem requires a basic understanding of C++ (given the codebase context), file path handling, and how profile settings are managed in the application (likely Windows Terminal or a related project). There are no complex algorithms, design patterns, or advanced language features involved. The primary technical challenge is understanding the profile generation and settings serialization logic to ensure the new icons are correctly applied, which is relatively simple for someone familiar with the codebase or C++ in general.\n\n3. **Potential Edge Cases and Error Handling**: The problem statement does not explicitly mention edge cases, and the code changes do not introduce significant error handling logic. However, there are implicit considerations, such as ensuring the icon files are present and correctly referenced, or handling cases where user settings might override the default icons. These are minor and do not add substantial complexity to the task.\n\n4. **Overall Complexity**: The task involves understanding a small part of the codebase related to profile settings and making targeted updates. It does not require deep architectural changes or advanced domain-specific knowledge beyond basic application configuration. The changes are more about integration than innovation, fitting well within the \"Easy\" category. I\u2019ve rated it slightly higher within this range (0.35) due to the need to navigate and modify multiple files and understand the profile settings logic, which adds a small layer of complexity compared to a single-file change or a trivial update.\n\nIn summary, this is an easy problem that requires moderate familiarity with the codebase and straightforward modifications to implement custom icons for specific profiles. It does not pose significant technical challenges or require handling complex edge cases.", "clarity_label": 1, "difficulty_label": 1, "human_clarity": -1, "human_difficulty": -1}
{"problem_statement": "Terminal crashes when closing any other pane than the last\n### Windows Terminal version\r\n\r\n1.21.1272.0\r\n\r\n### Windows build number\r\n\r\n10.0.22631.3593\r\n\r\n### Other Software\r\n\r\n_No response_\r\n\r\n### Steps to reproduce\r\n\r\nopen terminal. split horizontally twice. change to middle pane. CTRL-D -- crash.\r\n\r\ni have mouse tracking turned on if relevant\r\n\r\n![term-crash](https://github.com/microsoft/terminal/assets/46322585/fbb48d78-ecf0-4ced-8d41-5995c179b7ce)\r\n\r\n\r\n### Expected Behavior\r\n\r\nobviously, no crash :)\r\n\r\n### Actual Behavior\r\n\r\nit crashes and takes \"a long time\" to start\n", "patch": "diff --git a/src/cascadia/TerminalApp/Pane.cpp b/src/cascadia/TerminalApp/Pane.cpp\nindex fd195d8d42a..899e67e14ec 100644\n--- a/src/cascadia/TerminalApp/Pane.cpp\n+++ b/src/cascadia/TerminalApp/Pane.cpp\n@@ -467,7 +467,7 @@ std::shared_ptr<Pane> Pane::NextPane(const std::shared_ptr<Pane> targetPane)\n     std::shared_ptr<Pane> nextPane = nullptr;\r\n     auto foundTarget = false;\r\n \r\n-    auto foundNext = WalkTree([&](auto pane) {\r\n+    auto foundNext = WalkTree([&](const auto& pane) {\r\n         // If we are a parent pane we don't want to move to one of our children\r\n         if (foundTarget && targetPane->_HasChild(pane))\r\n         {\r\n@@ -985,6 +985,17 @@ void Pane::_ContentLostFocusHandler(const winrt::Windows::Foundation::IInspectab\n // - <none>\r\n void Pane::Close()\r\n {\r\n+    // Pane has two events, CloseRequested and Closed. CloseRequested is raised by the content asking to be closed,\r\n+    // but also by the window who owns the tab when it's closing. The event is then caught by the TerminalTab which\r\n+    // calls Close() which then raises the Closed event. Now, if this is the last pane in the window, this will result\r\n+    // in the window raising CloseRequested again which leads to infinite recursion, so we need to guard against that.\r\n+    // Ideally we would have just a single event in the future.\r\n+    if (_closed)\r\n+    {\r\n+        return;\r\n+    }\r\n+\r\n+    _closed = true;\r\n     // Fire our Closed event to tell our parent that we should be removed.\r\n     Closed.raise(nullptr, nullptr);\r\n }\r\n@@ -1341,7 +1352,7 @@ std::shared_ptr<Pane> Pane::DetachPane(std::shared_ptr<Pane> pane)\n         detached->_ApplySplitDefinitions();\r\n \r\n         // Trigger the detached event on each child\r\n-        detached->WalkTree([](auto pane) {\r\n+        detached->WalkTree([](const auto& pane) {\r\n             pane->Detached.raise(pane);\r\n         });\r\n \r\n@@ -1542,7 +1553,7 @@ void Pane::_CloseChild(const bool closeFirst)\n         {\r\n             // update our path to our first remaining leaf\r\n             _parentChildPath = _firstChild;\r\n-            _firstChild->WalkTree([](auto p) {\r\n+            _firstChild->WalkTree([](const auto& p) {\r\n                 if (p->_IsLeaf())\r\n                 {\r\n                     return true;\r\n@@ -2398,7 +2409,7 @@ void Pane::Id(uint32_t id) noexcept\n bool Pane::FocusPane(const uint32_t id)\r\n {\r\n     // Always clear the parent child path if we are focusing a leaf\r\n-    return WalkTree([=](auto p) {\r\n+    return WalkTree([=](const auto& p) {\r\n         p->_parentChildPath.reset();\r\n         if (p->_id == id)\r\n         {\r\n@@ -2421,7 +2432,7 @@ bool Pane::FocusPane(const uint32_t id)\n // - true if focus was set\r\n bool Pane::FocusPane(const std::shared_ptr<Pane> pane)\r\n {\r\n-    return WalkTree([&](auto p) {\r\n+    return WalkTree([&](const auto& p) {\r\n         if (p == pane)\r\n         {\r\n             p->_Focus();\r\ndiff --git a/src/cascadia/TerminalApp/Pane.h b/src/cascadia/TerminalApp/Pane.h\nindex f25a7b0834a..86757ad36f9 100644\n--- a/src/cascadia/TerminalApp/Pane.h\n+++ b/src/cascadia/TerminalApp/Pane.h\n@@ -248,7 +248,7 @@ class Pane : public std::enable_shared_from_this<Pane>\n \r\n     std::optional<uint32_t> _id;\r\n     std::weak_ptr<Pane> _parentChildPath{};\r\n-\r\n+    bool _closed{ false };\r\n     bool _lastActive{ false };\r\n     winrt::event_token _firstClosedToken{ 0 };\r\n     winrt::event_token _secondClosedToken{ 0 };\r\ndiff --git a/src/cascadia/TerminalApp/TabManagement.cpp b/src/cascadia/TerminalApp/TabManagement.cpp\nindex 3053d746df2..8ef5a36584e 100644\n--- a/src/cascadia/TerminalApp/TabManagement.cpp\n+++ b/src/cascadia/TerminalApp/TabManagement.cpp\n@@ -739,7 +739,7 @@ namespace winrt::TerminalApp::implementation\n             }\r\n \r\n             // Clean read-only mode to prevent additional prompt if closing the pane triggers closing of a hosting tab\r\n-            pane->WalkTree([](auto p) {\r\n+            pane->WalkTree([](const auto& p) {\r\n                 if (const auto control{ p->GetTerminalControl() })\r\n                 {\r\n                     if (control.ReadOnly())\r\ndiff --git a/src/cascadia/TerminalApp/TerminalPage.cpp b/src/cascadia/TerminalApp/TerminalPage.cpp\nindex ca86bb80a37..54a3e4efe09 100644\n--- a/src/cascadia/TerminalApp/TerminalPage.cpp\n+++ b/src/cascadia/TerminalApp/TerminalPage.cpp\n@@ -3810,7 +3810,7 @@ namespace winrt::TerminalApp::implementation\n             // recipe for disaster. We won't ever open up a tab in this window.\n             newTerminalArgs.Elevate(false);\n             const auto newPane = _MakePane(newTerminalArgs, nullptr, connection);\n-            newPane->WalkTree([](auto pane) {\n+            newPane->WalkTree([](const auto& pane) {\n                 pane->FinalizeConfigurationGivenDefault();\n             });\n             _CreateNewTabFromPane(newPane);\ndiff --git a/src/cascadia/TerminalApp/TerminalTab.cpp b/src/cascadia/TerminalApp/TerminalTab.cpp\nindex d3e52d4037d..6e1be17e38b 100644\n--- a/src/cascadia/TerminalApp/TerminalTab.cpp\n+++ b/src/cascadia/TerminalApp/TerminalTab.cpp\n@@ -41,7 +41,7 @@ namespace winrt::TerminalApp::implementation\n \r\n         auto firstId = _nextPaneId;\r\n \r\n-        _rootPane->WalkTree([&](std::shared_ptr<Pane> pane) {\r\n+        _rootPane->WalkTree([&](const auto& pane) {\r\n             // update the IDs on each pane\r\n             if (pane->_IsLeaf())\r\n             {\r\n@@ -203,7 +203,7 @@ namespace winrt::TerminalApp::implementation\n     {\r\n         ASSERT_UI_THREAD();\r\n \r\n-        _rootPane->WalkTree([&](std::shared_ptr<Pane> pane) {\r\n+        _rootPane->WalkTree([&](const auto& pane) {\r\n             // Attach event handlers to each new pane\r\n             _AttachEventHandlersToPane(pane);\r\n             if (auto content = pane->GetContent())\r\n@@ -275,7 +275,7 @@ namespace winrt::TerminalApp::implementation\n         _UpdateHeaderControlMaxWidth();\r\n \r\n         // Update the settings on all our panes.\r\n-        _rootPane->WalkTree([&](auto pane) {\r\n+        _rootPane->WalkTree([&](const auto& pane) {\r\n             pane->UpdateSettings(settings);\r\n             return false;\r\n         });\r\n@@ -534,7 +534,7 @@ namespace winrt::TerminalApp::implementation\n \r\n         // Add the new event handlers to the new pane(s)\r\n         // and update their ids.\r\n-        pane->WalkTree([&](auto p) {\r\n+        pane->WalkTree([&](const auto& p) {\r\n             _AttachEventHandlersToPane(p);\r\n             if (p->_IsLeaf())\r\n             {\r\n@@ -624,7 +624,7 @@ namespace winrt::TerminalApp::implementation\n         // manually.\r\n         _rootPane->Closed(_rootClosedToken);\r\n         auto p = _rootPane;\r\n-        p->WalkTree([](auto pane) {\r\n+        p->WalkTree([](const auto& pane) {\r\n             pane->Detached.raise(pane);\r\n         });\r\n \r\n@@ -650,7 +650,7 @@ namespace winrt::TerminalApp::implementation\n \r\n         // Add the new event handlers to the new pane(s)\r\n         // and update their ids.\r\n-        pane->WalkTree([&](auto p) {\r\n+        pane->WalkTree([&](const auto& p) {\r\n             _AttachEventHandlersToPane(p);\r\n             if (p->_IsLeaf())\r\n             {\r\n@@ -949,26 +949,20 @@ namespace winrt::TerminalApp::implementation\n \r\n         events.CloseRequested = content.CloseRequested(\r\n             winrt::auto_revoke,\r\n-            [dispatcher, weakThis](auto sender, auto&&) -> winrt::fire_and_forget {\r\n-                // Don't forget! this ^^^^^^^^ sender can't be a reference, this is a async callback.\r\n-\r\n-                // The lambda lives in the `std::function`-style container owned by `control`. That is, when the\r\n-                // `control` gets destroyed the lambda struct also gets destroyed. In other words, we need to\r\n-                // copy `weakThis` onto the stack, because that's the only thing that gets captured in coroutines.\r\n-                // See: https://devblogs.microsoft.com/oldnewthing/20211103-00/?p=105870\r\n-                const auto weakThisCopy = weakThis;\r\n-                co_await wil::resume_foreground(dispatcher);\r\n-                // Check if Tab's lifetime has expired\r\n-                if (auto tab{ weakThisCopy.get() })\r\n+            [this](auto&& sender, auto&&) {\r\n+                if (const auto content{ sender.try_as<TerminalApp::IPaneContent>() })\r\n                 {\r\n-                    if (const auto content{ sender.try_as<TerminalApp::IPaneContent>() })\r\n+                    // Calling Close() while walking the tree is not safe, because Close() mutates the tree.\r\n+                    const auto pane = _rootPane->_FindPane([&](const auto& p) -> std::shared_ptr<Pane> {\r\n+                        if (p->GetContent() == content)\r\n+                        {\r\n+                            return p;\r\n+                        }\r\n+                        return {};\r\n+                    });\r\n+                    if (pane)\r\n                     {\r\n-                        tab->_rootPane->WalkTree([content](std::shared_ptr<Pane> pane) {\r\n-                            if (pane->GetContent() == content)\r\n-                            {\r\n-                                pane->Close();\r\n-                            }\r\n-                        });\r\n+                        pane->Close();\r\n                     }\r\n                 }\r\n             });\r\n", "instance_id": "microsoft__terminal-17333", "clarity": 2, "difficulty": 0.65, "clarity_explanation": "The problem statement is mostly clear in describing the issue: a crash occurs in Windows Terminal when closing a pane other than the last one under specific conditions (splitting panes horizontally and using CTRL-D to close the middle pane). The steps to reproduce are provided, along with the expected behavior (no crash) and actual behavior (crash and slow restart). However, there are minor ambiguities and missing details. For instance, the problem does not specify whether the crash is consistent across different configurations or environments beyond the mentioned Windows build and Terminal version. Additionally, there are no explicit mentions of edge cases or constraints (e.g., does this happen only with specific terminal content or settings beyond mouse tracking?). While the issue is valid and reproducible based on the description, these minor gaps prevent it from being fully comprehensive.", "difficulty_explanation": "The difficulty of this problem falls into the \"Hard\" category due to several factors. First, the clarity of the problem is adequate but requires the developer to infer some details, adding to the initial understanding effort. Second, the scope of code changes spans multiple files (Pane.cpp, Pane.h, TabManagement.cpp, TerminalPage.cpp, TerminalTab.cpp), indicating a need to understand interactions across different parts of the Windows Terminal codebase, particularly the pane and tab management logic. The changes involve critical modifications, such as preventing infinite recursion in the `Close()` method by adding a guard (`_closed`), and adjusting tree traversal lambdas to use `const auto&` for safety and correctness. Third, the technical concepts involved include understanding C++ lambda captures, event handling in a UI context, tree traversal algorithms, and the specific architecture of Windows Terminal's pane and tab system. These are moderately complex and require familiarity with the codebase's design patterns. Finally, while the problem statement does not explicitly mention edge cases, the code changes suggest handling critical scenarios like preventing recursive event loops during pane closure, which is a non-trivial error handling concern. Overall, solving this requires a deep understanding of the codebase and careful modification to avoid introducing new issues, justifying a score of 0.65, leaning towards the harder end of the spectrum but not reaching the \"Very Hard\" category due to the absence of system-level or highly domain-specific challenges.", "clarity_label": 1, "difficulty_label": 1, "human_clarity": -1, "human_difficulty": -1}
{"problem_statement": "Unhandled permission denied exception in plugin-manager.cc\nWhen the chunkserver plugin is not installed (as is the default in CMake right now), it will try to load the plugin from the build directory, which may not be available (could be either permissions or it could not exist, very common when transitioning from a build environment), this causes a exception which is handled by initialize, which then causes the program exits. This is undesired as chunkserver can work without a plugin.\r\n\r\nReproduce:\r\n\r\n1. Build and install from directory where `saunafs` (or whatever user is running chunkserver) cannot access the build files.\r\n2. Run chunkserver\r\n\r\nPotential fix:\r\n\r\n```diff\r\ndiff --git a/src/chunkserver/chunkserver-common/plugin_manager.cc b/src/chunkserver/chunkserver-common/plugin_manager.cc\r\nindex 30fa071a..69cf5568 100644\r\n--- a/src/chunkserver/chunkserver-common/plugin_manager.cc\r\n+++ b/src/chunkserver/chunkserver-common/plugin_manager.cc\r\n@@ -19,19 +19,27 @@\r\n #include \"common/platform.h\"\r\n \r\n #include \"chunkserver-common/plugin_manager.h\"\r\n+#include <boost/filesystem/exception.hpp>\r\n \r\n #include \"chunkserver-common/disk_plugin.h\"\r\n #include \"slogger/slogger.h\"\r\n \r\n bool PluginManager::loadPlugins(const std::string &directory) {\r\n-\tif (!boost::filesystem::is_directory(directory) ||\r\n-\t    boost::filesystem::is_empty(directory)) {\r\n-\t\t// It is normal to not have any plugins in many scenarios\r\n-\t\tsafs_pretty_syslog(\r\n-\t\t    LOG_NOTICE,\r\n-\t\t    \"PluginManager: Directory %s does not exist or is empty\",\r\n-\t\t    directory.c_str());\r\n-\t\treturn false;\r\n+\ttry {\r\n+\t\tif (!boost::filesystem::is_directory(directory) ||\r\n+\t\t    boost::filesystem::is_empty(directory)) {\r\n+\t\t\t// It is normal to not have any plugins in many scenarios\r\n+\t\t\tsafs_pretty_syslog(\r\n+\t\t\t    LOG_NOTICE,\r\n+\t\t\t    \"PluginManager: Directory %s does not exist or is empty\",\r\n+\t\t\t    directory.c_str());\r\n+\t\t\treturn false;\r\n+\t\t}\r\n+\t} catch (boost::filesystem::filesystem_error &e) {\r\n+\t\t\tsafs::log_info(\r\n+\t\t\t    \"PluginManager: Directory {} cannot not be checked: {}\",\r\n+\t\t\t    directory.c_str(), e.what());\r\n+\t\t\treturn false;\r\n \t}\r\n \r\n \tboost::filesystem::path dir(directory);\r\n```\r\n\r\nOther idea is to include the chunkserver plugin by default when installing\n", "patch": "diff --git a/src/chunkserver/chunkserver-common/plugin_manager.cc b/src/chunkserver/chunkserver-common/plugin_manager.cc\nindex 30fa071a6..69cf5568a 100644\n--- a/src/chunkserver/chunkserver-common/plugin_manager.cc\n+++ b/src/chunkserver/chunkserver-common/plugin_manager.cc\n@@ -19,19 +19,27 @@\n #include \"common/platform.h\"\n \n #include \"chunkserver-common/plugin_manager.h\"\n+#include <boost/filesystem/exception.hpp>\n \n #include \"chunkserver-common/disk_plugin.h\"\n #include \"slogger/slogger.h\"\n \n bool PluginManager::loadPlugins(const std::string &directory) {\n-\tif (!boost::filesystem::is_directory(directory) ||\n-\t    boost::filesystem::is_empty(directory)) {\n-\t\t// It is normal to not have any plugins in many scenarios\n-\t\tsafs_pretty_syslog(\n-\t\t    LOG_NOTICE,\n-\t\t    \"PluginManager: Directory %s does not exist or is empty\",\n-\t\t    directory.c_str());\n-\t\treturn false;\n+\ttry {\n+\t\tif (!boost::filesystem::is_directory(directory) ||\n+\t\t    boost::filesystem::is_empty(directory)) {\n+\t\t\t// It is normal to not have any plugins in many scenarios\n+\t\t\tsafs_pretty_syslog(\n+\t\t\t    LOG_NOTICE,\n+\t\t\t    \"PluginManager: Directory %s does not exist or is empty\",\n+\t\t\t    directory.c_str());\n+\t\t\treturn false;\n+\t\t}\n+\t} catch (boost::filesystem::filesystem_error &e) {\n+\t\t\tsafs::log_info(\n+\t\t\t    \"PluginManager: Directory {} cannot not be checked: {}\",\n+\t\t\t    directory.c_str(), e.what());\n+\t\t\treturn false;\n \t}\n \n \tboost::filesystem::path dir(directory);\n", "instance_id": "leil-io__saunafs-237", "clarity": 2, "difficulty": 0.25, "clarity_explanation": "The problem statement is mostly clear in describing the issue: an unhandled permission denied exception in the plugin manager when the chunkserver plugin is not installed or accessible, leading to an undesired program exit. It provides steps to reproduce the issue and a potential fix via a code diff. However, there are minor ambiguities and missing details. For instance, the statement does not explicitly define the expected behavior beyond \"chunkserver can work without a plugin,\" nor does it mention specific edge cases or constraints (e.g., what should happen if partial access to the directory is available). Additionally, the alternative idea of including the plugin by default is mentioned but not elaborated upon, leaving some uncertainty about the full scope of the desired solution. Overall, the problem is valid and mostly clear, but these minor gaps prevent it from being comprehensive.", "difficulty_explanation": "The difficulty of this problem falls into the \"Easy\" range (0.2-0.4) due to the following factors:\n\n1. **Scope and Depth of Code Changes:** The provided code change is localized to a single function in `plugin_manager.cc` and involves a small, focused modification\u2014wrapping the directory check in a try-catch block to handle filesystem errors. It does not impact multiple modules or the broader system architecture, and the amount of code change is minimal (adding exception handling and logging).\n\n2. **Technical Concepts Involved:** The solution requires understanding basic C++ exception handling and familiarity with the Boost Filesystem library, specifically `boost::filesystem::filesystem_error`. These are relatively straightforward concepts for a developer with moderate experience in C++. No advanced algorithms, design patterns, or domain-specific knowledge are needed beyond basic filesystem operations and error logging.\n\n3. **Edge Cases and Error Handling:** The problem focuses on handling a specific error condition (permission denied or non-existent directory), and the provided solution addresses this directly with a catch block. While there might be minor edge cases (e.g., partial directory access or other filesystem errors), they are not mentioned in the problem statement and do not appear to significantly complicate the solution. The error handling logic added is simple and does not require complex decision-making.\n\n4. **Overall Complexity:** The fix is a straightforward bug resolution that does not require deep understanding of the broader codebase or intricate interactions between components. It is a contained change with minimal risk of introducing side effects, assuming the logging and return behavior align with the system's expectations.\n\nGiven these points, a difficulty score of 0.25 reflects the simplicity of the task, requiring only a basic understanding of C++ error handling and a small, targeted code modification. It is slightly above the \"Very Easy\" range due to the need to understand the Boost library's exception mechanism and ensure proper logging, but it remains an easy problem overall.", "clarity_label": 1, "difficulty_label": 1, "human_clarity": -1, "human_difficulty": -1}
{"problem_statement": "Invalid TypeScript type for event 'transactions-updated'\n### Preflight Checklist\n\n- [x] I have read the [Contributing Guidelines](https://github.com/electron/electron/blob/main/CONTRIBUTING.md) for this project.\n- [x] I agree to follow the [Code of Conduct](https://github.com/electron/electron/blob/main/CODE_OF_CONDUCT.md) that this project adheres to.\n- [x] I have searched the [issue tracker](https://www.github.com/electron/electron/issues) for a bug report that matches the one I want to file, without success.\n\n### Electron Version\n\n32.2.8\n\n### What operating system(s) are you using?\n\nOther (specify below)\n\n### Operating System Version\n\n...\n\n### What arch are you using?\n\nx64\n\n### Last Known Working Electron version\n\n_No response_\n\n### Expected Behavior\n\nExpected type:\n```ts\non(event: 'transactions-updated', listener: (event: Event, transactions: Transaction[]) => void): this;\n```\n\n### Actual Behavior\n\nActual type:\n```ts\non(event: 'transactions-updated', listener: () => void): this;\n```\n\n### Testcase Gist URL\n\n_No response_\n\n### Additional Information\n\nDocs: https://www.electronjs.org/docs/latest/api/in-app-purchase#event-transactions-updated\n", "patch": "diff --git a/docs/api/in-app-purchase.md b/docs/api/in-app-purchase.md\nindex 38078ecf29dd7..0fed7b8c2c1b6 100644\n--- a/docs/api/in-app-purchase.md\n+++ b/docs/api/in-app-purchase.md\n@@ -10,13 +10,13 @@ The `inAppPurchase` module emits the following events:\n \n ### Event: 'transactions-updated'\n \n-Emitted when one or more transactions have been updated.\n-\n Returns:\n \n * `event` Event\n * `transactions` Transaction[] - Array of [`Transaction`](structures/transaction.md) objects.\n \n+Emitted when one or more transactions have been updated.\n+\n ## Methods\n \n The `inAppPurchase` module has the following methods:\n", "instance_id": "electron__electron-45527", "clarity": 2, "difficulty": 0.15, "clarity_explanation": "The problem statement is mostly clear in identifying the issue: there is a mismatch between the expected and actual TypeScript type definitions for the 'transactions-updated' event in the Electron framework's in-app-purchase module. The expected behavior (listener function with parameters for event and transactions) and actual behavior (listener function with no parameters) are explicitly provided, which helps in understanding the goal of the fix. However, there are minor ambiguities and missing details. For instance, the problem statement does not specify whether this mismatch affects runtime behavior or is purely a type definition issue in the documentation or type files. Additionally, there are no examples of code that would fail due to this mismatch, nor are there mentions of specific edge cases or constraints to consider when fixing the type definition. The provided documentation link is helpful, but the lack of deeper context about the impact or related codebase components slightly reduces clarity.", "difficulty_explanation": "The difficulty of this problem is very low, falling in the 0.0-0.2 range, as it involves a straightforward fix to documentation or type definitions. The code change provided is minimal, affecting only a single line in the documentation file (in-app-purchase.md) to reorder the description and parameters of the 'transactions-updated' event for better clarity. However, based on the problem statement, the actual fix might also involve updating a TypeScript definition file (e.g., a .d.ts file) which is not shown in the provided diff. Even so, this task requires only basic knowledge of TypeScript type definitions and Electron's API structure. It does not involve complex logic, multiple files (beyond potentially one or two), or deep understanding of the codebase architecture. There are no significant edge cases or error handling requirements mentioned, and the change has no impact on runtime behavior or system architecture. The primary challenge is ensuring the type definition aligns with the actual implementation, which is a simple verification task. Thus, I assign a difficulty score of 0.15, reflecting a very easy problem with minimal technical depth.", "clarity_label": 1, "difficulty_label": 1, "human_clarity": -1, "human_difficulty": -1}
{"problem_statement": "[Documentation request] Explain why someone might enable the fuse `loadBrowserProcessSpecificV8Snapshot`\nThe [documentation](https://www.electronjs.org/docs/latest/tutorial/fuses#loadbrowserprocessspecificv8snapshot) of the fuse `loadBrowserProcessSpecificV8Snapshot` does not explain in which cases it would make sense to enable the fuse, i.e. why someone would want the browser process to use a separate V8 snapshot or what benefits and drawbacks that brings with it.\n\nIt would be great if that could be documented.\n", "patch": "diff --git a/docs/tutorial/fuses.md b/docs/tutorial/fuses.md\nindex 3e644f02dcad9..1afa53d6a7df3 100644\n--- a/docs/tutorial/fuses.md\n+++ b/docs/tutorial/fuses.md\n@@ -68,6 +68,10 @@ The onlyLoadAppFromAsar fuse changes the search system that Electron uses to loc\n \n The loadBrowserProcessSpecificV8Snapshot fuse changes which V8 snapshot file is used for the browser process.  By default Electron's processes will all use the same V8 snapshot file.  When this fuse is enabled the browser process uses the file called `browser_v8_context_snapshot.bin` for its V8 snapshot. The other processes will use the V8 snapshot file that they normally do.\n \n+V8 snapshots can be useful to improve app startup performance. V8 lets you take snapshots of initialized heaps and then load them back in to avoid the cost of initializing the heap.\n+\n+Using separate snapshots for renderer processes and the main process can improve security, especially to make sure that the renderer doesn't use a snapshot with `nodeIntegration` enabled. See [#35170](https://github.com/electron/electron/issues/35170) for details.\n+\n ### `grantFileProtocolExtraPrivileges`\n \n **Default:** Enabled\n", "instance_id": "electron__electron-44680", "clarity": 2, "difficulty": 0.15, "clarity_explanation": "The problem statement is mostly clear in its intent: it requests additional documentation for the `loadBrowserProcessSpecificV8Snapshot` fuse in Electron, specifically asking for an explanation of why someone might enable it and the associated benefits and drawbacks. The goal is well-defined, and the context (a link to the existing documentation) is provided. However, there are minor ambiguities, such as the lack of specific guidance on the depth or technical detail expected in the explanation. Additionally, it does not explicitly mention whether the documentation should cover specific use cases, edge cases, or performance metrics. While the intent is clear, these missing details prevent it from being comprehensive.", "difficulty_explanation": "The difficulty of this task is very low, as it primarily involves adding explanatory content to an existing documentation file rather than implementing complex code or logic. The scope of the change is minimal, confined to a single file (`docs/tutorial/fuses.md`) with a small addition of text (a couple of paragraphs). It does not require deep understanding of the Electron codebase or its architecture, nor does it involve modifying any functional code or handling edge cases. The technical concepts involved are basic\u2014understanding what a V8 snapshot is and its general purpose in improving startup performance and security. The provided code change already addresses the request by adding a concise explanation and referencing a related issue for further context. There are no significant challenges in terms of error handling, performance, or system impact. This task falls into the \"very easy\" category, as it requires only basic modifications to documentation with minimal technical depth.", "clarity_label": 1, "difficulty_label": 1, "human_clarity": -1, "human_difficulty": -1}
{"problem_statement": "[Bug]: Electron crashes with libnotify 0.8.3 in portal environment when closing notification\n### Preflight Checklist\r\n\r\n- [X] I have read the [Contributing Guidelines](https://github.com/electron/electron/blob/main/CONTRIBUTING.md) for this project.\r\n- [X] I agree to follow the [Code of Conduct](https://github.com/electron/electron/blob/main/CODE_OF_CONDUCT.md) that this project adheres to.\r\n- [X] I have searched the [issue tracker](https://www.github.com/electron/electron/issues) for a bug report that matches the one I want to file, without success.\r\n\r\n### Electron Version\r\n\r\n25.0.0, 27.0.3 and 28.0.0-beta.2\r\n\r\n### What operating system are you using?\r\n\r\nOther Linux\r\n\r\n### Operating System Version\r\n\r\n- Arch Linux\r\n- `uname -a`: `Linux hostname 6.5.7-arch1-1 #1 SMP PREEMPT_DYNAMIC Tue, 10 Oct 2023 21:10:21 +0000 x86_64 GNU/Linux`\r\n\r\n### What arch are you using?\r\n\r\nx64\r\n\r\n### Last Known Working Electron version\r\n\r\nNot sure\r\n\r\n### Expected Behavior\r\n\r\nElectron does not crash when running `notification.close()`.\r\n\r\n### Actual Behavior\r\n\r\nElectron crashes with `notification.close()` when in portal (flatpak/snap, or `NOTIFY_FORCE_PORTAL=1` is set).\r\n\r\n### Testcase Gist URL\r\n\r\n_No response_\r\n\r\n### Additional Information\r\n\r\nAn MRE modified from electron-quick-start: https://github.com/taoky/electron-libnotify-portal-crash-mre.\r\n\r\nScreencast:\r\n\r\nhttps://github.com/electron/electron/assets/2109893/9bc49b03-ddef-4599-93e6-e7b4fb168b29\r\n\r\nMy analysis:\r\n\r\n1. `LibnotifyNotification::Show()` binds \"closed\" glib signal to `LibnotifyNotification::OnNotificationClosed` https://github.com/electron/electron/blob/7999ea39e2ee9702e64e4125e8e89c314e9f468f/shell/browser/notifications/linux/libnotify_notification.cc#L91-L94\r\n2. When closing (dismissing) notification, `LibnotifyNotification::Dismiss()` is called which runs `libnotify_loader_.notify_notification_close()`: https://github.com/electron/electron/blob/7999ea39e2ee9702e64e4125e8e89c314e9f468f/shell/browser/notifications/linux/libnotify_notification.cc#L167\r\n3. In `notify_notification_close()`, as libnotify 0.8.x adds supports for portal environment, it will call `remove_portal_notification()` instead of using gdbus call (<https://gitlab.gnome.org/GNOME/libnotify/-/blob/0.8.3/libnotify/notification.c#L1761>), then it calls `close_notification()` (<https://gitlab.gnome.org/GNOME/libnotify/-/blob/0.8.3/libnotify/notification.c#L825>), and nightmare happens: it `g_signal_emit (notification, signals[SIGNAL_CLOSED], 0);` (<https://gitlab.gnome.org/GNOME/libnotify/-/blob/0.8.3/libnotify/notification.c#L707>).\r\n4. `LibnotifyNotification::OnNotificationClosed()` happily calls `NotificationDismissed()`, which finally calls `Destroy()`, and then `presenter()->RemoveNotification(this)`, and `this` is then `delete`d inside.\r\n5. `Notification::Close()` in electron_api_notification.cc has no idea about `notification_` being deleted, it continues, and crashes:\r\nhttps://github.com/electron/electron/blob/7999ea39e2ee9702e64e4125e8e89c314e9f468f/shell/browser/api/electron_api_notification.cc#L217C6-L227\n", "patch": "diff --git a/shell/browser/notifications/linux/libnotify_notification.cc b/shell/browser/notifications/linux/libnotify_notification.cc\nindex e039b382e3e24..4c8452fad1a8d 100644\n--- a/shell/browser/notifications/linux/libnotify_notification.cc\n+++ b/shell/browser/notifications/linux/libnotify_notification.cc\n@@ -159,21 +159,21 @@ void LibnotifyNotification::Show(const NotificationOptions& options) {\n \n void LibnotifyNotification::Dismiss() {\n   if (!notification_) {\n-    Destroy();\n     return;\n   }\n \n   GError* error = nullptr;\n+  on_dismissing_ = true;\n   libnotify_loader_.notify_notification_close(notification_, &error);\n   if (error) {\n     log_and_clear_error(error, \"notify_notification_close\");\n-    Destroy();\n   }\n+  on_dismissing_ = false;\n }\n \n void LibnotifyNotification::OnNotificationClosed(\n     NotifyNotification* notification) {\n-  NotificationDismissed();\n+  NotificationDismissed(!on_dismissing_);\n }\n \n void LibnotifyNotification::OnNotificationView(NotifyNotification* notification,\ndiff --git a/shell/browser/notifications/linux/libnotify_notification.h b/shell/browser/notifications/linux/libnotify_notification.h\nindex 8aacd0952062a..315419fc5c734 100644\n--- a/shell/browser/notifications/linux/libnotify_notification.h\n+++ b/shell/browser/notifications/linux/libnotify_notification.h\n@@ -33,6 +33,7 @@ class LibnotifyNotification : public Notification {\n   RAW_PTR_EXCLUSION NotifyNotification* notification_ = nullptr;\n \n   ScopedGSignal signal_;\n+  bool on_dismissing_ = false;\n };\n \n }  // namespace electron\n", "instance_id": "electron__electron-41691", "clarity": 2, "difficulty": 0.65, "clarity_explanation": "\nThe problem statement is mostly clear in describing the issue: Electron crashes when closing a notification in a portal environment with libnotify 0.8.3. It provides detailed context, including the affected Electron versions, operating system details, and a step-by-step analysis of the crash's root cause. The expected and actual behaviors are explicitly stated, and a minimal reproducible example (MRE) is referenced. However, there are minor ambiguities and missing details that prevent a perfect score. For instance, the problem statement does not explicitly mention specific constraints or requirements for the fix (e.g., compatibility with older libnotify versions or performance considerations). Additionally, edge cases beyond the portal environment are not discussed, which could be relevant for a comprehensive solution. Overall, while the issue is well-articulated for someone familiar with the domain, these minor gaps in detail result in a score of 2 (Mostly Clear).\n", "difficulty_explanation": "\nI assign a difficulty score of 0.65, placing this problem in the \"Hard\" range (0.6-0.8), due to the following factors:\n\n1. **Clarity and Complexity of the Problem Description**: While the problem is mostly clear, the underlying issue involves intricate interactions between Electron's notification system and the libnotify library in a portal environment (e.g., Flatpak/Snap). Understanding the crash requires tracing the signal handling and object lifecycle management, which adds to the logical complexity.\n\n2. **Scope and Depth of Code Changes**: The provided code changes are relatively localized, affecting only two files (`libnotify_notification.cc` and `libnotify_notification.h`). The modification introduces a flag (`on_dismissing_`) to track the dismissal state and prevent premature destruction of the notification object. However, this change requires a deep understanding of the notification lifecycle and signal handling in the Electron codebase. While the amount of code changed is small, the impact is significant as it addresses a critical crash bug. It does not appear to affect the broader system architecture, but it does require careful consideration of object ownership and deletion.\n\n3. **Number of Technical Concepts**: Solving this problem demands familiarity with several advanced concepts, including:\n   - C++ memory management and object lifecycle (e.g., avoiding double deletion or use-after-free issues).\n   - GLib signal handling (e.g., understanding how \"closed\" signals are emitted and handled).\n   - Domain-specific knowledge of Linux notification systems, particularly libnotify and portal environments.\n   - Electron's internal architecture for notifications.\n   These concepts are moderately to highly complex, especially for developers without prior experience in Linux desktop environments or Electron's internals.\n\n4. **Potential Edge Cases and Error Handling**: The problem statement does not explicitly mention additional edge cases beyond the portal environment crash, but the code change implies the need to handle the timing of dismissal and signal emission carefully. The solution must ensure that it does not introduce new issues (e.g., memory leaks or crashes in non-portal environments). Error handling logic is already present in the code (e.g., checking for GError), but the fix requires ensuring that the dismissal state is correctly managed across different scenarios, which adds moderate complexity.\n\nOverall, this problem is challenging due to the need for deep knowledge of specific libraries (libnotify, GLib) and Electron's notification system, combined with the risk of subtle bugs in object lifecycle management. It does not reach the \"Very Hard\" range (0.8-1.0) because the scope of changes is limited, and the solution does not involve system-level redesign or advanced algorithms. A score of 0.65 reflects the significant technical depth required while acknowledging that the problem is solvable with focused expertise in the relevant areas.\n", "clarity_label": 1, "difficulty_label": 1, "human_clarity": -1, "human_difficulty": -1}
{"problem_statement": "Built-in Jolt Physics colliding shape index is always 0\n### Tested versions\n\n- Reproducible in: v4.4.stable.official [4c311cbee] with built-in Jolt Physics\n- Not reproducible in: v4.3.stable.official [77dcf97d8] with Godot Jolt 0.15.0 Extension from AssetLib\n\n### System information\n\nGodot v4.3.stable - Garuda Linux #1 ZEN SMP PREEMPT_DYNAMIC Fri, 07 Mar 2025 20:18:44 +0000 - X11 - GLES3 (Compatibility) - Mesa Intel(R) HD Graphics 630 (KBL GT2) - Intel(R) Core(TM) i7-7700HQ CPU @ 2.80GHz (8 Threads)\n\n### Issue description\n\nIssue: When using Godot 4.4 with built-in Jolt Physics, `shape` value in the `get_rest_info()` output dictionary (obtained as ShapeCast3D's `collision_result`) is 0 regardless of the actual shape with which ShapeCast3D collided. \n\nExpected: different shapes have different shape indexes.\n\nThis issue does not occur when using DEFAULT physics on Godot 4.4, and it also doesnt occur when using  Godot Jolt extension or DEFAULT physics on Godot 4.3 version.\n\n### Steps to reproduce\n\n- Open MRP\n- Set project's physics engine to Jolt\n- Launch the game, note the output in the terminal being all 0 (three collision shapes report three different shapes of the same rigid body have index 0)\n- Change project's physics engine to DEFAULT\n- Launch the game, the output in the terminal should read 0 1 2 (three different shapes have different indexes)\n\nIdentical setup in a 4.3 project using the Godot Jolt Extension produces 0 1 2 as expected.\n\n### Minimal reproduction project (MRP)\n\n[ShapeTest4.4.zip](https://github.com/user-attachments/files/19436320/ShapeTest4.4.zip)\n", "patch": "diff --git a/modules/jolt_physics/spaces/jolt_physics_direct_space_state_3d.cpp b/modules/jolt_physics/spaces/jolt_physics_direct_space_state_3d.cpp\nindex ba904f0e9192..02fcbbc7e6a7 100644\n--- a/modules/jolt_physics/spaces/jolt_physics_direct_space_state_3d.cpp\n+++ b/modules/jolt_physics/spaces/jolt_physics_direct_space_state_3d.cpp\n@@ -787,7 +787,6 @@ bool JoltPhysicsDirectSpaceState3D::rest_info(const ShapeParameters &p_parameter\n \tr_info->normal = to_godot(-hit.mPenetrationAxis.Normalized());\n \tr_info->rid = object->get_rid();\n \tr_info->collider_id = object->get_instance_id();\n-\tr_info->shape = 0;\n \tr_info->linear_velocity = object->get_velocity_at_position(hit_point);\n \n \treturn true;\n", "instance_id": "godotengine__godot-104599", "clarity": 2, "difficulty": 0.15, "clarity_explanation": "The problem statement is mostly clear and provides a detailed description of the issue, including the specific behavior observed (shape index always being 0 with Jolt Physics in Godot 4.4), the expected behavior (different shapes having different indexes), and steps to reproduce the issue. It also includes version information and a minimal reproduction project (MRP), which aids in understanding the context. However, there are minor ambiguities: the problem statement does not explicitly mention how the shape index should be determined or retrieved in the codebase, nor does it discuss potential edge cases or constraints (e.g., whether this issue occurs with specific types of shapes or under certain conditions). Additionally, while the issue is well-documented with reproduction steps, the exact cause or expected fix is not hinted at in the statement, leaving some room for interpretation. Thus, it falls under \"Mostly Clear\" with minor details missing.", "difficulty_explanation": "The difficulty of this problem is very low, as the provided code change is minimal and straightforward. The modification involves removing a single line of code (`r_info->shape = 0;`) in a specific file, which suggests that the issue was caused by hardcoding the shape index to 0. This fix does not require deep understanding of the codebase, complex logic, or handling of edge cases. It falls into the \"Very Easy\" category (0.0-0.2) because:\n\n1. **Scope and Depth of Code Changes:** The change is isolated to a single line in one file (`jolt_physics_direct_space_state_3d.cpp`). There is no indication of broader impact on the system's architecture or interactions with other modules.\n2. **Technical Concepts:** The fix does not require advanced knowledge of programming language features, libraries, or algorithms. It only requires basic familiarity with C++ and the ability to identify a hardcoded value.\n3. **Edge Cases and Error Handling:** The problem statement and code change do not indicate any specific edge cases or error handling requirements. The removal of the hardcoded value likely allows the underlying physics engine to handle shape indexing correctly, with no additional logic needed in this fix.\n4. **Overall Effort:** The effort required to understand and apply this fix is minimal, akin to fixing a typo or changing a constant.\n\nWhile the problem context (physics engines in a game engine like Godot) might seem complex, the actual change is trivial and does not demand deep domain knowledge or extensive debugging. Therefore, a difficulty score of 0.15 is appropriate, reflecting a very easy task with minimal cognitive load.", "clarity_label": 1, "difficulty_label": 1, "human_clarity": -1, "human_difficulty": -1}
{"problem_statement": "Editor crash when trying to reimport gltf scenes that are nested in godot\n### Tested versions\n\nv4.4.1.rc1.official [daa4b058e]\n\n### System information\n\nGodot v4.4.1.rc1 - macOS Sequoia (15.1.0) - Multi-window, 1 monitor - Metal (Forward+) - integrated Apple M1 Max (Apple7) - Apple M1 Max (10 threads)\n\n### Issue description\n\nGodot crashes when trying to reimport two scenes where one scene is a child of another scene\n\nhttps://github.com/user-attachments/assets/95828c6e-d05f-4bb7-bbf8-ae44be9f130b\n\n### Steps to reproduce\n\nOpen the MRP, select both gltf files in the filesystem dock, right click and reimport\n\n### Minimal reproduction project (MRP)\n\n[mrp_nested_gltf_crash.zip](https://github.com/user-attachments/files/19266573/mrp_nested_gltf_crash.zip)\n", "patch": "diff --git a/editor/editor_node.cpp b/editor/editor_node.cpp\nindex 520666faa839..0614aa55bd85 100644\n--- a/editor/editor_node.cpp\n+++ b/editor/editor_node.cpp\n@@ -6457,6 +6457,18 @@ void EditorNode::reload_instances_with_path_in_edited_scenes() {\n \n \t\t\tget_scene_editor_data_for_node(owner, original_node, scene_editor_data_table);\n \n+\t\t\t// The current node being reloaded may also be an additional node for another node\n+\t\t\t// that is in the process of being reloaded.\n+\t\t\t// Replacing the additional node with the new one prevents a crash where nodes\n+\t\t\t// in 'addition_list' are removed from the scene tree and queued for deletion.\n+\t\t\tfor (InstanceModificationsEntry &im : scene_modifications->instance_list) {\n+\t\t\t\tfor (AdditiveNodeEntry &additive_node_entry : im.addition_list) {\n+\t\t\t\t\tif (additive_node_entry.node == original_node) {\n+\t\t\t\t\t\tadditive_node_entry.node = instantiated_node;\n+\t\t\t\t\t}\n+\t\t\t\t}\n+\t\t\t}\n+\n \t\t\tbool original_node_scene_instance_load_placeholder = original_node->get_scene_instance_load_placeholder();\n \n \t\t\t// Delete all the remaining node children.\n", "instance_id": "godotengine__godot-104384", "clarity": 2, "difficulty": 0.65, "clarity_explanation": "The problem statement is mostly clear in describing the issue: Godot crashes when reimporting nested glTF scenes. It provides context about the tested version, system information, steps to reproduce, and even a minimal reproduction project (MRP). However, there are minor ambiguities and missing details. For instance, the problem statement does not explicitly describe the expected behavior after the fix (e.g., should reimporting nested scenes work seamlessly, or are there specific limitations?). Additionally, it lacks details about the root cause of the crash (e.g., is it a memory issue, a dangling pointer, or something else?), which would help in understanding the problem's scope. While the steps to reproduce are clear, edge cases or specific constraints (e.g., does this happen only with glTF files, or other formats as well?) are not mentioned. Overall, the statement is valid and mostly clear but misses some minor details that could aid in fully grasping the issue without diving into the codebase or reproduction project.", "difficulty_explanation": "The difficulty of this problem falls into the \"Hard\" category due to several factors. First, the scope of the code change appears localized to a single file (`editor_node.cpp`), specifically within the `reload_instances_with_path_in_edited_scenes` function. However, the change itself addresses a critical issue related to node management during scene reloading, which suggests a deeper understanding of Godot's scene tree and instance management system is required. The modification involves updating references to nodes in an `addition_list` to prevent crashes caused by nodes being removed and queued for deletion, indicating a need to understand complex interactions between nodes and their lifecycle in the editor.\n\nSecond, the technical concepts involved are moderately advanced. The developer must be familiar with Godot's internal architecture, particularly how scene instances and node hierarchies are managed in memory during operations like reimporting. Knowledge of C++ memory management and pointer handling is crucial, as the crash likely stems from invalid references or dangling pointers. The code change, while small in terms of lines (about 10 lines), has a significant impact on preventing crashes, which implies a high level of precision and understanding of the system's behavior.\n\nThird, edge cases and error handling are implicitly critical here. The problem statement does not explicitly mention edge cases, but the nature of the crash (nested scenes during reimport) suggests that handling hierarchical dependencies and ensuring proper node replacement without breaking other parts of the scene tree are non-trivial tasks. The code change directly addresses a specific failure mode (nodes being removed and queued for deletion), but it\u2019s unclear if other related edge cases (e.g., deeply nested scenes, circular dependencies) are also handled or need additional consideration.\n\nFinally, while the change does not appear to impact the broader system architecture, it requires a deep understanding of a specific, critical part of the Godot editor's functionality. This places the difficulty at 0.65, reflecting a hard problem that demands specialized knowledge of the codebase and careful handling of node lifecycle issues, but not reaching the \"Very Hard\" category as it does not involve extensive refactoring or system-wide changes.", "clarity_label": 1, "difficulty_label": 1, "human_clarity": -1, "human_difficulty": -1}
{"problem_statement": "`NOTIFICATION_WM_POSITION_CHANGED` is not exposed in GDExtension\n### Tested versions\n\n4.4.stable\n\n### System information\n\nGodot v4.4.stable - Windows 10 (build 19045) - Multi-window, 2 monitors - Vulkan (Forward+) - dedicated NVIDIA GeForce RTX 3060 Ti (NVIDIA; 32.0.15.6636) - Intel(R) Core(TM) i7-6700K CPU @ 4.00GHz (8 threads)\n\n### Issue description\n\nOriginally reported here https://github.com/godotengine/godot-cpp/issues/1732\n\nThen I realized it better fits here.\nBasically, `extension_api.json` generated by Godot does not expose `NOTIFICATION_WM_POSITION_CHANGED`. Thus, it is not available in godot-cpp.\n\n### Steps to reproduce\n\nCall `godot --dump-extension-api` to generate api file. Observe that `NOTIFICATION_WM_POSITION_CHANGED` is not present.\n\n### Minimal reproduction project (MRP)\n\nN/A\n", "patch": "diff --git a/doc/classes/Node.xml b/doc/classes/Node.xml\nindex 15852097fb5b..fd0a2594c293 100644\n--- a/doc/classes/Node.xml\n+++ b/doc/classes/Node.xml\n@@ -1226,6 +1226,9 @@\n \t\t<constant name=\"NOTIFICATION_VP_MOUSE_EXIT\" value=\"1011\">\n \t\t\tNotification received when the mouse cursor leaves the [Viewport]'s visible area, that is not occluded behind other [Control]s or [Window]s, provided its [member Viewport.gui_disable_input] is [code]false[/code] and regardless if it's currently focused or not.\n \t\t</constant>\n+\t\t<constant name=\"NOTIFICATION_WM_POSITION_CHANGED\" value=\"1012\">\n+\t\t\tNotification received when the window is moved.\n+\t\t</constant>\n \t\t<constant name=\"NOTIFICATION_OS_MEMORY_WARNING\" value=\"2009\">\n \t\t\tNotification received from the OS when the application is exceeding its allocated memory.\n \t\t\tImplemented only on iOS.\ndiff --git a/scene/main/node.cpp b/scene/main/node.cpp\nindex 0978aa9ddfb9..ed0add6f43cd 100644\n--- a/scene/main/node.cpp\n+++ b/scene/main/node.cpp\n@@ -3811,6 +3811,7 @@ void Node::_bind_methods() {\n \tBIND_CONSTANT(NOTIFICATION_WM_DPI_CHANGE);\n \tBIND_CONSTANT(NOTIFICATION_VP_MOUSE_ENTER);\n \tBIND_CONSTANT(NOTIFICATION_VP_MOUSE_EXIT);\n+\tBIND_CONSTANT(NOTIFICATION_WM_POSITION_CHANGED);\n \tBIND_CONSTANT(NOTIFICATION_OS_MEMORY_WARNING);\n \tBIND_CONSTANT(NOTIFICATION_TRANSLATION_CHANGED);\n \tBIND_CONSTANT(NOTIFICATION_WM_ABOUT);\n", "instance_id": "godotengine__godot-104083", "clarity": 2, "difficulty": 0.15, "clarity_explanation": "The problem statement is mostly clear in identifying the issue: the `NOTIFICATION_WM_POSITION_CHANGED` constant is not exposed in the `extension_api.json` file generated by Godot, making it unavailable in the `godot-cpp` library. The goal of exposing this notification is implied, and the steps to reproduce the issue are provided (generating the API file and observing the missing constant). However, there are minor ambiguities and missing details. For instance, the problem statement does not explicitly state the expected behavior or use case for `NOTIFICATION_WM_POSITION_CHANGED` beyond a brief description in the code change. Additionally, there are no examples of how this notification should be used or any specific constraints or requirements for its implementation. Edge cases or potential side effects of adding this notification are also not mentioned. Despite these minor gaps, the issue is valid and understandable with the provided context and code changes.", "difficulty_explanation": "The difficulty of this problem is very low, falling in the 0.0-0.2 range, as it involves a straightforward and minimal code modification. The changes required are limited to two files: adding a constant definition in an XML documentation file (`Node.xml`) and binding the constant in the corresponding C++ source file (`node.cpp`). The scope of the change is extremely narrow, affecting only a single class or module with no apparent impact on the broader system architecture or interactions between components. The technical concepts involved are basic\u2014understanding how constants are defined and bound in the Godot engine, which is a fundamental aspect of working with this codebase. No advanced algorithms, design patterns, or domain-specific knowledge are required beyond basic familiarity with Godot's notification system. Additionally, there are no explicit edge cases or error handling requirements mentioned in the problem statement or evident in the code changes. The overall effort is minimal, akin to adding a simple constant or fixing a small omission, making this a very easy task for anyone with basic experience in C++ and the Godot engine.", "clarity_label": 1, "difficulty_label": 1, "human_clarity": -1, "human_difficulty": -1}
{"problem_statement": "Documentation tooltip disappears when you move the mouse - 4.4 dev7\n### Tested versions\n\nGodot 4.4 Dev 7 (MACOS mono build)\n\n### System information\n\nMacOS Sequoia 15.2 running on an M1 Pro\n\n### Issue description\n\nSeveral issues:\n\n1) Tooltip disappears when you move your mouse over it. It should persist instead, and only fade out after like 0.5ms or a second when the mouse is no longer over the tooltip.\n2) Cannot click on any hyperlinks within the tooltip, for example in the video I cannot click on the Color Cheatsheet web link on the bottom\n3) Cannot scroll down\n4) It would be nice to be able to click on documentation links within the tooltip, for example hovering over @export_range, we should be able to also click on the PROPERTY_HINT_RANGE link that comes under \"See also\" in the documentation.\n\nI'm running on an M1 Pro with macOS Sequoia 15.2. Single window mode was off when the issues occurred. With this mode on I still have the same issues.\n\n### Steps to reproduce\n\nJust hover over a keyword and you will notice all the mentioned issues.\n\nhttps://github.com/user-attachments/assets/689e6cf7-392e-4dae-a2e0-9f9a811bbc90\n\n\n### Minimal reproduction project (MRP)\n\nNA\n", "patch": "diff --git a/platform/macos/godot_content_view.mm b/platform/macos/godot_content_view.mm\nindex eff33208db4b..4e7fc2180cb9 100644\n--- a/platform/macos/godot_content_view.mm\n+++ b/platform/macos/godot_content_view.mm\n@@ -622,7 +622,7 @@ - (void)updateTrackingAreas {\n \t\t[self removeTrackingArea:tracking_area];\n \t}\n \n-\tNSTrackingAreaOptions options = NSTrackingMouseEnteredAndExited | NSTrackingActiveInKeyWindow | NSTrackingCursorUpdate | NSTrackingInVisibleRect;\n+\tNSTrackingAreaOptions options = NSTrackingMouseEnteredAndExited | NSTrackingActiveWhenFirstResponder | NSTrackingCursorUpdate | NSTrackingInVisibleRect;\n \ttracking_area = [[NSTrackingArea alloc] initWithRect:[self bounds] options:options owner:self userInfo:nil];\n \n \t[self addTrackingArea:tracking_area];\n", "instance_id": "godotengine__godot-103788", "clarity": 2, "difficulty": 0.25, "clarity_explanation": "The problem statement is mostly clear in describing the issues with the documentation tooltip in Godot 4.4 Dev 7 on macOS. It outlines multiple specific problems: the tooltip disappearing when the mouse moves over it, inability to click hyperlinks, inability to scroll, and a suggestion to enable clicking on documentation links. The description includes the environment (macOS Sequoia 15.2 on M1 Pro) and steps to reproduce the issue (hovering over a keyword). However, there are minor ambiguities and missing details. For instance, the expected behavior for tooltip persistence (e.g., exact fade-out timing) is vaguely described as \"0.5ms or a second,\" which is inconsistent and likely a typo (0.5ms is unreasonably short). Additionally, there are no explicit mentions of edge cases or specific constraints for the fixes, such as performance requirements or compatibility concerns with other platforms. While a video link is provided for context, a minimal reproduction project (MRP) is not included, which could hinder precise replication of the issue. Overall, the statement is valid and mostly clear but lacks some precision and completeness in requirements.", "difficulty_explanation": "The difficulty of this problem is rated as easy (0.25) based on the provided code changes and the nature of the issues described. Let's break it down by the evaluation factors:\n\n1. **Scope and Depth of Code Changes:** The provided diff shows a minimal change in a single file (`godot_content_view.mm`), specifically altering a tracking area option from `NSTrackingActiveInKeyWindow` to `NSTrackingActiveWhenFirstResponder`. This suggests the fix for at least one aspect of the issue (likely the tooltip disappearing on mouse movement) is a small, targeted modification. However, the problem statement lists multiple issues (hyperlink clicking, scrolling, and documentation link navigation), which are not addressed in the provided diff. If these additional issues require similar small changes in related areas, the overall scope remains limited. There is no indication of architectural impact or extensive cross-module changes.\n\n2. **Number of Technical Concepts:** The code change involves understanding macOS-specific Cocoa framework concepts, particularly `NSTrackingArea` and its options, which are part of the macOS platform layer in Godot. This requires some domain-specific knowledge of macOS event handling, but the concept is relatively straightforward for someone familiar with macOS development or the Godot engine's platform code. No complex algorithms, design patterns, or advanced language features are evident in the provided change. Additional issues like hyperlink clicking and scrolling might involve understanding Godot's UI event system or tooltip rendering logic, but these are likely to be at a similar or slightly higher level of complexity.\n\n3. **Edge Cases and Error Handling:** The problem statement does not explicitly mention edge cases or error conditions, and the provided code change does not introduce new error handling logic. However, implementing fixes for tooltip persistence, hyperlink interaction, and scrolling might require considering edge cases such as tooltip positioning near screen edges, handling multiple overlapping tooltips, or ensuring compatibility with different input devices (e.g., trackpads vs. mice). These are not overly complex but would add some additional considerations.\n\n4. **Overall Assessment:** The provided code change is a simple tweak, and even accounting for the unaddressed issues in the problem statement, the overall task appears to involve localized fixes within the macOS platform code or Godot's UI system. It requires basic to intermediate knowledge of the Godot engine and macOS development but does not seem to demand deep architectural changes, complex algorithms, or extensive performance optimization. Therefore, I rate this as an easy problem (0.25), as it involves understanding some code logic and making relatively simple modifications, potentially across a few related areas.", "clarity_label": 1, "difficulty_label": 1, "human_clarity": -1, "human_difficulty": -1}
{"problem_statement": "[Web] `Input.mouse_mode` can't capture mouse after user presses escape key in browser\n### Tested versions\n\n- Reproducible in Godot 4.4.beta2\n- Not Reproducible in 4.3\n\n### System information\n\nGodot v4.4.beta2 - Linux Mint 22 (Wilma) on X11 - X11 display driver, Multi-window, 2 monitors - OpenGL 3 (Compatibility) - NVIDIA GeForce RTX 4060 Ti (nvidia; 550.120) - AMD Ryzen 9 3900X 12-Core Processor (24 threads)\n\n### Issue description\n\nI have discovered an edge case that likely happens often. When the mouse is captured browsers tend to tell the user that they can press escape to free there mouse. If we capture the users mouse and then they press escape we can not again capture it with the current behavior. Even though the engine knows that the mouse has been released. To capture the mouse again after the user has pressed escape we must first tell the engine to release the mouse and then capture it again. So that they engine executes the correct sequence.\n\nNote: https://github.com/godotengine/godot/issues/100758#issuecomment-2624679816\n\n### Steps to reproduce\n\n\n1. Extract MRP\n2. Open MRP in Godot 4.4.beta2\n3. Ensure exports are managed for Godot 4.4.beta2\n4. Run the MRP in the browser.\n5. Capture the mouse using the button provided.\n6. Press the escape key \"esc\".\n7. Observe that your mouse is released and visible.\n8. Attempt to capture the mouse using the button provided that says \"Capture Mouse\".\n9. Observe this does not work.\n10. Press the button that says \"Capture Mouse After Release\".\n11. Observe this works.\n\nAlternatively for step 10. You can also press space bar or press the \"Release Mouse\" button. and then you can press the \"Capture Mouse\" button and it will work.\n\n### Minimal reproduction project (MRP)\n\n[web-mouse-capture-part-2.zip](https://github.com/user-attachments/files/18608637/web-mouse-capture-part-2.zip)\n", "patch": "diff --git a/platform/web/display_server_web.cpp b/platform/web/display_server_web.cpp\nindex 89cc6339d28b..180c05ef411d 100644\n--- a/platform/web/display_server_web.cpp\n+++ b/platform/web/display_server_web.cpp\n@@ -576,9 +576,17 @@ void DisplayServerWeb::_mouse_update_mode() {\n \n void DisplayServerWeb::mouse_set_mode(MouseMode p_mode) {\n \tERR_FAIL_INDEX(p_mode, MouseMode::MOUSE_MODE_MAX);\n-\tif (p_mode == mouse_mode_base) {\n+\n+\tif (mouse_mode_override_enabled) {\n+\t\tmouse_mode_base = p_mode;\n+\t\t// No need to update, as override is enabled.\n+\t\treturn;\n+\t}\n+\tif (p_mode == mouse_mode_base && p_mode == mouse_get_mode()) {\n+\t\t// No need to update, as it is currently set as the correct mode.\n \t\treturn;\n \t}\n+\n \tmouse_mode_base = p_mode;\n \t_mouse_update_mode();\n }\n@@ -596,9 +604,17 @@ DisplayServer::MouseMode DisplayServerWeb::mouse_get_mode() const {\n \n void DisplayServerWeb::mouse_set_mode_override(MouseMode p_mode) {\n \tERR_FAIL_INDEX(p_mode, MouseMode::MOUSE_MODE_MAX);\n-\tif (p_mode == mouse_mode_override) {\n+\n+\tif (!mouse_mode_override_enabled) {\n+\t\tmouse_mode_override = p_mode;\n+\t\t// No need to update, as override is not enabled.\n+\t\treturn;\n+\t}\n+\tif (p_mode == mouse_mode_override && p_mode == mouse_get_mode()) {\n+\t\t// No need to update, as it is currently set as the correct mode.\n \t\treturn;\n \t}\n+\n \tmouse_mode_override = p_mode;\n \t_mouse_update_mode();\n }\n", "instance_id": "godotengine__godot-102719", "clarity": 2, "difficulty": 0.45, "clarity_explanation": "The problem statement is mostly clear in describing the issue: the inability to recapture the mouse in a browser environment after the user presses the escape key in Godot 4.4.beta2. It provides detailed steps to reproduce the issue, system information, and a minimal reproduction project (MRP), which are helpful for understanding the context. However, there are minor ambiguities and missing details. For instance, the problem statement does not explicitly define the expected behavior or constraints for mouse capture in a browser after the escape key is pressed (e.g., browser-specific behaviors or limitations). Additionally, while it references a GitHub comment for context, it does not fully clarify the desired fix or the broader implications of the issue across different environments. These minor gaps prevent it from being comprehensive, but the overall intent and reproduction steps are well-articulated.", "difficulty_explanation": "The difficulty of this problem falls into the medium range due to several factors. First, the scope of code changes is relatively small, confined to a single file (`display_server_web.cpp`) and focused on modifying logic related to mouse mode handling in the Godot engine's web platform. The changes involve adding conditional checks to prevent unnecessary updates when the mouse mode is already set or when an override is not enabled, which requires a moderate understanding of the existing codebase logic. Second, the technical concepts involved include familiarity with Godot's display server architecture, mouse input handling in a web context (likely involving JavaScript interop or browser APIs like Pointer Lock API), and state management for input modes. These concepts are not overly complex but do require domain-specific knowledge of game engine internals and web platform constraints. Third, the problem touches on edge cases (e.g., user pressing escape to release the mouse), and the code changes address this by ensuring proper state transitions, though no extensive error handling or performance optimization is evident. Finally, the impact of the change is limited to the web platform's mouse handling and does not appear to affect the broader system architecture. Overall, this problem requires a moderate level of expertise and understanding of specific parts of the codebase, placing it in the 0.4-0.6 range, with a score of 0.45 reflecting the balance between focused changes and the need for contextual knowledge.", "clarity_label": 1, "difficulty_label": 1, "human_clarity": -1, "human_difficulty": -1}
{"problem_statement": "Popup menus broken when `content_scale_mode` is bigger then 1 and subwindows are not embedded\n### Tested versions\n\n- reproducable in 4.4 beta1\n- not reproducable in 4.4 dev 7 or before\n\n### System information\n\nWindows 10\n\n### Issue description\n\nWorking on applications (material maker in my case) you often want to allow scaling the window using the content_scale_factor AND allow using multiple native windows (so having embed subwindows off). Unfortunately at higher factors, popup menus (and option buttons, maybe more popups idk) don't function anymore. The lower parts of the popups does not receive input/clicks. Strangely enough the hover works fine, so I really have no clue what's going on.\n\n### Steps to reproduce\n\nCreate a popup menu or option button with a couple of items. Change the content scale factor to 2, turn embed subwindows off. Then run the game and try selecting the last popup item.\n\n### Minimal reproduction project (MRP)\n\n[mrp_scalemenupopupbug.zip](https://github.com/user-attachments/files/18592487/mrp_scalemenupopupbug.zip)\nHope this helps.\n", "patch": "diff --git a/scene/gui/popup.cpp b/scene/gui/popup.cpp\nindex 94d7303ae504..cbba65e0088b 100644\n--- a/scene/gui/popup.cpp\n+++ b/scene/gui/popup.cpp\n@@ -247,8 +247,14 @@ void PopupPanel::_input_from_window(const Ref<InputEvent> &p_event) {\n \n \t\tRef<InputEventMouseButton> b = p_event;\n \t\t// Hide it if the shadows have been clicked.\n-\t\tif (b.is_valid() && b->is_pressed() && b->get_button_index() == MouseButton::LEFT && !panel->get_global_rect().has_point(b->get_position())) {\n-\t\t\t_close_pressed();\n+\t\tif (b.is_valid() && b->is_pressed() && b->get_button_index() == MouseButton::LEFT) {\n+\t\t\tRect2 panel_area = panel->get_global_rect();\n+\t\t\tfloat win_scale = get_content_scale_factor();\n+\t\t\tpanel_area.position *= win_scale;\n+\t\t\tpanel_area.size *= win_scale;\n+\t\t\tif (!panel_area.has_point(b->get_position())) {\n+\t\t\t\t_close_pressed();\n+\t\t\t}\n \t\t}\n \t} else {\n \t\tWARN_PRINT_ONCE(\"PopupPanel has received an invalid InputEvent. Consider filtering out invalid events.\");\ndiff --git a/scene/gui/popup_menu.cpp b/scene/gui/popup_menu.cpp\nindex 092a12bd1486..b6dc75754690 100644\n--- a/scene/gui/popup_menu.cpp\n+++ b/scene/gui/popup_menu.cpp\n@@ -327,16 +327,17 @@ int PopupMenu::_get_mouse_over(const Point2 &p_over) const {\n \t\titem_clickable_area.size.width -= scroll_width;\n \t}\n \tfloat win_scale = get_content_scale_factor();\n-\titem_clickable_area.position.y = (item_clickable_area.position.y + theme_cache.panel_style->get_margin(SIDE_TOP)) * win_scale;\n+\titem_clickable_area.position.x += theme_cache.panel_style->get_margin(SIDE_LEFT);\n+\titem_clickable_area.position.y += theme_cache.panel_style->get_margin(SIDE_TOP);\n+\titem_clickable_area.position *= win_scale;\n \titem_clickable_area.size.y -= theme_cache.panel_style->get_margin(SIDE_TOP) + theme_cache.panel_style->get_margin(SIDE_BOTTOM);\n \titem_clickable_area.size *= win_scale;\n \n-\tif (p_over.x < item_clickable_area.position.x || p_over.x >= item_clickable_area.position.x + item_clickable_area.size.width ||\n-\t\t\tp_over.y < item_clickable_area.position.y || p_over.y >= item_clickable_area.position.y + item_clickable_area.size.height) {\n+\tif (!item_clickable_area.has_point(p_over)) {\n \t\treturn -1;\n \t}\n \n-\tfloat ofs = item_clickable_area.position.y + theme_cache.v_separation * 0.5;\n+\tfloat ofs = item_clickable_area.position.y + (float)theme_cache.v_separation * win_scale * 0.5;\n \tfor (int i = 0; i < items.size(); i++) {\n \t\tofs += i > 0 ? (float)theme_cache.v_separation * win_scale : (float)theme_cache.v_separation * win_scale * 0.5;\n \t\tofs += _get_item_height(i) * win_scale;\n@@ -430,7 +431,7 @@ void PopupMenu::_activate_submenu(int p_over, bool p_by_keyboard) {\n \t\t\tthis_rect.size.x, scaled_ofs_cache + scroll_offset + theme_cache.panel_style->get_margin(SIDE_TOP) * win_scale - theme_cache.v_separation / 2));\n \n \t// If there is an area below the submenu item, add an autohide area there.\n-\tif (scaled_ofs_cache + scaled_height_cache + scroll_offset <= control->get_size().height) {\n+\tif (scaled_ofs_cache + scaled_height_cache + scroll_offset <= control->get_size().height * win_scale) {\n \t\tconst int from = scaled_ofs_cache + scaled_height_cache + scroll_offset + theme_cache.v_separation / 2;\n \t\tsubmenu_pum->add_autohide_area(Rect2(this_rect.position.x, this_rect.position.y + from, this_rect.size.x, this_rect.size.y - from));\n \t}\n@@ -605,9 +606,13 @@ void PopupMenu::_input_from_window_internal(const Ref<InputEvent> &p_event) {\n \t\t}\n \t\titem_clickable_area.size.width -= scroll_width;\n \t}\n-\titem_clickable_area.position.y = (item_clickable_area.position.y + theme_cache.panel_style->get_margin(SIDE_TOP)) * get_content_scale_factor();\n+\n+\tfloat win_scale = get_content_scale_factor();\n+\titem_clickable_area.position.x += theme_cache.panel_style->get_margin(SIDE_LEFT);\n+\titem_clickable_area.position.y += theme_cache.panel_style->get_margin(SIDE_TOP);\n+\titem_clickable_area.position *= win_scale;\n \titem_clickable_area.size.y -= theme_cache.panel_style->get_margin(SIDE_TOP) + theme_cache.panel_style->get_margin(SIDE_BOTTOM);\n-\titem_clickable_area.size *= get_content_scale_factor();\n+\titem_clickable_area.size *= win_scale;\n \n \tRef<InputEventMouseButton> b = p_event;\n \n@@ -622,9 +627,14 @@ void PopupMenu::_input_from_window_internal(const Ref<InputEvent> &p_event) {\n \t\t\t\tis_scrolling = is_layout_rtl() ? b->get_position().x < item_clickable_area.position.x : b->get_position().x > item_clickable_area.size.width;\n \n \t\t\t\t// Hide it if the shadows have been clicked.\n-\t\t\t\tif (get_flag(FLAG_POPUP) && !panel->get_global_rect().has_point(b->get_position())) {\n-\t\t\t\t\t_close_pressed();\n-\t\t\t\t\treturn;\n+\t\t\t\tif (get_flag(FLAG_POPUP)) {\n+\t\t\t\t\tRect2 panel_area = panel->get_global_rect();\n+\t\t\t\t\tpanel_area.position *= win_scale;\n+\t\t\t\t\tpanel_area.size *= win_scale;\n+\t\t\t\t\tif (!panel_area.has_point(b->get_position())) {\n+\t\t\t\t\t\t_close_pressed();\n+\t\t\t\t\t\treturn;\n+\t\t\t\t\t}\n \t\t\t\t}\n \n \t\t\t\tif (!item_clickable_area.has_point(b->get_position())) {\n", "instance_id": "godotengine__godot-102625", "clarity": 2, "difficulty": 0.45, "clarity_explanation": "The problem statement is mostly clear in describing the issue: popup menus and option buttons fail to receive input/clicks on their lower parts when the content scale factor is greater than 1 and subwindows are not embedded. It provides specific steps to reproduce the issue, mentions the affected versions, and includes a minimal reproduction project (MRP). However, there are minor ambiguities and missing details. For instance, the problem statement does not explicitly define the expected behavior or desired outcome beyond \"fixing\" the input issue. Additionally, it lacks clarity on specific edge cases (e.g., different scale factors, various popup sizes, or interactions with other UI elements) and constraints (e.g., performance expectations or compatibility requirements). While the issue is reproducible and the context is provided, these missing details prevent it from being fully comprehensive, warranting a score of 2 (Mostly Clear).", "difficulty_explanation": "The difficulty of this problem falls into the medium range (0.4-0.6) due to several factors. First, the scope of code changes is relatively focused, affecting two files (`popup.cpp` and `popup_menu.cpp`) within a GUI-related module of what appears to be a game engine (likely Godot, based on context). The changes primarily involve adjusting coordinate scaling logic to account for the content scale factor, which requires understanding how UI elements are positioned and interact with input events. Second, the technical concepts involved include GUI rendering, input event handling, and coordinate transformations, which are moderately complex but not overly advanced. Familiarity with the engine's API (e.g., `get_content_scale_factor()`, `get_global_rect()`) and internal rendering logic is necessary, but the changes do not appear to impact the broader system architecture. Third, the amount of code change is small but requires precision, as it deals with pixel-perfect input detection and scaling. Finally, while the problem statement does not explicitly mention edge cases, the code changes implicitly address issues related to scaled coordinates and input detection, suggesting some consideration of edge cases (e.g., different scale factors or window configurations). However, no extensive error handling or performance optimization is required. Overall, this problem requires a moderate understanding of the codebase and GUI systems, along with careful modifications, justifying a difficulty score of 0.45.", "clarity_label": 1, "difficulty_label": 1, "human_clarity": -1, "human_difficulty": -1}
{"problem_statement": "`get_global_transform_interpolated()` may return wrong value when FPS < physics ticks per second\n### Tested versions\n\n- Reproducible in v3.6.stable.official [de2f0f147]\n- Reproducible in v4.4.dev1.official [28a72fa43]\n- Reproducible in v4.4.beta1.official [d33da79d3]\n- Reproducible in v4.4.beta.custom_build [a013481b0]\n\n### System information\n\nGodot v4.4.beta (a013481b0) - CachyOS Linux #1 SMP PREEMPT_DYNAMIC Mon, 20 Jan 2025 21:26:55 +0000 on Wayland - X11 display driver, Multi-window, 1 monitor - Vulkan (Forward+) - integrated Intel(R) HD Graphics 620 (KBL GT2) - Intel(R) Core(TM) i7-7500U CPU @ 2.70GHz (4 threads)\n\n### Issue description\n\nWhen FPS drops below `physics_ticks_per_second` the function `get_global_transform_interpolated()` sometimes returns wrong value.\n\nWhen calling `get_global_transform_interpolated()` in a `_process()` I expect to get the most recent interpolated transform regardless of how many physics ticks happen between successive process frames. I think the actual returned value may be interpolated transform only after 1 physics tick that occurred directly after the previous process frame.\n\nThe issue is about functionality introduced to `4.4.dev1` in https://github.com/godotengine/godot/pull/92391 but it is also reproducible in `3.6` version of physics interpolation.\n\n### Steps to reproduce\n\nRun the MRP and notice NinePatchRect is constantly jittering.\n\nIn order to reproduce the issue the project has `max_fps` set lower than `physics_ticks_per_second`.\n\nIf needed I can provide even more simplified MRP without the usage of `Camera3D.unproject_position()`.\n\n### Minimal reproduction project (MRP)\n\nGodot 4.x project:\n[test-physics-interpolation-maxfps.zip](https://github.com/user-attachments/files/18580802/test-physics-interpolation-maxfps.zip)\n\nGodot 3.x project:\n[Test Physics Interpolation max_fps Godot3.zip](https://github.com/user-attachments/files/18580804/Test.Physics.Interpolation.max_fps.Godot3.zip)\n", "patch": "diff --git a/scene/main/scene_tree.cpp b/scene/main/scene_tree.cpp\nindex 3c1809c3586b..99273ffa81c7 100644\n--- a/scene/main/scene_tree.cpp\n+++ b/scene/main/scene_tree.cpp\n@@ -559,11 +559,6 @@ void SceneTree::iteration_prepare() {\n \t\t// are flushed before pumping the interpolation prev and currents.\n \t\tflush_transform_notifications();\n \t\tVisualServer::get_singleton()->tick();\n-\n-\t\t// Any objects performing client physics interpolation\n-\t\t// should be given an opportunity to keep their previous transforms\n-\t\t// up to date before each new physics tick.\n-\t\t_client_physics_interpolation.physics_process();\n \t}\n }\n \n@@ -572,6 +567,11 @@ void SceneTree::iteration_end() {\n \t// to be flushed to the VisualServer before finishing a physics tick.\n \tif (_physics_interpolation_enabled) {\n \t\tflush_transform_notifications();\n+\n+\t\t// Any objects performing client physics interpolation\n+\t\t// should be given an opportunity to keep their previous transforms\n+\t\t// up to date.\n+\t\t_client_physics_interpolation.physics_process();\n \t}\n }\n \n", "instance_id": "godotengine__godot-102184", "clarity": 2, "difficulty": 0.65, "clarity_explanation": "The problem statement is mostly clear in describing the issue with `get_global_transform_interpolated()` returning incorrect values when FPS is lower than the physics ticks per second. It provides context about the affected versions of the Godot engine, system information, and steps to reproduce the issue using minimal reproduction projects (MRPs). The goal of fixing the interpolation behavior is evident, and the issue's impact (jittering in rendering) is described. However, there are minor ambiguities: the exact expected behavior of the interpolation under varying FPS conditions is not fully detailed, and potential edge cases (e.g., extreme FPS drops or specific physics tick configurations) are not explicitly mentioned. Additionally, while the MRPs are provided, the problem statement lacks specific input/output examples or detailed constraints that could further clarify the issue. Overall, it is clear enough to understand the problem but misses some finer details that would make it comprehensive.", "difficulty_explanation": "The difficulty of this problem falls into the \"Hard\" category due to several factors. First, the scope of the code change, while seemingly small (a few lines in `scene_tree.cpp`), involves critical timing logic in the Godot engine's scene tree iteration process. Moving the call to `_client_physics_interpolation.physics_process()` from `iteration_prepare()` to `iteration_end()` suggests a deep understanding of the engine's physics interpolation and rendering pipeline is required to ensure transforms are updated at the correct stage. This impacts the core functionality of how physics and rendering are synchronized, which is a complex architectural concern. Second, the number of technical concepts involved is significant: knowledge of game engine internals (physics ticks, frame rendering, interpolation), timing and synchronization in real-time systems, and potentially the specifics of Godot's `VisualServer` and transform notification system are necessary. Third, while the problem statement does not explicitly mention edge cases, the nature of the issue (FPS drops below physics ticks) implies potential complexities in handling varying frame rates, physics tick rates, and ensuring smooth interpolation under stress conditions. Error handling might also need to be considered to prevent jittering or transform desynchronization in extreme scenarios. Overall, solving this requires a deep dive into the engine's internals and careful consideration of timing issues, justifying a difficulty score of 0.65, leaning towards the harder end of the spectrum due to the specialized domain knowledge and potential for subtle bugs if not handled correctly.", "clarity_label": 1, "difficulty_label": 1, "human_clarity": -1, "human_difficulty": -1}
{"problem_statement": "[4.4beta1] ResourceLoader.has_cached() does not return proper values for UIDs\n### Tested versions\n\nReproducible in 4.4 dev 4, 5, 6, 7, and beta 1. Probably in previous 4.4 dev builds as well.\n\n### System information\n\nGodot v4.4.beta1 - Arch Linux #1 SMP PREEMPT_DYNAMIC Fri, 10 Jan 2025 00:39:41 +0000 on Wayland - X11 display driver, Multi-window, 2 monitors - Vulkan (Forward+) - dedicated AMD Radeon RX 6600 XT (RADV NAVI23) - AMD Ryzen 5 5600X 6-Core Processor (12 threads)\n\n### Issue description\n\nPassing a UID into `ResourceLoader.has_cached()` returns `false` for a resource that is cached. Passing the resource path for the resource with the same UID properly returns `true`.\n\n### Steps to reproduce\n\n1. Create a Sprite2D node and attach the `icon.svg` as the texture.\n2. Attach a script to the Sprite2D node to see if the `icon.svg` resource is cached. Something like:\n```\nextends Sprite2D\n\nvar resource_path: String = \"res://icon.svg\"\nvar uid: String = \"\" # Insert UID of icon.svg here.\n\n\nfunc _ready():\n\tprint(\"ResourceLoader.has_cached results:\\nResource Path: \",\n\t\t\tResourceLoader.has_cached(resource_path), \" UID: \", ResourceLoader.has_cached(uid))\n```\n3. Observe that passing the resource path returns `true` whereas passing the UID returns `false`.\n\n### Minimal reproduction project (MRP)\n\n[resource-loader-bug.zip](https://github.com/user-attachments/files/18463852/resource-loader-bug.zip)\n", "patch": "diff --git a/core/core_bind.cpp b/core/core_bind.cpp\nindex 6974d98234cc..acd589783ece 100644\n--- a/core/core_bind.cpp\n+++ b/core/core_bind.cpp\n@@ -113,12 +113,12 @@ PackedStringArray ResourceLoader::get_dependencies(const String &p_path) {\n }\n \n bool ResourceLoader::has_cached(const String &p_path) {\n-\tString local_path = ProjectSettings::get_singleton()->localize_path(p_path);\n+\tString local_path = ::ResourceLoader::_validate_local_path(p_path);\n \treturn ResourceCache::has(local_path);\n }\n \n Ref<Resource> ResourceLoader::get_cached_ref(const String &p_path) {\n-\tString local_path = ProjectSettings::get_singleton()->localize_path(p_path);\n+\tString local_path = ::ResourceLoader::_validate_local_path(p_path);\n \treturn ResourceCache::get_ref(local_path);\n }\n \ndiff --git a/core/io/resource_loader.cpp b/core/io/resource_loader.cpp\nindex 8f873d859b65..7cc91ef4318b 100644\n--- a/core/io/resource_loader.cpp\n+++ b/core/io/resource_loader.cpp\n@@ -495,7 +495,7 @@ void ResourceLoader::_run_load_task(void *p_userdata) {\n \tcurr_load_task = curr_load_task_backup;\n }\n \n-static String _validate_local_path(const String &p_path) {\n+String ResourceLoader::_validate_local_path(const String &p_path) {\n \tResourceUID::ID uid = ResourceUID::get_singleton()->text_to_id(p_path);\n \tif (uid != ResourceUID::INVALID_ID) {\n \t\treturn ResourceUID::get_singleton()->get_id_path(uid);\ndiff --git a/core/io/resource_loader.h b/core/io/resource_loader.h\nindex f933e88b23bf..56052b6a6fc4 100644\n--- a/core/io/resource_loader.h\n+++ b/core/io/resource_loader.h\n@@ -36,6 +36,10 @@\n #include \"core/object/worker_thread_pool.h\"\n #include \"core/os/thread.h\"\n \n+namespace core_bind {\n+class ResourceLoader;\n+}\n+\n class ConditionVariable;\n \n template <int Tag>\n@@ -101,6 +105,7 @@ typedef void (*ResourceLoadedCallback)(Ref<Resource> p_resource, const String &p\n \n class ResourceLoader {\n \tfriend class LoadToken;\n+\tfriend class core_bind::ResourceLoader;\n \n \tenum {\n \t\tMAX_LOADERS = 64\n@@ -217,6 +222,8 @@ class ResourceLoader {\n \n \tstatic bool _ensure_load_progress();\n \n+\tstatic String _validate_local_path(const String &p_path);\n+\n public:\n \tstatic Error load_threaded_request(const String &p_path, const String &p_type_hint = \"\", bool p_use_sub_threads = false, ResourceFormatLoader::CacheMode p_cache_mode = ResourceFormatLoader::CACHE_MODE_REUSE);\n \tstatic ThreadLoadStatus load_threaded_get_status(const String &p_path, float *r_progress = nullptr);\n", "instance_id": "godotengine__godot-101752", "clarity": 2, "difficulty": 0.45, "clarity_explanation": "The problem statement is mostly clear and provides a detailed description of the issue with `ResourceLoader.has_cached()` not returning the correct value when a UID is passed, compared to when a resource path is used. It includes specific steps to reproduce the issue, system information, and a minimal reproduction project (MRP), which are helpful for understanding the context. However, there are minor ambiguities: the problem statement does not explicitly discuss expected behavior for edge cases (e.g., invalid UIDs or non-existent resources) or constraints on the input format for UIDs. Additionally, while the issue is well-documented, the desired fix or expected outcome is implied rather than explicitly stated (e.g., should `has_cached()` always resolve UIDs to paths internally?). These minor missing details prevent it from being fully comprehensive, hence a score of 2 (Mostly Clear).", "difficulty_explanation": "The difficulty of this problem falls in the medium range (0.4-0.6) due to several factors. First, the scope of code changes is relatively focused, affecting a small number of files (`core_bind.cpp`, `resource_loader.cpp`, and `resource_loader.h`) and primarily involving modifications to path validation logic. The changes replace a call to `ProjectSettings::localize_path()` with a custom `ResourceLoader::_validate_local_path()` function that handles UID-to-path conversion, which is a straightforward fix once understood. However, it requires a moderate understanding of the Godot engine's resource loading system, including how UIDs and resource paths are managed internally, as well as familiarity with the `ResourceCache` and `ResourceUID` classes. The problem also touches on namespace and access control adjustments (e.g., making `_validate_local_path` non-static and adding friend class declarations), which adds a slight layer of complexity. There are no explicit edge cases mentioned in the problem statement, but the code changes implicitly handle the UID resolution case, and potential error handling for invalid UIDs or paths may need consideration. Overall, this requires understanding a few specific concepts and making targeted changes across a few files, but it does not significantly impact the broader architecture or involve deep system-level modifications. A score of 0.45 reflects this as a medium-difficulty task, leaning towards the lower end due to the focused nature of the fix.", "clarity_label": 1, "difficulty_label": 1, "human_clarity": -1, "human_difficulty": -1}
{"problem_statement": "Ctrl-Click on enum value/member does nothing\n### Tested versions\n\n- reproducible in: 4.4.dev7\n- reproducible on master (tested with a 03-Jan-2025 build - `v4.4.dev.gh-101012 [c37ada786]`)\n- works in: 4.4.dev6\n\n\n### System information\n\nGodot v4.4.dev7 - Windows 11 (build 22631) - Multi-window, 1 monitor - OpenGL 3 (Compatibility) - NVIDIA GeForce RTX 2070 SUPER (NVIDIA; 32.0.15.6636) - 13th Gen Intel(R) Core(TM) i7-13700KF (24 threads)\n\n### Issue description\n\nI mentioned this here: https://github.com/godotengine/godot/issues/100680#issuecomment-2557966392\nWhile general control-click was restored with https://github.com/godotengine/godot/pull/100707 the enum issue remains.\n\nCTRL-clicking on an enum value/member does nothing (well, it actually navigates to the beginning of the line).\n\nE.g. enum like this:\n```\nclass_name E extends Object\n\nenum Team {\n\tNone,\n\tOne,\n}\n\nfunc test():\n\tvar t = E.Team.None\n```\nand CTRL-clicking on the `None` of `E.Team.None` does not take you to the `None` under `enum Team`.\n\n\n### Steps to reproduce\n\nOpen enum.gd in MRP - same code as in description.\n\n### Minimal reproduction project (MRP)\n\n[44dev7enum.zip](https://github.com/user-attachments/files/18303044/44dev7enum.zip)\n\n", "patch": "diff --git a/modules/gdscript/gdscript_editor.cpp b/modules/gdscript/gdscript_editor.cpp\nindex c20c17f34860..7ee8d8c42614 100644\n--- a/modules/gdscript/gdscript_editor.cpp\n+++ b/modules/gdscript/gdscript_editor.cpp\n@@ -3684,12 +3684,12 @@ static Error _lookup_symbol_from_base(const GDScriptParser::DataType &p_base, co\n \t\t\t\t\tcase GDScriptParser::ClassNode::Member::GROUP:\n \t\t\t\t\t\treturn ERR_BUG;\n \t\t\t\t\tcase GDScriptParser::ClassNode::Member::CLASS: {\n-\t\t\t\t\t\tString type_name;\n-\t\t\t\t\t\tString enum_name;\n-\t\t\t\t\t\tGDScriptDocGen::doctype_from_gdtype(GDScriptAnalyzer::type_from_metatype(member.get_datatype()), type_name, enum_name);\n+\t\t\t\t\t\tString doc_type_name;\n+\t\t\t\t\t\tString doc_enum_name;\n+\t\t\t\t\t\tGDScriptDocGen::doctype_from_gdtype(GDScriptAnalyzer::type_from_metatype(member.get_datatype()), doc_type_name, doc_enum_name);\n \n \t\t\t\t\t\tr_result.type = ScriptLanguage::LOOKUP_RESULT_CLASS;\n-\t\t\t\t\t\tr_result.class_name = type_name;\n+\t\t\t\t\t\tr_result.class_name = doc_type_name;\n \t\t\t\t\t} break;\n \t\t\t\t\tcase GDScriptParser::ClassNode::Member::CONSTANT:\n \t\t\t\t\t\tr_result.type = ScriptLanguage::LOOKUP_RESULT_CLASS_CONSTANT;\n@@ -3712,11 +3712,11 @@ static Error _lookup_symbol_from_base(const GDScriptParser::DataType &p_base, co\n \t\t\t\t}\n \n \t\t\t\tif (member.type != GDScriptParser::ClassNode::Member::CLASS) {\n-\t\t\t\t\tString type_name;\n-\t\t\t\t\tString enum_name;\n-\t\t\t\t\tGDScriptDocGen::doctype_from_gdtype(GDScriptAnalyzer::type_from_metatype(base_type), type_name, enum_name);\n+\t\t\t\t\tString doc_type_name;\n+\t\t\t\t\tString doc_enum_name;\n+\t\t\t\t\tGDScriptDocGen::doctype_from_gdtype(GDScriptAnalyzer::type_from_metatype(base_type), doc_type_name, doc_enum_name);\n \n-\t\t\t\t\tr_result.class_name = type_name;\n+\t\t\t\t\tr_result.class_name = doc_type_name;\n \t\t\t\t\tr_result.class_member = name;\n \t\t\t\t}\n \n@@ -3934,21 +3934,35 @@ static Error _lookup_symbol_from_base(const GDScriptParser::DataType &p_base, co\n \t\t\tcase GDScriptParser::DataType::ENUM: {\n \t\t\t\tif (base_type.is_meta_type) {\n \t\t\t\t\tif (base_type.enum_values.has(p_symbol)) {\n-\t\t\t\t\t\tString type_name;\n-\t\t\t\t\t\tString enum_name;\n-\t\t\t\t\t\tGDScriptDocGen::doctype_from_gdtype(GDScriptAnalyzer::type_from_metatype(base_type), type_name, enum_name);\n+\t\t\t\t\t\tString doc_type_name;\n+\t\t\t\t\t\tString doc_enum_name;\n+\t\t\t\t\t\tGDScriptDocGen::doctype_from_gdtype(GDScriptAnalyzer::type_from_metatype(base_type), doc_type_name, doc_enum_name);\n \n-\t\t\t\t\t\tif (CoreConstants::is_global_enum(enum_name)) {\n+\t\t\t\t\t\tif (CoreConstants::is_global_enum(doc_enum_name)) {\n \t\t\t\t\t\t\tr_result.type = ScriptLanguage::LOOKUP_RESULT_CLASS_CONSTANT;\n \t\t\t\t\t\t\tr_result.class_name = \"@GlobalScope\";\n \t\t\t\t\t\t\tr_result.class_member = p_symbol;\n \t\t\t\t\t\t\treturn OK;\n \t\t\t\t\t\t} else {\n-\t\t\t\t\t\t\tconst int dot_pos = enum_name.rfind_char('.');\n+\t\t\t\t\t\t\tconst int dot_pos = doc_enum_name.rfind_char('.');\n \t\t\t\t\t\t\tif (dot_pos >= 0) {\n \t\t\t\t\t\t\t\tr_result.type = ScriptLanguage::LOOKUP_RESULT_CLASS_CONSTANT;\n-\t\t\t\t\t\t\t\tr_result.class_name = enum_name.left(dot_pos);\n+\t\t\t\t\t\t\t\tr_result.class_name = doc_enum_name.left(dot_pos);\n \t\t\t\t\t\t\t\tr_result.class_member = p_symbol;\n+\t\t\t\t\t\t\t\tif (base_type.class_type != nullptr) {\n+\t\t\t\t\t\t\t\t\tconst String enum_name = doc_enum_name.substr(dot_pos + 1);\n+\t\t\t\t\t\t\t\t\tif (base_type.class_type->has_member(enum_name)) {\n+\t\t\t\t\t\t\t\t\t\tconst GDScriptParser::ClassNode::Member member = base_type.class_type->get_member(enum_name);\n+\t\t\t\t\t\t\t\t\t\tif (member.type == GDScriptParser::ClassNode::Member::ENUM) {\n+\t\t\t\t\t\t\t\t\t\t\tfor (const GDScriptParser::EnumNode::Value &value : member.m_enum->values) {\n+\t\t\t\t\t\t\t\t\t\t\t\tif (value.identifier->name == p_symbol) {\n+\t\t\t\t\t\t\t\t\t\t\t\t\tr_result.location = value.line;\n+\t\t\t\t\t\t\t\t\t\t\t\t\tbreak;\n+\t\t\t\t\t\t\t\t\t\t\t\t}\n+\t\t\t\t\t\t\t\t\t\t\t}\n+\t\t\t\t\t\t\t\t\t\t}\n+\t\t\t\t\t\t\t\t\t}\n+\t\t\t\t\t\t\t\t}\n \t\t\t\t\t\t\t\treturn OK;\n \t\t\t\t\t\t\t}\n \t\t\t\t\t\t}\n", "instance_id": "godotengine__godot-101127", "clarity": 2, "difficulty": 0.55, "clarity_explanation": "The problem statement is mostly clear in describing the issue: CTRL-clicking on an enum value in the Godot engine's GDScript editor does not navigate to the correct definition of the enum member, instead navigating to the beginning of the line. The statement includes specific versions where the issue is reproducible, system information, a minimal reproduction project (MRP), and a clear example of the problematic code. Steps to reproduce are provided, which adds to the clarity. However, there are minor ambiguities, such as the lack of explicit mention of expected behavior beyond \"navigating to the enum definition\" and no discussion of potential edge cases (e.g., nested enums, global vs. local enums, or enums in different files). Additionally, the problem statement does not specify constraints or requirements for the fix (e.g., performance considerations or compatibility with other features). Thus, while the issue is well-defined, minor details are missing, warranting a score of 2 (Mostly Clear).", "difficulty_explanation": "The difficulty of this problem falls into the medium range (0.4-0.6) due to several factors. First, the scope of code changes is relatively focused, primarily affecting a single file (`gdscript_editor.cpp`) and specific functions related to symbol lookup in the GDScript editor. The changes involve modifying how enum values are resolved and navigated to, which requires understanding the existing symbol lookup logic and the structure of the GDScript parser and data types. Second, the technical concepts involved include familiarity with C++ (the language of the Godot engine), the internal representation of GDScript enums, and the editor's navigation system. The code changes also require handling specific cases like global enums and extracting class and member names, which adds moderate complexity. Third, the changes impact a specific feature (CTRL-click navigation) but do not appear to affect the broader system architecture or performance significantly. Finally, while the problem statement does not explicitly mention edge cases, the code changes suggest the need to handle different enum contexts (e.g., global vs. class-specific enums) and locate the exact line of the enum value definition, which introduces some complexity in error handling and edge case management. Overall, this problem requires a solid understanding of the Godot engine's internals and moderate effort to implement and test the fix, justifying a difficulty score of 0.55.", "clarity_label": 1, "difficulty_label": 1, "human_clarity": -1, "human_difficulty": -1}
{"problem_statement": "Setting SpinBox value with signal gets overwritten by the LineEdit's text value when the LineEdit is about to lose focus.\n### Tested versions\n\n- Reproducible in v4.4.dev7.official [46c8f8c5c]\n- Reproducible in v4.3.stable.official [77dcf97d8]\n- Reproducible in v4.2.2.stable.official [15073afe3]\n\n### System information\n\nGodot v4.3.stable - Windows 10.0.19045 - GLES3 (Compatibility) - NVIDIA GeForce GTX 750 Ti (NVIDIA; 32.0.15.6094) - Intel(R) Core(TM) i5-6400 CPU @ 2.70GHz (4 Threads)\n\n### Issue description\n\nWhen setting a SpinBox value with a signal **when the SpinBox's LineEdit still has focus** and is about to lose focus the value is first set correctly but then is set again to the LineEdit's displayed value. If the value is set with `set_value_no_signal` to prevent emmiting a signal, the SpinBox will emit the `value_changed` signal with the incorrect value.\n\nhttps://github.com/user-attachments/assets/32618d3e-910a-418e-b913-0fc2db197b9d\n\n\n### Steps to reproduce\n\nUsing the MRP:\n\n1. Click on the SpinBox's LineEdit.\n2. Click on the LineEdit next to it (Or any other node. This is just so that the SpinBox loses focus)\n3. The value will be set correctly (and a signal emmited depending on what method to set the value was used)\n4. The value will then be set to whatever the SpinBox's LineEdit is displaying instead of the set value and a signal will be emmited.\n\nThe MRP has prints to inform of the values the moment before and after they are set.\n\nI've seen that the issue only occours if the value is set right before the SpinBox loses focus.\n\nThe issue is prevented if you ALSO set the SpinBox's value to its TextBox:\n`spin_box.get_line_edit().text = str(spin_box.value)`\n\n### Minimal reproduction project (MRP)\n\n[debugging.zip](https://github.com/user-attachments/files/18256719/debugging.zip)\n\n", "patch": "diff --git a/scene/gui/spin_box.cpp b/scene/gui/spin_box.cpp\nindex ffe6e2bb9785..e76170623955 100644\n--- a/scene/gui/spin_box.cpp\n+++ b/scene/gui/spin_box.cpp\n@@ -40,7 +40,7 @@ Size2 SpinBox::get_minimum_size() const {\n \treturn ms;\n }\n \n-void SpinBox::_update_text(bool p_keep_line_edit) {\n+void SpinBox::_update_text(bool p_only_update_if_value_changed) {\n \tdouble step = get_step();\n \tif (use_custom_arrow_step && custom_arrow_step != 0.0) {\n \t\tstep = custom_arrow_step;\n@@ -50,6 +50,11 @@ void SpinBox::_update_text(bool p_keep_line_edit) {\n \t\tvalue = TS->format_number(value);\n \t}\n \n+\tif (p_only_update_if_value_changed && value == last_text_value) {\n+\t\treturn;\n+\t}\n+\tlast_text_value = value;\n+\n \tif (!line_edit->is_editing()) {\n \t\tif (!prefix.is_empty()) {\n \t\t\tvalue = prefix + \" \" + value;\n@@ -58,17 +63,12 @@ void SpinBox::_update_text(bool p_keep_line_edit) {\n \t\t\tvalue += \" \" + suffix;\n \t\t}\n \t}\n-\n-\tif (p_keep_line_edit && value == last_updated_text && value != line_edit->get_text()) {\n-\t\treturn;\n-\t}\n-\n \tline_edit->set_text_with_selection(value);\n-\tlast_updated_text = value;\n }\n \n void SpinBox::_text_submitted(const String &p_string) {\n \tif (p_string.is_empty()) {\n+\t\t_update_text();\n \t\treturn;\n \t}\n \n@@ -288,14 +288,12 @@ void SpinBox::_line_edit_editing_toggled(bool p_toggled_on) {\n \t\t\tline_edit->select_all();\n \t\t}\n \t} else {\n-\t\t// Discontinue because the focus_exit was caused by canceling or the text is empty.\n \t\tif (Input::get_singleton()->is_action_pressed(\"ui_cancel\") || line_edit->get_text().is_empty()) {\n-\t\t\t_update_text();\n-\t\t\treturn;\n+\t\t\t_update_text(); // Revert text if editing was canceled.\n+\t\t} else {\n+\t\t\t_update_text(true); // Update text in case value was changed this frame (e.g. on `focus_exited`).\n+\t\t\t_text_submitted(line_edit->get_text());\n \t\t}\n-\n-\t\tline_edit->deselect();\n-\t\t_text_submitted(line_edit->get_text());\n \t}\n }\n \ndiff --git a/scene/gui/spin_box.h b/scene/gui/spin_box.h\nindex 564294649c94..79076d3f4692 100644\n--- a/scene/gui/spin_box.h\n+++ b/scene/gui/spin_box.h\n@@ -58,13 +58,13 @@ class SpinBox : public Range {\n \tvoid _range_click_timeout();\n \tvoid _release_mouse_from_drag_mode();\n \n-\tvoid _update_text(bool p_keep_line_edit = false);\n+\tvoid _update_text(bool p_only_update_if_value_changed = false);\n \tvoid _text_submitted(const String &p_string);\n \tvoid _text_changed(const String &p_string);\n \n \tString prefix;\n \tString suffix;\n-\tString last_updated_text;\n+\tString last_text_value;\n \tdouble custom_arrow_step = 0.0;\n \tbool use_custom_arrow_step = false;\n \n", "instance_id": "godotengine__godot-100860", "clarity": 2, "difficulty": 0.55, "clarity_explanation": "The problem statement is mostly clear in describing the issue with the SpinBox component in the Godot engine, where setting a value via a signal gets overwritten by the LineEdit's text value when losing focus. It provides specific versions affected, system information, steps to reproduce, and a minimal reproduction project (MRP). The goal of fixing the incorrect value update behavior is evident, and the issue's context (focus loss timing) is well-articulated. However, there are minor ambiguities: the problem statement does not explicitly define the expected behavior in all scenarios (e.g., what should happen if the LineEdit text is invalid), and edge cases beyond the focus loss timing are not mentioned. Additionally, while the MRP and steps to reproduce are helpful, the lack of detailed expected output for various input scenarios slightly reduces clarity. Overall, it is a valid and mostly clear description but misses some minor details that could aid in fully understanding the requirements.", "difficulty_explanation": "The difficulty of this problem falls into the medium range due to several factors. First, the scope of code changes is relatively contained, primarily affecting a single file (`spin_box.cpp`) and its associated header (`spin_box.h`), with modifications to a few key functions like `_update_text` and `_line_edit_editing_toggled`. The changes involve a moderate amount of code (around 20-30 lines modified), focusing on logic for text updates and focus handling, without impacting the broader system architecture. Second, the technical concepts required include understanding C++ class member interactions, event handling (focus and text submission events), and state management (tracking last text values), which are moderately complex but not overly advanced. Third, the problem requires handling specific edge cases related to focus loss timing and ensuring signals are emitted correctly, as highlighted in the problem statement, but these are not extraordinarily intricate. Finally, solving this requires a good grasp of the SpinBox component's internal behavior in Godot, which adds some complexity but does not necessitate deep architectural refactoring or advanced domain-specific knowledge. A score of 0.55 reflects a medium difficulty level, as it involves understanding multiple concepts and making targeted, non-trivial modifications, but it is not a highly challenging or system-wide issue.", "clarity_label": 1, "difficulty_label": 1, "human_clarity": -1, "human_difficulty": -1}
{"problem_statement": "Jolt Physics: state.get_contact_collider_position() Fails for Sleeping Bodies Despite get_contact_count() > 0\n### Tested versions\n\n- Reproducible in: 4.3.stable\n\n### System information\n\nWindows 10 - Vulkan (Forward+) - NVIDIA RTX 3060\n\n### Issue description\n\n**Jolt was just integrated to Godot, so I believe this should be in Godot issues. If not let me know!**\n\nWhen using Jolt Physics in Godot 4, and trying to get collision contact points between bodies, calling state.get_contact_collider_position(index) for a RigidBody3D results in an \"Index out of bounds\" error if the body gets in sleep mode. This occurs even when get_contact_count() reports a value greater than 0. The error does not occur with default Godot Physics\n\nThe error:\n```\n_physics_process(): Index p_contact_idx = 0 is out of bounds (body->get_contact_count() = 0).\n  <C++ Source>   src\\objects\\jolt_physics_direct_body_state_3d.cpp:217 @ _get_contact_collider_position()\n```\n\nThis behavior affects contact point calculations for bodies that are stationary but still colliding with other objects\n\n### Steps to reproduce\n\n1. Set up a scene with two colliding RigidBody3D objects.\n2. Ensure Jolt Physics is installed and defined as current physics engine\n3. Enable contact_monitor and set max_contacts_reported to a non-zero value (e.g., 5).\n4. Let one of the bodies come to rest, causing it to enter sleep mode.\n5. Execute the code below inside the body that has come to a rest:\n\n```\nextends RigidBody3D\n\nfunc _ready() -> void:\n\tcontact_monitor = true\n\tmax_contacts_reported = 5\n\nfunc _physics_process(_delta: float) -> void:\n\t# Get body rid\n\tvar rid := get_rid()\n\t# Get body physics state\n\tvar state := PhysicsServer3D.body_get_direct_state(rid)\n\t\n\tfor i in get_contact_count():\n\t\tprint(\"Contact count: \", get_contact_count(),\n\t\t\t\"  \", state.get_contact_collider_position(i))\n```\n\n**Expected Behavior:**\nstate.get_contact_collider_position(index) should return valid contact points if get_contact_count() > 0, even when the body is in sleep mode.\n\n**Observed Behavior:**\nAn \"Index out of bounds\" error occurs, and get_contact_collider_position() fails.\n\n### Minimal reproduction project (MRP)\n\nI had to remove macOS, Linux and android libraries from the Jolt folder to make the file small enough to upload. You can always reinstall jolt add-on to make sure.\n\n[BugJoltContact.zip](https://github.com/user-attachments/files/18168435/BugJoltContact.zip)\n\n\n\n", "patch": "diff --git a/modules/jolt_physics/spaces/jolt_contact_listener_3d.cpp b/modules/jolt_physics/spaces/jolt_contact_listener_3d.cpp\nindex 21fb76464b27..85cf08d4c921 100644\n--- a/modules/jolt_physics/spaces/jolt_contact_listener_3d.cpp\n+++ b/modules/jolt_physics/spaces/jolt_contact_listener_3d.cpp\n@@ -407,24 +407,28 @@ void JoltContactListener3D::_flush_contacts() {\n \t\tconst JPH::SubShapeIDPair &shape_pair = E.key;\n \t\tManifold &manifold = E.value;\n \n-\t\tconst JPH::BodyID body_ids[2] = { shape_pair.GetBody1ID(), shape_pair.GetBody2ID() };\n-\t\tconst JoltReadableBodies3D jolt_bodies = space->read_bodies(body_ids, 2);\n+\t\tconst JoltReadableBody3D jolt_body1 = space->read_body(shape_pair.GetBody1ID());\n+\t\tconst JoltReadableBody3D jolt_body2 = space->read_body(shape_pair.GetBody2ID());\n \n-\t\tJoltBody3D *body1 = jolt_bodies[0].as_body();\n+\t\tJoltBody3D *body1 = jolt_body1.as_body();\n \t\tERR_FAIL_NULL(body1);\n \n-\t\tJoltBody3D *body2 = jolt_bodies[1].as_body();\n+\t\tJoltBody3D *body2 = jolt_body2.as_body();\n \t\tERR_FAIL_NULL(body2);\n \n \t\tconst int shape_index1 = body1->find_shape_index(shape_pair.GetSubShapeID1());\n \t\tconst int shape_index2 = body2->find_shape_index(shape_pair.GetSubShapeID2());\n \n-\t\tfor (const Contact &contact : manifold.contacts1) {\n-\t\t\tbody1->add_contact(body2, manifold.depth, shape_index1, shape_index2, contact.normal, contact.point_self, contact.point_other, contact.velocity_self, contact.velocity_other, contact.impulse);\n+\t\tif (jolt_body1->IsActive()) {\n+\t\t\tfor (const Contact &contact : manifold.contacts1) {\n+\t\t\t\tbody1->add_contact(body2, manifold.depth, shape_index1, shape_index2, contact.normal, contact.point_self, contact.point_other, contact.velocity_self, contact.velocity_other, contact.impulse);\n+\t\t\t}\n \t\t}\n \n-\t\tfor (const Contact &contact : manifold.contacts2) {\n-\t\t\tbody2->add_contact(body1, manifold.depth, shape_index2, shape_index1, contact.normal, contact.point_self, contact.point_other, contact.velocity_self, contact.velocity_other, contact.impulse);\n+\t\tif (jolt_body2->IsActive()) {\n+\t\t\tfor (const Contact &contact : manifold.contacts2) {\n+\t\t\t\tbody2->add_contact(body1, manifold.depth, shape_index2, shape_index1, contact.normal, contact.point_self, contact.point_other, contact.velocity_self, contact.velocity_other, contact.impulse);\n+\t\t\t}\n \t\t}\n \n \t\tmanifold.contacts1.clear();\n", "instance_id": "godotengine__godot-100533", "clarity": 2, "difficulty": 0.45, "clarity_explanation": "\nThe problem statement is mostly clear and provides a detailed description of the issue, including the context (Jolt Physics integration in Godot), the specific behavior observed (failure of `state.get_contact_collider_position()` for sleeping bodies despite `get_contact_count() > 0`), and the expected behavior. It also includes steps to reproduce the issue, system information, and a minimal reproduction project (MRP). However, there are minor ambiguities and missing details. For instance, the problem statement does not explicitly discuss potential edge cases beyond sleeping bodies (e.g., what happens during transitions between active and sleep states, or with multiple simultaneous contacts). Additionally, it lacks clarity on whether this behavior is specific to certain types of collisions or configurations. While the issue is well-documented, these minor gaps prevent it from being fully comprehensive, hence a score of 2 (Mostly Clear).\n", "difficulty_explanation": "\nI assign a difficulty score of 0.45, placing this problem in the medium range, based on the following analysis of the factors:\n\n1. **Clarity and Complexity of the Problem Description**: The problem is relatively straightforward\u2014ensuring contact points are reported correctly for sleeping bodies in a physics engine. The logic is not inherently complex, but it requires understanding the specific behavior of Jolt Physics and its integration with Godot.\n\n2. **Scope and Depth of Code Changes**: The provided code changes are localized to a single file (`jolt_contact_listener_3d.cpp`) and involve a small modification to conditionally add contacts only for active bodies using `IsActive()`. The change does not impact the broader system architecture or require modifications across multiple modules. The amount of code change is minimal, focusing on adding conditional checks before processing contacts.\n\n3. **Number of Technical Concepts**: Solving this requires understanding a few specific concepts: physics engine internals (e.g., body states like active/sleeping in Jolt Physics), Godot's physics integration, and C++ programming within the context of the Jolt library. While these concepts are not overly complex for someone familiar with physics engines or game development, they do require domain-specific knowledge and familiarity with the Jolt API.\n\n4. **Potential Edge Cases and Error Handling**: The problem statement highlights the primary edge case (sleeping bodies with reported contacts), but the code change introduces a potential issue: by skipping contact reporting for inactive bodies, it might suppress valid contact data, which could lead to other bugs or unexpected behavior in Godot. The modification does not explicitly address error handling beyond the conditional check, and further investigation might be needed to ensure no side effects occur (e.g., during state transitions or with multiple contacts). The edge case handling is moderate in complexity.\n\nOverall, this problem falls into the medium difficulty range (0.4-0.6) because it requires understanding specific domain knowledge (physics engines and Jolt/Godot integration) and making a targeted but potentially impactful change. It is not a simple bug fix due to the need to consider the implications of skipping contact reporting for inactive bodies, but it is also not a deep architectural change or a highly complex problem. A score of 0.45 reflects this balance.\n", "clarity_label": 1, "difficulty_label": 1, "human_clarity": -1, "human_difficulty": -1}
{"problem_statement": "build: Native ./depends build fails on s390x\nSteps to reproduce on a fresh s390x machine:\r\n\r\n```\r\nmake NO_QT=1 NO_WALLET=1 NO_UPNP=1 NO_NATPMP=1 -j $(nproc)\r\n```\r\n\r\n(Cross-compilation to s390x works)\r\n\r\n\r\nOutput:\r\n\r\n```\r\nBuilding zeromq...\r\nmake[1]: Entering directory '/b-c/depends/work/build/s390x-ibm-linux-gnu/zeromq/4.3.5-be763aa3d4e/build'\r\nmake[2]: Entering directory '/b-c/depends/work/build/s390x-ibm-linux-gnu/zeromq/4.3.5-be763aa3d4e/build'\r\nmake[3]: Entering directory '/b-c/depends/work/build/s390x-ibm-linux-gnu/zeromq/4.3.5-be763aa3d4e/build'\r\nmake[3]: Leaving directory '/b-c/depends/work/build/s390x-ibm-linux-gnu/zeromq/4.3.5-be763aa3d4e/build'\r\nmake[3]: Entering directory '/b-c/depends/work/build/s390x-ibm-linux-gnu/zeromq/4.3.5-be763aa3d4e/build'\r\n[  1%] Building CXX object CMakeFiles/objects.dir/src/address.cpp.o\r\nIn file included from /b-c/depends/work/build/s390x-ibm-linux-gnu/zeromq/4.3.5-be763aa3d4e/src/precompiled.hpp:16,\r\n                 from /b-c/depends/work/build/s390x-ibm-linux-gnu/zeromq/4.3.5-be763aa3d4e/src/address.cpp:3:\r\n/b-c/depends/work/build/s390x-ibm-linux-gnu/zeromq/4.3.5-be763aa3d4e/build/platform.hpp:22:28: error: 'undefined' was not declared in this scope\r\n   22 | #define ZMQ_CACHELINE_SIZE undefined\r\n      |                            ^~~~~~~~~\r\n/b-c/depends/work/build/s390x-ibm-linux-gnu/zeromq/4.3.5-be763aa3d4e/src/command.hpp:191:26: note: in expansion of macro 'ZMQ_CACHELINE_SIZE'\r\n  191 | __attribute__ ((aligned (ZMQ_CACHELINE_SIZE)))\r\n      |                          ^~~~~~~~~~~~~~~~~~\r\n/b-c/depends/work/build/s390x-ibm-linux-gnu/zeromq/4.3.5-be763aa3d4e/build/platform.hpp:22:28: error: 'undefined' was not declared in this scope\r\n   22 | #define ZMQ_CACHELINE_SIZE undefined\r\n      |                            ^~~~~~~~~\r\n/b-c/depends/work/build/s390x-ibm-linux-gnu/zeromq/4.3.5-be763aa3d4e/src/yqueue.hpp:34:45: note: in expansion of macro 'ZMQ_CACHELINE_SIZE'\r\n   34 | template <typename T, int N, size_t ALIGN = ZMQ_CACHELINE_SIZE> class yqueue_t\r\n      |                                             ^~~~~~~~~~~~~~~~~~\r\nIn file included from /b-c/depends/work/build/s390x-ibm-linux-gnu/zeromq/4.3.5-be763aa3d4e/src/mailbox.hpp:12,\r\n                 from /b-c/depends/work/build/s390x-ibm-linux-gnu/zeromq/4.3.5-be763aa3d4e/src/ctx.hpp:11,\r\n                 from /b-c/depends/work/build/s390x-ibm-linux-gnu/zeromq/4.3.5-be763aa3d4e/src/address.cpp:6:\r\n/b-c/depends/work/build/s390x-ibm-linux-gnu/zeromq/4.3.5-be763aa3d4e/src/ypipe.hpp:155:18: error: template argument 3 is invalid\r\n  155 |     yqueue_t<T, N> _queue;\r\n      |                  ^\r\n/b-c/depends/work/build/s390x-ibm-linux-gnu/zeromq/4.3.5-be763aa3d4e/src/ypipe.hpp: In constructor 'zmq::ypipe_t<T, N>::ypipe_t()':\r\n/b-c/depends/work/build/s390x-ibm-linux-gnu/zeromq/4.3.5-be763aa3d4e/src/ypipe.hpp:26:16: error: request for member 'push' in '((zmq::ypipe_t<T, N>*)this)->zmq::ypipe_t<T, N>::_queue', which is of non-class type 'int'\r\n   26 |         _queue.push ();\r\n      |                ^~~~\r\n/b-c/depends/work/build/s390x-ibm-linux-gnu/zeromq/4.3.5-be763aa3d4e/src/ypipe.hpp:30:32: error: request for member 'back' in '((zmq::ypipe_t<T, N>*)this)->zmq::ypipe_t<T, N>::_queue', which is of non-class type 'int'\r\n   30 |         _r = _w = _f = &_queue.back ();\r\n      |                                ^~~~\r\n/b-c/depends/work/build/s390x-ibm-linux-gnu/zeromq/4.3.5-be763aa3d4e/src/ypipe.hpp:31:25: error: request for member 'back' in '((zmq::ypipe_t<T, N>*)this)->zmq::ypipe_t<T, N>::_queue', which is of non-class type 'int'\r\n   31 |         _c.set (&_queue.back ());\r\n      |                         ^~~~\r\n/b-c/depends/work/build/s390x-ibm-linux-gnu/zeromq/4.3.5-be763aa3d4e/src/ypipe.hpp: In member function 'void zmq::ypipe_t<T, N>::write(const T&, bool)':\r\n/b-c/depends/work/build/s390x-ibm-linux-gnu/zeromq/4.3.5-be763aa3d4e/src/ypipe.hpp:50:16: error: request for member 'back' in '((zmq::ypipe_t<T, N>*)this)->zmq::ypipe_t<T, N>::_queue', which is of non-class type 'int'\r\n   50 |         _queue.back () = value_;\r\n      |                ^~~~\r\n/b-c/depends/work/build/s390x-ibm-linux-gnu/zeromq/4.3.5-be763aa3d4e/src/ypipe.hpp:51:16: error: request for member 'push' in '((zmq::ypipe_t<T, N>*)this)->zmq::ypipe_t<T, N>::_queue', which is of non-class type 'int'\r\n   51 |         _queue.push ();\r\n      |                ^~~~\r\n/b-c/depends/work/build/s390x-ibm-linux-gnu/zeromq/4.3.5-be763aa3d4e/src/ypipe.hpp:55:26: error: request for member 'back' in '((zmq::ypipe_t<T, N>*)this)->zmq::ypipe_t<T, N>::_queue', which is of non-class type 'int'\r\n   55 |             _f = &_queue.back ();\r\n      |                          ^~~~\r\n/b-c/depends/work/build/s390x-ibm-linux-gnu/zeromq/4.3.5-be763aa3d4e/src/ypipe.hpp: In member function 'bool zmq::ypipe_t<T, N>::unwrite(T*)':\r\n/b-c/depends/work/build/s390x-ibm-linux-gnu/zeromq/4.3.5-be763aa3d4e/src/ypipe.hpp:66:27: error: request for member 'back' in '((zmq::ypipe_t<T, N>*)this)->zmq::ypipe_t<T, N>::_queue', which is of non-class type 'int'\r\n   66 |         if (_f == &_queue.back ())\r\n      |                           ^~~~\r\n/b-c/depends/work/build/s390x-ibm-linux-gnu/zeromq/4.3.5-be763aa3d4e/src/ypipe.hpp:68:16: error: request for member 'unpush' in '((zmq::ypipe_t<T, N>*)this)->zmq::ypipe_t<T, N>::_queue', which is of non-class type 'int'\r\n   68 |         _queue.unpush ();\r\n      |                ^~~~~~\r\n/b-c/depends/work/build/s390x-ibm-linux-gnu/zeromq/4.3.5-be763aa3d4e/src/ypipe.hpp:69:26: error: request for member 'back' in '((zmq::ypipe_t<T, N>*)this)->zmq::ypipe_t<T, N>::_queue', which is of non-class type 'int'\r\n   69 |         *value_ = _queue.back ();\r\n      |                          ^~~~\r\n/b-c/depends/work/build/s390x-ibm-linux-gnu/zeromq/4.3.5-be763aa3d4e/src/ypipe.hpp: In member function 'bool zmq::ypipe_t<T, N>::check_read()':\r\n/b-c/depends/work/build/s390x-ibm-linux-gnu/zeromq/4.3.5-be763aa3d4e/src/ypipe.hpp:104:21: error: request for member 'front' in '((zmq::ypipe_t<T, N>*)this)->zmq::ypipe_t<T, N>::_queue', which is of non-class type 'int'\r\n  104 |         if (&_queue.front () != _r && _r)\r\n      |                     ^~~~~\r\n/b-c/depends/work/build/s390x-ibm-linux-gnu/zeromq/4.3.5-be763aa3d4e/src/ypipe.hpp:111:30: error: request for member 'front' in '((zmq::ypipe_t<T, N>*)this)->zmq::ypipe_t<T, N>::_queue', which is of non-class type 'int'\r\n  111 |         _r = _c.cas (&_queue.front (), NULL);\r\n      |                              ^~~~~\r\n/b-c/depends/work/build/s390x-ibm-linux-gnu/zeromq/4.3.5-be763aa3d4e/src/ypipe.hpp:117:21: error: request for member 'front' in '((zmq::ypipe_t<T, N>*)this)->zmq::ypipe_t<T, N>::_queue', which is of non-class type 'int'\r\n  117 |         if (&_queue.front () == _r || !_r)\r\n      |                     ^~~~~\r\n/b-c/depends/work/build/s390x-ibm-linux-gnu/zeromq/4.3.5-be763aa3d4e/src/ypipe.hpp: In member function 'bool zmq::ypipe_t<T, N>::read(T*)':\r\n/b-c/depends/work/build/s390x-ibm-linux-gnu/zeromq/4.3.5-be763aa3d4e/src/ypipe.hpp:134:26: error: request for member 'front' in '((zmq::ypipe_t<T, N>*)this)->zmq::ypipe_t<T, N>::_queue', which is of non-class type 'int'\r\n  134 |         *value_ = _queue.front ();\r\n      |                          ^~~~~\r\n/b-c/depends/work/build/s390x-ibm-linux-gnu/zeromq/4.3.5-be763aa3d4e/src/ypipe.hpp:135:16: error: request for member 'pop' in '((zmq::ypipe_t<T, N>*)this)->zmq::ypipe_t<T, N>::_queue', which is of non-class type 'int'\r\n  135 |         _queue.pop ();\r\n      |                ^~~\r\n/b-c/depends/work/build/s390x-ibm-linux-gnu/zeromq/4.3.5-be763aa3d4e/src/ypipe.hpp: In member function 'bool zmq::ypipe_t<T, N>::probe(bool (*)(const T&))':\r\n/b-c/depends/work/build/s390x-ibm-linux-gnu/zeromq/4.3.5-be763aa3d4e/src/ypipe.hpp:147:31: error: request for member 'front' in '((zmq::ypipe_t<T, N>*)this)->zmq::ypipe_t<T, N>::_queue', which is of non-class type 'int'\r\n  147 |         return (*fn_) (_queue.front ());\r\n      |                               ^~~~~\r\nAt global scope:\r\ncc1plus: note: unrecognized command-line option '-Wno-tautological-constant-compare' may have been intended to silence earlier diagnostics\r\nmake[3]: *** [CMakeFiles/objects.dir/build.make:90: CMakeFiles/objects.dir/src/address.cpp.o] Error 1\r\nmake[3]: Leaving directory '/b-c/depends/work/build/s390x-ibm-linux-gnu/zeromq/4.3.5-be763aa3d4e/build'\r\nmake[2]: *** [CMakeFiles/Makefile2:88: CMakeFiles/objects.dir/all] Error 2\r\nmake[2]: Leaving directory '/b-c/depends/work/build/s390x-ibm-linux-gnu/zeromq/4.3.5-be763aa3d4e/build'\r\nmake[1]: *** [Makefile:136: all] Error 2\r\nmake[1]: Leaving directory '/b-c/depends/work/build/s390x-ibm-linux-gnu/zeromq/4.3.5-be763aa3d4e/build'\r\nmake: *** [funcs.mk:301: /b-c/depends/work/build/s390x-ibm-linux-gnu/zeromq/4.3.5-be763aa3d4e/build/.stamp_built] Error 2\r\n```\r\n\r\n\n", "patch": "diff --git a/depends/packages/zeromq.mk b/depends/packages/zeromq.mk\nindex 7620df5477727..df018a1032247 100644\n--- a/depends/packages/zeromq.mk\n+++ b/depends/packages/zeromq.mk\n@@ -10,6 +10,7 @@ $(package)_patches += builtin_sha1.patch\n $(package)_patches += fix_have_windows.patch\n $(package)_patches += openbsd_kqueue_headers.patch\n $(package)_patches += cmake_minimum.patch\n+$(package)_patches += cacheline_undefined.patch\n $(package)_patches += no_librt.patch\n \n define $(package)_set_vars\n@@ -25,6 +26,7 @@ define $(package)_preprocess_cmds\n   patch -p1 < $($(package)_patch_dir)/remove_libstd_link.patch && \\\n   patch -p1 < $($(package)_patch_dir)/macos_mktemp_check.patch && \\\n   patch -p1 < $($(package)_patch_dir)/builtin_sha1.patch && \\\n+  patch -p1 < $($(package)_patch_dir)/cacheline_undefined.patch && \\\n   patch -p1 < $($(package)_patch_dir)/fix_have_windows.patch && \\\n   patch -p1 < $($(package)_patch_dir)/openbsd_kqueue_headers.patch && \\\n   patch -p1 < $($(package)_patch_dir)/cmake_minimum.patch && \\\ndiff --git a/depends/patches/zeromq/cacheline_undefined.patch b/depends/patches/zeromq/cacheline_undefined.patch\nnew file mode 100644\nindex 0000000000000..02bd2a5fe5d5a\n--- /dev/null\n+++ b/depends/patches/zeromq/cacheline_undefined.patch\n@@ -0,0 +1,15 @@\n+Use proper STREQUAL instead of EQUAL to compare strings.txt\n+\n+See: https://github.com/zeromq/libzmq/pull/4711.\n+\n+--- a/CMakeLists.txt\n++++ b/CMakeLists.txt\n+@@ -476,7 +476,7 @@ execute_process(\n+ if(CACHELINE_SIZE STREQUAL \"\"\n+    OR CACHELINE_SIZE EQUAL 0\n+    OR CACHELINE_SIZE EQUAL -1\n+-   OR CACHELINE_SIZE EQUAL \"undefined\")\n++   OR CACHELINE_SIZE STREQUAL \"undefined\")\n+   set(ZMQ_CACHELINE_SIZE 64)\n+ else()\n+   set(ZMQ_CACHELINE_SIZE ${CACHELINE_SIZE})\n", "instance_id": "bitcoin__bitcoin-30588", "clarity": 2, "difficulty": 0.3, "clarity_explanation": "The problem statement is mostly clear in identifying the issue: a build failure for ZeroMQ on s390x architecture during a native build. It provides steps to reproduce the issue, including the exact command to run, and includes detailed error output from the build process. The error messages point to a specific problem with the `ZMQ_CACHELINE_SIZE` macro being set to \"undefined,\" which causes compilation errors in the ZeroMQ library. However, the statement lacks explicit mention of the expected outcome or constraints (e.g., what should happen after the fix, or any performance considerations). Additionally, edge cases or potential side effects of the fix are not discussed. While the issue is clear to someone familiar with build systems and compilation errors, minor details are missing that could help in fully understanding the context or potential challenges in resolving it. Hence, I rate it as \"Mostly Clear\" with a score of 2.", "difficulty_explanation": "The difficulty of this problem falls into the \"Easy\" category with a score of 0.30. Here's the breakdown based on the evaluation factors:\n\n1. **Scope and Depth of Code Changes:** The code changes are minimal and localized to the build configuration of ZeroMQ. The fix involves adding a patch (`cacheline_undefined.patch`) to correct a string comparison in the CMake configuration file, changing `EQUAL` to `STREQUAL` for comparing the `CACHELINE_SIZE` value. The modification is limited to a single line in the CMakeLists.txt file and the addition of a patch file in the build system. It does not impact the broader architecture of the system or require changes across multiple modules. The amount of code change is very small.\n\n2. **Number of Technical Concepts:** Solving this requires a basic understanding of CMake scripting and string comparison operations within CMake. Familiarity with build systems and how patches are applied in a dependency management context (as seen in the `zeromq.mk` file) is necessary but not complex. No advanced algorithms, design patterns, or domain-specific knowledge beyond build configuration are needed. The concept of cache line size and its relevance to performance is tangential and not directly required to implement the fix.\n\n3. **Potential Edge Cases and Error Handling:** The problem statement and error output do not explicitly mention edge cases or additional error handling requirements. The fix addresses a specific build error caused by an incorrect comparison operator in CMake. There is no indication that the change introduces new edge cases or requires additional error handling logic. The simplicity of the fix suggests minimal risk of unintended side effects.\n\n4. **Overall Complexity:** The issue is a straightforward build configuration error that can be resolved with a small, targeted patch. It requires understanding the error message and applying a fix in the build script, which is a routine task for someone with experience in software builds. The problem does not demand deep knowledge of the ZeroMQ library internals or the s390x architecture beyond recognizing the build failure.\n\nGiven these factors, the problem is relatively easy, requiring only a basic understanding of CMake and build systems to implement a simple fix. A score of 0.30 reflects this as an \"Easy\" task, slightly above the lowest difficulty due to the need to interpret build errors and apply a patch in a dependency management system.", "clarity_label": 1, "difficulty_label": 1, "human_clarity": -1, "human_difficulty": -1}
{"problem_statement": "[Terminal Canary] Cursor doesn't show up in Terminal\n### Windows Terminal version\n\n1.23.10011.0\n\n### Windows build number\n\n10.0.27764.1000\n\n### Other Software\n\nsudo for Windows (1.0.1)\n\n### Steps to reproduce\n\n1. Launch Terminal Canary \n2. Launch a command with `sudo`\n3. Hover over the terminal with the cursor\n\n### Expected Behavior\n\nThe cursor should be visible when you hover over the Terminal launched with administrative privileges.\n\n### Actual Behavior\n\nCursor isn't showing when you hover over the Terminal.\n\nhttps://github.com/user-attachments/assets/b0ace3d3-c69e-475b-bac9-c864db5d76c7\n\n\n", "patch": "diff --git a/.github/actions/spelling/expect/expect.txt b/.github/actions/spelling/expect/expect.txt\nindex 55f9bac881d..b77cf969f49 100644\n--- a/.github/actions/spelling/expect/expect.txt\n+++ b/.github/actions/spelling/expect/expect.txt\n@@ -1354,6 +1354,7 @@ PNMLINK\n pntm\n POBJECT\n Podcast\n+POINTERUPDATE\n POINTSLIST\n policheck\n POLYTEXTW\ndiff --git a/src/cascadia/TerminalControl/TermControl.cpp b/src/cascadia/TerminalControl/TermControl.cpp\nindex 3724edd542c..d40ea2feb7f 100644\n--- a/src/cascadia/TerminalControl/TermControl.cpp\n+++ b/src/cascadia/TerminalControl/TermControl.cpp\n@@ -47,66 +47,6 @@ constexpr std::wstring_view StateCollapsed{ L\"Collapsed\" };\n DEFINE_ENUM_FLAG_OPERATORS(winrt::Microsoft::Terminal::Control::CopyFormat);\r\n DEFINE_ENUM_FLAG_OPERATORS(winrt::Microsoft::Terminal::Control::MouseButtonState);\r\n \r\n-// WinUI 3's UIElement.ProtectedCursor property allows someone to set the cursor on a per-element basis.\r\n-// This would allow us to hide the cursor when the TermControl has input focus and someone starts typing.\r\n-// Unfortunately, no equivalent exists for WinUI 2 so we fake it with the CoreWindow.\r\n-// There are 3 downsides:\r\n-// * SetPointerCapture() is global state and may interfere with other components.\r\n-// * You can't start dragging the cursor (for text selection) while it's still hidden.\r\n-// * The CoreWindow covers the union of all window rectangles, so the cursor is hidden even if it's outside\r\n-//   the current foreground window, but still on top of another Terminal window in the background.\r\n-static void hideCursorUntilMoved()\r\n-{\r\n-    static bool cursorIsHidden;\r\n-    static const auto shouldVanish = []() {\r\n-        BOOL shouldVanish = TRUE;\r\n-        SystemParametersInfoW(SPI_GETMOUSEVANISH, 0, &shouldVanish, 0);\r\n-        if (!shouldVanish)\r\n-        {\r\n-            return false;\r\n-        }\r\n-\r\n-        const auto window = CoreWindow::GetForCurrentThread();\r\n-        static constexpr auto releaseCapture = [](CoreWindow window, PointerEventArgs) {\r\n-            if (cursorIsHidden)\r\n-            {\r\n-                window.ReleasePointerCapture();\r\n-            }\r\n-        };\r\n-        static constexpr auto restoreCursor = [](CoreWindow window, PointerEventArgs) {\r\n-            if (cursorIsHidden)\r\n-            {\r\n-                cursorIsHidden = false;\r\n-                window.PointerCursor(CoreCursor{ CoreCursorType::Arrow, 0 });\r\n-            }\r\n-        };\r\n-\r\n-        winrt::Windows::Foundation::TypedEventHandler<CoreWindow, PointerEventArgs> releaseCaptureHandler{ releaseCapture };\r\n-        std::ignore = window.PointerMoved(releaseCaptureHandler);\r\n-        std::ignore = window.PointerPressed(releaseCaptureHandler);\r\n-        std::ignore = window.PointerReleased(releaseCaptureHandler);\r\n-        std::ignore = window.PointerWheelChanged(releaseCaptureHandler);\r\n-        std::ignore = window.PointerCaptureLost(restoreCursor);\r\n-        return true;\r\n-    }();\r\n-\r\n-    if (shouldVanish && !cursorIsHidden)\r\n-    {\r\n-        try\r\n-        {\r\n-            const auto window = CoreWindow::GetForCurrentThread();\r\n-            window.PointerCursor(nullptr);\r\n-            window.SetPointerCapture();\r\n-            cursorIsHidden = true;\r\n-        }\r\n-        catch (...)\r\n-        {\r\n-            // Swallow the 0x80070057 \"Failed to get pointer information.\" exception that randomly occurs.\r\n-            // Curiously, it doesn't happen during the PointerCursor() but during the SetPointerCapture() call (thanks, WinUI).\r\n-        }\r\n-    }\r\n-}\r\n-\r\n // InputPane::GetForCurrentView() does not reliably work for XAML islands,\r\n // as it assumes that there's a 1:1 relationship between windows and threads.\r\n //\r\n@@ -1551,8 +1491,6 @@ namespace winrt::Microsoft::Terminal::Control::implementation\n             return;\r\n         }\r\n \r\n-        hideCursorUntilMoved();\r\n-\r\n         const auto ch = e.Character();\r\n         const auto keyStatus = e.KeyStatus();\r\n         const auto scanCode = gsl::narrow_cast<WORD>(keyStatus.ScanCode);\r\ndiff --git a/src/cascadia/WindowsTerminal/IslandWindow.cpp b/src/cascadia/WindowsTerminal/IslandWindow.cpp\nindex 4c950cb986d..4b965be4022 100644\n--- a/src/cascadia/WindowsTerminal/IslandWindow.cpp\n+++ b/src/cascadia/WindowsTerminal/IslandWindow.cpp\n@@ -26,6 +26,48 @@ using VirtualKeyModifiers = winrt::Windows::System::VirtualKeyModifiers;\n #define XAML_HOSTING_WINDOW_CLASS_NAME L\"CASCADIA_HOSTING_WINDOW_CLASS\"\r\n #define IDM_SYSTEM_MENU_BEGIN 0x1000\r\n \r\n+// WinUI doesn't support the \"Hide cursor on input\" setting which is why all the modern Windows apps\r\n+// are broken in that respect. We want to support it though, so we implement an imitation of it here.\r\n+// We use the classic ShowCursor() API to hide it on keydown and show it on a select few messages.\r\n+// WinUI's SetPointerCapture() cannot be used for this, because it races with internal WinUI code\r\n+// calling that function and has proven itself to be very unreliable in practice.\r\n+//\r\n+// With UWP half the input stack got split off, and so most input events get rerouted through\r\n+// the CoreInput child window running in another thread (aka InputHost aka Windows.UI.Input).\r\n+// HideCursor() is called by WindowEmperor because WM_KEYDOWN is otherwise sent directly to that\r\n+// CoreInput window. Same for WM_POINTERUPDATE which we use to reliably detect cursor movement.\r\n+// WM_ACTIVATE on the other hand is only sent to each specific window and cannot be hooked by\r\n+// inspecting the MSG struct coming from GetMessage. That's why the code must be here.\r\n+// Best not think about this too much...\r\n+bool IslandWindow::IsCursorHidden() noexcept\r\n+{\r\n+    return _cursorHidden;\r\n+}\r\n+\r\n+void IslandWindow::HideCursor() noexcept\r\n+{\r\n+    static const auto shouldVanish = []() noexcept {\r\n+        BOOL shouldVanish = TRUE;\r\n+        SystemParametersInfoW(SPI_GETMOUSEVANISH, 0, &shouldVanish, 0);\r\n+        return shouldVanish != FALSE;\r\n+    }();\r\n+\r\n+    if (!_cursorHidden && shouldVanish)\r\n+    {\r\n+        ShowCursor(FALSE);\r\n+        _cursorHidden = true;\r\n+    }\r\n+}\r\n+\r\n+void IslandWindow::ShowCursorMaybe(const UINT message) noexcept\r\n+{\r\n+    if (_cursorHidden && (message == WM_ACTIVATE || message == WM_POINTERUPDATE))\r\n+    {\r\n+        _cursorHidden = false;\r\n+        ShowCursor(TRUE);\r\n+    }\r\n+}\r\n+\r\n IslandWindow::IslandWindow() noexcept :\r\n     _interopWindowHandle{ nullptr },\r\n     _rootGrid{ nullptr },\r\n@@ -425,6 +467,11 @@ void IslandWindow::_OnGetMinMaxInfo(const WPARAM /*wParam*/, const LPARAM lParam\n \r\n [[nodiscard]] LRESULT IslandWindow::MessageHandler(UINT const message, WPARAM const wparam, LPARAM const lparam) noexcept\r\n {\r\n+    if (IsCursorHidden())\r\n+    {\r\n+        ShowCursorMaybe(message);\r\n+    }\r\n+\r\n     switch (message)\r\n     {\r\n     case WM_GETMINMAXINFO:\r\ndiff --git a/src/cascadia/WindowsTerminal/IslandWindow.h b/src/cascadia/WindowsTerminal/IslandWindow.h\nindex 8432d4e8134..47d4e38ce98 100644\n--- a/src/cascadia/WindowsTerminal/IslandWindow.h\n+++ b/src/cascadia/WindowsTerminal/IslandWindow.h\n@@ -14,6 +14,10 @@ class IslandWindow :\n     public BaseWindow<IslandWindow>\n {\n public:\n+    static bool IsCursorHidden() noexcept;\n+    static void HideCursor() noexcept;\n+    static void ShowCursorMaybe(const UINT message) noexcept;\n+\n     IslandWindow() noexcept;\n     virtual ~IslandWindow() override;\n \n@@ -143,7 +147,7 @@ class IslandWindow :\n     bool _minimizeToNotificationArea{ false };\n \n     std::unordered_map<UINT, SystemMenuItemInfo> _systemMenuItems;\n-    UINT _systemMenuNextItemId;\n+    UINT _systemMenuNextItemId = 0;\n     void _resetSystemMenu();\n \n private:\n@@ -154,4 +158,6 @@ class IslandWindow :\n     // though the total height will take into account the non-client area\n     // and the requirements of components hosted in the client area\n     static constexpr float minimumHeight = 0;\n+\n+    inline static bool _cursorHidden;\n };\ndiff --git a/src/cascadia/WindowsTerminal/WindowEmperor.cpp b/src/cascadia/WindowsTerminal/WindowEmperor.cpp\nindex 59f26b50b16..16e128d077b 100644\n--- a/src/cascadia/WindowsTerminal/WindowEmperor.cpp\n+++ b/src/cascadia/WindowsTerminal/WindowEmperor.cpp\n@@ -417,6 +417,16 @@ void WindowEmperor::HandleCommandlineArgs(int nCmdShow)\n                 _dispatchSpecialKey(msg);\r\n                 continue;\r\n             }\r\n+\r\n+            if (msg.message == WM_KEYDOWN)\r\n+            {\r\n+                IslandWindow::HideCursor();\r\n+            }\r\n+        }\r\n+\r\n+        if (IslandWindow::IsCursorHidden())\r\n+        {\r\n+            IslandWindow::ShowCursorMaybe(msg.message);\r\n         }\r\n \r\n         TranslateMessage(&msg);\r\n", "instance_id": "microsoft__terminal-18445", "clarity": 2, "difficulty": 0.65, "clarity_explanation": "The problem statement is mostly clear in describing the issue: the cursor does not appear when hovering over the Terminal Canary window launched with administrative privileges using `sudo` on Windows. It provides the version of the software, the steps to reproduce, and the expected versus actual behavior, which helps in understanding the context. However, there are minor ambiguities and missing details. For instance, it does not specify whether this issue occurs under specific conditions (e.g., certain terminal profiles, specific hardware, or input devices) or if there are related side effects (e.g., does it affect functionality beyond visibility?). Additionally, there are no explicit constraints or requirements for the solution, such as performance expectations or compatibility concerns. While the attached video link (presumably showing the issue) is helpful, it is not a substitute for a detailed textual description of edge cases or environmental factors. Thus, the statement is valid and mostly clear but lacks some minor details that could aid in fully understanding the scope of the problem.", "difficulty_explanation": "The difficulty of this problem falls into the \"Hard\" category (0.6-0.8) due to several factors. First, the scope of code changes spans multiple files (`TermControl.cpp`, `IslandWindow.cpp`, `IslandWindow.h`, `WindowEmperor.cpp`), indicating a need to understand and modify interactions across different components of the Windows Terminal codebase. The changes involve replacing an existing cursor-hiding mechanism (based on `CoreWindow` and `SetPointerCapture`) with a new approach using the classic `ShowCursor` API, which suggests a moderate impact on the system's input handling logic. This is not a trivial refactoring, as it requires careful handling to avoid race conditions or interference with other UI components, as noted in the code comments.\n\nSecond, the number of technical concepts involved is significant. The solution requires knowledge of Windows API calls (`ShowCursor`, `SystemParametersInfoW`), WinUI limitations, UWP input stack intricacies (e.g., CoreInput child window), and message handling in Windows (e.g., `WM_KEYDOWN`, `WM_POINTERUPDATE`, `WM_ACTIVATE`). Understanding the threading model and event routing in the Windows Terminal architecture is also necessary, which adds to the complexity.\n\nThird, while the problem statement does not explicitly mention edge cases, the code changes and comments imply potential challenges, such as ensuring the cursor visibility toggles correctly under various input events and window states (e.g., activation, pointer movement). The previous implementation's issues with global state interference (`SetPointerCapture`) and unreliable behavior highlight the need for robust error handling and testing across different scenarios, which increases the difficulty.\n\nOverall, this problem requires a deep understanding of the Windows Terminal's input handling and UI architecture, along with careful modifications to ensure compatibility and reliability. It is not at the very high end of difficulty (0.8-1.0) because it does not involve system-level redesign or highly specialized domain knowledge, but it is still a challenging task due to the cross-component changes and technical depth required.", "clarity_label": 1, "difficulty_label": 1, "human_clarity": -1, "human_difficulty": -1}
{"problem_statement": "[High Contrast] Colored tabs lose color when unfocused\n### Windows Terminal version\n\n1.14.1262.0\n\n### Windows build number\n\n10.0.22621.0\n\n### Other Software\n\n_No response_\n\n### Steps to reproduce\n\n1. Enter high contrast mode\r\n2. color a tab\r\n3. switch focus to another tab\n\n### Expected Behavior\n\ncolored tab should still retain the color\n\n### Actual Behavior\n\ncolored tab reverted to high contrast color (until focused again).\n", "patch": "diff --git a/src/cascadia/TerminalApp/TabBase.cpp b/src/cascadia/TerminalApp/TabBase.cpp\nindex 2d5e8da4433..55f2cffcb57 100644\n--- a/src/cascadia/TerminalApp/TabBase.cpp\n+++ b/src/cascadia/TerminalApp/TabBase.cpp\n@@ -458,45 +458,67 @@ namespace winrt::TerminalApp::implementation\n             deselectedFontBrush.Color(winrt::Windows::UI::Colors::White());\r\n         }\r\n \r\n-        // Prior to MUX 2.7, we set TabViewItemHeaderBackground, but now we can\r\n-        // use TabViewItem().Background() for that. HOWEVER,\r\n-        // TabViewItem().Background() only sets the color of the tab background\r\n-        // when the TabViewItem is unselected. So we still need to set the other\r\n-        // properties ourselves.\r\n-        //\r\n-        // In GH#11294 we thought we'd still need to set\r\n-        // TabViewItemHeaderBackground manually, but GH#11382 discovered that\r\n-        // Background() was actually okay after all.\r\n-\r\n-        const auto& tabItemResources{ TabViewItem().Resources() };\r\n-\r\n-        TabViewItem().Background(deselectedTabBrush);\r\n-        tabItemResources.Insert(winrt::box_value(L\"TabViewItemHeaderBackgroundSelected\"), selectedTabBrush);\r\n-        tabItemResources.Insert(winrt::box_value(L\"TabViewItemHeaderBackgroundPointerOver\"), hoverTabBrush);\r\n-        tabItemResources.Insert(winrt::box_value(L\"TabViewItemHeaderBackgroundPressed\"), selectedTabBrush);\r\n-\r\n-        // Similarly, TabViewItem().Foreground()  sets the color for the text\r\n-        // when the TabViewItem isn't selected, but not when it is hovered,\r\n-        // pressed, dragged, or selected, so we'll need to just set them all\r\n-        // anyways.\r\n-        TabViewItem().Foreground(deselectedFontBrush);\r\n-        tabItemResources.Insert(winrt::box_value(L\"TabViewItemHeaderForeground\"), deselectedFontBrush);\r\n-        tabItemResources.Insert(winrt::box_value(L\"TabViewItemHeaderForegroundSelected\"), fontBrush);\r\n-        tabItemResources.Insert(winrt::box_value(L\"TabViewItemHeaderForegroundPointerOver\"), fontBrush);\r\n-        tabItemResources.Insert(winrt::box_value(L\"TabViewItemHeaderForegroundPressed\"), fontBrush);\r\n-\r\n-        tabItemResources.Insert(winrt::box_value(L\"TabViewItemHeaderCloseButtonForeground\"), deselectedFontBrush);\r\n-        tabItemResources.Insert(winrt::box_value(L\"TabViewItemHeaderCloseButtonForegroundPressed\"), secondaryFontBrush);\r\n-        tabItemResources.Insert(winrt::box_value(L\"TabViewItemHeaderCloseButtonForegroundPointerOver\"), fontBrush);\r\n-        tabItemResources.Insert(winrt::box_value(L\"TabViewItemHeaderPressedCloseButtonForeground\"), fontBrush);\r\n-        tabItemResources.Insert(winrt::box_value(L\"TabViewItemHeaderPointerOverCloseButtonForeground\"), fontBrush);\r\n-        tabItemResources.Insert(winrt::box_value(L\"TabViewItemHeaderSelectedCloseButtonForeground\"), fontBrush);\r\n-        tabItemResources.Insert(winrt::box_value(L\"TabViewItemHeaderCloseButtonBackgroundPressed\"), subtleFillColorTertiaryBrush);\r\n-        tabItemResources.Insert(winrt::box_value(L\"TabViewItemHeaderCloseButtonBackgroundPointerOver\"), subtleFillColorSecondaryBrush);\r\n-\r\n-        tabItemResources.Insert(winrt::box_value(L\"TabViewButtonForegroundActiveTab\"), fontBrush);\r\n-        tabItemResources.Insert(winrt::box_value(L\"TabViewButtonForegroundPressed\"), fontBrush);\r\n-        tabItemResources.Insert(winrt::box_value(L\"TabViewButtonForegroundPointerOver\"), fontBrush);\r\n+        // Add the empty theme dictionaries\r\n+        const auto& tabItemThemeResources{ TabViewItem().Resources().ThemeDictionaries() };\r\n+        ResourceDictionary lightThemeDictionary;\r\n+        ResourceDictionary darkThemeDictionary;\r\n+        ResourceDictionary highContrastThemeDictionary;\r\n+        tabItemThemeResources.Insert(winrt::box_value(L\"Light\"), lightThemeDictionary);\r\n+        tabItemThemeResources.Insert(winrt::box_value(L\"Dark\"), darkThemeDictionary);\r\n+        tabItemThemeResources.Insert(winrt::box_value(L\"HighContrast\"), highContrastThemeDictionary);\r\n+\r\n+        // Now actually set the resources we want in them.\r\n+        // Before, we used to put these on the ResourceDictionary directly.\r\n+        // However, HighContrast mode may require some adjustments. So let's just add\r\n+        //   all three so we can make those adjustments on the HighContrast version.\r\n+        for (const auto& [k, v] : tabItemThemeResources)\r\n+        {\r\n+            const bool isHighContrast = winrt::unbox_value<hstring>(k) == L\"HighContrast\";\r\n+            const auto& currentDictionary = v.as<ResourceDictionary>();\r\n+\r\n+            // TabViewItem.Background\r\n+            currentDictionary.Insert(winrt::box_value(L\"TabViewItemHeaderBackground\"), deselectedTabBrush);\r\n+            currentDictionary.Insert(winrt::box_value(L\"TabViewItemHeaderBackgroundSelected\"), selectedTabBrush);\r\n+            currentDictionary.Insert(winrt::box_value(L\"TabViewItemHeaderBackgroundPointerOver\"), isHighContrast ? fontBrush : hoverTabBrush);\r\n+            currentDictionary.Insert(winrt::box_value(L\"TabViewItemHeaderBackgroundPressed\"), selectedTabBrush);\r\n+\r\n+            // TabViewItem.Foreground (aka text)\r\n+            currentDictionary.Insert(winrt::box_value(L\"TabViewItemHeaderForeground\"), deselectedFontBrush);\r\n+            currentDictionary.Insert(winrt::box_value(L\"TabViewItemHeaderForegroundSelected\"), fontBrush);\r\n+            currentDictionary.Insert(winrt::box_value(L\"TabViewItemHeaderForegroundPointerOver\"), isHighContrast ? selectedTabBrush : fontBrush);\r\n+            currentDictionary.Insert(winrt::box_value(L\"TabViewItemHeaderForegroundPressed\"), fontBrush);\r\n+\r\n+            // TabViewItem.CloseButton.Foreground (aka X)\r\n+            currentDictionary.Insert(winrt::box_value(L\"TabViewItemHeaderCloseButtonForeground\"), deselectedFontBrush);\r\n+            currentDictionary.Insert(winrt::box_value(L\"TabViewItemHeaderCloseButtonForegroundPressed\"), isHighContrast ? deselectedFontBrush : secondaryFontBrush);\r\n+            currentDictionary.Insert(winrt::box_value(L\"TabViewItemHeaderCloseButtonForegroundPointerOver\"), isHighContrast ? deselectedFontBrush : fontBrush);\r\n+\r\n+            // TabViewItem.CloseButton.Foreground _when_ interacting with the tab\r\n+            currentDictionary.Insert(winrt::box_value(L\"TabViewItemHeaderPressedCloseButtonForeground\"), fontBrush);\r\n+            currentDictionary.Insert(winrt::box_value(L\"TabViewItemHeaderPointerOverCloseButtonForeground\"), isHighContrast ? selectedTabBrush : fontBrush);\r\n+            currentDictionary.Insert(winrt::box_value(L\"TabViewItemHeaderSelectedCloseButtonForeground\"), fontBrush);\r\n+\r\n+            // TabViewItem.CloseButton.Background (aka X button)\r\n+            currentDictionary.Insert(winrt::box_value(L\"TabViewItemHeaderCloseButtonBackground\"), deselectedTabBrush);\r\n+            currentDictionary.Insert(winrt::box_value(L\"TabViewItemHeaderCloseButtonBackgroundPressed\"), isHighContrast ? selectedTabBrush : subtleFillColorTertiaryBrush);\r\n+            currentDictionary.Insert(winrt::box_value(L\"TabViewItemHeaderCloseButtonBackgroundPointerOver\"), isHighContrast ? selectedTabBrush : subtleFillColorSecondaryBrush);\r\n+\r\n+            // A few miscellaneous resources that WinUI said may be removed in the future\r\n+            currentDictionary.Insert(winrt::box_value(L\"TabViewButtonForegroundActiveTab\"), fontBrush);\r\n+            currentDictionary.Insert(winrt::box_value(L\"TabViewButtonForegroundPressed\"), fontBrush);\r\n+            currentDictionary.Insert(winrt::box_value(L\"TabViewButtonForegroundPointerOver\"), fontBrush);\r\n+\r\n+            // Add a few extra ones for high contrast mode\r\n+            // BODGY: contrary to the docs, Insert() seems to throw if the value already exists\r\n+            //   Make sure you don't touch any that already exist here!\r\n+            if (isHighContrast)\r\n+            {\r\n+                // TabViewItem.CloseButton.Border: in HC mode, the border makes the button more clearly visible\r\n+                currentDictionary.Insert(winrt::box_value(L\"TabViewItemHeaderCloseButtonBorderBrushPressed\"), fontBrush);\r\n+                currentDictionary.Insert(winrt::box_value(L\"TabViewItemHeaderCloseButtonBorderBrushPointerOver\"), fontBrush);\r\n+                currentDictionary.Insert(winrt::box_value(L\"TabViewItemHeaderCloseButtonBorderBrushSelected\"), fontBrush);\r\n+            }\r\n+        }\r\n \r\n         _RefreshVisualState();\r\n     }\r\n@@ -511,36 +533,55 @@ namespace winrt::TerminalApp::implementation\n     void TabBase::_ClearTabBackgroundColor()\r\n     {\r\n         static const winrt::hstring keys[] = {\r\n+            // TabViewItem.Background\r\n             L\"TabViewItemHeaderBackground\",\r\n             L\"TabViewItemHeaderBackgroundSelected\",\r\n             L\"TabViewItemHeaderBackgroundPointerOver\",\r\n             L\"TabViewItemHeaderBackgroundPressed\",\r\n+\r\n+            // TabViewItem.Foreground (aka text)\r\n             L\"TabViewItemHeaderForeground\",\r\n             L\"TabViewItemHeaderForegroundSelected\",\r\n             L\"TabViewItemHeaderForegroundPointerOver\",\r\n             L\"TabViewItemHeaderForegroundPressed\",\r\n+\r\n+            // TabViewItem.CloseButton.Foreground (aka X)\r\n             L\"TabViewItemHeaderCloseButtonForeground\",\r\n-            L\"TabViewItemHeaderCloseButtonForegroundPressed\",\r\n+            L\"TabViewItemHeaderForegroundSelected\",\r\n             L\"TabViewItemHeaderCloseButtonForegroundPointerOver\",\r\n+            L\"TabViewItemHeaderCloseButtonForegroundPressed\",\r\n+\r\n+            // TabViewItem.CloseButton.Foreground _when_ interacting with the tab\r\n             L\"TabViewItemHeaderPressedCloseButtonForeground\",\r\n             L\"TabViewItemHeaderPointerOverCloseButtonForeground\",\r\n             L\"TabViewItemHeaderSelectedCloseButtonForeground\",\r\n+\r\n+            // TabViewItem.CloseButton.Background (aka X button)\r\n+            L\"TabViewItemHeaderCloseButtonBackground\",\r\n             L\"TabViewItemHeaderCloseButtonBackgroundPressed\",\r\n             L\"TabViewItemHeaderCloseButtonBackgroundPointerOver\",\r\n+\r\n+            // A few miscellaneous resources that WinUI said may be removed in the future\r\n             L\"TabViewButtonForegroundActiveTab\",\r\n             L\"TabViewButtonForegroundPressed\",\r\n-            L\"TabViewButtonForegroundPointerOver\"\r\n+            L\"TabViewButtonForegroundPointerOver\",\r\n+\r\n+            // TabViewItem.CloseButton.Border: in HC mode, the border makes the button more clearly visible\r\n+            L\"TabViewItemHeaderCloseButtonBorderBrushPressed\",\r\n+            L\"TabViewItemHeaderCloseButtonBorderBrushPointerOver\",\r\n+            L\"TabViewItemHeaderCloseButtonBorderBrushSelected\"\r\n         };\r\n \r\n-        const auto& tabItemResources{ TabViewItem().Resources() };\r\n+        const auto& tabItemThemeResources{ TabViewItem().Resources().ThemeDictionaries() };\r\n \r\n         // simply clear any of the colors in the tab's dict\r\n         for (const auto& keyString : keys)\r\n         {\r\n-            auto key = winrt::box_value(keyString);\r\n-            if (tabItemResources.HasKey(key))\r\n+            const auto key = winrt::box_value(keyString);\r\n+            for (const auto& [_, v] : tabItemThemeResources)\r\n             {\r\n-                tabItemResources.Remove(key);\r\n+                const auto& themeDictionary = v.as<ResourceDictionary>();\r\n+                themeDictionary.Remove(key);\r\n             }\r\n         }\r\n \r\n", "instance_id": "microsoft__terminal-18109", "clarity": 2, "difficulty": 0.55, "clarity_explanation": "The problem statement is mostly clear in describing the issue: colored tabs in Windows Terminal lose their color when unfocused in high contrast mode. It provides specific steps to reproduce the issue, the expected behavior (tabs should retain color), and the actual behavior (color reverts to high contrast until focused again). Additionally, it includes relevant context such as the Windows Terminal version and build number. However, it lacks explicit mention of edge cases or specific constraints (e.g., whether this applies to all high contrast themes or specific ones, or if there are performance considerations). While the goal is clear, these minor missing details prevent it from being comprehensive, hence a score of 2 (Mostly Clear).", "difficulty_explanation": "The difficulty of this problem falls into the medium range (0.4-0.6) due to several factors. First, the scope of code changes is relatively focused, primarily affecting a single file (`TabBase.cpp`) and a specific section related to tab styling and theme resources. However, the changes are substantial, involving a complete overhaul of how theme dictionaries (Light, Dark, HighContrast) are managed and applied, with specific adjustments for high contrast mode. This requires understanding WinUI resource management, theme dictionaries, and the interaction between different visual states of tabs (selected, deselected, hovered, etc.), which introduces moderate complexity. Second, the technical concepts involved include C++ with WinRT, familiarity with Windows UI frameworks (specifically WinUI and TabViewItem resources), and handling theme-specific logic, which are non-trivial but not extremely advanced. Third, while the problem statement does not explicitly mention edge cases, the code changes suggest considerations for high contrast mode-specific behaviors (e.g., border visibility for close buttons), indicating some implicit edge case handling. Finally, the changes do not appear to impact the broader system architecture but require careful attention to ensure visual consistency across themes. Given the need to understand multiple concepts and implement detailed modifications, but without requiring deep architectural changes or advanced domain knowledge, a difficulty score of 0.55 seems appropriate, placing it in the medium category with a slight lean towards the higher end due to the UI framework complexity.", "clarity_label": 1, "difficulty_label": 1, "human_clarity": -1, "human_difficulty": -1}
{"problem_statement": "Resizing the font while playing a sixel video can trigger a crash\n### Windows Terminal version\n\n1.22.2362.0\n\n### Windows build number\n\n10.0.19045.4894\n\n### Other Software\n\n[img2sixel](https://github.com/saitoha/libsixel)\n\n### Steps to reproduce\n\n1. Start a WSL shell in Windows Terminal.\r\n2. Get some content in the buffer so that resizing will force a reflow.\r\n3. View an animated gif with `img2sixel filename.gif` so you've got some sixel content being constantly refreshed.\r\n4. Resize the font with the mouse scroll wheel, so you're rapidly growing and shrinking the animation. Make sure the image sometimes grows larger than the viewport.\n\n### Expected Behavior\n\nThe animation should continue to play without any problems, aside from the fact that some partial frames will be pushed into the scrollback buffer when the image becomes too large to fit the height of the page.\n\n### Actual Behavior\n\nThe terminal eventually crashes.\r\n\r\nThis doesn't happen in OpenConsole, but that is assumedly because it resizes the window when you change the font size, so the text dimensions never change, and thus no reflow is required. Although now that I say that, I suspect you could possibly cause it to crash just by resizing the window in a way that triggers a reflow.\n", "patch": "diff --git a/src/terminal/adapter/SixelParser.cpp b/src/terminal/adapter/SixelParser.cpp\nindex f9dbdf6603a..979dd42371c 100644\n--- a/src/terminal/adapter/SixelParser.cpp\n+++ b/src/terminal/adapter/SixelParser.cpp\n@@ -715,8 +715,16 @@ void SixelParser::_eraseImageBufferRows(const int rowCount, const til::CoordType\n     const auto pixelCount = rowCount * _cellSize.height;\r\n     const auto bufferOffset = rowOffset * _cellSize.height * _imageMaxWidth;\r\n     const auto bufferOffsetEnd = bufferOffset + pixelCount * _imageMaxWidth;\r\n-    _imageBuffer.erase(_imageBuffer.begin() + bufferOffset, _imageBuffer.begin() + bufferOffsetEnd);\r\n-    _imageCursor.y -= pixelCount;\r\n+    if (static_cast<size_t>(bufferOffsetEnd) >= _imageBuffer.size()) [[unlikely]]\r\n+    {\r\n+        _imageBuffer.clear();\r\n+        _imageCursor.y = 0;\r\n+    }\r\n+    else\r\n+    {\r\n+        _imageBuffer.erase(_imageBuffer.begin() + bufferOffset, _imageBuffer.begin() + bufferOffsetEnd);\r\n+        _imageCursor.y -= pixelCount;\r\n+    }\r\n }\r\n \r\n void SixelParser::_maybeFlushImageBuffer(const bool endOfSequence)\r\n", "instance_id": "microsoft__terminal-17951", "clarity": 2, "difficulty": 0.5, "clarity_explanation": "The problem statement is mostly clear in describing the issue: resizing the font while playing a sixel video in Windows Terminal causes a crash. It provides specific steps to reproduce the issue, including the environment (WSL shell, Windows Terminal version, and external software), the actions to trigger the crash (font resizing during sixel animation playback), and the expected versus actual behavior. However, there are minor ambiguities and missing details. For instance, the problem does not explicitly define the root cause of the crash (though it hints at reflow issues), nor does it specify constraints or edge cases beyond the general scenario of resizing. Additionally, there are no examples of specific inputs (e.g., particular GIF files or resizing patterns) that might consistently trigger the issue. While the context is sufficient to understand the problem, these missing details prevent it from being fully comprehensive.", "difficulty_explanation": "The difficulty of this problem falls into the medium range due to several factors. First, the scope of the code change is relatively small, confined to a single file (`SixelParser.cpp`) and a specific function related to image buffer management. The diff shows a targeted modification to handle a potential buffer overflow or invalid erase operation by adding a bounds check and clearing the buffer if necessary. This suggests a focused bug fix rather than a broad architectural change. However, the problem requires understanding specific technical concepts, such as sixel graphics parsing, buffer management, and the interaction between terminal resizing and content reflow. These concepts are moderately complex, especially since sixel graphics are a niche domain within terminal emulation. Additionally, the crash likely involves edge cases related to buffer size mismatches during rapid resizing, which the code change addresses by introducing a safety check. While the fix itself is straightforward (a conditional check and buffer clearing), identifying the root cause and ensuring the solution handles all edge cases (e.g., partial frame rendering, scrollback buffer interactions) requires a deeper understanding of the terminal's rendering logic. There are no significant performance or system-level considerations apparent in the change, and the impact is localized, which keeps the difficulty from being higher. Overall, this problem balances moderate conceptual complexity with a contained scope, warranting a score of 0.50.", "clarity_label": 1, "difficulty_label": 1, "human_clarity": -1, "human_difficulty": -1}
{"problem_statement": "Low reliability of VT replies\n### Windows Terminal version\r\n\r\nLatest source\r\n\r\n### Windows build number\r\n\r\n10.0.19045.4780\r\n\r\n### Other Software\r\n\r\nNo\r\n\r\n### Steps to reproduce\r\n\r\nI want to query some terminal state, in particular the latest and greatest palette (#17729).\r\nTo do so, I build a bunch of those `\"\\x1b]4;N;?\\x1b\\\\\"`, send them in one go and wait for the reply.\r\nSince I want to support not only the latest nightlies and do not want the older versions to deadlock on unknown queries, I prepend and append another query, the one that even prehistoric versions understand: `\"\\x1b[c\"`.\r\nIf there is something between those DA replies, it must be the one I need.\r\nIf there are only two DA replies, then it is probably not supported.\r\n\r\nThis approach works flawlessly in OpenConsole.\r\nIn WT, however, not so much: way, way too often random parts of the reply are simply missing.\r\n\r\n1. Compile the code:\r\n    \r\n<details>\r\n<summary>Code</summary>\r\n  \r\n```C++\r\n#ifndef _CRT_SECURE_NO_WARNINGS\r\n#define _CRT_SECURE_NO_WARNINGS\r\n#endif\r\n\r\n#ifndef _UNICODE\r\n#define _UNICODE\r\n#endif\r\n\r\n#ifndef UNICODE\r\n#define UNICODE\r\n#endif\r\n\r\n#include <algorithm>\r\n#include <format>\r\n#include <exception>\r\n#include <iostream>\r\n#include <optional>\r\n#include <ranges>\r\n#include <string>\r\n#include <string_view>\r\n\r\n#include <string.h>\r\n\r\n#include <windows.h>\r\n\r\nusing namespace std::literals;\r\n\r\nauto win32_error()\r\n{\r\n\treturn std::runtime_error(std::format(\"Error 0x{:08X}, look it up\"sv, GetLastError()));\r\n};\r\n\r\nauto invalid_response()\r\n{\r\n\treturn std::runtime_error(\"Invalid response\");\r\n}\r\n\r\nauto invalid_response(const size_t Index)\r\n{\r\n\treturn std::runtime_error(std::format(\"Invalid response at #{}\"sv, Index));\r\n}\r\n\r\nauto printable(const std::wstring_view Str)\r\n{\r\n\tstd::wstring Printable;\r\n\tstd::ranges::transform(Str, std::back_inserter(Printable), [](wchar_t Char){ return Char < L' ' ? Char + L'\\u2400' : Char; });\r\n\treturn Printable;\r\n}\r\n\r\nvoid write(const std::wstring_view Str)\r\n{\r\n\tDWORD Written;\r\n\tif (!WriteConsole(GetStdHandle(STD_OUTPUT_HANDLE), Str.data(), static_cast<DWORD>(Str.size()), &Written, {}))\r\n\t\tthrow win32_error();\r\n}\r\n\r\nvoid write(const std::string_view Str)\r\n{\r\n\twrite(std::wstring(Str.begin(), Str.end()));\r\n}\r\n\r\nstd::wstring query(const std::wstring& Command)\r\n{\r\n\tconst auto Dummy = L\"\\x1b[c\"s;\r\n\r\n\twrite(Dummy + Command + Dummy);\r\n\r\n\t// Sleep(1);\r\n\r\n\tstd::wstring Response;\r\n\r\n\tstd::optional<size_t>\r\n\t\tFirstTokenPrefixPos,\r\n\t\tFirstTokenSuffixPos,\r\n\t\tSecondTokenPrefixPos,\r\n\t\tSecondTokenSuffixPos;\r\n\r\n\tconst auto\r\n\t\tTokenPrefix = L\"\\x1b[?\"sv,\r\n\t\tTokenSuffix = L\"c\"sv;\r\n\r\n\twhile (!SecondTokenSuffixPos)\r\n\t{\r\n\t\twchar_t ResponseBuffer[8192];\r\n\t\tDWORD ResponseSize;\r\n\r\n\t\tif (!ReadConsole(GetStdHandle(STD_INPUT_HANDLE), ResponseBuffer, ARRAYSIZE(ResponseBuffer),  &ResponseSize, {}))\r\n\t\t\tthrow win32_error();\r\n\r\n\t\tResponse.append(ResponseBuffer, ResponseSize);\r\n\r\n\t\tif (!FirstTokenPrefixPos)\r\n\t\t\tif (const auto Pos = Response.find(TokenPrefix); Pos != Response.npos)\r\n\t\t\t\tFirstTokenPrefixPos = Pos;\r\n\r\n\t\tif (FirstTokenPrefixPos && !FirstTokenSuffixPos)\r\n\t\t\tif (const auto Pos = Response.find(TokenSuffix, *FirstTokenPrefixPos + TokenPrefix.size()); Pos != Response.npos)\r\n\t\t\t\tFirstTokenSuffixPos = Pos;\r\n\r\n\t\tif (FirstTokenSuffixPos && !SecondTokenPrefixPos)\r\n\t\t\tif (const auto Pos = Response.find(TokenPrefix, *FirstTokenSuffixPos + TokenSuffix.size()); Pos != Response.npos)\r\n\t\t\t\tSecondTokenPrefixPos = Pos;\r\n\r\n\t\tif (SecondTokenPrefixPos && !SecondTokenSuffixPos)\r\n\t\t\tif (const auto Pos = Response.find(TokenSuffix, *SecondTokenPrefixPos + TokenPrefix.size()); Pos != Response.npos)\r\n\t\t\t\tSecondTokenSuffixPos = Pos;\r\n\t}\r\n\r\n\tResponse.resize(*SecondTokenPrefixPos);\r\n\tResponse.erase(0, *FirstTokenSuffixPos + TokenSuffix.size());\r\n\r\n\tif (Response.empty())\r\n\t\tthrow std::runtime_error(\"Query is not supported\"s);\r\n\r\n\treturn Response;\r\n}\r\n\r\nvoid set_modes()\r\n{\r\n\tconst auto\r\n\t\tIn = GetStdHandle(STD_INPUT_HANDLE),\r\n\t\tOut = GetStdHandle(STD_OUTPUT_HANDLE);\r\n\r\n\tDWORD InMode;\r\n\tif (!GetConsoleMode(In, &InMode))\r\n\t\tthrow win32_error();\r\n\r\n\tif (!SetConsoleMode(In, (InMode & ~(ENABLE_LINE_INPUT | ENABLE_ECHO_INPUT | ENABLE_QUICK_EDIT_MODE)) | ENABLE_MOUSE_INPUT | ENABLE_EXTENDED_FLAGS | ENABLE_VIRTUAL_TERMINAL_INPUT))\r\n\t\tthrow win32_error();\r\n\r\n\tDWORD OutMode;\r\n\tif (!GetConsoleMode(Out, &OutMode))\r\n\t\tthrow win32_error();\r\n\r\n\tif (!SetConsoleMode(Out, OutMode | ENABLE_PROCESSED_OUTPUT | ENABLE_VIRTUAL_TERMINAL_PROCESSING))\r\n\t\tthrow win32_error();\r\n}\r\n\r\nint main()\r\n{\r\n\ttry\r\n\t{\r\n\t\tset_modes();\r\n\r\n\t\tstd::wstring Str;\r\n\r\n\t\tfor (size_t i = 0; i != 256; ++i)\r\n\t\t\tstd::format_to(std::back_inserter(Str), L\"\\x1b]4;{};?\\x1b\\\\\"sv, i);\r\n\r\n\t\tfor (;;)\r\n\t\t{\r\n\t\t\tconst auto ReplyData = query(Str);\r\n\r\n\t\t\tstd::wstring_view Reply(ReplyData);\r\n\r\n\t\t\tif (!Reply.ends_with(L\"\\\\\"sv))\r\n\t\t\t\tthrow invalid_response();\r\n\r\n\t\t\tReply.remove_suffix(1);\r\n\r\n\t\t\tsize_t Index = 0;\r\n\r\n\t\t\tfor (const auto& Part: std::views::split(Reply, L\"\\\\\"sv))\r\n\t\t\t{\r\n\t\t\t\tstd::wstring_view ColorStr(Part.begin(), Part.end());\r\n\r\n\t\t\t\ttry\r\n\t\t\t\t{\r\n\t\t\t\t\tif (!ColorStr.starts_with(L\"\\x1b]4;\"sv))\r\n\t\t\t\t\t\tthrow invalid_response(Index);\r\n\r\n\t\t\t\t\tColorStr.remove_prefix(L\"\\x1b]4;\"sv.size());\r\n\r\n\t\t\t\t\twchar_t* Ptr;\r\n\t\t\t\t\tconst auto ReportedIndex = std::wcstol(ColorStr.data(), &Ptr, 10);\r\n\r\n\t\t\t\t\tif (Ptr == ColorStr.data())\r\n\t\t\t\t\t\tthrow invalid_response(Index);\r\n\r\n\t\t\t\t\tif (ReportedIndex != Index)\r\n\t\t\t\t\t\tthrow invalid_response(Index);\r\n\r\n\t\t\t\t\tColorStr.remove_prefix(Ptr - ColorStr.data());\r\n\r\n\t\t\t\t\tconst auto End = ColorStr.find(L\"\\x1b\"sv);\r\n\t\t\t\t\tif (End == ColorStr.npos)\r\n\t\t\t\t\t\tthrow invalid_response(Index);\r\n\r\n\t\t\t\t\tColorStr.remove_suffix(ColorStr.size() - End);\r\n\r\n\t\t\t\t\tif (!ColorStr.starts_with(L\";rgb:\"sv))\r\n\t\t\t\t\t\tthrow invalid_response(Index);\r\n\r\n\t\t\t\t\tColorStr.remove_prefix(L\";rgb:\"sv.size());\r\n\r\n\t\t\t\t\tif (ColorStr.size() != L\"ffff/ffff/ffff\"sv.size())\r\n\t\t\t\t\t\tthrow invalid_response(Index);\r\n\t\t\t\t}\r\n\t\t\t\tcatch (const std::runtime_error& e)\r\n\t\t\t\t{\r\n\t\t\t\t\tBeep(500, 200);\r\n\r\n\t\t\t\t\twrite(e.what());\r\n\t\t\t\t\twrite(L\": \"sv);\r\n\t\t\t\t\twrite(printable(ColorStr));\r\n\t\t\t\t\twrite(L\"\\n\"sv);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t++Index;\r\n\t\t\t}\r\n\r\n\t\t\tstd::wcout << L\"Everything is OK\"sv << std::endl;\r\n\r\n\t\t}\r\n\t}\r\n\tcatch (const std::exception& e)\r\n\t{\r\n\t\tstd::cerr << e.what() << std::endl;\r\n\t}\r\n}\r\n```\r\n</details>\r\n\r\n2. Run it in WT.\r\n \r\n\r\n\r\n### Expected Behavior\r\n\r\nThe program should print \"Everything is OK\" in a loop indefinitely and nothing else:\r\n```\r\nEverything is OK\r\nEverything is OK\r\nEverything is OK\r\nEverything is OK\r\n...and so on.\r\n```\r\n\r\n### Actual Behavior\r\n\r\nThe program prints \"Everything is OK\" a few times, then it detects errors due to missing bits in the reply, e.g.\r\n```\r\nEverything is OK\r\nEverything is OK\r\nEverything is OK\r\nEverything is OK\r\nInvalid response at #234: c/1c1c\u241b\r\nEverything is OK\r\n```\r\n\r\nEventually it deadlocks in `ReadConsole`.\r\n\r\nAdding a delay between sending the query and reading the reply improves the situation dramatically, but still not to 100% and it does not feel like the right thing to do: fixing issues with `Sleep(N)` never works in the long term.\r\n\r\nSplitting it to smaller queries also helps, but again, it is guesswork.\r\nOverall it is about 2700 characters to send and about 7000 to receive. It does not look like something humongous by modern standards.\r\n\r\nMoving the mouse or pressing keyboard keys noticeably increases the error rate. Again, only in WT.\r\n\n", "patch": "diff --git a/src/cascadia/TerminalControl/ControlCore.cpp b/src/cascadia/TerminalControl/ControlCore.cpp\nindex d8d975f667c..357b43c1aa1 100644\n--- a/src/cascadia/TerminalControl/ControlCore.cpp\n+++ b/src/cascadia/TerminalControl/ControlCore.cpp\n@@ -98,7 +98,7 @@ namespace winrt::Microsoft::Terminal::Control::implementation\n         Connection(connection);\r\n \r\n         _terminal->SetWriteInputCallback([this](std::wstring_view wstr) {\r\n-            _sendInputToConnection(wstr);\r\n+            _pendingResponses.append(wstr);\r\n         });\r\n \r\n         // GH#8969: pre-seed working directory to prevent potential races\r\n@@ -419,6 +419,17 @@ namespace winrt::Microsoft::Terminal::Control::implementation\n     // Return Value:\r\n     // - <none>\r\n     void ControlCore::_sendInputToConnection(std::wstring_view wstr)\r\n+    {\r\n+        _connection.WriteInput(winrt_wstring_to_array_view(wstr));\r\n+    }\r\n+\r\n+    // Method Description:\r\n+    // - Writes the given sequence as input to the active terminal connection,\r\n+    // Arguments:\r\n+    // - wstr: the string of characters to write to the terminal connection.\r\n+    // Return Value:\r\n+    // - <none>\r\n+    void ControlCore::SendInput(const std::wstring_view wstr)\r\n     {\r\n         if (wstr.empty())\r\n         {\r\n@@ -435,21 +446,10 @@ namespace winrt::Microsoft::Terminal::Control::implementation\n         }\r\n         else\r\n         {\r\n-            _connection.WriteInput(winrt_wstring_to_array_view(wstr));\r\n+            _sendInputToConnection(wstr);\r\n         }\r\n     }\r\n \r\n-    // Method Description:\r\n-    // - Writes the given sequence as input to the active terminal connection,\r\n-    // Arguments:\r\n-    // - wstr: the string of characters to write to the terminal connection.\r\n-    // Return Value:\r\n-    // - <none>\r\n-    void ControlCore::SendInput(const std::wstring_view wstr)\r\n-    {\r\n-        _sendInputToConnection(wstr);\r\n-    }\r\n-\r\n     bool ControlCore::SendCharEvent(const wchar_t ch,\r\n                                     const WORD scanCode,\r\n                                     const ::Microsoft::Terminal::Core::ControlKeyStates modifiers)\r\n@@ -485,7 +485,7 @@ namespace winrt::Microsoft::Terminal::Control::implementation\n         }\r\n         if (out)\r\n         {\r\n-            _sendInputToConnection(*out);\r\n+            SendInput(*out);\r\n             return true;\r\n         }\r\n         return false;\r\n@@ -643,7 +643,7 @@ namespace winrt::Microsoft::Terminal::Control::implementation\n         }\r\n         if (out)\r\n         {\r\n-            _sendInputToConnection(*out);\r\n+            SendInput(*out);\r\n             return true;\r\n         }\r\n         return false;\r\n@@ -662,7 +662,7 @@ namespace winrt::Microsoft::Terminal::Control::implementation\n         }\r\n         if (out)\r\n         {\r\n-            _sendInputToConnection(*out);\r\n+            SendInput(*out);\r\n             return true;\r\n         }\r\n         return false;\r\n@@ -1412,7 +1412,7 @@ namespace winrt::Microsoft::Terminal::Control::implementation\n         }\r\n \r\n         // It's important to not hold the terminal lock while calling this function as sending the data may take a long time.\r\n-        _sendInputToConnection(filtered);\r\n+        SendInput(filtered);\r\n \r\n         const auto lock = _terminal->LockForWriting();\r\n         _terminal->ClearSelection();\r\n@@ -2107,7 +2107,7 @@ namespace winrt::Microsoft::Terminal::Control::implementation\n                     // Sending input requires that we're unlocked, because\r\n                     // writing the input pipe may block indefinitely.\r\n                     const auto suspension = _terminal->SuspendLock();\r\n-                    _sendInputToConnection(buffer);\r\n+                    SendInput(buffer);\r\n                 }\r\n             }\r\n         }\r\n@@ -2164,6 +2164,12 @@ namespace winrt::Microsoft::Terminal::Control::implementation\n                 _terminal->Write(hstr);\r\n             }\r\n \r\n+            if (!_pendingResponses.empty())\r\n+            {\r\n+                _sendInputToConnection(_pendingResponses);\r\n+                _pendingResponses.clear();\r\n+            }\r\n+\r\n             // Start the throttled update of where our hyperlinks are.\r\n             const auto shared = _shared.lock_shared();\r\n             if (shared->outputIdle)\r\n@@ -2480,9 +2486,7 @@ namespace winrt::Microsoft::Terminal::Control::implementation\n         }\r\n         if (out && !out->empty())\r\n         {\r\n-            // _sendInputToConnection() asserts that we aren't in focus mode,\r\n-            // but window focus events are always fine to send.\r\n-            _connection.WriteInput(winrt_wstring_to_array_view(*out));\r\n+            _sendInputToConnection(*out);\r\n         }\r\n     }\r\n \r\ndiff --git a/src/cascadia/TerminalControl/ControlCore.h b/src/cascadia/TerminalControl/ControlCore.h\nindex 938d048243b..57484c0b7b7 100644\n--- a/src/cascadia/TerminalControl/ControlCore.h\n+++ b/src/cascadia/TerminalControl/ControlCore.h\n@@ -319,6 +319,7 @@ namespace winrt::Microsoft::Terminal::Control::implementation\n         winrt::com_ptr<ControlSettings> _settings{ nullptr };\r\n \r\n         std::shared_ptr<::Microsoft::Terminal::Core::Terminal> _terminal{ nullptr };\r\n+        std::wstring _pendingResponses;\r\n \r\n         // NOTE: _renderEngine must be ordered before _renderer.\r\n         //\r\ndiff --git a/src/cascadia/TerminalCore/TerminalApi.cpp b/src/cascadia/TerminalCore/TerminalApi.cpp\nindex 26daf24e5d2..82e06b03d4a 100644\n--- a/src/cascadia/TerminalCore/TerminalApi.cpp\n+++ b/src/cascadia/TerminalCore/TerminalApi.cpp\n@@ -24,7 +24,6 @@ void Terminal::ReturnResponse(const std::wstring_view response)\n {\r\n     if (_pfnWriteInput && !response.empty())\r\n     {\r\n-        const auto suspension = _readWriteLock.suspend();\r\n         _pfnWriteInput(response);\r\n     }\r\n }\r\n", "instance_id": "microsoft__terminal-17786", "clarity": 2, "difficulty": 0.65, "clarity_explanation": "\nThe problem statement is mostly clear in describing the issue of low reliability of VT (Virtual Terminal) replies in Windows Terminal (WT). It provides a detailed context about querying terminal state (specifically palette data) using escape sequences and highlights the discrepancy in behavior between WT and OpenConsole. The expected and actual behaviors are well-documented with examples of output, and the steps to reproduce the issue are provided with a complete C++ code snippet. Additionally, the statement mentions factors like the impact of mouse/keyboard input on error rates and the partial effectiveness of workarounds like delays or smaller queries. However, there are minor ambiguities: the problem does not explicitly define the exact conditions under which replies are missing (e.g., specific terminal settings or workload conditions), nor does it fully clarify the desired fix (e.g., whether the goal is to ensure 100% reliability or just reduce error frequency). Edge cases, such as behavior under high load or specific terminal configurations, are not specified. Thus, while the problem is valid and mostly clear, these missing details prevent it from being comprehensive.\n", "difficulty_explanation": "\nI assign a difficulty score of 0.65, placing this problem in the \"Hard\" category, due to the following factors:\n\n1. **Scope and Depth of Code Changes**: The code changes provided affect multiple files (`ControlCore.cpp`, `ControlCore.h`, and `TerminalApi.cpp`) within the Windows Terminal codebase, which is a complex, multi-layered system. The modifications involve altering how input and responses are handled, specifically by introducing a buffering mechanism (`_pendingResponses`) and adjusting the flow of data through the terminal's input/output pipeline. While the changes are not extensive in terms of lines of code, they impact critical components related to terminal input processing and response handling, requiring a good understanding of the system's architecture to avoid introducing new issues.\n\n2. **Number of Technical Concepts**: Solving this problem requires familiarity with several technical concepts, including Windows Terminal's internal architecture (e.g., how `ControlCore` and `TerminalApi` interact), Virtual Terminal (VT) escape sequence handling, asynchronous input/output processing, and thread safety (as seen in the removal of a lock suspension in `TerminalApi.cpp`). Additionally, knowledge of Windows API calls (e.g., `ReadConsole`, `WriteConsole`) and their behavior under different conditions is necessary to understand the root cause of the missing replies. These concepts are moderately complex and require experience with low-level terminal emulation and system programming.\n\n3. **Potential Edge Cases and Error Handling**: The problem statement highlights that replies are often missing, especially under conditions like mouse or keyboard input, suggesting that race conditions or buffering issues might be at play. The code changes attempt to address this by buffering responses (`_pendingResponses`) and ensuring they are sent at the right time, but this introduces potential new edge cases, such as buffer overflow, timing issues, or interactions with other terminal events. Error handling logic in the modified code is minimal, but ensuring reliability across all scenarios (e.g., high input rates, different terminal configurations) adds to the complexity.\n\n4. **Overall Complexity**: The issue lies in a nuanced area of terminal emulation, where reliability of VT replies depends on subtle timing and synchronization issues. While the provided code changes offer a potential solution, validating and refining this fix requires deep debugging skills and an understanding of the broader impact on terminal behavior. The problem does not reach the \"Very Hard\" category (0.8-1.0) because it does not involve advanced domain-specific knowledge (e.g., distributed systems or novel algorithms), but it is still challenging due to the need to navigate a complex codebase and ensure robust behavior under varied conditions.\n\nIn summary, this problem requires a solid grasp of terminal internals, careful handling of input/output synchronization, and consideration of edge cases, making it a hard but not insurmountable challenge for an experienced developer.\n", "clarity_label": 1, "difficulty_label": 1, "human_clarity": -1, "human_difficulty": -1}
{"problem_statement": "Add color scheme for EGA (the \"16 color ANSI\" palette)\n# Description of the new feature/enhancement\r\nThe 16 color standard EGA palette used on PCs back in the day was a very defining look (and still in use today for the correct look of DOS CLI/TUI programs and ANSI art etc), and I think it should definitely be a default colorscheme that comes with Windows Terminal.\r\n\r\n# Proposed technical implementation details (optional)\r\n\r\nAdd a default color scheme (call it \"EGA\" or \"ANSI\" or \"MS-DOS\" or whatever):\r\n\r\n```json\r\n{\r\n    \"background\": \"#000000\",\r\n    \"black\": \"#000000\",\r\n    \"blue\": \"#0000AA\",\r\n    \"brightBlack\": \"#555555\",\r\n    \"brightBlue\": \"#5555FF\",\r\n    \"brightCyan\": \"#55FFFF\",\r\n    \"brightGreen\": \"#55FF55\",\r\n    \"brightPurple\": \"#FF55FF\",\r\n    \"brightRed\": \"#FF5555\",\r\n    \"brightWhite\": \"#FFFFFF\",\r\n    \"brightYellow\": \"#FFFF55\",\r\n    \"cursorColor\": \"#00AA00\",\r\n    \"cyan\": \"#00AAAA\",\r\n    \"foreground\": \"#AAAAAA\",\r\n    \"green\": \"#00AA00\",\r\n    \"name\": \"16 Color ANSI\",\r\n    \"purple\": \"#AA00AA\",\r\n    \"red\": \"#AA0000\",\r\n    \"selectionBackground\": \"#FFFFFF\",\r\n    \"white\": \"#AAAAAA\",\r\n    \"yellow\": \"#AA5500\"\r\n}\r\n```\n", "patch": "diff --git a/src/cascadia/TerminalSettingsModel/defaults.json b/src/cascadia/TerminalSettingsModel/defaults.json\nindex 360f37afaad..ae8ed369ff6 100644\n--- a/src/cascadia/TerminalSettingsModel/defaults.json\n+++ b/src/cascadia/TerminalSettingsModel/defaults.json\n@@ -281,6 +281,75 @@\n             \"brightPurple\": \"#AD7FA8\",\r\n             \"brightCyan\": \"#34E2E2\",\r\n             \"brightWhite\": \"#EEEEEC\"\r\n+        },\r\n+        {\r\n+            \"name\": \"Dark+\",\r\n+            \"foreground\": \"#cccccc\",\r\n+            \"background\": \"#1e1e1e\",\r\n+            \"cursorColor\": \"#808080\",\r\n+            \"selectionBackground\": \"#ffffff\",\r\n+            \"black\": \"#000000\",\r\n+            \"red\": \"#cd3131\",\r\n+            \"green\": \"#0dbc79\",\r\n+            \"yellow\": \"#e5e510\",\r\n+            \"blue\": \"#2472c8\",\r\n+            \"purple\": \"#bc3fbc\",\r\n+            \"cyan\": \"#11a8cd\",\r\n+            \"white\": \"#e5e5e5\",\r\n+            \"brightBlack\": \"#666666\",\r\n+            \"brightRed\": \"#f14c4c\",\r\n+            \"brightGreen\": \"#23d18b\",\r\n+            \"brightYellow\": \"#f5f543\",\r\n+            \"brightBlue\": \"#3b8eea\",\r\n+            \"brightPurple\": \"#d670d6\",\r\n+            \"brightCyan\": \"#29b8db\",\r\n+            \"brightWhite\": \"#e5e5e5\"\r\n+        },\r\n+        {\r\n+            \"background\": \"#000000\",\r\n+            \"black\": \"#000000\",\r\n+            \"blue\": \"#0000AA\",\r\n+            \"brightBlack\": \"#555555\",\r\n+            \"brightBlue\": \"#5555FF\",\r\n+            \"brightCyan\": \"#55FFFF\",\r\n+            \"brightGreen\": \"#55FF55\",\r\n+            \"brightPurple\": \"#FF55FF\",\r\n+            \"brightRed\": \"#FF5555\",\r\n+            \"brightWhite\": \"#FFFFFF\",\r\n+            \"brightYellow\": \"#FFFF55\",\r\n+            \"cursorColor\": \"#00AA00\",\r\n+            \"cyan\": \"#00AAAA\",\r\n+            \"foreground\": \"#AAAAAA\",\r\n+            \"green\": \"#00AA00\",\r\n+            \"name\": \"CGA\",\r\n+            \"purple\": \"#AA00AA\",\r\n+            \"red\": \"#AA0000\",\r\n+            \"selectionBackground\": \"#FFFFFF\",\r\n+            \"white\": \"#AAAAAA\",\r\n+            \"yellow\": \"#AA5500\"\r\n+        },\r\n+        {\r\n+            \"background\": \"#000000\",\r\n+            \"black\": \"#000000\",\r\n+            \"blue\": \"#0000AA\",\r\n+            \"brightBlack\": \"#555555\",\r\n+            \"brightBlue\": \"#5555FF\",\r\n+            \"brightCyan\": \"#55FFFF\",\r\n+            \"brightGreen\": \"#55FF55\",\r\n+            \"brightPurple\": \"#FF55FF\",\r\n+            \"brightRed\": \"#FF5555\",\r\n+            \"brightWhite\": \"#FFFFFF\",\r\n+            \"brightYellow\": \"#FFFF55\",\r\n+            \"cursorColor\": \"#00AA00\",\r\n+            \"cyan\": \"#00AAAA\",\r\n+            \"foreground\": \"#AAAAAA\",\r\n+            \"green\": \"#00AA00\",\r\n+            \"name\": \"IBM 5153\",\r\n+            \"purple\": \"#AA00AA\",\r\n+            \"red\": \"#AA0000\",\r\n+            \"selectionBackground\": \"#FFFFFF\",\r\n+            \"white\": \"#AAAAAA\",\r\n+            \"yellow\": \"#C47E00\"\r\n         }\r\n     ],\r\n     \"themes\": [\r\n", "instance_id": "microsoft__terminal-16953", "clarity": 2, "difficulty": 0.1, "clarity_explanation": "The problem statement is mostly clear in its intent to add a new color scheme for the EGA (16 color ANSI palette) to the Windows Terminal. The goal is well-defined, and the proposed implementation is provided in the form of a JSON configuration for the color scheme. However, there are minor ambiguities and missing details. For instance, the problem statement suggests naming the scheme \"EGA,\" \"ANSI,\" or \"MS-DOS,\" but the code changes use \"CGA\" and \"IBM 5153,\" which introduces a discrepancy. Additionally, there is no mention of whether this addition requires any specific validation, compatibility checks with existing schemes, or handling of potential conflicts. Edge cases, such as how the terminal should behave if the color scheme is not supported by certain environments, are not addressed. Overall, while the core requirement is clear, these minor gaps prevent it from being comprehensive.", "difficulty_explanation": "The difficulty of this task is very low, as it involves a straightforward addition of new color scheme entries to a JSON configuration file within the codebase. The scope of the code change is minimal, confined to a single file (`defaults.json`), and does not require understanding complex interactions between different parts of the codebase or modifying the system's architecture. The amount of code change is small, essentially adding static data with no logic or computation involved. No advanced programming concepts, algorithms, or domain-specific knowledge are required beyond basic familiarity with JSON format and the structure of the configuration file. There are no edge cases or error handling requirements mentioned in the problem statement, and the code changes do not introduce any logic that would necessitate such considerations. This task falls into the \"very easy\" category, as it is a simple modification akin to updating constants or adding predefined data.", "clarity_label": 1, "difficulty_label": 1, "human_clarity": -1, "human_difficulty": -1}
